<div class="container">

<table style="width: 100%;"><tr>
<td>optim_apsim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Optimize parameters in an APSIM simulation</h2>

<h3>Description</h3>

<p>It is a wrapper for running APSIM and optimizing parameters using <code>optim</code>
</p>
<p>Friendly printing of optim_apsim
</p>
<p>Variance-Covariance for an ‘optim_apsim’ object
</p>
<p>Parameter estimates for an ‘optim_apsim’ object
</p>
<p>Confidence intervals for parameter estimates for an ‘optim_apsim’ object
</p>


<h3>Usage</h3>

<pre><code class="language-R">optim_apsim(
  file,
  src.dir = ".",
  crop.file,
  parm.paths,
  data,
  type = c("optim", "nloptr", "mcmc", "ucminf"),
  weights,
  index = "Date",
  parm.vector.index,
  xml.parm,
  ...
)

## S3 method for class 'optim_apsim'
print(x, ..., digits = 3, level = 0.95)

## S3 method for class 'optim_apsim'
vcov(object, ..., scaled = TRUE)

## S3 method for class 'optim_apsim'
coef(object, ..., scaled = FALSE)

## S3 method for class 'optim_apsim'
confint(object, parm, level = 0.95, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>file name to be run (the extension .apsim is optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>src.dir</code></td>
<td>
<p>directory containing the .apsim file to be run (defaults to the current directory)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crop.file</code></td>
<td>
<p>name of auxiliary xml file where parameters are stored. If this is missing, it is 
assumed that the parameters to be edited are in the main simulation file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parm.paths</code></td>
<td>
<p>absolute paths of the coefficients to be optimized. 
It is recommended that you use <code>inspect_apsim</code> or <code>inspect_apsim_xml</code>  for this.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame with the observed data. By default is assumes there is a 'Date' column for the index.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of optimization. For now, <code>optim</code> and, if available, <code>nloptr</code> or 
‘mcmc’ through <code>runMCMC</code>. Option ‘ucminf’ uses the <code>ucminf</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Weighting method or values for computing the residual sum of squares (see Note).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>Index for filtering APSIM output. ‘Date’ is currently used. (I have not tested how well it works using anything other than Date).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parm.vector.index</code></td>
<td>
<p>Index to optimize a specific element of a parameter vector. At the moment it is
possible to only edit one element at a time. This is because there is a conflict when generating multiple
elements in the candidate vector for the same parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xml.parm</code></td>
<td>
<p>optional logical vector used when optimizing parameters which are both in the .apsim file and in the ‘crop.file’.
If ‘crop.file’ is missing it is assumed that the paramters to be optimized are in the .apsim file. If ‘crop.file’ is
not missing it is assumed that they are in the ‘crop.file’. If the parameters are in both, this needs to be specified in 
this argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments (none used at the moment)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>object of class ‘optim_apsim’</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits to round up the output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>confidence level (default is 0.95)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>object of class ‘optim_apsim’</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaled</code></td>
<td>
<p>whether to return the scaled or unscaled estimates
(TRUE in the optimized scale, FALSE in the original scale)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parm</code></td>
<td>
<p>parameter to select (it can be a regular expression)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Simple optimization for APSIM Classic
</p>
<p>* This function assumes that you want to optimize parameters which are stored in
an auxiliary XML file. These are typically crop or cultivar specific parameters.
However, it is possible to optimize parameters present in the main simulation
file.
</p>
<p>* Only one observation per day is allowed in the data.
</p>
<p>* Given how APSIM Classic works, this can only be run when the main simulation
file is in the current directory and the crop file (or XML) 
should be in the same directory as the main simulation.
</p>
<p>* The initial values for the optimization should be the ones in the stored
crop parameter file.
</p>
<p>* It is suggested that you keep a backup of the original file. This function
will edit and overwrite the file during the optimization. 
</p>
<p>* When you use the parm.vector.index you cannot edit two separate elements of
a vector at the same time. This should be used to target a single element of 
a vector only.
</p>
<p>* Internally, the optimization is done around the scaled value of the initial parameter
values. A value of 1 would correspond to the inital value of the parameter. 
The ‘lower’ and ‘upper’ (or ‘ub’ and ‘lb’) are also scaled 
to the initial values of the parameters. So, for example, if your initial value is 20 
and you provide an upper bound of 5, it means that the actual upper value that you are allowing for is 100.
</p>


<h3>Value</h3>

<p>object of class ‘optim_apsim’, but really just a list with results from optim and additional information.
</p>
<p>prints to console
</p>
<p>it returns the variance-covariance matrix for an object of class ‘optim_apsim’.
</p>
<p>a numeric vector with the value of the parameter estimates.
</p>
<p>a matrix with lower and upper limits and the point estimate (coef)
</p>


<h3>Note</h3>

<p>When computing the objective function (residual sum-of-squares) different variables are combined.
It is common to weight them since they are in different units. If the argument weights is not supplied
no weighting is applied. It can be ‘mean’, ‘var’ or a numeric vector of appropriate length.
</p>
<p>This in the scale of the optimized parameters which are
scaled to be around 1.
</p>


</div>