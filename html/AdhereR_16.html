<div class="container">

<table style="width: 100%;"><tr>
<td>compute.treatment.episodes</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute Treatment Episodes.</h2>

<h3>Description</h3>

<p>For a given event (prescribing or dispensing) database, compute the treatment
episodes for each patient in various scenarious.
</p>


<h3>Usage</h3>

<pre><code class="language-R">compute.treatment.episodes(
  data,
  ID.colname = NA,
  event.date.colname = NA,
  event.duration.colname = NA,
  event.daily.dose.colname = NA,
  medication.class.colname = NA,
  carryover.within.obs.window = TRUE,
  carry.only.for.same.medication = TRUE,
  consider.dosage.change = TRUE,
  medication.change.means.new.treatment.episode = TRUE,
  dosage.change.means.new.treatment.episode = FALSE,
  maximum.permissible.gap = 90,
  maximum.permissible.gap.unit = c("days", "weeks", "months", "years", "percent")[1],
  maximum.permissible.gap.append.to.episode = FALSE,
  followup.window.start = 0,
  followup.window.start.unit = c("days", "weeks", "months", "years")[1],
  followup.window.duration = 365 * 2,
  followup.window.duration.unit = c("days", "weeks", "months", "years")[1],
  event.interval.colname = "event.interval",
  gap.days.colname = "gap.days",
  return.mapping.events.episodes = FALSE,
  date.format = "%m/%d/%Y",
  parallel.backend = c("none", "multicore", "snow", "snow(SOCK)", "snow(MPI)",
    "snow(NWS)")[1],
  parallel.threads = "auto",
  suppress.warnings = FALSE,
  suppress.special.argument.checks = FALSE,
  return.data.table = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <em><code>data.frame</code></em> containing the events used to
compute the CMA. Must contain, at a minimum, the patient unique ID, the event
date and duration, and might also contain the daily dosage and medication
type (the actual column names are defined in the following four parameters);
the <code>CMA</code> constructors call this parameter <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ID.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in <code>data</code>
containing the unique patient ID, or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event.date.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the start date of the event (in the format given in
the <code>date.format</code> parameter), or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event.duration.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the event duration (in days), or <code>NA</code> if not
defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event.daily.dose.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the prescribed daily dose, or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>medication.class.colname</code></td>
<td>
<p>A <em>string</em>, the name of the column in
<code>data</code> containing the classes/types/groups of medication, or <code>NA</code>
if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>carryover.within.obs.window</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> consider
the carry-over within the observation window, or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>carry.only.for.same.medication</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the
carry-over applies only across medication of the same type, or <code>NA</code> if
not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>consider.dosage.change</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> the carry-over
is adjusted to reflect changes in dosage, or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>medication.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should
a change in medication automatically start a new treatment episode?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dosage.change.means.new.treatment.episode</code></td>
<td>
<p><em>Logical</em>, should
a change in dosage automatically start a new treatment episode?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maximum.permissible.gap</code></td>
<td>
<p>The <em>number</em> of units given by
<code>maximum.permissible.gap.unit</code> representing the maximum duration of
permissible gaps between treatment episodes (can also be a percent, see
<code>maximum.permissible.gap.unit</code> for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maximum.permissible.gap.unit</code></td>
<td>
<p>can be either <em>"days"</em>,
<em>"weeks"</em>, <em>"months"</em>, <em>"years"</em> or <em>"percent"</em>, and
represents the time units that <code>maximum.permissible.gap</code> refers to;
if <em>percent</em>, then  <code>maximum.permissible.gap</code> is interpreted as a
percent (can be greater than 100%) of the duration of the current
prescription.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maximum.permissible.gap.append.to.episode</code></td>
<td>
<p>a <em>logical</em> value
specifying of the <code>maximum.permissible.gap</code> should be append at the
end of an episode with a gap larger than the <code>maximum.permissible.gap</code>;
<code>FALSE</code> (the default) mean no addition, while <code>TRUE</code> mean that the
full <code>maximum.permissible.gap</code> is added.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup.window.start</code></td>
<td>
<p>If a <em><code>Date</code></em> object it is the actual
start date of the follow-up window; if a <em>string</em> it is the name of the
column in <code>data</code> containing the start date of the follow-up window; if a
<em>number</em> it is the number of time units defined in the
<code>followup.window.start.unit</code> parameter after the begin of the
participant's first event; or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup.window.start.unit</code></td>
<td>
<p>can be either <em>"days"</em>, <em>"weeks"</em>,
<em>"months"</em> or <em>"years"</em>, and represents the time units that
<code>followup.window.start</code> refers to (when a number), or <code>NA</code> if not
defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup.window.duration</code></td>
<td>
<p>a <em>number</em> representing the duration of
the follow-up window in the time units given in
<code>followup.window.duration.unit</code>, or <code>NA</code> if not defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>followup.window.duration.unit</code></td>
<td>
<p>can be either <em>"days"</em>,
<em>"weeks"</em>, <em>"months"</em> or <em>"years"</em>, and represents the time
units that <code>followup.window.duration</code> refers to, or <code>NA</code> if not
defined.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event.interval.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created
column storing the number of days between the start of the current event and
the start of the next one; the default value "event.interval" should be
changed only if there is a naming conflict with a pre-existing
"event.interval" column in <code>event.info</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gap.days.colname</code></td>
<td>
<p>A <em>string</em>, the name of a newly-created column
storing the number of days when medication was not available (i.e., the
"gap days"); the default value "gap.days" should be changed only if there is
a naming conflict with a pre-existing "gap.days" column in <code>event.info</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.mapping.events.episodes</code></td>
<td>
<p>A <em>Logical</em>, if <code>TRUE</code> then
the mapping between events and episodes is returned as the attribute
<code>mapping.episodes.to.events</code>, which is a <code>data.table</code> giving, for
each episode, the events that belong to it (an event is given by its row
number in the <code>data</code>). Please note that the episodes returned are quite
"generic" (e.g., they include all the events in the FUW), because which events
will be actually used in the computation of a <code>CMA_per_episode</code> depend on
which simple CMA is used (see also <code>CMA_per_episode</code>), and should be used
with care (we recommend using the mappings given by <code>CMA_per_episode</code>
instead).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date.format</code></td>
<td>
<p>A <em>string</em> giving the format of the dates used in the
<code>data</code> and the other parameters; see the <code>format</code> parameters of the
<code>as.Date</code> function for details (NB, this concerns only the
dates given as strings and not as <code>Date</code> objects).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel.backend</code></td>
<td>
<p>Can be "none" (the default) for single-threaded
execution, "multicore"  (using <code>mclapply</code> in package <code>parallel</code>)
for multicore processing (NB. not currently implemented on MS Windows and
automatically falls back on "snow" on this platform),  or "snow",
"snow(SOCK)" (equivalent to "snow"), "snow(MPI)" or "snow(NWS)" specifying
various types of SNOW clusters (can be on the local machine or more complex
setups â€“ please see the documentation of package <code>snow</code> for details;
the last two require packages <code>Rmpi</code> and <code>nws</code>, respectively, not
automatically installed with <code>AdhereR</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel.threads</code></td>
<td>
<p>Can be "auto" (for <code>parallel.backend</code> ==
"multicore", defaults to the number of cores in the system as given by
<code>options("cores")</code>, while for <code>parallel.backend</code> == "snow",
defaults to 2), a strictly positive integer specifying the number of parallel
threads, or a more complex specification of the SNOW cluster nodes for
<code>parallel.backend</code> == "snow" (see the documentation of package
<code>snow</code> for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suppress.warnings</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> don't show any
warnings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suppress.special.argument.checks</code></td>
<td>
<p><em>Logical</em> parameter for internal
use; if <code>FALSE</code> (default) check if the important columns in the <code>data</code>
have some of the reserved names, if <code>TRUE</code> this check is not performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.data.table</code></td>
<td>
<p><em>Logical</em>, if <code>TRUE</code> return a
<code>data.table</code> object, otherwise a <code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>extra arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This should in general not be called directly by the user, but is provided as
a basis for the extension to new CMAs.
</p>
<p>For the last treatment episode, the gap is considered only when longer than
the maximum permissible gap.
Please note the following:
</p>

<ul>
<li>
<p> episode starts at first medication event for a particular medication,
</p>
</li>
<li>
<p> episode ends on the day when the last supply of that medication
finished or if a period longer than the permissible gap preceded the next
medication event, or at the end of the FUW,
</p>
</li>
<li>
<p> end episode gap days represents either the number of days after the
end of the treatment episode (if medication changed, or if a period longer
than the permissible gap preceded the next medication event) or at the
end of (and within) the episode, i.e. the number of days after the last
supply finished (if no other medication event followed until the end of the
FUW),
</p>
</li>
<li>
<p> the duration of the episode is the interval between the episode start
and episode end (and may include the gap days at the end, in the latter
condition described above),
</p>
</li>
<li>
<p> the number of gap days after the end of the episode can be computed
as all values larger than the permissible gap and 0 otherwise,
</p>
</li>
<li>
<p> if medication change starts new episode, then previous episode ends
when the last supply is finished (irrespective of the length of gap compared
to a maximum permissible gap); any days before the date of the new
medication supply are considered a gap; this maintains consistency with gaps
between episodes (whether they are constructed based on the maximum
permissible gap rule or the medication change rule).
</p>
</li>
</ul>
<h3>Value</h3>

<p>A <code>data.frame</code> or <code>data.table</code> with the following columns
(or <code>NULL</code> if no
treatment episodes could be computed):
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>episode.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>episode.start</code> the episode start date.
</p>
</li>
<li> <p><code>end.episode.gap.days</code> the corresponding gap days of the last event in this episode.
</p>
</li>
<li> <p><code>episode.duration</code> the episode duration in days.
</p>
</li>
<li> <p><code>episode.end</code> the episode end date.
</p>
</li>
</ul>
<p>If <code>mapping.episodes.to.events</code> is <code>TRUE</code>, then this also has an
<em>attribute</em> <code>mapping.episodes.to.events</code> that gives the mapping between
episodes and events as a <code>data.table</code> with the following columns:
</p>

<ul>
<li> <p><code>patid</code> the patient ID.
</p>
</li>
<li> <p><code>episode.ID</code> the episode unique ID (increasing sequentially).
</p>
</li>
<li> <p><code>event.index.in.data</code> the event given by its row number in the <code>data</code>.
</p>
</li>
</ul>
</div>