<div class="container">

<table style="width: 100%;"><tr>
<td>derive_param_clinbenefit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Adds a Parameter for Clinical Benefit</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt="[Superseded]"></a> The <code>derive_param_clinbenefit()</code> function
has been superseded in favor of <code>derive_extreme_event()</code>.
</p>
<p>Adds a parameter for clinical benefit/disease control
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_param_clinbenefit(
  dataset,
  dataset_adsl,
  filter_source,
  source_resp,
  source_pd = NULL,
  source_datasets,
  reference_date,
  ref_start_window,
  aval_fun,
  clinben_vals = c("CR", "PR", "SD", "NON-CR/NON-PD"),
  set_values_to,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset. This is the dataset to which the clinical
benefit rate parameter will be added.
</p>
<p>The variables <code>PARAMCD</code>, <code>AVALC</code>, <code>ADT</code>, and those specified by the <code>subject_keys</code>
parameter and the <code>reference_date</code> parameter are expected.
</p>
<p>After applying <code>filter_source</code> and/or <code>source_pd</code> the variable <code>ADT</code> and the
variables specified by <code>subject_keys</code> must be a unique key of the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset_adsl</code></td>
<td>
<p>ADSL input dataset.
</p>
<p>The variables specified for <code>subject_keys</code>is expected. For each subject of
the specified dataset a new observation is added to the input dataset. Variables
in <code>dataset_adsl</code> that also appear in <code>dataset</code> will be populated with the
appropriate subject-specific value for these new observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_source</code></td>
<td>
<p>Filter condition in <code>dataset</code> that represents records
for overall disease response assessment for a subject at a given timepoint,
e.g. <code>PARAMCD == "OVR"</code> or <code>PARAMCD == "OVRLRESP"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source_resp</code></td>
<td>
<p>A <code>date_source</code> object specifying the dataset, date variable,
and filter condition used to identify response status.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source_pd</code></td>
<td>
<p>A <code>date_source</code> object specifying the dataset, date variable,
and filter condition used to identify disease progression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source_datasets</code></td>
<td>
<p>A named list of data sets is expected.
</p>
<p>The list must contain the names provided by the <code>dataset_name</code> field of the
<code>date_source()</code> objects specified for <code>source_pd</code> and <code>source_resp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference_date</code></td>
<td>
<p>Name of variable representing the index date for
<code>ref_start_window</code>. A variable providing a date. An unquoted symbol is expected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_start_window</code></td>
<td>
<p>Integer representing number of days from <code>reference_date</code>
that must elapse before an evaluable non-PD assessment counts toward determining
clinical benefit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aval_fun</code></td>
<td>
<p><em>Deprecated</em>, please use <code>set_values_to</code> instead.
</p>
<p>Function to map character analysis value (<code>AVALC</code>) to numeric analysis value
(<code>AVAL</code>)
</p>
<p>The (first) argument of the function must expect a character vector and the
function must return a numeric vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clinben_vals</code></td>
<td>
<p>A vector of response values to be considered when determining
clinical benefit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set_values_to</code></td>
<td>
<p>A named list returned by <code>exprs()</code> containing new variables
and their static value to be populated for the clinical benefit rate parameter
records, e.g. <code>exprs(PARAMCD = "CBR", PARAM = "Clinical Benefit Rate")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subject_keys</code></td>
<td>
<p>A named list returned by <code>exprs()</code> containing variables
used to uniquely identify subjects.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Clinical benefit/disease control is first identified by looking for subjects
having response status, and then derived for subjects that have at least one
evaluable non-PD response assessment prior to first PD (Progressive Disease)
(i.e., responses inclusive of <code>CR</code>, <code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>) and after a specified
amount of time from a reference date (<code>ref_start_window</code>).
</p>
<p>Note: The user input values they wish to include when determining
clinical benefit using the argument <code>clinben_vals</code>. The default values for this are
<code>CR</code>, <code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>, as listed above. In the below example,
eligible values be limited to <code>CR</code> and <code>PR</code>.
</p>
<p>Example: <code>clinben_vals &lt;- c("CR", "PR")</code>
</p>

<ol>
<li>
<p> The input dataset (<code>dataset</code>) is restricted to the observations matching
<code>filter_source</code> and to observations before or at the date specified by <code>source_pd</code>.
</p>
</li>
<li>
<p> This dataset is further restricted to include user-generated response
assessments from <code>clinben_vals</code> or include response assessments of <code>CR</code>,
<code>PR</code>, <code>SD</code>, and <code>NON-CR/NON-PD</code>, exclude missing response assessments, and
exclude those less than <code>ref_start_window</code> after <code>reference_date</code>. The earliest
assessment by <code>ADT</code> is then selected.
</p>
</li>
<li>
<p> The dataset identified by <code>dataset</code> in <code>source_resp</code> is restricted
according to its <code>filter</code> argument. The variable corresponding to the <code>date</code>
parameter of <code>source_resp</code> is considered together with <code>ADT</code> from the
previous step.
</p>
</li>
<li>
<p> For the observations being added to <code>dataset</code>, <code>ADT</code> is set to the earlier
of the first assessment date representing an evaluable non-PD assessment prior
to first PD, or the date representing the start of response.
</p>
</li>
<li>
<p> For the observations being added to <code>dataset</code>, <code>AVALC</code> is set to
</p>

<ul>
<li> <p><code>Y</code> for those subjects in the <code>dataset</code> meeting the criteria for clinical
benefit above
</p>
</li>
<li> <p><code>N</code> for subjects not meeting the clinical benefit criteria in <code>dataset</code>
or the dataset identified in <code>source_resp</code>
</p>
</li>
<li> <p><code>N</code> for subjects present in <code>dataset_adsl</code> but not present in <code>dataset</code>
or the dataset identified in <code>source_resp</code>.
</p>
</li>
</ul>
</li>
<li> <p><code>AVAL</code> is derived using <code>AVALC</code> as input to the function specified in
<code>aval_fun</code>.
</p>
</li>
<li>
<p> The variables specified by <code>set_values_to</code> are added to the new observations
with values equal to the values specified in the same.
</p>
</li>
<li>
<p> The new observations are added to <code>dataset</code>. Variables held in common
between <code>dataset</code> and <code>dataset_adsl</code> are kept for the new observations, and
are populated with their values from <code>dataset_adsl</code>.
</p>
</li>
</ol>
<h3>Value</h3>

<p>The input dataset with a new parameter for clinical benefit
</p>


<h3>Author(s)</h3>

<p>Andrew Smith
</p>


<h3>See Also</h3>

<p>Other superseded: 
<code>derive_param_bor()</code>,
<code>derive_param_confirmed_bor()</code>,
<code>derive_param_confirmed_resp()</code>,
<code>derive_param_response()</code>,
<code>filter_pd()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(lubridate)
library(dplyr)
library(admiral)

adsl &lt;- tibble::tribble(
  ~USUBJID, ~TRTSDT,
  "01",     ymd("2020-01-14"),
  "02",     ymd("2021-02-16"),
  "03",     ymd("2021-03-09"),
  "04",     ymd("2021-04-21")
) %&gt;%
  mutate(STUDYID = "AB42")

adrs &lt;- tibble::tribble(
  ~USUBJID, ~PARAMCD, ~AVALC, ~ADT,
  "01",     "RSP",    "Y",    ymd("2021-03-14"),
  "02",     "RSP",    "N",    ymd("2021-05-07"),
  "03",     "RSP",    "N",    NA,
  "04",     "RSP",    "N",    NA,
  "01",     "PD",     "N",    NA,
  "02",     "PD",     "Y",    ymd("2021-05-07"),
  "03",     "PD",     "N",    NA,
  "04",     "PD",     "N",    NA,
  "01",     "OVR",    "SD",   ymd("2020-03-14"),
  "01",     "OVR",    "PR",   ymd("2021-04-13"),
  "02",     "OVR",    "PR",   ymd("2021-04-08"),
  "02",     "OVR",    "PD",   ymd("2021-05-07"),
  "02",     "OVR",    "CR",   ymd("2021-06-20"),
  "03",     "OVR",    "SD",   ymd("2021-03-30"),
  "04",     "OVR",    "NE",   ymd("2021-05-21"),
  "04",     "OVR",    "NA",   ymd("2021-06-30"),
  "04",     "OVR",    "NE",   ymd("2021-07-24"),
  "04",     "OVR",    "ND",   ymd("2021-09-04"),
) %&gt;%
  mutate(STUDYID = "AB42", ANL01FL = "Y") %&gt;%
  derive_vars_merged(
    dataset_add = adsl,
    by_vars = exprs(STUDYID, USUBJID),
    new_vars = exprs(TRTSDT)
  )

pd &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "PD" &amp; AVALC == "Y" &amp; ANL01FL == "Y"
)

resp &lt;- date_source(
  dataset_name = "adrs",
  date = ADT,
  filter = PARAMCD == "RSP" &amp; AVALC == "Y" &amp; ANL01FL == "Y"
)

derive_param_clinbenefit(
  dataset = adrs,
  dataset_adsl = adsl,
  filter_source = PARAMCD == "OVR" &amp; ANL01FL == "Y",
  source_resp = resp,
  source_pd = pd,
  source_datasets = list(adrs = adrs),
  reference_date = TRTSDT,
  ref_start_window = 28,
  set_values_to = exprs(
    PARAMCD = "CBR"
  )
) %&gt;%
  filter(PARAMCD == "CBR")
</code></pre>


</div>