<div class="container">

<table style="width: 100%;"><tr>
<td>az_storage</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Storage account resource class</h2>

<h3>Description</h3>

<p>Class representing a storage account, exposing methods for working with it.
</p>


<h3>Methods</h3>

<p>The following methods are available, in addition to those provided by the AzureRMR::az_resource class:
</p>

<ul>
<li> <p><code>new(...)</code>: Initialize a new storage object. See 'Initialization'.
</p>
</li>
<li> <p><code>list_keys()</code>: Return the access keys for this account.
</p>
</li>
<li> <p><code>get_account_sas(...)</code>: Return an account shared access signature (SAS). See 'Creating a shared access signature' below.
</p>
</li>
<li> <p><code>get_user_delegation_key(...)</code>: Returns a key that can be used to construct a user delegation SAS.
</p>
</li>
<li> <p><code>get_user_delegation_sas(...)</code>: Return a user delegation SAS.
</p>
</li>
<li> <p><code>revoke_user_delegation_keys()</code>: Revokes all user delegation keys for the account. This also renders all SAS's obtained via such keys invalid.
</p>
</li>
<li> <p><code>get_blob_endpoint(key, sas)</code>: Return the account's blob storage endpoint, along with an access key and/or a SAS. See 'Endpoints' for more details
</p>
</li>
<li> <p><code>get_file_endpoint(key, sas)</code>: Return the account's file storage endpoint.
</p>
</li>
<li> <p><code>regen_key(key)</code>: Regenerates (creates a new value for) an access key. The argument <code>key</code> can be 1 or 2.
</p>
</li>
</ul>
<h3>Initialization</h3>

<p>Initializing a new object of this class can either retrieve an existing storage account, or create a account on the host. Generally, the best way to initialize an object is via the <code>get_storage_account</code>, <code>create_storage_account</code> or <code>list_storage_accounts</code> methods of the az_resource_group class, which handle the details automatically.
</p>


<h3>Creating a shared access signature</h3>

<p>Note that you don't need to worry about this section if you have been <em>given</em> a SAS, and only want to use it to access storage.
</p>
<p>AzureStor supports generating three kinds of SAS: account, service and user delegation. An account SAS can be used with any type of storage. A service SAS can be used with blob and file storage, whle a user delegation SAS can be used with blob and ADLS2 storage.
</p>
<p>To create an account SAS, call the <code>get_account_sas()</code> method. This has the following signature:</p>
<pre>get_account_sas(key=self$list_keys()[1], start=NULL, expiry=NULL, services="bqtf", permissions="rl",
                resource_types="sco", ip=NULL, protocol=NULL)
</pre>
<p>To create a service SAS, call the <code>get_service_sas()</code> method, which has the following signature:</p>
<pre>get_service_sas(key=self$list_keys()[1], resource, service, start=NULL, expiry=NULL, permissions="r",
                resource_type=NULL, ip=NULL, protocol=NULL, policy=NULL, snapshot_time=NULL)
</pre>
<p>To create a user delegation SAS, you must first create a user delegation <em>key</em>. This takes the place of the account's access key in generating the SAS. The <code>get_user_delegation_key()</code> method has the following signature:</p>
<pre>get_user_delegation_key(token=self$token, key_start=NULL, key_expiry=NULL)
</pre>
<p>Once you have a user delegation key, you can use it to obtain a user delegation sas. The <code>get_user_delegation_sas()</code> method has the following signature:</p>
<pre>get_user_delegation_sas(key, resource, start=NULL, expiry=NULL, permissions="rl",
                        resource_type="c", ip=NULL, protocol=NULL, snapshot_time=NULL)
</pre>
<p>(Note that the <code>key</code> argument for this method is the user delegation key, <em>not</em> the account key.)
</p>
<p>To invalidate all user delegation keys, as well as the SAS's generated with them, call the <code>revoke_user_delegation_keys()</code> method. This has the following signature:</p>
<pre>revoke_user_delegation_keys()
</pre>
<p>See the Shared access signatures page for more information about this topic.
</p>


<h3>Endpoints</h3>

<p>The client-side interaction with a storage account is via an <em>endpoint</em>. A storage account can have several endpoints, one for each type of storage supported: blob, file, queue and table.
</p>
<p>The client-side interface in AzureStor is implemented using S3 classes. This is for consistency with other data access packages in R, which mostly use S3. It also emphasises the distinction between Resource Manager (which is for interacting with the storage account itself) and the client (which is for accessing files and data stored in the account).
</p>
<p>To create a storage endpoint independently of Resource Manager (for example if you are a user without admin or owner access to the account), use the blob_endpoint or file_endpoint functions.
</p>
<p>If a storage endpoint is created without an access key and SAS, only public (anonymous) access is possible.
</p>


<h3>See Also</h3>

<p>blob_endpoint, file_endpoint,
create_storage_account, get_storage_account, delete_storage_account, Date, POSIXt
</p>
<p><a href="https://docs.microsoft.com/en-us/rest/api/storagerp/">Azure Storage Provider API reference</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/">Azure Storage Services API reference</a>
</p>
<p><a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-account-sas">Create an account SAS</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-user-delegation-sas">Create a user delegation SAS</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-service-sas">Create a service SAS</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

# recommended way of retrieving a resource: via a resource group object
stor &lt;- resgroup$get_storage_account("mystorage")

# list account access keys
stor$list_keys()

# regenerate a key
stor$regen_key(1)

# storage endpoints
stor$get_blob_endpoint()
stor$get_file_endpoint()


## End(Not run)
</code></pre>


</div>