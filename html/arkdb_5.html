<div class="container">

<table style="width: 100%;"><tr>
<td>local_db</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Connect to a local stand-alone database</h2>

<h3>Description</h3>

<p>This function will provide a connection to the best available database.
This function is a drop-in replacement for <code style="white-space: pre;">⁠[DBI::dbConnect]⁠</code> with behaviour
that makes it more subtle for R packages that need a database backend with
minimal complexity, as described in details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">local_db(
  dbdir = arkdb_dir(),
  driver = Sys.getenv("ARKDB_DRIVER", "duckdb"),
  readonly = FALSE,
  cache_connection = TRUE,
  memory_limit = getOption("duckdb_memory_limit", NA),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dbdir</code></td>
<td>
<p>Path to the database.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>driver</code></td>
<td>
<p>Default driver, one of "duckdb", "MonetDBLite", "RSQLite".
It will select the first one of those it finds available if a
driver is not set. This fallback can be overwritten either by explicit
argument or by setting the environmental variable <code>ARKDB_DRIVER</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>readonly</code></td>
<td>
<p>Should the database be opened read-only? (duckdb only).
This allows multiple concurrent connections (e.g. from different R sessions)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache_connection</code></td>
<td>
<p>should we preserve a cache of the connection? allows
faster load times and prevents connection from being garbage-collected.  However,
keeping open a read-write connection to duckdb or MonetDBLite will block access of
other R sessions to the database.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memory_limit</code></td>
<td>
<p>Set a memory limit for duckdb, in GB.  This can
also be set for the session by using options, e.g.
<code>options(duckdb_memory_limit=10)</code> for a limit of 10GB.  On most systems
duckdb will automatically set a limit to 80% of machine capacity if not
set explicitly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments (not used at this time)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function provides several abstractions to <code style="white-space: pre;">⁠[DBI::dbConnect]⁠</code> to
provide a seamless backend for use inside other R packages.
</p>
<p>First, this  provides a generic method that allows the use of a <code style="white-space: pre;">⁠[RSQLite::SQLite]`` connection if nothing else is available, while being able to automatically select a much faster, more powerful backend from ⁠</code>duckdb::duckdb'
if available.  An argument or environmental variable can be used to override this
to manually set a database endpoint for testing purposes.
</p>
<p>Second, this function will cache the database connection in an R environment and
load that cache.  That means you can call <code>local_db()</code> as fast/frequently as you
like without causing errors that would occur by rapid calls to <code style="white-space: pre;">⁠[DBI::dbConnect]⁠</code>
</p>
<p>Third, this function defaults to persistent storage location set by <code style="white-space: pre;">⁠[tools::R_user_dir]⁠</code>
and configurable by setting the environmental variable <code>ARKDB_HOME</code>.  This allows
a package to provide persistent storage out-of-the-box, and easily switch that storage
to a temporary directory (e.g. for testing purposes, or custom user configuration) without
having to edit database calls directly.
</p>


<h3>Value</h3>

<p>Returns a <code style="white-space: pre;">⁠[DBIconnection]⁠</code> connection to the default database
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## OPTIONAL: you can first set an alternative home location,
## such as a temporary directory:
Sys.setenv(ARKDB_HOME = tempdir())

## Connect to the database:
db &lt;- local_db()

</code></pre>


</div>