<div class="container">

<table style="width: 100%;"><tr>
<td>centos_7.5_ss</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Virtual machine scaleset configuration functions</h2>

<h3>Description</h3>

<p>Virtual machine scaleset configuration functions
</p>


<h3>Usage</h3>

<pre><code class="language-R">centos_7.5_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

centos_7.6_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

centos_8.1_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

debian_8_backports_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

debian_9_backports_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

debian_10_backports_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

debian_10_backports_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

ubuntu_dsvm_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh, nsg_rule_allow_jupyter,
  nsg_rule_allow_rstudio)), load_balancer = lb_config(rules =
  list(lb_rule_ssh, lb_rule_jupyter, lb_rule_rstudio), probes =
  list(lb_probe_ssh, lb_probe_jupyter, lb_probe_rstudio)), ...)

ubuntu_dsvm_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh, nsg_rule_allow_jupyter,
  nsg_rule_allow_rstudio)), load_balancer = lb_config(rules =
  list(lb_rule_ssh, lb_rule_jupyter, lb_rule_rstudio), probes =
  list(lb_probe_ssh, lb_probe_jupyter, lb_probe_rstudio)), ...)

windows_dsvm_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_rdp)),
  load_balancer = lb_config(rules = list(lb_rule_rdp), probes =
  list(lb_probe_rdp)), options = scaleset_options(keylogin = FALSE), ...)

rhel_7.6_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

rhel_8_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

rhel_8.1_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

rhel_8.1_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

rhel_8.2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

rhel_8.2_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

ubuntu_16.04_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

ubuntu_18.04_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

ubuntu_20.04_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

ubuntu_20.04_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)),
  load_balancer = lb_config(rules = list(lb_rule_ssh), probes =
  list(lb_probe_ssh)), ...)

windows_2016_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_rdp)),
  load_balancer = lb_config(rules = list(lb_rule_rdp), probes =
  list(lb_probe_rdp)), options = scaleset_options(keylogin = FALSE), ...)

windows_2019_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_rdp)),
  load_balancer = lb_config(rules = list(lb_rule_rdp), probes =
  list(lb_probe_rdp)), options = scaleset_options(keylogin = FALSE), ...)

windows_2019_gen2_ss(datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_rdp)),
  load_balancer = lb_config(rules = list(lb_rule_rdp), probes =
  list(lb_probe_rdp)), options = scaleset_options(keylogin = FALSE), ...)

vmss_config(image, options = scaleset_options(), datadisks = numeric(0),
  nsg = nsg_config(), vnet = vnet_config(), load_balancer = lb_config(),
  load_balancer_address = ip_config(), autoscaler = autoscaler_config(),
  other_resources = list(), variables = list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>datadisks</code></td>
<td>
<p>The data disks to attach to the VM. Specify this as either a vector of numeric disk sizes in GB, or a list of <code>datadisk_config</code> objects for more control over the specification.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsg</code></td>
<td>
<p>The network security group for the scaleset. Can be a call to <code>nsg_config</code> to create a new NSG; an AzureRMR resource object or resource ID to reuse an existing NSG; or NULL to not use an NSG (not recommended).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>load_balancer</code></td>
<td>
<p>The load balancer for the scaleset. Can be a call to <code>lb_config</code> to create a new load balancer;  an AzureRMR resource object or resource ID to reuse an existing load balancer; or NULL if load balancing is not required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>For the specific VM configurations, other customisation arguments to be passed to <code>vm_config</code>. For <code>vmss_config</code>, named arguments that will be folded into the scaleset resource definition in the template.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>Scaleset options, as obtained via a call to <code>scaleset_options</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>image</code></td>
<td>
<p>For <code>vmss_config</code>, the VM image to deploy. This should be an object of class <code>image_config</code>, created by the function of the same name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vnet</code></td>
<td>
<p>The virtual network for the scaleset. Can be a call to <code>vnet_config</code> to create a new virtual network, or an AzureRMR resource object or resource ID to reuse an existing virtual network. Note that by default, AzureVM will associate the NSG with the virtual network/subnet, not with the VM's network interface.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>load_balancer_address</code></td>
<td>
<p>The public IP address for the load balancer. Can be a call to <code>ip_config</code> to create a new IP address, or an AzureRMR resource object or resource ID to reuse an existing address resource. Ignored if <code>load_balancer</code> is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>autoscaler</code></td>
<td>
<p>The autoscaler for the scaleset. Can be a call to <code>autoscaler_config</code> to create a new autoscaler; an AzureRMR resource object or resource ID to reuse an existing autoscaler; or NULL if autoscaling is not required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>other_resources</code></td>
<td>
<p>An optional list of other resources to include in the deployment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>An optional named list of variables to add to the template.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions are for specifying the details of a new virtual machine scaleset deployment: the base VM image and related options, along with the Azure resources that the scaleset may need. These include the network security group, virtual network, load balancer and associated public IP address, and autoscaler.
</p>
<p>Each resource can be specified in a number of ways:
</p>

<ul>
<li>
<p> To <em>create</em> a new resource as part of the deployment, call the corresponding <code style="white-space: pre;">⁠*_config⁠</code> function.
</p>
</li>
<li>
<p> To use an <em>existing</em> resource, supply either an <code>AzureRMR::az_resource</code> object (recommended) or a string containing the resource ID.
</p>
</li>
<li>
<p> If the resource is not needed, specify it as NULL.
</p>
</li>
<li>
<p> For the <code>other_resources</code> argument, supply a list of resources, each of which should be a list of resource fields (name, type, properties, sku, etc).
</p>
</li>
</ul>
<p>The <code>vmss_config</code> function is the base configuration function, and the others call it to create VM scalesets with specific operating systems and other image details.
</p>

<ul>
<li> <p><code>ubuntu_dsvm_ss</code>: Data Science Virtual Machine, based on Ubuntu 18.04
</p>
</li>
<li> <p><code>windows_dsvm_ss</code>: Data Science Virtual Machine, based on Windows Server 2019
</p>
</li>
<li> <p><code>ubuntu_16.04_ss</code>, <code>ubuntu_18.04_ss</code>, <code>ubuntu_20.04_ss</code>, <code>ubuntu_20.04_gen2_ss</code>: Ubuntu LTS
</p>
</li>
<li> <p><code>windows_2016_ss</code>, <code>windows_2019_ss</code>: Windows Server Datacenter edition
</p>
</li>
<li> <p><code>rhel_7.6_ss</code>, <code>rhel_8_ss</code>, <code>rhel_8.1_ss</code>, <code>rhel_8.1_gen2_ss</code>, <code>rhel_8.2_ss</code>, <code>rhel_8.2_gen2_ss</code>: Red Hat Enterprise Linux
</p>
</li>
<li> <p><code>centos_7.5_ss</code>, <code>centos_7.6_ss</code>, <code>centos_8.1_ss</code>: CentOS
</p>
</li>
<li> <p><code>debian_8_backports_ss</code>, <code>debian_9_backports_ss</code>, <code>debian_10_backports_ss</code>, <code>debian_10_backports_gen2_ss</code>: Debian with backports
</p>
</li>
</ul>
<p>The VM scaleset configurations with <code>gen2</code> in the name use <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/generation-2">generation 2 VMs</a>, which feature several technical improvements over the earlier generation 1. Consider using these for greater efficiency, however note that gen2 VMs are only available for select images and do not support all possible VM sizes.
</p>
<p>A VM scaleset configuration defines the following template variables by default, depending on its resources. If a particular resource is created, the corresponding <code style="white-space: pre;">⁠*Name⁠</code>, <code style="white-space: pre;">⁠*Id⁠</code> and <code style="white-space: pre;">⁠*Ref⁠</code> variables will be available. If a resource is referred to but not created, the <code style="white-space: pre;">⁠*Name*⁠</code> and <code style="white-space: pre;">⁠*Id⁠</code> variables will be available. Other variables can be defined via the <code>variables</code> argument.
</p>

<table>
<tr>
<td style="text-align: left;">
<strong>Variable name</strong> </td>
<td style="text-align: left;"> <strong>Contents</strong> </td>
<td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>location</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceGroup().location]⁠</code> </td>
<td style="text-align: left;"> Region to deploy resources </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vmId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Compute/virtualMachines', parameters('vmName'))]⁠</code> </td>
<td style="text-align: left;"> VM scaleset resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vmRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]⁠</code> </td>
<td style="text-align: left;"> Scaleset template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-nsg')]⁠</code> </td>
<td style="text-align: left;"> Network security group resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]⁠</code> </td>
<td style="text-align: left;"> NSG resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/networkSecurityGroups/', variables('nsgName'))]⁠</code> </td>
<td style="text-align: left;"> NSG template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-vnet')]⁠</code> </td>
<td style="text-align: left;"> Virtual network resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/virtualNetworks', variables('vnetName'))]⁠</code> </td>
<td style="text-align: left;"> Vnet resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/virtualNetworks/', variables('vnetName'))]⁠</code> </td>
<td style="text-align: left;"> Vnet template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>subnet</code> </td>
<td style="text-align: left;"> <code>subnet</code> </td>
<td style="text-align: left;"> Subnet name. Only defined if a Vnet was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>subnetId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(variables('vnetId'), '/subnets/', variables('subnet'))]⁠</code> </td>
<td style="text-align: left;"> Subnet resource ID. Only defined if a Vnet was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-lb')]⁠</code> </td>
<td style="text-align: left;"> Load balancer resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/loadBalancers', variables('lbName'))]⁠</code> </td>
<td style="text-align: left;"> Load balancer resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/loadBalancers/', variables('lbName'))]⁠</code> </td>
<td style="text-align: left;"> Load balancer template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbFrontendName</code> </td>
<td style="text-align: left;"> <code>frontend</code> </td>
<td style="text-align: left;"> Load balancer frontend IP configuration name. Only defined if a load balancer was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbBackendName</code> </td>
<td style="text-align: left;"> <code>backend</code> </td>
<td style="text-align: left;"> Load balancer backend address pool name. Only defined if a load balancer was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbFrontendId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(variables('lbId'), '/frontendIPConfigurations/', variables('lbFrontendName'))]⁠</code> </td>
<td style="text-align: left;"> Load balancer frontend resource ID. Only defined if a load balancer was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>lbBackendId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(variables('lbId'), '/backendAddressPools/', variables('lbBackendName'))]⁠</code> </td>
<td style="text-align: left;"> Load balancer backend resource ID. Only defined if a load balancer was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-ip')]⁠</code> </td>
<td style="text-align: left;"> Public IP address resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/publicIPAddresses', variables('ipName'))]⁠</code> </td>
<td style="text-align: left;"> IP resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/publicIPAddresses/', variables('ipName'))]⁠</code> </td>
<td style="text-align: left;"> IP template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>asName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-as')]⁠</code> </td>
<td style="text-align: left;"> Autoscaler resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>asId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Insights/autoscaleSettings', variables('asName'))]⁠</code> </td>
<td style="text-align: left;"> Autoscaler resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>asRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Insights/autoscaleSettings/', variables('asName'))]⁠</code> </td>
<td style="text-align: left;"> Autoscaler template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>asMaxCapacity</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[mul(int(parameters('instanceCount')), 10)]⁠</code> </td>
<td style="text-align: left;"> Maximum capacity for the autoscaler. Only defined if an autoscaler was created. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>asScaleValue</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[max(div(int(parameters('instanceCount')), 5), 1)]⁠</code> </td>
<td style="text-align: left;"> Default capacity for the autoscaler. Only defined if an autoscaler was created.
</td>
</tr>
</table>
<p>Thus, for example, if you are creating a VM scaleset named "myvmss" along with all its associated resources, the NSG is named "myvmss-nsg", the virtual network is "myvmss-vnet", the load balancer is "myvmss-lb", the public IP address is "myvmss-ip", and the autoscaler is "myvm-as".
</p>


<h3>Value</h3>

<p>An object of S3 class <code>vmss_config</code>, that can be used by the <code>create_vm_scaleset</code> method.
</p>


<h3>See Also</h3>

<p>scaleset_options for options relating to the scaleset resource itself
</p>
<p>nsg_config, ip_config, vnet_config, lb_config, autoscaler_config for other resource configs
</p>
<p>build_template for template builder methods
</p>
<p>vm_config for configuring an individual virtual machine
</p>
<p>create_vm_scaleset
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# basic Linux (Ubuntu) and Windows configs
ubuntu_18.04_ss()
windows_2019_ss()

# Windows DSVM scaleset, no load balancer and autoscaler
windows_dsvm_ss(load_balancer=NULL, autoscaler=NULL)

# RHEL VM exposing ports 80 (HTTP) and 443 (HTTPS)
rhel_8_ss(nsg=nsg_config(nsg_rule_allow_http, nsg_rule_allow_https))

# exposing no ports externally
rhel_8_ss(nsg=nsg_config(list()))

# low-priority (spot) VMs, large scaleset (&gt;100 instances allowed), no managed identity
rhel_8_ss(options=scaleset_options(priority="spot", large_scaleset=TRUE, managed_identity=FALSE))


## Not run: 

# reusing existing resources: placing a scaleset in an existing vnet/subnet
# we don't need a new network security group either
vnet &lt;- AzureRMR::get_azure_login()$
    get_subscription("sub_id")$
    get_resource_group("rgname")$
    get_resource(type="Microsoft.Network/virtualNetworks", name="myvnet")

ubuntu_18.04_ss(vnet=vnet, nsg=NULL)


## End(Not run)
</code></pre>


</div>