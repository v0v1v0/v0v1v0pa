<div class="container">

<table style="width: 100%;"><tr>
<td>plot_APChexamap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hexamap of an APC surface</h2>

<h3>Description</h3>

<p>Plot the heatmap of an APC structure using a hexagon-based plot with adapted
axes. In this way, the one temporal dimension that is represented by the
diagonal structure is visually not underrepresented compared to the other two
dimensions on the x-axis and y-axis. <br>
The function can be used in two ways: Either to plot the observed mean
structure of a metric variable, by specifying <code>dat</code> and the variable
<code>y_var</code>, or by specifying <code>dat</code> and the <code>model</code> object, to
plot some mean structure represented by an estimated two-dimensional tensor
product surface. The model must be estimated with <code>gam</code> or
<code>bam</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_APChexamap(
  dat,
  y_var = NULL,
  model = NULL,
  apc_range = NULL,
  y_var_logScale = FALSE,
  obs_interval = 1,
  iso_interval = 5,
  color_vec = NULL,
  color_range = NULL,
  line_width = 0.5,
  line_color = gray(0.5),
  label_size = 0.5,
  label_color = "black",
  legend_title = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_var</code></td>
<td>
<p>Optional character name of a metric variable to be plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Optional regression model estimated with <code>gam</code>
or <code>bam</code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apc_range</code></td>
<td>
<p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_var_logScale</code></td>
<td>
<p>Indicator if <code>y_var</code> should be log10 transformed.
Only used if <code>y_var</code> is specified. Defaults to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_interval</code></td>
<td>
<p>Numeric specifying the interval width based on which the
data is spaced. Only used if <code>y_var</code> is specified. Defaults to 1, i.e.
observations each year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iso_interval</code></td>
<td>
<p>Numeric specifying the interval width between the
isolines along each axis. Defaults to 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_vec</code></td>
<td>
<p>Optional character vector of color names, specifying the
color continuum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_range</code></td>
<td>
<p>Optional numeric vector with two elements, specifying the
ends of the color scale in the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line_width</code></td>
<td>
<p>Line width of the isolines. Defaults to 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line_color</code></td>
<td>
<p>Character color name for the isolines. Defaults to gray.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_size</code></td>
<td>
<p>Size of the labels along the axes. Defaults to 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_color</code></td>
<td>
<p>Character color name for the labels along the axes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_title</code></td>
<td>
<p>Optional character title for the legend.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See also <code>plot_APCheatmap</code> to plot a regular heatmap.
</p>
<p>If the plot is created based on the <code>model</code> object and the model was
estimated with a log or logit link, the function automatically performs an
exponential transformation of the effect.
</p>


<h3>Value</h3>

<p>Creates a plot with base R functions (not <code>ggplot2</code>).
</p>


<h3>Author(s)</h3>

<p>Hawre Jalal <a href="mailto:hjalal@pitt.edu">hjalal@pitt.edu</a>,
Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>
</p>


<h3>References</h3>

<p>Jalal, H., Burke, D. (2020). Hexamaps for Age–Period–Cohort
Data Visualization and Implementation in R.
<em>Epidemiology</em>, 31 (6), e47-e49. doi: 10.1097/EDE.0000000000001236.
</p>


<h3>See Also</h3>

<p><code>plot_APCheatmap</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(APCtools)
library(mgcv)
library(dplyr)

data(drug_deaths)

# restrict to data where the mortality rate is available
drug_deaths &lt;- drug_deaths %&gt;% filter(!is.na(mortality_rate))

# hexamap of an observed structure
plot_APChexamap(dat         = drug_deaths,
                y_var       = "mortality_rate",
                color_range = c(0,40))

# hexamap of a smoothed structure
model &lt;- gam(mortality_rate ~ te(age, period, bs = "ps", k = c(8,8)),
             data = drug_deaths)

plot_APChexamap(dat = drug_deaths, model = model)

</code></pre>


</div>