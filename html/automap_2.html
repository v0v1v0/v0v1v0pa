<div class="container">

<table style="width: 100%;"><tr>
<td>autoKrige</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Performs an automatic interpolation</h2>

<h3>Description</h3>

<p>This function performs automatic kriging on the given dataset.
The variogram is generated automatically using autofitVariogram.</p>


<h3>Usage</h3>

<pre><code class="language-R">autoKrige(formula, 
  	  input_data, 
	  new_data, 
 	  data_variogram = input_data, 
	  block = 0, 
	  model = c("Sph", "Exp", "Gau", "Ste"), 
	  kappa = c(0.05, seq(0.2, 2, 0.1), 5, 10), 
	  fix.values = c(NA,NA,NA), 
	  remove_duplicates = TRUE, 
	  verbose = FALSE, 
	  GLS.model = NA,
      start_vals = c(NA,NA,NA),
      miscFitOptions = list(),
	  ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>formula that defines the dependent variable as a linear model
of independent variables; suppose the dependent variable has
name 'z', for ordinary and simple kriging use the formula
'z~1'; for simple kriging also define 'beta' (see below); for
universal kriging, suppose 'z' is linearly dependent on 'x'
and 'y', use the formula 'z~x+y'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input_data</code></td>
<td>
<p>An object of the 
SpatialPointsDataFrame-class or sf 
containing the data to be interpolated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_data</code></td>
<td>
<p>A <code>sp</code>, <code>sf</code> or <code>stars</code> (<code>st_as_stars</code>) object containing the 
prediction locations. <code>new_data</code> can be
a points set, a grid or a polygon. Must not contain NA's. If this object is not provided
a default is calculated. This is done by taking the convex hull of <code>input_data</code> and 
placing around 5000 gridcells in that convex hull.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_variogram</code></td>
<td>
<p>An optional way to provide a different dataset for
the building of the variogram then for the spatial
interpolation. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block</code></td>
<td>
<p>Use this parameter to pass on a specification for the 
block size. e.g. c(1000,1000) </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>List of models that will be tested during automatic variogram fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>List of values for the smoothing parameter of the Matern model that will be tested during automatic variogram fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.values</code></td>
<td>
<p>Can be used to fix a variogram parameter to a certain value. It 
consists of a list with a length of three. The items describe the
fixed value for the nugget, range and sill respectively. Setting
the value to NA means that the value is not fixed. Is passed on to autofitVariogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove_duplicates</code></td>
<td>
<p>logical, remove duplicate points from the <code>input_data</code>. This can take
some time on large datasets. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical, if TRUE autoKrige will give extra information on the fitting process</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GLS.model</code></td>
<td>
<p>If a variogram model is passed on through this parameter a Generalized Least Squares 
sample variogram is calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_vals</code></td>
<td>
<p>Can be used to give the starting values for the variogram fitting. The items describe the
fixed value for the nugget, range and sill respectively. They need to be given in that order.
Setting the value to NA means that the value will be automatically chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>miscFitOptions</code></td>
<td>
<p>Additional options to set the behavior of autofitVariogram. For details see the 
documentation of autofitVariogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments that are passed on to the gstat function <code>krige</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>autoKrige</code> calls the function <code>autofitVariogram</code> that fits a variogram model to the
given dataset. This variogram model and the data are used to make predictions on the locations
in <code>new_data</code>. The only compulsory argument is <code>input_data</code>. So the most
simple call would of the form:
</p>
<p><code>autoKrige(meuse)</code>
</p>
<p><code>autoKrige</code> now assumes that you want to perform ordinary kriging on the first column of 
<code>input_data</code>.
</p>
<p><code>autoKrige</code> performs some checks on the coordinate systems of <code>input_data</code> and <code>new_data</code>.
If one of both is <code>NA</code>, it is assigned the projection of the other. If they have different projections,
an error is raised. If one of both has a non-projected system (i.e. latitude-longitude), an error is raised.
This error is raised because 'gstat does use spherical distances when data are in geographical
coordinates, however the usual variogram models are typically not
non-negative definite on the sphere, and no appropriate models are
available' (Edzer Pebesma on r-sig-geo).
</p>
<p>When the user specifies the power model (<code>Pow</code>) as the model, the initial range is set to one. Note that
when using the power model, the initial range is the initial power.
</p>


<h3>Value</h3>

<p>This function returns an <code>autoKrige</code> object containing the results of the interpolation 
(prediction, variance and standard deviation), the sample variogram, the variogram model that
was fitted by <code>autofitVariogram</code> and the sums of squares between the sample variogram and the
fitted variogram model. The attribute names are <code>krige_output</code>, <code>exp_var</code>, <code>var_model</code> 
and <code>sserr</code> respectively.
</p>


<h3>Author(s)</h3>

<p>Paul Hiemstra, <a href="mailto:paul@numbertheory.nl">paul@numbertheory.nl</a></p>


<h3>See Also</h3>

<p><code>autofitVariogram</code>, <code>krige</code></p>


<h3>Examples</h3>

<pre><code class="language-R"># Data preparation

library(sp)
library(sf)
library(stars)
data(meuse)
coordinates(meuse) =~ x+y
data(meuse.grid)
gridded(meuse.grid) =~ x+y


# Ordinary kriging, no new_data object
kriging_result = autoKrige(zinc~1, meuse)
plot(kriging_result)

# Ordinary kriging
kriging_result = autoKrige(zinc~1, meuse, meuse.grid)
plot(kriging_result)

# Fixing the nugget to 0.2
kriging_result = autoKrige(zinc~1, meuse, 
	meuse.grid, fix.values = c(0.2,NA,NA))
plot(kriging_result)

# Universal kriging
kriging_result = autoKrige(zinc~soil+ffreq+dist, meuse, meuse.grid)
plot(kriging_result)

# Block kriging  
kriging_result_block = autoKrige(zinc~soil+ffreq+dist, 
	meuse, meuse.grid, block = c(400,400))
plot(kriging_result_block)

# Dealing with duplicate observations
data(meuse)
meuse.dup = rbind(meuse, meuse[1,]) # Create duplicate
coordinates(meuse.dup) = ~x+y
kr = autoKrige(zinc~dist, meuse.dup, meuse.grid)

# Extracting parts from the autoKrige object
prediction_spdf = kr$krige_output
sample_variogram = kr$exp_var
variogram_model = kr$var_model

coordinates(meuse) = ~x + y
meuse = st_as_sf(meuse)
meuse.grid = st_as_stars(meuse.grid)
kriging_result = autoKrige(zinc~1, meuse, 
	meuse.grid, fix.values = c(0.2,NA,NA))



</code></pre>


</div>