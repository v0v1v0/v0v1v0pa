<div class="container">

<table style="width: 100%;"><tr>
<td>estimate.affinity.matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate Dupuy and Galichon's model</h2>

<h3>Description</h3>

<p>This function estimates the affinity matrix of the matching model of Dupuy
and Galichon (2014), performs the saliency analysis and the rank tests. The
user must supply a <em>matched sample</em> that is treated as the equilibrium
matching of a bipartite one-to-one matching model without frictions and with
Transferable Utility. For the sake of clarity, in the documentation we take
the example of the marriage market and refer to "men" as the observations on
one side of the market and to "women" as the observations on the other side.
Other applications may include matching between CEOs and firms, firms and
workers, buyers and sellers, etc.
</p>


<h3>Usage</h3>

<pre><code class="language-R">estimate.affinity.matrix(
  X,
  Y,
  w = rep(1, N),
  A0 = matrix(0, nrow = Kx, ncol = Ky),
  lb = matrix(-Inf, nrow = Kx, ncol = Ky),
  ub = matrix(Inf, nrow = Kx, ncol = Ky),
  pr = 0.05,
  max_iter = 10000,
  tol_level = 1e-06,
  scale = 1,
  nB = 2000,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>The matrix of men's traits. Its rows must be ordered so that the
i-th man is matched with the i-th woman: this means that <code>nrow(X)</code>
must be equal to <code>nrow(Y)</code>. Its columns correspond to the different
matching variables: <code>ncol(X)</code> can be different from <code>ncol(Y)</code>.
For the sake of clarity of exposition when using descriptive tools such
as <code>show.correlations</code>, it is recommended assigning the same
matching variable to the k-th column of <code>X</code> and to the k-th column
of <code>Y</code>, whenever possible. If <code>X</code> has more matching variables
than <code>Y</code>, then those variables that appear in <code>X</code> but no in Y
should be found in the last columns of <code>X</code> (and vice versa). The
matrix is demeaned and rescaled before the start of the estimation
algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>The matrix of women's traits. Its rows must be ordered so that the
i-th woman is matched with the i-th man: this means that <code>nrow(Y)</code>
must be equal to <code>nrow(X)</code>.  Its columns correspond to the different
matching variables: <code>ncol(Y)</code> can be different from <code>ncol(X)</code>.
The matrix is demeaned and rescaled before the start of the estimation
algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>A vector of sample weights with length <code>nrow(X)</code>. Defaults to
uniform weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A0</code></td>
<td>
<p>A vector or matrix with <code>ncol(X)*ncol(Y)</code> elements
corresponding to the initial values of the affinity matrix to be fed to
the estimation algorithm. Optional. Defaults to matrix of zeros.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lb</code></td>
<td>
<p>A vector or matrix with <code>ncol(X)*ncol(Y)</code> elements
corresponding to the lower bounds of the elements of the affinity matrix.
Defaults to <code>-Inf</code> for all parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ub</code></td>
<td>
<p>A vector or matrix with <code>ncol(X)*ncol(Y)</code> elements
corresponding to the upper bounds of the elements of the affinity matrix.
Defaults to <code>Inf</code> for all parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pr</code></td>
<td>
<p>A probability indicating the significance level used to compute
bootstrap two-sided confidence intervals for <code>U</code>, <code>V</code> and
<code>lambda</code>. Defaults to 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>An integer indicating the maximum number of iterations in the
Maximum Likelihood Estimation. See <code>optim</code> for the
<code>"L-BFGS-B"</code> method. Defaults to 10000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol_level</code></td>
<td>
<p>A positive real number indicating the tolerance level in the
Maximum Likelihood Estimation. See <code>optim</code> for the
<code>"L-BFGS-B"</code> method. Defaults to 1e-6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>A positive real number indicating the scale of the model.
Defaults to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nB</code></td>
<td>
<p>An integer indicating the number of bootstrap replications used to
compute the confidence intervals of <code>U</code>, <code>V</code> and <code>lambda</code>.
Defaults to 2000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code>, the function displays messages to keep track
of its progress. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The function returns a list with elements: <code>X</code>, the demeaned and
rescaled matrix of men's traits; <code>Y</code>, the demeaned and rescaled
matrix of men's traits; <code>fx</code>, the empirical marginal distribution of
men; <code>fy</code>, the empirical marginal distribution of women;
<code>Aopt</code>, the estimated affinity matrix; <code>sdA</code>, the standard
errors of <code>Aopt</code>; <code>tA</code>, the Z-test statistics of <code>Aopt</code>;
<code>VarCovA</code>, the full variance-covariance matrix of <code>Aopt</code>;
<code>rank.tests</code>, a list with all the summaries of the rank tests on
<code>Aopt</code>; <code>U</code>, whose columns are the left-singular vectors of
<code>Aopt</code>; <code>V</code>, whose columns are the right-singular vectors of
<code>Aopt</code>; <code>lambda</code>, whose elements are the singular values of
<code>Aopt</code>; <code>UCI</code>, whose columns are the lower and the upper bounds
of the confidence intervals of <code>U</code>; <code>VCI</code>, whose columns are
the lower and the upper bounds of the confidence intervals of <code>V</code>;
<code>lambdaCI</code>, whose columns are the lower and the upper bounds of the
confidence intervals of <code>lambda</code>; <code>df.bootstrap</code>, a data frame
resulting from the <code>nB</code> bootstrap replications and used to infer the
empirical distribution of the estimated objects.
</p>


<h3>See Also</h3>

<p><strong>Dupuy, Arnaud, and Alfred Galichon</strong>. "Personality traits and
the marriage market." <em>Journal of Political Economy</em> 122, no. 6
(2014): 1271-1319.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Parameters
Kx = 4; Ky = 4; # number of matching variables on both sides of the market
N = 200 # sample size
mu = rep(0, Kx+Ky) # means of the data generating process
Sigma = matrix(c(1, 0.326, 0.1446, -0.0668, 0.5712, 0.4277, 0.1847, -0.2883,
                 0.326, 1, -0.0372, 0.0215, 0.2795, 0.8471, 0.1211, -0.0902,
                 0.1446, -0.0372, 1, -0.0244, 0.2186, 0.0636, 0.1489,
                 -0.1301, -0.0668, 0.0215, -0.0244, 1, 0.0192, 0.0452,
                 -0.0553, 0.2717, 0.5712, 0.2795, 0.2186, 0.0192, 1, 0.3309,
                 0.1324, -0.1896, 0.4277, 0.8471, 0.0636, 0.0452, 0.3309, 1,
                 0.0915, -0.1299, 0.1847, 0.1211, 0.1489, -0.0553, 0.1324,
                 0.0915, 1, -0.1959, -0.2883, -0.0902, -0.1301, 0.2717,
                 -0.1896, -0.1299, -0.1959, 1),
               nrow=Kx+Ky) # (normalized) variance-covariance matrix of the
               # data generating process
labels_x = c("Educ.", "Age", "Height", "BMI") # labels for men's matching variables
labels_y = c("Educ.", "Age", "Height", "BMI") # labels for women's matching variables

# Sample
data = MASS::mvrnorm(N, mu, Sigma) # generating sample
X = data[,1:Kx]; Y = data[,Kx+1:Ky] # men's and women's sample data
w = sort(runif(N-1)); w = c(w,1) - c(0,w) # sample weights

# Main estimation
res = estimate.affinity.matrix(X, Y, w = w, nB = 500)

# Summarize results
show.affinity.matrix(res, labels_x = labels_x, labels_y = labels_y)
show.diagonal(res, labels = labels_x)
show.test(res)
show.saliency(res, labels_x = labels_x, labels_y = labels_y,
              ncol_x = 2, ncol_y = 2)
show.correlations(res, labels_x = labels_x, labels_y = labels_y,
                  label_x_axis = "Husband", label_y_axis = "Wife", ndims = 2)

</code></pre>


</div>