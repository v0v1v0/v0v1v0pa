<div class="container">

<table style="width: 100%;"><tr>
<td>aldvmm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Adjusted Limited Dependent Variable Mixture Models</h2>

<h3>Description</h3>

<p>The function <code>aldvmm</code> fits adjusted limited dependent variable mixture models
of health state utilities. Adjusted limited dependent variable mixture
models are finite mixtures of normal distributions with an accumulation of
density mass at the limits, and a gap between 100% quality of life and
the next smaller utility value. The package <code>aldvmm</code> uses the
likelihood and expected value functions proposed by Hernandez Alava and
Wailoo (2015) using normal component distributions and a multinomial logit
model of probabilities of component membership.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aldvmm(
  formula,
  data,
  subset = NULL,
  psi,
  ncmp = 2,
  dist = "normal",
  optim.method = NULL,
  optim.control = list(trace = FALSE),
  optim.grad = TRUE,
  init.method = "zero",
  init.est = NULL,
  init.lo = NULL,
  init.hi = NULL,
  se.fit = FALSE,
  model = TRUE,
  level = 0.95,
  na.action = "na.omit"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class "formula" with a symbolic
description of the model to be fitted. The model formula takes the form
<code>y ~ x1 + x2 | x1 + x4</code>, where the <code>|</code> delimiter separates the
model for expected values of normal distributions (left) and the
multinomial logit model of probabilities of component membership (right).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame, list or environment (or object coercible to a data
frame by 
<code>as.data.frame</code>) 
including data on outcomes and explanatory variables in <code>'formula'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional numeric vector of row indices of the subset of the model 
matrix used in the estimation. <code>'subset'</code> can be longer than the 
number of rows in <code>data</code> and include repeated values for re-sampling 
purposes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>
<p>a numeric vector of minimum and maximum possible utility values
smaller than or equal to 1 (e.g. <code>c(-0.594, 0.883)</code>). The potential
gap between the maximum value and 1 represents an area with zero density
in the value set from which utilities were obtained. The order of the
minimum and maximum limits in <code>'psi'</code> does not matter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncmp</code></td>
<td>
<p>a numeric value of the number of components that are mixed. The
default value is 2. A value of 1 represents a tobit model with a gap
between 1 and the maximum value in <code>'psi'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>an optional character value of the distribution used in the
components. In this release, only the normal distribution is
available, and the default value is set to <code>"normal"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.method</code></td>
<td>
<p>an optional character value of one of the following
<code>optimr</code>
methods: <code>"Nelder-Mead"</code>, <code>"BFGS"</code>, <code>"CG"</code>,
<code>"L-BFGS-B"</code>, <code>"nlminb"</code>, <code>"Rcgmin"</code>, <code>"Rvmmin"</code> and
<code>"hjn"</code>. The default method is <code>"BFGS"</code>. The method
<code>"L-BFGS-B"</code> is used when lower and/or upper constraints are set
using <code>'init.lo'</code> and <code>'init.hi'</code>. The method <code>"nlm"</code>
cannot be used in the <code>'aldvmm'</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.control</code></td>
<td>
<p>an optional list of
<code>optimr</code>
control parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.grad</code></td>
<td>
<p>an optional logical value indicating if an analytical
gradient should be used in
<code>optimr</code>
methods that can use this information. The default value is <code>TRUE</code>.
If <code>'optim.grad'</code> is set to <code>FALSE</code>, a finite difference
approximation is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.method</code></td>
<td>
<p>an optional character value indicating the method for
obtaining initial values. The following values are available:
<code>"zero"</code>, <code>"random"</code>, <code>"constant"</code> and <code>"sann"</code>. The
default value is <code>"zero"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.est</code></td>
<td>
<p>an optional numeric vector of user-defined initial values.
User-defined initial values override the <code>'init.method'</code> argument.
Initial values have to follow the same order as parameter estimates in the
return value <code>'coef'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.lo</code></td>
<td>
<p>an optional numeric vector of user-defined lower limits for
constrained optimization. When <code>'init.lo'</code> is not <code>NULL</code>, the
optimization method <code>"L-BFGS-B"</code> is used. Lower limits of parameters
have to follow the same order as parameter estimates in the return value
<code>'coef'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.hi</code></td>
<td>
<p>an optional numeric vector of user-defined upper limits for
constrained optimization. When <code>'init.hi'</code> is not <code>NULL</code>, the
optimization method <code>"L-BFGS-B"</code> is used. Upper limits of parameters
have to follow the same order as parameter estimates in the return value
<code>'coef'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.fit</code></td>
<td>
<p>an optional logical value indicating whether standard errors
of fitted values are calculated. The default value is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>an optional logical value indicating whether the estimation 
data frame is returned in the output object. The default value is 
<code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>a numeric value of the significance level for confidence bands
of fitted values. The default value is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a character value passed to 
argument <code>'na.action'</code> of the function 
<code>model.frame</code> 
in the preparation of the model matrix. The default value is 
<code>"na.omit"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>aldvmm</code> fits
an adjusted limited dependent variable mixture model using the likelihood
and expected value functions from Hernandez Alava and Wailoo (2015).  The
model accounts for latent classes, multi-modality, minimum and maximum
utility values and potential gaps between 1 and the next smaller utility
value.  Adjusted limited dependent variable mixture models combine
multiple component distributions with a multinomial logit model of the
probabilities of component membership. The standard deviations of normal
distributions are estimated and reported as log-transformed values which
enter the likelihood function as exponentiated values to ensure
non-negative values.
</p>
<p>The minimum utility and the largest utility smaller than or equal to 1 are
supplied in the argument <code>'psi'</code>.  The number of
distributions/components that are mixed is set by the argument
<code>'ncmp'</code>. When <code>'ncmp'</code> is set to 1 the procedure estimates a
tobit model with a gap between 1 and the maximum utility value in
<code>'psi'</code>.  The current version only allows finite mixtures of normal
distributions.
</p>
<p>The <code>'formula'</code> object can include a <code>|</code> delimiter to separate
formulae for expected values in components (left) and the multinomial
logit model of probabilities of group membership (right).  If no <code>|</code>
delimiter is used, the same formula will be used for expected values in
components and the multinomial logit of the probabilities of component
membership.
</p>
<p><code>aldvmm</code> uses
<code>optimr</code> for
maximum likelihood estimation of model parameters.  The argument
<code>'optim.method'</code> accepts the following methods: <code>"Nelder-Mead"</code>,
<code>"BFGS"</code>, <code>"CG"</code>, <code>"L-BFGS-B"</code>, <code>"nlminb"</code>,
<code>"Rcgmin"</code>, <code>"Rvmmin"</code> and <code>"hjn"</code>. The default method is
<code>"BFGS"</code>.  The method <code>"nlm"</code> cannot be used in
<code>aldvmm</code> because it
requires a different implementation of the likelihood function. The
argument <code>'optim.control'</code> accepts a list of
<code>optimr</code>
control parameters.  If <code>'optim.grad'</code> is set to <code>TRUE</code> the
function
<code>optimr</code> uses
analytical gradients during the optimization procedure for all methods 
that allow for this approach. If <code>'optim.grad'</code> is set to 
<code>FALSE</code> or a method cannot use gradients, a finite difference 
approximation is used. The hessian matrix at maximum likelihood parameters 
is approximated numerically using 
<code>hessian</code>.
</p>
<p><code>'init.method'</code> accepts four values of methods for generating initial
values: <code>"zero"</code>, <code>"random"</code>, <code>"constant"</code>, <code>"sann"</code>.
The method <code>"zero"</code> sets initial values of all parameters to 0. The
method <code>"random"</code> draws random starting values from a standard normal
distribution.  The method <code>"constant"</code> estimates a constant-only
model and uses estimates as initial values of intercepts and standard
errors and 0 for all other parameters.  The method <code>"sann"</code> estimates
the full model using the simulated annealing optimization method in
<code>optim</code> and uses
parameter estimates as initial values.  When user-specified initial values
are supplied in <code>'init.est'</code>, the argument <code>'init.method'</code> is
ignored.
</p>
<p>By default, <code>aldvmm</code>
performs unconstrained optimization with upper and lower limits at
<code>-Inf</code> and <code>Inf</code>.  When user-defined lower and upper limits are
supplied to <code>'init.lo'</code> and/or <code>'init.hi'</code>, these default limits
are replaced with the user-specified values, and the method
<code>"L-BFGS-B"</code> is used for box-constrained optimization instead of the
user defined <code>'optim.method'</code>.  It is possible to only set either
maximum or minimum limits.  When initial values supplied to 
<code>'init.est'</code> or from default methods lie outside the limits, the 
in-feasible values will be set to the limits using the function 
<code>bmchk</code>.
</p>
<p>The function <code>aldvmm()</code> returns the negative log-likelihood, Akaike 
information criterion and Bayesian information criterion. Smaller values 
of these measures indicate better fit.
</p>
<p>If <code>'se.fit'</code> is set to <code>TRUE</code>, standard errors of fitted values
are calculated using the delta method.  The standard errors of fitted
values in the estimation data set are calculated as <code class="reqn">se_{fit} =
  \sqrt{G^{t} \Sigma G}</code>, where <code class="reqn">G</code>
is the gradient of a fitted value with respect to changes of parameter
estimates, and <code class="reqn">\Sigma</code> is the estimated covariance matrix of
parameters (Dowd et al., 2014).  The standard errors of predicted values
in new data sets are calculated as <code class="reqn">se_{pred} = \sqrt{MSE + G^{t}
  \Sigma G}</code>, where
<code class="reqn">MSE</code> is the mean squared error of fitted versus observed
outcomes in the original estimation data (Whitmore, 1986).
</p>
<p>The generic function
<code>summary</code> can be
used to obtain or print a summary of the results. The generic function
<code>predict</code> can
be used to obtain predicted values and standard errors of predictions in
new data.
</p>


<h3>Value</h3>

<p><code>aldvmm</code>
returns an object of class "aldvmm". An object of class
"aldvmm" is a list containing the following objects. </p>
<table>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>a
numeric vector of parameter estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hessian</code></td>
<td>
<p>a numeric 
matrix object with second partial derivatives of the likelihood function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov</code></td>
<td>
<p>a numeric matrix object with covariances of parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>a scalar representing the number of observations that were 
used in the estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>a scalar representing the number of components that were
mixed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.null</code></td>
<td>
<p>an integer value of the residual 
degrees of freedom of a null model including intercepts and standard 
errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.residual</code></td>
<td>
<p>an integer value of the residual 
degrees of freedom..</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>an integer value of the number of iterations used in 
optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>an integer value indicating convergence. "0" 
indicates successful completion.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gof</code></td>
<td>
<p>a list including the following elements. </p>

<dl>
<dt><code>ll</code></dt>
<dd>
<p>a numeric value of the negative log-likelihood
<code class="reqn">-ll</code>.</p>
</dd> 
<dt><code>aic</code></dt>
<dd>
<p>a numeric value of the Akaike information
criterion <code class="reqn">AIC = 2n_{par} - 2ll</code>.</p>
</dd>
<dt><code>bic</code></dt>
<dd>
<p>a numeric value of the Bayesian information criterion
<code class="reqn">BIC = n_{par}*log(n_{obs}) - 2ll</code>.</p>
</dd>
<dt><code>mse</code></dt>
<dd>
<p>a numeric value of the mean squared error <code class="reqn">\sum{(y -
  \hat{y})^2}/(n_{obs} - n_{par})</code>.</p>
</dd>
<dt><code>mae</code></dt>
<dd>
<p>a numeric value of the mean absolute error <code class="reqn">\sum{|y
  - \hat{y}|}/(n_{obs} - n_{par})</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>a list including the following elements. </p>

<dl>
<dt><code>y</code></dt>
<dd>
<p>a numeric vector of observed outcomes in <code>'data'</code>.</p>
</dd>
<dt><code>yhat</code></dt>
<dd>
<p>a numeric vector of fitted values.</p>
</dd> <dt><code>res</code></dt>
<dd>
<p>a
numeric vector of residuals.</p>
</dd> <dt><code>se.fit</code></dt>
<dd>
<p>a numeric vector of the
standard error of fitted values.</p>
</dd> <dt><code>lower.fit</code></dt>
<dd>
<p>a numeric vector
of 95% lower confidence limits of fitted values.</p>
</dd>
<dt><code>upper.fit</code></dt>
<dd>
<p>a numeric vector of 95% upper confidence limits
of fitted values</p>
</dd> <dt><code>prob</code></dt>
<dd>
<p>a numeric matrix of expected 
probabilities of group membership per individual in <code>'data'</code>.</p>
</dd> </dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>a list including the following elements. </p>

<dl>
<dt><code>est</code></dt>
<dd>
<p>a numeric vector of initial parameter estimates.</p>
</dd>
<dt><code>lo</code></dt>
<dd>
<p>a numeric vector of lower limits of parameter estimates.</p>
</dd>
<dt><code>hi</code></dt>
<dd>
<p>a numeric vector of upper limits of parameter
estimates.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>a character value including the model call captured by
<code>match.call</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class "formula" supplied to argument 
<code>'formula'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>
<p>a list of objects of class "terms" for the 
model of component means ("beta"), probabilities of component membership 
("delta") and the full model ("full").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>a nested list of character values showing 
contrasts of factors used in models of component means ("beta") and 
probabilities of component membership ("delta").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame created by 
<code>model.frame</code> 
including estimation data with additional attributes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>
<p>a numeric vector with the minimum and maximum utility
below 1 in <code>'data'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>a character value indicating the used component 
distributions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>a list including the following elements. </p>

<dl>
<dt><code>lcoef</code></dt>
<dd>
<p>a character vector of labels for objects including
results on distributions (default <code>"beta"</code>) and the probabilities of
component membership (default <code>"delta"</code>).</p>
</dd> <dt><code>lcpar</code></dt>
<dd>
<p>a
character vector of labels for objects including constant distribution
parameters (default <code>"sigma"</code> for <code>dist = "normal"</code>).</p>
</dd>
<dt><code>lcmp</code></dt>
<dd>
<p>a character value of the label for objects including
results on different components (default "Comp")</p>
</dd> <dt><code>lvar</code></dt>
<dd>
<p>a
list including 2 character vectors of covariate names for model parameters
of distributions (<code>"beta"</code>) and the multinomial logit
(<code>"delta"</code>).</p>
</dd> </dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim.method</code></td>
<td>
<p>a character value of the used
<code>optimr</code>
method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>a numeric value of the confidence level used for 
reporting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>an object of class "omit" extracted from the 
"na.action" attribute of the data frame created by 
<code>model.frame</code> 
in the preparation of model matrices.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Alava, M. H. and Wailoo, A. (2015) Fitting adjusted limited
dependent variable mixture models to EQ-5D. <em>The Stata Journal</em>,
<b>15(3)</b>, 737–750. <a href="https://doi.org/10.1177/1536867X1501500307">doi:10.1177/1536867X1501500307</a>
</p>
<p>Dowd, B. E., Greene, W. H., and Norton, E. C. (2014) Computation of
standard errors. <em>Health services research</em>, <b>49(2)</b>, 731–750.
<a href="https://doi.org/10.1111/1475-6773.12122">doi:10.1111/1475-6773.12122</a>
</p>
<p>Whitmore, G. A. (1986) Prediction limits for a univariate normal
observation. <em>The American Statistician</em>, <b>40(2)</b>, 141–143.
<a href="https://doi.org/10.1080/00031305.1986.10475378">doi:10.1080/00031305.1986.10475378</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(utility)

 fit &lt;- aldvmm(eq5d ~ age + female | 1,
               data = utility,
               psi = c(0.883, -0.594),
               ncmp = 2)

 summary(fit)

 yhat &lt;- predict(fit)

</code></pre>


</div>