<div class="container">

<table style="width: 100%;"><tr>
<td>EM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
EM Algorithm for State Space Models
</h2>

<h3>Description</h3>

<p>Estimation of the parameters in general linear state space models via the EM algorithm.   
Missing data may be entered as <code>NA</code> or as zero (0), however, use <code>NA</code>s if zero (0) can be an
observation. Inputs in both the state and observation equations are allowed. This script replaces <code>EM0</code> and <code>EM1</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">EM(y, A, mu0, Sigma0, Phi, Q, R, Ups = NULL, Gam = NULL, input = NULL, 
    max.iter = 100, tol = 1e-04)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>data matrix (n <code>x</code> q), vector or time series, n = number of observations, q = number of series.
Use <code>NA</code> or  zero (0) for missing data, however, use <code>NA</code>s if zero (0) can be an
observation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>

<p>measurement matrices; can be constant or an array with dimension <code>dim=c(q,p,n)</code> if time varying.
Use <code>NA</code> or  zero (0) for missing data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu0</code></td>
<td>

<p>initial state mean vector (p <code>x</code> 1)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma0</code></td>
<td>

<p>initial state covariance matrix (p <code>x</code> p)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Phi</code></td>
<td>

<p>state transition matrix (p <code>x</code> p)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>

<p>state error matrix (p <code>x</code> p)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>

<p>observation error matrix (q <code>x</code> q - diagonal only)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ups</code></td>
<td>

<p>state input matrix (p <code>x</code> r); leave as NULL (default) if not needed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gam</code></td>
<td>

<p>observation input matrix (q <code>x</code> r); leave as NULL (default) if not needed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>

<p>NULL (default) if not needed or a   
matrix (n <code>x</code> r) of inputs having the same row dimension (n) as y
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.iter</code></td>
<td>

<p>maximum number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>

<p>relative tolerance for determining convergence
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This script replaces <code>EM0</code>  and <code>EM1</code> by combining all cases and allowing inputs in the state
and observation equations. It uses version 1 of the new <code>Ksmooth</code> script (hence correlated errors
is not allowed).
</p>
<p>The states <code class="reqn">x_t</code> are p-dimensional, the data <code class="reqn">y_t</code> are q-dimensional, and 
the inputs <code class="reqn">u_t</code> are r-dimensional for <code class="reqn">t=1, \dots, n</code>. The initial state is <code class="reqn">x_0 \sim N(\mu_0, \Sigma_0)</code>.
</p>
<p>The general model  is 
</p>
<p style="text-align: center;"><code class="reqn">x_t = \Phi  x_{t-1} + \Upsilon u_{t} +    w_t \quad w_t \sim iid\ N(0, Q)</code>
</p>

<p style="text-align: center;"><code class="reqn">y_t = A_t  x_{t-1} + \Gamma u_{t} +   v_t \quad v_t \sim iid\ N(0, R)</code>
</p>

<p>where <code class="reqn">w_t \perp v_t</code>. The observation noise covariance matrix is assumed to be diagonal and it is forced
to diagonal otherwise.
</p>
<p>The measurement matrices <code class="reqn">A_t</code> can be constant or time varying.  If time varying, they should be entered as an array of dimension <code>dim = c(q,p,n)</code>.  Otherwise, just enter the constant value making sure it has the appropriate <code class="reqn">q \times p</code> dimension.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Phi </code></td>
<td>
<p>Estimate of Phi</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q </code></td>
<td>
<p>Estimate of Q</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R </code></td>
<td>
<p>Estimate of R</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ups </code></td>
<td>
<p>Estimate of Upsilon (NULL if not used)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gam </code></td>
<td>
<p>Estimate of Gamma (NULL if not used)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu0 </code></td>
<td>
<p>Estimate of initial state mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma0 </code></td>
<td>
<p>Estimate of initial state covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>like </code></td>
<td>
<p>-log likelihood at each iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter </code></td>
<td>
<p>number of iterations to convergence</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cvg </code></td>
<td>
<p>relative tolerance at convergence</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The script does not allow for constrained estimation directly, however, constrained estimation is possible with some extra manipulations. There is an example of constrained estimation using <code>EM</code> at <a href="https://github.com/nickpoison/astsa/blob/master/fun_with_astsa/fun_with_astsa.md">FUN WITH ASTSA</a>, where the fun never stops.
</p>


<h3>Author(s)</h3>

<p>D.S. Stoffer
</p>


<h3>References</h3>

<p>You can find demonstrations of astsa capabilities at  
<a href="https://github.com/nickpoison/astsa/blob/master/fun_with_astsa/fun_with_astsa.md">FUN WITH ASTSA</a>.
</p>
<p>The most recent version of the package can be found  at <a href="https://github.com/nickpoison/astsa/">https://github.com/nickpoison/astsa/</a>.
</p>
<p>In addition, the News and ChangeLog files are at  <a href="https://github.com/nickpoison/astsa/blob/master/NEWS.md">https://github.com/nickpoison/astsa/blob/master/NEWS.md</a>.
</p>
<p>The webpages for the texts and some help on using R for time series analysis can be found at
<a href="https://nickpoison.github.io/">https://nickpoison.github.io/</a>. 
</p>


<h3>See Also</h3>

<p><code>Kfilter, Ksmooth </code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># example used for ssm() 
# x[t] = Ups + Phi x[t-1] + w[t]
# y[t] = x[t] + v[t]
y = gtemp_land  
A = 1; Phi = 1; Ups = 0.01
Q = 0.001; R = 0.01
mu0 = -0.6; Sigma0 = 0.02
input = rep(1, length(y))
( em = EM(y, A, mu0, Sigma0, Phi, Q, R, Ups, Gam=NULL, input) ) 
</code></pre>


</div>