<div class="container">

<table style="width: 100%;"><tr>
<td>allocate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Allocate soil properties within various classification systems.</h2>

<h3>Description</h3>

<p>Generic function to allocate soil properties to different classification schemes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">allocate(
  ...,
  to = c("FAO Salt Severity", "FAO Black Soil", "ST Diagnostic Features"),
  droplevels = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to specific allocation functions, see details and examples</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>character specifying the classification scheme: FAO Salt Severity, FAO Black Soil (see details for the required <code>...</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>droplevels</code></td>
<td>
<p>logical indicating whether to drop unused levels in factors. This is useful when the results have a large number of unused classes, which can waste space in tables and figures.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is intended to allocate a set of soil properties to an established soil classification scheme, such as Salt Severity or Black Soil. Allocation is semantically different from classification. While classification is the 'act' of developing a grouping scheme, allocation is the assignment or identification of measurements to a established class (Powell, 2008).
</p>


<h4>Usage Details</h4>

<p>Each classification scheme (<code>to</code> argument) uses a different set of arguments.
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠FAO Salt Severity⁠</code>
</p>

<ul>
<li> <p><strong>EC:</strong> electrical conductivity column name, dS/m
</p>
</li>
<li> <p><strong>pH:</strong> pH column name, saturated paste extract
</p>
</li>
<li> <p><strong>ESP:</strong> exchangeable sodium percentage column name, percent
</p>
</li>
</ul>
</li>
<li> <p><code style="white-space: pre;">⁠FAO Black Soils⁠</code>
</p>

<ul>
<li> <p><strong>object:</strong> a <code>data.frame</code> or <code>SoilProfileCollection</code>
</p>
</li>
<li> <p><strong>pedonid:</strong> pedon ID column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>hztop:</strong> horizon top depth column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>hzbot:</strong> horizon bottom depth column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>OC</strong>: organic carbon column name, percent
</p>
</li>
<li> <p><strong>m_chroma:</strong> moist Munsell chroma column name
</p>
</li>
<li> <p><strong>m_value:</strong> moist Munsell value column name
</p>
</li>
<li> <p><strong>d_value:</strong> dry Munsell value column name
</p>
</li>
<li> <p><strong>CEC:</strong> cation exchange capacity column name (NH4OAc at pH 7), units of cmol(+)/kg soil
</p>
</li>
<li> <p><strong>BS:</strong> base saturation column name (NH4OAc at pH 7), percent
</p>
</li>
<li> <p><strong>tropical:</strong> logical, data are associated with "tropical soils"
</p>
</li>
</ul>
</li>
<li> <p><code style="white-space: pre;">⁠ST Diagnostic Features⁠</code>
</p>

<ul>
<li> <p><strong>object:</strong> a <code>data.frame</code> or <code>SoilProfileCollection</code>
</p>
</li>
<li> <p><strong>pedonid:</strong> pedon ID column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>hzname:</strong> horizon name column, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>hztop:</strong> horizon top depth column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>hzbot:</strong> horizon bottom depth column name, required when <code>object</code> is a <code>data.frame</code>
</p>
</li>
<li> <p><strong>texcl:</strong> soil texture class (USDA) column name
</p>
</li>
<li> <p><strong>rupresblkcem:</strong> rupture resistance column name
</p>
</li>
<li> <p><strong>m_value:</strong> moist Munsell value column name
</p>
</li>
<li> <p><strong>m_chroma:</strong> moist Munsell chroma column name
</p>
</li>
<li> <p><strong>d_value:</strong> dry Munsell value column name
</p>
</li>
<li> <p><strong>BS:</strong> base saturation column name (method ??), percent
</p>
</li>
<li> <p><strong>OC</strong>: organic carbon column name, percent
</p>
</li>
<li> <p><strong>n_value:</strong> ??
</p>
</li>
<li> <p><strong>featkind:</strong> ??
</p>
</li>
</ul>
</li>
</ul>
<h3>Value</h3>

<p>A vector or <code>data.frame</code> object.
</p>


<h3>Note</h3>

<p>The results returned by <code>allocate(to = "ST Diagnostic Features")</code> currently return a limited set of diagnostic features that are easily defined. Also, the logic implemented for some features does not include all the criteria defined in the Keys to Soil Taxonomy.
</p>


<h3>Author(s)</h3>

<p>Stephen Roecker
</p>


<h3>References</h3>

<p>Abrol, I., Yadav, J. &amp; Massoud, F. 1988. <a href="https://www.fao.org/4/x5871e/x5871e00.htm">Salt-affected soils and their management</a>. No. Bulletin 39. Rome, FAO Soils.
</p>
<p>FAO. 2006. <a href="https://www.fao.org/4/a0541e/a0541e.pdf">Guidelines for soil description</a>. Rome, Food and Agriculture Organization of the United Nations.
</p>
<p>FAO. 2020. DEFINITION | What is a black soil? (online). (Cited 28 December 2020). http://www.fao.org/global-soil-partnership/intergovernmental-technical-panel-soils/gsoc17-implementation/internationalnetworkblacksoils/more-on-black-soils/definition-what-is-a-black-soil/es/
</p>
<p>Powell, B., 2008. Classifying soil and land, in: McKenzie, N.J., Grundy, M.J., Webster, R., Ringrose-Voase, A.J. (Eds.), Guidelines for Survey Soil and Land Resources, Australian Soil and Land Survey Handbook Series. CSIRO, Melbourne, p. 572.
</p>
<p>Richards, L.A. 1954. <a href="https://www.ars.usda.gov/ARSUserFiles/20360500/hb60_pdf/hb60complete.pdf">Diagnosis and Improvement of Saline and Alkali Soils</a>. U. S. Government Printing Office. 166 pp.
</p>
<p>Soil Survey Staff, 2014. Keys to Soil Taxonomy, 12th ed. USDA-Natural Resources Conservation Service, Washington, D.C.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Salt Severity
test &lt;- expand.grid(
  EC  = sort(sapply(c(0, 0.75, 2, 4, 8, 15, 30), function(x) x + c(0, -0.05, 0.05))),
  pH  = c(8.1, 8.2, 8.3, 8.4, 8.5, 8.6),
  ESP = sort(sapply(c(0, 15, 30, 50, 70, 100), function(x) x + c(0, 0.1, -0.1)))
)
test$ss      &lt;- with(test, allocate(EC = EC, pH = pH, ESP = ESP, to = "FAO Salt Severity"))
table(test$ss)

# Black Soil Category 1 (BS1)
test &lt;- expand.grid(
  dept = seq(0, 50, 10),
  OC   = sort(sapply(c(0, 0.6, 1.2, 20, 40), function(x) x + c(0, -0.05, 0.05))),
  chroma_moist  = 2:4,
  value_moist   = 2:4,
  value_dry     = 4:6,
  thickness     = 24:26,
  CEC           = 24:26,
  BS            = 49:51,
  tropical      = c(TRUE, FALSE)
)
test$pedon_id &lt;- rep(1:21870, each = 6)
test$depb     &lt;- test$dept + 10

bs1 &lt;- allocate(test, pedonid = "pedon_id", hztop = "dept", hzbot = "depb", 
                OC = "OC", m_chroma = "chroma_moist", m_value = "value_moist", 
                d_value = "value_dry", CEC = "CEC", BS = "BS", 
                to = "FAO Black Soil"
)

table(BS1 = bs1$BS1, BS2 = bs1$BS2)


# SoilProfileCollection interface

data(sp3)
depths(sp3) &lt;- id ~ top + bottom
hzdesgnname(sp3) &lt;- 'name'

# fake base saturation
horizons(sp3)$bs &lt;- 75

plotSPC(sp3)

allocate(
  sp3, 
  to = 'FAO Black Soil', 
  OC = 'tc', 
  m_chroma = 'chroma', 
  m_value = 'value', 
  d_value = 'value',
  CEC = 'cec',
  BS = 'bs'
)

# make a copy and edit horizon values
x &lt;- sp3
x$value &lt;- 2
x$chroma &lt;- 2
x$cec &lt;- 26
x$tc &lt;- 2

x$soil_color &lt;- munsell2rgb(x$hue, x$value, x$chroma)

plotSPC(x)

allocate(
  x, 
  to = 'FAO Black Soil', 
  OC = 'tc', 
  m_chroma = 'chroma', 
  m_value = 'value', 
  d_value = 'value',
  CEC = 'cec',
  BS = 'bs'
)


# Soil Taxonomy Diagnostic Features
data(sp1)
sp1$texcl = gsub("gr|grv|cbv", "", sp1$texture)
df &lt;- allocate(object = sp1, pedonid = "id", hzname = "name", 
               hzdept = "top", hzdepb = "bottom", texcl = "texcl", 
               to = "ST Diagnostic Features"
)
aggregate(featdept ~ id, data = df, summary)

</code></pre>


</div>