<div class="container">

<table style="width: 100%;"><tr>
<td>resid_disc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Residuals for regression models with discrete outcomes</h2>

<h3>Description</h3>

<p>Calculates the DPIT residuals for regression models with discrete outcomes.
Specifically, the model assumption of GLMs with binary, ordinal, Poisson,
and negative binomial outcomes
can be assessed using <code>resid_disc()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">resid_disc(model, plot=TRUE, scale="normal")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Model object (e.g., <code>glm</code>, <code>glm.nb</code>, <code>polr</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>A logical value indicating whether or not to return QQ-plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>You can choose the scale of the residuals among <code>normal</code> and <code>uniform</code> scales.
The sample quantiles of the residuals are plotted against
the theoretical quantiles of a standard normal distribution under the normal scale,
and against the theoretical quantiles of a uniform (0,1) distribution under the uniform scale.
The defalut scale is <code>normal</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The DPIT residual for the <code class="reqn">i</code>th observation is defined as follows:
</p>
<p style="text-align: center;"><code class="reqn">\hat{r}(Y_i|X_i) = \hat{G}\bigg(\hat{F}(Y_i|\mathbf{X}_i)\bigg)</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">\hat{G}(s) = \frac{1}{n-1}\sum_{j=1, j \neq i}^{n}\hat{F}\bigg(\hat{F}^{(-1)}(\mathbf{X}_j)\bigg|\mathbf{X}_j\bigg)</code>
</p>

<p>and <code class="reqn">\hat{F}</code> refers to the fitted cumulative distribution function.
When <code>scale="uniform"</code>, DPIT residuals should closely follow a uniform distribution, otherwise it implies model deficiency.
When <code>scale="normal"</code>, it applies the normal quantile transformation to the DPIT residuals
</p>
<p style="text-align: center;"><code class="reqn">\Phi^{-1}\left[\hat{r}(Y_i|\mathbf{X}_i)\right],i=1,\ldots,n.</code>
</p>
<p> The null pattern is the standard normal distribution in this case.
<br></p>
<p>Check reference for more details.
</p>


<h3>Value</h3>

<p>DPIT residuals. If <code>plot=TRUE</code>, also produces a QQ plot.
</p>


<h3>References</h3>

<p>Yang, Lu. "Double Probability Integral Transform Residuals for Regression Models with Discrete Outcomes." arXiv preprint arXiv:2308.15596 (2023).
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(MASS)
n &lt;- 500
set.seed(1234)
## Negative Binomial example
# Covariates
x1 &lt;- rnorm(n)
x2 &lt;- rbinom(n, 1, 0.7)
### Parameters
beta0 &lt;- -2
beta1 &lt;- 2
beta2 &lt;- 1
size1 &lt;- 2
lambda1 &lt;- exp(beta0 + beta1 * x1 + beta2 * x2)
# generate outcomes
y &lt;- rnbinom(n, mu = lambda1, size = size1)

# True model
model1 &lt;- glm.nb(y ~ x1 + x2)
resid.nb1 &lt;- resid_disc(model1, plot = TRUE, scale = "uniform")

# Overdispersion
model2 &lt;- glm(y ~ x1 + x2, family = poisson(link = "log"))
resid.nb2 &lt;- resid_disc(model2, plot = TRUE, scale = "normal")

## Binary example
n &lt;- 500
set.seed(1234)
# Covariates
x1 &lt;- rnorm(n, 1, 1)
x2 &lt;- rbinom(n, 1, 0.7)
# Coefficients
beta0 &lt;- -5
beta1 &lt;- 2
beta2 &lt;- 1
beta3 &lt;- 3
q1 &lt;- 1 / (1 + exp(beta0 + beta1 * x1 + beta2 * x2 + beta3 * x1 * x2))
y1 &lt;- rbinom(n, size = 1, prob = 1 - q1)

# True model
model01 &lt;- glm(y1 ~ x1 * x2, family = binomial(link = "logit"))
resid.bin1 &lt;- resid_disc(model01, plot = TRUE)

# Missing covariates
model02 &lt;- glm(y1 ~ x1, family = binomial(link = "logit"))
resid.bin2 &lt;- resid_disc(model02, plot = TRUE)

## Poisson example
n &lt;- 500
set.seed(1234)
# Covariates
x1 &lt;- rnorm(n)
x2 &lt;- rbinom(n, 1, 0.7)
# Coefficients
beta0 &lt;- -2
beta1 &lt;- 2
beta2 &lt;- 1
lambda1 &lt;- exp(beta0 + beta1 * x1 + beta2 * x2)
y &lt;- rpois(n, lambda1)

# True model
poismodel1 &lt;- glm(y ~ x1 + x2, family = poisson(link = "log"))
resid.poi1 &lt;- resid_disc(poismodel1, plot = TRUE)

# Enlarge three outcomes
y &lt;- rpois(n, lambda1) + c(rep(0, (n - 3)), c(10, 15, 20))
poismodel2 &lt;- glm(y ~ x1 + x2, family = poisson(link = "log"))
resid.poi2 &lt;- resid_disc(poismodel2, plot = TRUE)

## Ordinal example
n &lt;- 500
set.seed(1234)
# Covariates
x1 &lt;- rnorm(n, mean = 2)
# Coefficient
beta1 &lt;- 3

# True model
p0 &lt;- plogis(1, location = beta1 * x1)
p1 &lt;- plogis(4, location = beta1 * x1) - p0
p2 &lt;- 1 - p0 - p1
genemult &lt;- function(p) {
  rmultinom(1, size = 1, prob = c(p[1], p[2], p[3]))
}
test &lt;- apply(cbind(p0, p1, p2), 1, genemult)
y1 &lt;- rep(0, n)
y1[which(test[1, ] == 1)] &lt;- 0
y1[which(test[2, ] == 1)] &lt;- 1
y1[which(test[3, ] == 1)] &lt;- 2
multimodel &lt;- polr(as.factor(y1) ~ x1, method = "logistic")
resid.ord1 &lt;- resid_disc(multimodel, plot = TRUE)

## Non-Proportionality
n &lt;- 500
set.seed(1234)
x1 &lt;- rnorm(n, mean = 2)
beta1 &lt;- 3
beta2 &lt;- 1
p0 &lt;- plogis(1, location = beta1 * x1)
p1 &lt;- plogis(4, location = beta2 * x1) - p0
p2 &lt;- 1 - p0 - p1
genemult &lt;- function(p) {
  rmultinom(1, size = 1, prob = c(p[1], p[2], p[3]))
}
test &lt;- apply(cbind(p0, p1, p2), 1, genemult)
y1 &lt;- rep(0, n)
y1[which(test[1, ] == 1)] &lt;- 0
y1[which(test[2, ] == 1)] &lt;- 1
y1[which(test[3, ] == 1)] &lt;- 2
multimodel &lt;- polr(as.factor(y1) ~ x1, method = "logistic")
resid.ord2 &lt;- resid_disc(multimodel, plot = TRUE)
</code></pre>


</div>