<div class="container">

<table style="width: 100%;"><tr>
<td>certificate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Certificate object</h2>

<h3>Description</h3>

<p>This class represents a certificate stored in a vault. It provides methods for carrying out operations, including encryption and decryption, signing and verification, and wrapping and unwrapping.
</p>


<h3>Fields</h3>

<p>This class provides the following fields:
</p>

<ul>
<li> <p><code>cer</code>: The contents of the certificate, in CER format.
</p>
</li>
<li> <p><code>id</code>: The ID of the certificate.
</p>
</li>
<li> <p><code>kid</code>: The ID of the key backing the certificate.
</p>
</li>
<li> <p><code>sid</code>: The ID of the secret backing the certificate.
</p>
</li>
<li> <p><code>contentType</code>: The content type of the secret backing the certificate.
</p>
</li>
<li> <p><code>policy</code>: The certificate management policy, containing the authentication details.
</p>
</li>
<li> <p><code>x5t</code>: The thumbprint of the certificate.
</p>
</li>
</ul>
<h3>Methods</h3>

<p>This class provides the following methods:</p>
<pre>export(file)
export_cer(file)
sign(digest, ...)
verify(signature, digest, ...)
set_policy(subject=NULL, x509=NULL, issuer=NULL,
           key=NULL, secret_type=NULL, actions=NULL,
           attributes=NULL, wait=TRUE)
get_policy()
sync()

update_attributes(attributes=vault_object_attrs(), ...)
list_versions()
set_version(version=NULL)
delete(confirm=TRUE)
</pre>


<h3>Arguments</h3>


<ul>
<li> <p><code>file</code>: For <code>export</code> and <code>export_cer</code>, a connection object or a character string naming a file to export to.
</p>
</li>
<li> <p><code>digest</code>: For <code>sign</code>, a hash digest string to sign. For <code>verify</code>, a digest to compare to a signature.
</p>
</li>
<li> <p><code>signature</code>: For <code>verify</code>, a signature string.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠subject,x509,issuer,key,secret_type,actions,wait⁠</code>: These are the same arguments as used when creating a new certificate. See certificates for more information.
</p>
</li>
<li> <p><code>attributes</code>: For <code>update_attributes</code>, the new attributes for the object, such as the expiry date and activation date. A convenient way to provide this is via the vault_object_attrs helper function.
</p>
</li>
<li> <p><code>...</code>: For <code>update_attributes</code>, additional key-specific properties to update. For <code>sign</code> and <code>verify</code>, additional arguments for the corresponding key object methods. See keys and key.
</p>
</li>
<li> <p><code>version</code>: For <code>set_version</code>, the version ID or NULL for the current version.
</p>
</li>
<li> <p><code>confirm</code>: For <code>delete</code>, whether to ask for confirmation before deleting the key.
</p>
</li>
</ul>
<h3>Details</h3>

<p><code>export</code> exports the full certificate to a file. The format wll be either PEM or PFX (aka PKCS#12), as set by the <code>format</code> argument when the certificate was created. <code>export_cer</code> exports the public key component, aka the CER file. Note that the public key can also be found in the <code>cer</code> field of the object.
</p>
<p><code>sign</code> uses the key associated with the a certificate to sign a digest, and <code>verify</code> checks a signature against a digest for authenticity. See below for an example of using <code>sign</code> to do OAuth authentication with certificate credentials.
</p>
<p><code>set_policy</code> updates the authentication details of a certificate: its issuer, identity, key type, renewal actions, and so on. <code>get_policy</code> returns the current policy of a certificate.
</p>
<p>A certificate can have multiple <em>versions</em>, which are automatically generated when a cert is created with the same name as an existing cert. By default, this object contains the information for the most recent (current) version; use <code>list_versions</code> and <code>set_version</code> to change the version.
</p>


<h3>Value</h3>

<p>For <code>get_policy</code>, a list of certificate policy details.
</p>
<p>For <code>list_versions</code>, a data frame containing details of each version.
</p>
<p>For <code>set_version</code>, the key object with the updated version.
</p>


<h3>See Also</h3>

<p>certificates
</p>
<p><a href="https://docs.microsoft.com/en-us/azure/key-vault/">Azure Key Vault documentation</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/keyvault">Azure Key Vault API reference</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

vault &lt;- key_vault("mykeyvault")

cert &lt;- vault$certificates$create("mynewcert")
cert$cer
cert$export("mynewcert.pem")

# new version of an existing certificate
vault$certificates$create("mynewcert", x509=cert_x509_properties(validity_months=24))

cert &lt;- vault$certificates$get("mynewcert")
vers &lt;- cert$list_versions()
cert$set_version(vers[2])

# updating an existing cert version
cert$set_policy(x509=cert_x509_properties(validity_months=12))


## signing a JSON web token (JWT) for authenticating with Azure Active Directory
app &lt;- "app_id"
tenant &lt;- "tenant_id"
claim &lt;- jose::jwt_claim(
    iss=app,
    sub=app,
    aud="https://login.microsoftonline.com/tenant_id/oauth2/token",
    exp=as.numeric(Sys.time() + 60*60),
    nbf=as.numeric(Sys.time())
)
# header includes cert thumbprint
header &lt;- list(alg="RS256", typ="JWT", x5t=cert$x5t)

token_encode &lt;- function(x)
{
    jose::base64url_encode(jsonlite::toJSON(x, auto_unbox=TRUE))
}
token_contents &lt;- paste(token_encode(header), token_encode(claim), sep=".")

# get the signature and concatenate it with header and claim to form JWT
sig &lt;- cert$sign(openssl::sha256(charToRaw(token_contents)))
cert_creds &lt;- paste(token_contents, sig, sep=".")

AzureAuth::get_azure_token("resource_url", tenant, app, certificate=cert_creds)


## End(Not run)
</code></pre>


</div>