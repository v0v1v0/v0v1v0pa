<div class="container">

<table style="width: 100%;"><tr>
<td>proportion</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate Antimicrobial Resistance</h2>

<h3>Description</h3>

<p>These functions can be used to calculate the (co-)resistance or susceptibility of microbial isolates (i.e. percentage of S, SI, I, IR or R). All functions support quasiquotation with pipes, can be used in <code>summarise()</code> from the <code>dplyr</code> package and also support grouped variables, see <em>Examples</em>.
</p>
<p><code>resistance()</code> should be used to calculate resistance, <code>susceptibility()</code> should be used to calculate susceptibility.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">resistance(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

susceptibility(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

sir_confidence_interval(
  ...,
  ab_result = "R",
  minimum = 30,
  as_percent = FALSE,
  only_all_tested = FALSE,
  confidence_level = 0.95,
  side = "both",
  collapse = FALSE
)

proportion_R(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

proportion_IR(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

proportion_I(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

proportion_SI(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

proportion_S(..., minimum = 30, as_percent = FALSE, only_all_tested = FALSE)

proportion_df(
  data,
  translate_ab = "name",
  language = get_AMR_locale(),
  minimum = 30,
  as_percent = FALSE,
  combine_SI = TRUE,
  confidence_level = 0.95
)

sir_df(
  data,
  translate_ab = "name",
  language = get_AMR_locale(),
  minimum = 30,
  as_percent = FALSE,
  combine_SI = TRUE,
  confidence_level = 0.95
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>one or more vectors (or columns) with antibiotic interpretations. They will be transformed internally with <code>as.sir()</code> if needed. Use multiple columns to calculate (the lack of) co-resistance: the probability where one of two drugs have a resistant or susceptible result. See <em>Examples</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum</code></td>
<td>
<p>the minimum allowed number of available (tested) isolates. Any isolate count lower than <code>minimum</code> will return <code>NA</code> with a warning. The default number of <code>30</code> isolates is advised by the Clinical and Laboratory Standards Institute (CLSI) as best practice, see <em>Source</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_percent</code></td>
<td>
<p>a logical to indicate whether the output must be returned as a hundred fold with % sign (a character). A value of <code>0.123456</code> will then be returned as <code>"12.3%"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only_all_tested</code></td>
<td>
<p>(for combination therapies, i.e. using more than one variable for <code>...</code>): a logical to indicate that isolates must be tested for all antibiotics, see section <em>Combination Therapy</em> below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ab_result</code></td>
<td>
<p>antibiotic results to test against, must be one or more values of "S", "I", or "R"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confidence_level</code></td>
<td>
<p>the confidence level for the returned confidence interval. For the calculation, the number of S or SI isolates, and R isolates are compared with the total number of available isolates with R, S, or I by using <code>binom.test()</code>, i.e., the Clopper-Pearson method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>side</code></td>
<td>
<p>the side of the confidence interval to return. The default is <code>"both"</code> for a length 2 vector, but can also be (abbreviated as) <code>"min"</code>/<code>"left"</code>/<code>"lower"</code>/<code>"less"</code> or <code>"max"</code>/<code>"right"</code>/<code>"higher"</code>/<code>"greater"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collapse</code></td>
<td>
<p>a logical to indicate whether the output values should be 'collapsed', i.e. be merged together into one value, or a character value to use for collapsing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data.frame containing columns with class <code>sir</code> (see <code>as.sir()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>translate_ab</code></td>
<td>
<p>a column name of the antibiotics data set to translate the antibiotic abbreviations to, using <code>ab_property()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>language</code></td>
<td>
<p>language of the returned text - the default is the current system language (see <code>get_AMR_locale()</code>) and can also be set with the package option <code>AMR_locale</code>. Use <code>language = NULL</code> or <code>language = ""</code> to prevent translation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combine_SI</code></td>
<td>
<p>a logical to indicate whether all values of S and I must be merged into one, so the output only consists of S+I vs. R (susceptible vs. resistant) - the default is <code>TRUE</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Remember that you should filter your data to let it contain only first isolates!</strong> This is needed to exclude duplicates and to reduce selection bias. Use <code>first_isolate()</code> to determine them in your data set with one of the four available algorithms.
</p>
<p>The function <code>resistance()</code> is equal to the function <code>proportion_R()</code>. The function <code>susceptibility()</code> is equal to the function <code>proportion_SI()</code>.
</p>
<p>Use <code>sir_confidence_interval()</code> to calculate the confidence interval, which relies on <code>binom.test()</code>, i.e., the Clopper-Pearson method. This function returns a vector of length 2 at default for antimicrobial <em>resistance</em>. Change the <code>side</code> argument to "left"/"min" or "right"/"max" to return a single value, and change the <code>ab_result</code> argument to e.g. <code>c("S", "I")</code> to test for antimicrobial <em>susceptibility</em>, see Examples.
</p>
<p>These functions are not meant to count isolates, but to calculate the proportion of resistance/susceptibility. Use the <code>count_*()</code> functions to count isolates. The function <code>susceptibility()</code> is essentially equal to <code>count_susceptible()</code><code>/</code><code>count_all()</code>. <em>Low counts can influence the outcome - the <code style="white-space: pre;">⁠proportion_*()⁠</code> functions may camouflage this, since they only return the proportion (albeit dependent on the <code>minimum</code> argument).</em>
</p>
<p>The function <code>proportion_df()</code> takes any variable from <code>data</code> that has an <code>sir</code> class (created with <code>as.sir()</code>) and calculates the proportions S, I, and R. It also supports grouped variables. The function <code>sir_df()</code> works exactly like <code>proportion_df()</code>, but adds the number of isolates.
</p>


<h3>Value</h3>

<p>A double or, when <code>as_percent = TRUE</code>, a character.
</p>


<h3>Combination Therapy</h3>

<p>When using more than one variable for <code>...</code> (= combination therapy), use <code>only_all_tested</code> to only count isolates that are tested for all antibiotics/variables that you test them for. See this example for two antibiotics, Drug A and Drug B, about how <code>susceptibility()</code> works to calculate the %SI:
</p>
<div class="sourceCode"><pre>--------------------------------------------------------------------
                    only_all_tested = FALSE  only_all_tested = TRUE
                    -----------------------  -----------------------
 Drug A    Drug B   include as  include as   include as  include as
                    numerator   denominator  numerator   denominator
--------  --------  ----------  -----------  ----------  -----------
 S or I    S or I       X            X            X            X
   R       S or I       X            X            X            X
  &lt;NA&gt;     S or I       X            X            -            -
 S or I      R          X            X            X            X
   R         R          -            X            -            X
  &lt;NA&gt;       R          -            -            -            -
 S or I     &lt;NA&gt;        X            X            -            -
   R        &lt;NA&gt;        -            -            -            -
  &lt;NA&gt;      &lt;NA&gt;        -            -            -            -
--------------------------------------------------------------------
</pre></div>
<p>Please note that, in combination therapies, for <code>only_all_tested = TRUE</code> applies that:
</p>
<div class="sourceCode"><pre>    count_S()    +   count_I()    +   count_R()    = count_all()
  proportion_S() + proportion_I() + proportion_R() = 1
</pre></div>
<p>and that, in combination therapies, for <code>only_all_tested = FALSE</code> applies that:
</p>
<div class="sourceCode"><pre>    count_S()    +   count_I()    +   count_R()    &gt;= count_all()
  proportion_S() + proportion_I() + proportion_R() &gt;= 1
</pre></div>
<p>Using <code>only_all_tested</code> has no impact when only using one antibiotic as input.
</p>


<h3>Interpretation of SIR</h3>

<p>In 2019, the European Committee on Antimicrobial Susceptibility Testing (EUCAST) has decided to change the definitions of susceptibility testing categories S, I, and R as shown below (<a href="https://www.eucast.org/newsiandr">https://www.eucast.org/newsiandr</a>):
</p>

<ul>
<li> <p><strong>S - Susceptible, standard dosing regimen</strong><br>
A microorganism is categorised as "Susceptible, standard dosing regimen", when there is a high likelihood of therapeutic success using a standard dosing regimen of the agent.
</p>
</li>
<li> <p><strong>I - Susceptible, increased exposure</strong> <em><br>
A microorganism is categorised as "Susceptible, Increased exposure</em>" when there is a high likelihood of therapeutic success because exposure to the agent is increased by adjusting the dosing regimen or by its concentration at the site of infection.
</p>
</li>
<li> <p><strong>R = Resistant</strong><br>
A microorganism is categorised as "Resistant" when there is a high likelihood of therapeutic failure even when there is increased exposure.
</p>

<ul><li> <p><em>Exposure</em> is a function of how the mode of administration, dose, dosing interval, infusion time, as well as distribution and excretion of the antimicrobial agent will influence the infecting organism at the site of infection.
</p>
</li></ul>
</li>
</ul>
<p>This AMR package honours this insight. Use <code>susceptibility()</code> (equal to <code>proportion_SI()</code>) to determine antimicrobial susceptibility and <code>count_susceptible()</code> (equal to <code>count_SI()</code>) to count susceptible isolates.
</p>


<h3>Source</h3>

<p><strong>M39 Analysis and Presentation of Cumulative Antimicrobial Susceptibility Test Data, 5th Edition</strong>, 2022, <em>Clinical and Laboratory Standards Institute (CLSI)</em>. <a href="https://clsi.org/standards/products/microbiology/documents/m39/">https://clsi.org/standards/products/microbiology/documents/m39/</a>.
</p>


<h3>See Also</h3>

<p><code>count()</code> to count resistant and susceptible isolates.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># example_isolates is a data set available in the AMR package.
# run ?example_isolates for more info.
example_isolates


# base R ------------------------------------------------------------
# determines %R
resistance(example_isolates$AMX)
sir_confidence_interval(example_isolates$AMX)
sir_confidence_interval(example_isolates$AMX,
  confidence_level = 0.975
)
sir_confidence_interval(example_isolates$AMX,
  confidence_level = 0.975,
  collapse = ", "
)

# determines %S+I:
susceptibility(example_isolates$AMX)
sir_confidence_interval(example_isolates$AMX,
  ab_result = c("S", "I")
)

# be more specific
proportion_S(example_isolates$AMX)
proportion_SI(example_isolates$AMX)
proportion_I(example_isolates$AMX)
proportion_IR(example_isolates$AMX)
proportion_R(example_isolates$AMX)

# dplyr -------------------------------------------------------------

if (require("dplyr")) {
  example_isolates %&gt;%
    group_by(ward) %&gt;%
    summarise(
      r = resistance(CIP),
      n = n_sir(CIP)
    ) # n_sir works like n_distinct in dplyr, see ?n_sir
}
if (require("dplyr")) {
  example_isolates %&gt;%
    group_by(ward) %&gt;%
    summarise(
      cipro_R = resistance(CIP),
      ci_min = sir_confidence_interval(CIP, side = "min"),
      ci_max = sir_confidence_interval(CIP, side = "max"),
    )
}
if (require("dplyr")) {
  # scoped dplyr verbs with antibiotic selectors
  # (you could also use across() of course)
  example_isolates %&gt;%
    group_by(ward) %&gt;%
    summarise_at(
      c(aminoglycosides(), carbapenems()),
      resistance
    )
}
if (require("dplyr")) {
  example_isolates %&gt;%
    group_by(ward) %&gt;%
    summarise(
      R = resistance(CIP, as_percent = TRUE),
      SI = susceptibility(CIP, as_percent = TRUE),
      n1 = count_all(CIP), # the actual total; sum of all three
      n2 = n_sir(CIP), # same - analogous to n_distinct
      total = n()
    ) # NOT the number of tested isolates!

  # Calculate co-resistance between amoxicillin/clav acid and gentamicin,
  # so we can see that combination therapy does a lot more than mono therapy:
  example_isolates %&gt;% susceptibility(AMC) # %SI = 76.3%
  example_isolates %&gt;% count_all(AMC) #   n = 1879

  example_isolates %&gt;% susceptibility(GEN) # %SI = 75.4%
  example_isolates %&gt;% count_all(GEN) #   n = 1855

  example_isolates %&gt;% susceptibility(AMC, GEN) # %SI = 94.1%
  example_isolates %&gt;% count_all(AMC, GEN) #   n = 1939


  # See Details on how `only_all_tested` works. Example:
  example_isolates %&gt;%
    summarise(
      numerator = count_susceptible(AMC, GEN),
      denominator = count_all(AMC, GEN),
      proportion = susceptibility(AMC, GEN)
    )

  example_isolates %&gt;%
    summarise(
      numerator = count_susceptible(AMC, GEN, only_all_tested = TRUE),
      denominator = count_all(AMC, GEN, only_all_tested = TRUE),
      proportion = susceptibility(AMC, GEN, only_all_tested = TRUE)
    )


  example_isolates %&gt;%
    group_by(ward) %&gt;%
    summarise(
      cipro_p = susceptibility(CIP, as_percent = TRUE),
      cipro_n = count_all(CIP),
      genta_p = susceptibility(GEN, as_percent = TRUE),
      genta_n = count_all(GEN),
      combination_p = susceptibility(CIP, GEN, as_percent = TRUE),
      combination_n = count_all(CIP, GEN)
    )

  # Get proportions S/I/R immediately of all sir columns
  example_isolates %&gt;%
    select(AMX, CIP) %&gt;%
    proportion_df(translate = FALSE)

  # It also supports grouping variables
  # (use sir_df to also include the count)
  example_isolates %&gt;%
    select(ward, AMX, CIP) %&gt;%
    group_by(ward) %&gt;%
    sir_df(translate = FALSE)
}

</code></pre>


</div>