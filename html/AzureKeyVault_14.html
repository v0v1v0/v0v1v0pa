<div class="container">

<table style="width: 100%;"><tr>
<td>key</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Encryption key object</h2>

<h3>Description</h3>

<p>This class represents an encryption key stored in a vault. It provides methods for carrying out operations, including encryption and decryption, signing and verification, and wrapping and unwrapping.
</p>


<h3>Fields</h3>

<p>This class provides the following fields:
</p>

<ul>
<li> <p><code>key</code>: The key details as a parsed JSON web key (JWK).
</p>
</li>
<li> <p><code>managed</code>: Whether this key's lifetime is managed by Key Vault. TRUE if the key backs a certificate.
</p>
</li>
</ul>
<h3>Methods</h3>

<p>This class provides the following methods:</p>
<pre>encrypt(plaintext, algorithm=c("RSA-OAEP", "RSA-OAEP-256", "RSA1_5"))
decrypt(ciphertext, algorithm=c("RSA-OAEP", "RSA-OAEP-256", "RSA1_5"), as_raw=TRUE)
sign(digest,
     algorithm=c("RS256", "RS384", "RS512", "PS256", "PS384", "PS512",
                 "ES256", "ES256K", "ES384", "ES512"))
verify(signature, digest,
       algorithm=c("RS256", "RS384", "RS512", "PS256", "PS384", "PS512",
                   "ES256", "ES256K", "ES384", "ES512"))
wrap(value, algorithm=c("RSA-OAEP", "RSA-OAEP-256", "RSA1_5"))
unwrap(value, algorithm=c("RSA-OAEP", "RSA-OAEP-256", "RSA1_5"), as_raw=TRUE)

update_attributes(attributes=vault_object_attrs(), ...)
list_versions()
set_version(version=NULL)
delete(confirm=TRUE)
</pre>


<h3>Arguments</h3>


<ul>
<li> <p><code>plaintext</code>: For <code>encrypt</code>, the plaintext to encrypt.
</p>
</li>
<li> <p><code>ciphertext</code>: For <code>decrypt</code>, the ciphertext to decrypt.
</p>
</li>
<li> <p><code>digest</code>: For <code>sign</code>, a generated hash to sign. For <code>verify</code>, the digest to verify for authenticity.
</p>
</li>
<li> <p><code>signature</code>: For <code>verify</code>, a signature to verify for authenticity.
</p>
</li>
<li> <p><code>value</code>: For <code>wrap</code>, a symmetric key to be wrapped; for <code>unwrap</code>, the value to be unwrapped to obtain the symmetric key.
</p>
</li>
<li> <p><code>as_raw</code>: For <code>decrypt</code> and <code>unwrap</code>, whether to return a character vector or a raw vector (the default).
</p>
</li>
<li> <p><code>algorithm</code>: The algorithm to use for each operation. Note that the algorithm must be compatible with the key type, eg RSA keys cannot use ECDSA for signing or verifying.
</p>
</li>
<li> <p><code>attributes</code>: For <code>update_attributes</code>, the new attributes for the object, such as the expiry date and activation date. A convenient way to provide this is via the vault_object_attrs helper function.
</p>
</li>
<li> <p><code>...</code>: For <code>update_attributes</code>, additional key-specific properties to update. See keys.
</p>
</li>
<li> <p><code>version</code>: For <code>set_version</code>, the version ID or NULL for the current version.
</p>
</li>
<li> <p><code>confirm</code>: For <code>delete</code>, whether to ask for confirmation before deleting the key.
</p>
</li>
</ul>
<h3>Details</h3>

<p>The operations supported by a key will be those given by the <code>key_ops</code> argument when the key was created. By default, a newly created RSA key supports all the operations listed above: encrypt/decrypt, sign/verify, and wrap/unwrap. An EC key only supports the sign and verify operations.
</p>
<p>A key can have multiple <em>versions</em>, which are automatically generated when a key is created with the same name as an existing key. By default, the most recent (current) version is used for key operations; use <code>list_versions</code> and <code>set_version</code> to change the version.
</p>


<h3>Value</h3>

<p>For the key operations, a raw vector (for <code>decrypt</code> and <code>unwrap</code>, if <code>as_raw=TRUE</code>) or character vector.
</p>
<p>For <code>list_versions</code>, a data frame containing details of each version.
</p>
<p>For <code>set_version</code>, the key object with the updated version.
</p>


<h3>See Also</h3>

<p>keys
</p>
<p><a href="https://docs.microsoft.com/en-us/azure/key-vault/">Azure Key Vault documentation</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/keyvault">Azure Key Vault API reference</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

vault &lt;- key_vault("mykeyvault")

vault$keys$create("mynewkey")
# new version of an existing key
vault$keys$create("mynewkey", type="RSA", rsa_key_size=4096)

key &lt;- vault$keys$get("mynewkey")
vers &lt;- key$list_versions()
key$set_version(vers[2])

plaintext &lt;- "some secret text"

ciphertext &lt;- key$encrypt(plaintext)
decrypted &lt;- key$decrypt(ciphertext, as_raw=FALSE)
decrypted == plaintext  # TRUE

dig &lt;- openssl::sha2(charToRaw(plaintext))
sig &lt;- key$sign(dig)
key$verify(sig, dig)  # TRUE

wraptext &lt;- key$wrap(plaintext)
unwrap_text &lt;- key$unwrap(wraptext, as_raw=FALSE)
plaintext == unwrap_text  # TRUE


## End(Not run)
</code></pre>


</div>