<div class="container">

<table style="width: 100%;"><tr>
<td>call_derivation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Call a Single Derivation Multiple Times</h2>

<h3>Description</h3>

<p>Call a single derivation multiple times with some parameters/arguments being fixed across
iterations and others varying.
</p>


<h3>Usage</h3>

<pre><code class="language-R">call_derivation(dataset = NULL, derivation, variable_params, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivation</code></td>
<td>
<p>The derivation function to call
</p>
<p>A function that performs a specific derivation is expected. A derivation
adds variables or observations to a dataset. The first argument of a
derivation must expect a dataset and the derivation must return a dataset.
The function must provide the <code>dataset</code> argument and all arguments
specified in the <code>params()</code> objects passed to the <code>variable_params</code> and
<code>...</code> argument.
</p>
<p>Please note that it is not possible to specify <code>{dplyr}</code>
functions like <code>mutate()</code> or <code>summarize()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable_params</code></td>
<td>
<p>A <code>list</code> of function arguments that are different across iterations.
Each set of function arguments must be created using <code>params()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Any number of <em>named</em> function arguments that stay the same across iterations.
If a function argument is specified both inside <code>variable_params</code> and <code>...</code> then
the value in <code>variable_params</code> overwrites the one in <code>...</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The input dataset with additional records/variables added depending on
which <code>derivation</code> has been used.
</p>


<h3>See Also</h3>

<p><code>params()</code>
</p>
<p>Higher Order Functions: 
<code>derivation_slice()</code>,
<code>restrict_derivation()</code>,
<code>slice_derivation()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(dplyr, warn.conflicts = FALSE)
adsl &lt;- tribble(
  ~STUDYID,   ~USUBJID,      ~TRTSDT,      ~TRTEDT,
  "PILOT01", "01-1307",           NA,           NA,
  "PILOT01", "05-1377", "2014-01-04", "2014-01-25",
  "PILOT01", "06-1384", "2012-09-15", "2012-09-24",
  "PILOT01", "15-1085", "2013-02-16", "2013-08-18",
  "PILOT01", "16-1298", "2013-04-08", "2013-06-28"
) %&gt;%
  mutate(
    across(TRTSDT:TRTEDT, as.Date)
  )

ae &lt;- tribble(
  ~STUDYID,  ~DOMAIN,  ~USUBJID,     ~AESTDTC,     ~AEENDTC,
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-23", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-23", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-15", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-23", "2012-09-29",
  "PILOT01",    "AE", "06-1384", "2012-09-23", "2012-09-29",
  "PILOT01",    "AE", "16-1298", "2013-06-08", "2013-07-06",
  "PILOT01",    "AE", "16-1298", "2013-06-08", "2013-07-06",
  "PILOT01",    "AE", "16-1298", "2013-04-22", "2013-07-06",
  "PILOT01",    "AE", "16-1298", "2013-04-22", "2013-07-06",
  "PILOT01",    "AE", "16-1298", "2013-04-22", "2013-07-06",
  "PILOT01",    "AE", "16-1298", "2013-04-22", "2013-07-06"
)

adae &lt;- ae %&gt;%
  derive_vars_merged(
    dataset_add = adsl,
    new_vars = exprs(TRTSDT, TRTEDT),
    by_vars = exprs(USUBJID)
  )

## While `derive_vars_dt()` can only add one variable at a time, using `call_derivation()`
## one can add multiple variables in one go
call_derivation(
  dataset = adae,
  derivation = derive_vars_dt,
  variable_params = list(
    params(dtc = AESTDTC, date_imputation = "first", new_vars_prefix = "AST"),
    params(dtc = AEENDTC, date_imputation = "last", new_vars_prefix = "AEN")
  ),
  min_dates = exprs(TRTSDT),
  max_dates = exprs(TRTEDT)
)

## The above call using `call_derivation()` is equivalent to the following
adae %&gt;%
  derive_vars_dt(
    new_vars_prefix = "AST",
    dtc = AESTDTC,
    date_imputation = "first",
    min_dates = exprs(TRTSDT),
    max_dates = exprs(TRTEDT)
  ) %&gt;%
  derive_vars_dt(
    new_vars_prefix = "AEN",
    dtc = AEENDTC,
    date_imputation = "last",
    min_dates = exprs(TRTSDT),
    max_dates = exprs(TRTEDT)
  )
</code></pre>


</div>