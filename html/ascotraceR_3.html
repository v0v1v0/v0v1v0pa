<div class="container">

<table style="width: 100%;"><tr>
<td>format_weather</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Format weather data into an an object suitable for use in ascotraceR spore dispersal models</h2>

<h3>Description</h3>

<p>Formats raw weather data into an object suitable for use in the
<code>trace_asco()</code> function ensuring that the supplied weather data meet the
requirements of the model to run.
</p>


<h3>Usage</h3>

<pre><code class="language-R">format_weather(
  x,
  YYYY = NULL,
  MM = NULL,
  DD = NULL,
  hh = NULL,
  mm = NULL,
  POSIXct_time = NULL,
  time_zone = NULL,
  temp,
  rain,
  ws,
  wd,
  wd_sd,
  station,
  lon = NULL,
  lat = NULL,
  r = NULL,
  lonlat_file = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A data.frame object of weather station data for formatting.
<code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>YYYY</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the year when the
weather was logged. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MM</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the month (numerical)
when the weather was logged. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DD</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the day of month when
the weather was logged. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hh</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the hour (24 hour) when
the weather was logged. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mm</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the minute when the
weather was logged. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>POSIXct_time</code></td>
<td>
<p>Column name or index in <code>x</code> which contains a <code>POSIXct</code>
formatted time. This can be used instead of arguments <code>YYYY</code>, <code>MM</code>, <code>DD</code>,
<code>hh</code>, <code>mm.</code> <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_zone</code></td>
<td>
<p>Time zone (Olsen time zone format) where the weather station
is located. May be in a column or supplied as a character string. Optional,
see also <code>r</code>. <code>character</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temp</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to temperature in degrees
Celsius. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rain</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to rainfall in mm.
<code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ws</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to wind speed in km / h.
<code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wd</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to wind direction in
degrees. <code>character</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wd_sd</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to wind speed columns
standard deviation .<code>character</code>.  This is only applicable if weather data
is already summarised to hourly increments. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>station</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to the weather station
name or identifier. <code>character</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to weather station's
longitude. <code>character</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>Column name or index in <code>x</code> that refers to weather station's
latitude. <code>character</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>Spatial raster which is intended to be used with this weather data
for use in the blackspot model. Used to set <code>time_zone</code> if it is not
supplied in data. <code>character</code>. Optional, see also <code>time_zone</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lonlat_file</code></td>
<td>
<p>A file path to a <abbr><span class="acronym">CSV</span></abbr> which included station
name/id and longitude and latitude coordinates if they are not supplied in
the data. <code>character</code>. Optional, see also <code>lon</code> and <code>lat</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>time_zone</code> All weather stations must fall within the same time
zone.  If the required stations are located in differing time zones,
separate <code>ascotraceR.weather</code> objects must be created for each time zone.
If a raster object, <code>r</code>, of previous crops is provided that spans time
zones, an error will be emitted.
</p>
<p><code>wd_sd</code> If weather data is provided in hourly increments, a column
with the standard deviation of the wind direction over the hour is required
to be provided. If the weather data are sub-hourly, the standard deviation
will be calculated and returned automatically.
</p>
<p><code>lon</code>, <code>lat</code> and <code>lonlat_file</code> If <code>x</code> provides longitude and
latitude values for station locations, these may be specified in the <code>lon</code>
and <code>lat</code> columns.  If the coordinates are not relevant to the study
location <code>NA</code> can be specified and the function will drop these column
variables.  If these data are not included, (<code>NULL</code>) a separate file may be
provided that contains the longitude, latitude and matching station name to
provide station locations in the final <code>ascotraceR.weather</code> object that is
created by specifying the file path to a <abbr><span class="acronym">CSV</span></abbr> file using
<code>lonlat_file</code>.
</p>


<h3>Value</h3>

<p>A <code>ascotraceR.weather</code> object (an extension of <a href="https://CRAN.R-project.org/package=data.table"><span class="pkg">data.table</span></a>)
containing the supplied weather aggregated to each hour in a suitable
format for use with <code>trace_asco()</code> containing the following columns:
</p>

<table>
<tr>
<td style="text-align: right;">
<strong>times</strong>: </td>
<td style="text-align: left;"> Time in POSIXct format </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>rain</strong>: </td>
<td style="text-align: left;"> Rainfall in mm </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>ws</strong>: </td>
<td style="text-align: left;"> Wind speed in km / h </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>wd</strong>: </td>
<td style="text-align: left;"> Wind direction in compass degrees </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>wd_sd</strong>: </td>
<td style="text-align: left;"> Wind direction standard deviation in compass degrees </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>lon</strong>: </td>
<td style="text-align: left;"> Station longitude in decimal degrees </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>lat</strong>: </td>
<td style="text-align: left;"> Station latitude in decimal degrees </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>station</strong>: </td>
<td style="text-align: left;"> Unique station identifying name </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>YYYY</strong>: </td>
<td style="text-align: left;"> Year </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>MM</strong>: </td>
<td style="text-align: left;"> Month </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>DD</strong>: </td>
<td style="text-align: left;"> Day </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>hh</strong>: </td>
<td style="text-align: left;"> Hour </td>
</tr>
<tr>
<td style="text-align: right;">
<strong>mm</strong>: </td>
<td style="text-align: left;"> Minute </td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R"># Weather data files for Newmarracara for testing and examples have been
# included in ascotraceR. The weather data files both are of the same format,
# so they will be combined for formatting here.

Newmarracarra &lt;- read.csv(
 system.file("extdata",
             "1998_Newmarracarra_weather_table.csv",
             package = "ascotraceR")
)

station_data &lt;- system.file("extdata",
                            "stat_dat.csv",
                            package = "ascotraceR")

weather &lt;- format_weather(
  x = Newmarracarra,
  POSIXct_time = "Local.Time",
  temp = "mean_daily_temp",
  rain = "rain_mm",
  ws = "ws",
  wd = "wd",
  wd_sd = "wd_sd",
  station = "Location",
  time_zone = "Australia/Perth",
  lonlat_file = station_data
)

# Saving weather data and reimporting can lose the object class
# Reimported data can be quickly reformatted, adding the 'asco.weather' class
#  with this same function
temp_file_path &lt;- paste0(tempdir(),"weather_file.csv")
write.csv(weather, file = temp_file_path, row.names = FALSE)
weather_imported &lt;- read.csv(temp_file_path)
weather &lt;- format_weather(weather_imported,
                          time_zone = "Australia/Perth")
unlink(temp_file_path) # remove temporary weather file
</code></pre>


</div>