<div class="container">

<table style="width: 100%;"><tr>
<td>ggplot_sir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>AMR Plots with <code>ggplot2</code>
</h2>

<h3>Description</h3>

<p>Use these functions to create bar plots for AMR data analysis. All functions rely on ggplot2 functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ggplot_sir(
  data,
  position = NULL,
  x = "antibiotic",
  fill = "interpretation",
  facet = NULL,
  breaks = seq(0, 1, 0.1),
  limits = NULL,
  translate_ab = "name",
  combine_SI = TRUE,
  minimum = 30,
  language = get_AMR_locale(),
  nrow = NULL,
  colours = c(S = "#3CAEA3", SI = "#3CAEA3", I = "#F6D55C", IR = "#ED553B", R =
    "#ED553B"),
  datalabels = TRUE,
  datalabels.size = 2.5,
  datalabels.colour = "grey15",
  title = NULL,
  subtitle = NULL,
  caption = NULL,
  x.title = "Antimicrobial",
  y.title = "Proportion",
  ...
)

geom_sir(
  position = NULL,
  x = c("antibiotic", "interpretation"),
  fill = "interpretation",
  translate_ab = "name",
  minimum = 30,
  language = get_AMR_locale(),
  combine_SI = TRUE,
  ...
)

facet_sir(facet = c("interpretation", "antibiotic"), nrow = NULL)

scale_y_percent(breaks = seq(0, 1, 0.1), limits = NULL)

scale_sir_colours(..., aesthetics = "fill")

theme_sir()

labels_sir_count(
  position = NULL,
  x = "antibiotic",
  translate_ab = "name",
  minimum = 30,
  language = get_AMR_locale(),
  combine_SI = TRUE,
  datalabels.size = 3,
  datalabels.colour = "grey15"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data.frame with column(s) of class <code>sir</code> (see <code>as.sir()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>position adjustment of bars, either <code>"fill"</code>, <code>"stack"</code> or <code>"dodge"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>variable to show on x axis, either <code>"antibiotic"</code> (default) or <code>"interpretation"</code> or a grouping variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill</code></td>
<td>
<p>variable to categorise using the plots legend, either <code>"antibiotic"</code> (default) or <code>"interpretation"</code> or a grouping variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet</code></td>
<td>
<p>variable to split plots by, either <code>"interpretation"</code> (default) or <code>"antibiotic"</code> or a grouping variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>a numeric vector of positions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limits</code></td>
<td>
<p>a numeric vector of length two providing limits of the scale, use <code>NA</code> to refer to the existing minimum or maximum</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>translate_ab</code></td>
<td>
<p>a column name of the antibiotics data set to translate the antibiotic abbreviations to, using <code>ab_property()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combine_SI</code></td>
<td>
<p>a logical to indicate whether all values of S and I must be merged into one, so the output only consists of S+I vs. R (susceptible vs. resistant) - the default is <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum</code></td>
<td>
<p>the minimum allowed number of available (tested) isolates. Any isolate count lower than <code>minimum</code> will return <code>NA</code> with a warning. The default number of <code>30</code> isolates is advised by the Clinical and Laboratory Standards Institute (CLSI) as best practice, see <em>Source</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>language</code></td>
<td>
<p>language of the returned text - the default is the current system language (see <code>get_AMR_locale()</code>) and can also be set with the package option <code>AMR_locale</code>. Use <code>language = NULL</code> or <code>language = ""</code> to prevent translation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrow</code></td>
<td>
<p>(when using <code>facet</code>) number of rows</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colours</code></td>
<td>
<p>a named vactor with colour to be used for filling. The default colours are colour-blind friendly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datalabels</code></td>
<td>
<p>show datalabels using <code>labels_sir_count()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datalabels.size</code></td>
<td>
<p>size of the datalabels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datalabels.colour</code></td>
<td>
<p>colour of the datalabels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>text to show as title of the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subtitle</code></td>
<td>
<p>text to show as subtitle of the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>caption</code></td>
<td>
<p>text to show as caption of the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.title</code></td>
<td>
<p>text to show as x axis description</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.title</code></td>
<td>
<p>text to show as y axis description</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments passed on to <code>geom_sir()</code> or, in case of <code>scale_sir_colours()</code>, named values to set colours. The default colours are colour-blind friendly, while maintaining the convention that e.g. 'susceptible' should be green and 'resistant' should be red. See <em>Examples</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aesthetics</code></td>
<td>
<p>aesthetics to apply the colours to - the default is "fill" but can also be (a combination of) "alpha", "colour", "fill", "linetype", "shape" or "size"</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>At default, the names of antibiotics will be shown on the plots using <code>ab_name()</code>. This can be set with the <code>translate_ab</code> argument. See <code>count_df()</code>.
</p>


<h4>The Functions</h4>

<p><code>geom_sir()</code> will take any variable from the data that has an <code>sir</code> class (created with <code>as.sir()</code>) using <code>sir_df()</code> and will plot bars with the percentage S, I, and R. The default behaviour is to have the bars stacked and to have the different antibiotics on the x axis.
</p>
<p><code>facet_sir()</code> creates 2d plots (at default based on S/I/R) using <code>ggplot2::facet_wrap()</code>.
</p>
<p><code>scale_y_percent()</code> transforms the y axis to a 0 to 100% range using <code>ggplot2::scale_y_continuous()</code>.
</p>
<p><code>scale_sir_colours()</code> sets colours to the bars (green for S, yellow for I, and red for R). with multilingual support. The default colours are colour-blind friendly, while maintaining the convention that e.g. 'susceptible' should be green and 'resistant' should be red.
</p>
<p><code>theme_sir()</code> is a [ggplot2 theme][<code>ggplot2::theme()</code> with minimal distraction.
</p>
<p><code>labels_sir_count()</code> print datalabels on the bars with percentage and amount of isolates using <code>ggplot2::geom_text()</code>.
</p>
<p><code>ggplot_sir()</code> is a wrapper around all above functions that uses data as first input. This makes it possible to use this function after a pipe (<code style="white-space: pre;">⁠%&gt;%⁠</code>). See <em>Examples</em>.
</p>



<h3>Examples</h3>

<pre><code class="language-R">
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # get antimicrobial results for drugs against a UTI:
  ggplot(example_isolates %&gt;% select(AMX, NIT, FOS, TMP, CIP)) +
    geom_sir()
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # prettify the plot using some additional functions:
  df &lt;- example_isolates %&gt;% select(AMX, NIT, FOS, TMP, CIP)
  ggplot(df) +
    geom_sir() +
    scale_y_percent() +
    scale_sir_colours() +
    labels_sir_count() +
    theme_sir()
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # or better yet, simplify this using the wrapper function - a single command:
  example_isolates %&gt;%
    select(AMX, NIT, FOS, TMP, CIP) %&gt;%
    ggplot_sir()
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # get only proportions and no counts:
  example_isolates %&gt;%
    select(AMX, NIT, FOS, TMP, CIP) %&gt;%
    ggplot_sir(datalabels = FALSE)
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # add other ggplot2 arguments as you like:
  example_isolates %&gt;%
    select(AMX, NIT, FOS, TMP, CIP) %&gt;%
    ggplot_sir(
      width = 0.5,
      colour = "black",
      size = 1,
      linetype = 2,
      alpha = 0.25
    )
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # you can alter the colours with colour names:
  example_isolates %&gt;%
    select(AMX) %&gt;%
    ggplot_sir(colours = c(SI = "yellow"))
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # but you can also use the built-in colour-blind friendly colours for
  # your plots, where "S" is green, "I" is yellow and "R" is red:
  data.frame(
    x = c("Value1", "Value2", "Value3"),
    y = c(1, 2, 3),
    z = c("Value4", "Value5", "Value6")
  ) %&gt;%
    ggplot() +
    geom_col(aes(x = x, y = y, fill = z)) +
    scale_sir_colours(Value4 = "S", Value5 = "I", Value6 = "R")
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # resistance of ciprofloxacine per age group
  example_isolates %&gt;%
    mutate(first_isolate = first_isolate()) %&gt;%
    filter(
      first_isolate == TRUE,
      mo == as.mo("Escherichia coli")
    ) %&gt;%
    # age_groups() is also a function in this AMR package:
    group_by(age_group = age_groups(age)) %&gt;%
    select(age_group, CIP) %&gt;%
    ggplot_sir(x = "age_group")
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # a shorter version which also adjusts data label colours:
  example_isolates %&gt;%
    select(AMX, NIT, FOS, TMP, CIP) %&gt;%
    ggplot_sir(colours = FALSE)
}
if (require("ggplot2") &amp;&amp; require("dplyr")) {
  # it also supports groups (don't forget to use the group var on `x` or `facet`):
  example_isolates %&gt;%
    filter(mo_is_gram_negative(), ward != "Outpatient") %&gt;%
    # select only UTI-specific drugs
    select(ward, AMX, NIT, FOS, TMP, CIP) %&gt;%
    group_by(ward) %&gt;%
    ggplot_sir(
      x = "ward",
      facet = "antibiotic",
      nrow = 1,
      title = "AMR of Anti-UTI Drugs Per Ward",
      x.title = "Ward",
      datalabels = FALSE
    )
}

</code></pre>


</div>