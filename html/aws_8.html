<div class="container">

<table style="width: 100%;"><tr>
<td>smooth3D</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Auxiliary 3D smoothing routines
</h2>

<h3>Description</h3>

<p><code>smooth3D</code> and <code>medianFilter3D</code> are auxiliary functions for non-adaptive
smoothing of 3D image data using kernel or median smoothing. Both function restrict
to sub-areas determined by a mask.  The functions are used in packages <code>dti</code> and
<code>qMRI</code>.
</p>
<p>Functions <code>aws3Dmask</code> and <code>aws3Dmaskfull</code> perform adaptive weights smoothing on
statistical parametric maps in fMRI. Variability of results is determined from smoothed
(using the same weighting schemes) residuals in order to correctly account for spatial
correlation. These functions are intended to be used internally in package <code>fmri</code>.
They have been moved here because they share significant parts of the
openMP parallelized Fortran code underlying function <code>aws</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">smooth3D(y, h, mask, lkern = "Gaussian", weighted = FALSE, sigma2 = NULL,
         wghts = NULL)
medianFilter3D(y, h = 10, mask = NULL)
aws3Dmask(y, mask, lambda, hmax, res = NULL, sigma2 = NULL, lkern = "Gaussian",
   skern = "Plateau", weighted = TRUE, u = NULL, wghts = NULL,
   h0 = c(0, 0, 0), testprop = FALSE)
aws3Dmaskfull(y, mask, lambda, hmax, res = NULL, sigma2 = NULL, lkern = "Gaussian",
       skern = "Plateau", weighted = TRUE, u = NULL, wghts = NULL,
       testprop = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>3D array of data in case of functions <code>smooth3D</code> and <code>medianFilter3D</code>. For <code>aws3Dmask*</code>
with <code>!is.null(mask)</code> a vector of length <code>sum(mask)</code> containing only data values within the specified mask.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lkern</code></td>
<td>
<p>character: location kernel, either "Triangle", "Plateau", "Quadratic", "Cubic" or "Gaussian".
The default "Triangle" is equivalent to using an Epanechnikov kernel, "Quadratic" and  "Cubic" refer to a Bi-weight and Tri-weight
kernel, see Fan and Gijbels (1996). "Gaussian" is a truncated (compact support) Gaussian kernel.
This is included for comparisons only and should be avoided due to its large computational costs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighted</code></td>
<td>

<p>logical: use inverse variances as weights.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2</code></td>
<td>

<p><code>sigma2</code> allows to specify the variance of data entries.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask</code></td>
<td>

<p>optional logical mask, same dimensionality as <code>y</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>

<p>bandwidth to use. In case of <code>lkern="Gaussian"</code> this is in FWHM (full width half maximum) units.
Value refers to first voxel dimension.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wghts</code></td>
<td>

<p>voxel dimensions. Defaults to <code>c(1,1,1)</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>kritical scale parameter in hypothesis testing (adaptive weights smoothing)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hmax</code></td>
<td>

<p>maximum bandwidth for adaptive weights smoothing
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>

<p>array of residuals with dimension <code>c(nres,sum(mask))</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skern</code></td>
<td>
 <p><code>skern</code> specifies the kernel for the statistical
penalty. Defaults to "Plateau", the alternatives are "Triangle" and "Exp".
"Plateau" specifies a kernel that is equal to 1 in the interval (0,.3),
decays linearly in (.3,1) and is 0 for arguments larger than 1.
<code>lkern="Plateau"</code> and <code>lkern="Triangle"</code> allow for much faster computation (saves up
to 50% CPU-time). <code>lkern="Plateau"</code> produces a less random weighting scheme.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>

<p>For test purposes in simulations: noisless 3D data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h0</code></td>
<td>

<p>Vector of 3 bandwidths corresponding to a Gaussian kernel that would produce a
comparable spatial correlation by convoluting iid data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testprop</code></td>
<td>

<p>logical: test the validity of a propagation condition for the specified value of <code>lambda</code>.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Functions <code>smooth3D</code> and <code>medianFilter3D</code> return a 3D array.
Functions <code>awsmask*</code> return a list with smoothed values of <code>y</code> in
component <code>theta</code> and smoothed residuals in component <code>res</code>.
</p>


<h3>Note</h3>

<p>Functions <code>awsmask*</code> are used intenally in package <code>fmri</code>. They refer to the
situation, typical for fMRI, where the data are spatially correlated and this correlation
can be accessed using residuals with respect to a model.
</p>


<h3>Author(s)</h3>

<p> Joerg Polzehl <a href="mailto:polzehl@wias-berlin.de">polzehl@wias-berlin.de</a>,
Karsten Tabelow <a href="mailto:tabelow@wias-berlin.de">tabelow@wias-berlin.de</a>
</p>


</div>