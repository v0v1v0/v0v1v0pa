<div class="container">

<table style="width: 100%;"><tr>
<td>stepper</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a new stepper</h2>

<h3>Description</h3>


<ul>
<li> <p><code>stepper()</code> returns a function that can be used to add or subtract a
number of days from a Date, "stepping" over events specified by an
rschedule. You supply it the rschedule to step relative to, and then
call the returned function with the number of days to step by.
</p>
</li>
<li> <p><code>workdays()</code> is a convenient stepper for stepping over the weekend.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠%s+%⁠</code> steps forwards.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠%s-%⁠</code> steps backwards.
</p>
</li>
</ul>
<p>You <em>must</em> use <code style="white-space: pre;">⁠%s+⁠</code> and <code style="white-space: pre;">⁠%s-%⁠</code> to control the stepping. <code>+</code> and <code>-</code> will
not work due to limitations in R's S3 dispatch system. Alternatively, you
can call <code>vctrs::vec_arith()</code> directly, which powers <code style="white-space: pre;">⁠%s+%⁠</code> with a correct
double dispatch implementation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stepper(rschedule)

x %s+% y

x %s-% y

workdays(n, since = NULL, until = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rschedule</code></td>
<td>
<p><code style="white-space: pre;">⁠[rschedule]⁠</code>
</p>
<p>An rschedule, such as an rrule, runion, rintersect, or rsetdiff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, y</code></td>
<td>
<p><code style="white-space: pre;">⁠[objects]⁠</code>
</p>
<p>Objects to perform step arithmetic on. Typically Dates or steppers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p><code style="white-space: pre;">⁠[integer]⁠</code>
</p>
<p>The number of days to step. Can be negative to step backwards.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>since</code></td>
<td>
<p><code style="white-space: pre;">⁠[Date(1)]⁠</code>
</p>
<p>The lower bound on the event set. Depending on the final
recurrence rule, pieces of information from this anchor date might be used
to generate a complete recurrence rule.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>until</code></td>
<td>
<p><code style="white-space: pre;">⁠[Date(1)]⁠</code>
</p>
<p>The upper bound on the event set.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Internally, a stepper is just powered by <code>alma_step()</code>, so feel free to
use that directly.
</p>


<h3>Value</h3>


<ul>
<li> <p><code>stepper()</code> returns a function of 1 argument, <code>n</code>, that can be used to
step by <code>n</code> days, relative to the rschedule.
</p>
</li>
<li> <p><code>workdays()</code> return a new stepper object.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠%s+%⁠</code> and <code style="white-space: pre;">⁠%s-%⁠</code> return a new shifted Date vector.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># A Thursday and Friday
x &lt;- as.Date(c("1970-01-01", "1970-01-02"))

# Thursday is stepped forward 1 working day to Friday,
# and then 1 more working day to Monday.
# Friday is stepped forward 1 working day to Monday,
# and then 1 more working day to Tuesday
x %s+% workdays(2)

# ---------------------------------------------------------------------------

on_weekends &lt;- weekly() %&gt;%
  recur_on_weekends()

on_christmas &lt;- yearly() %&gt;%
  recur_on_day_of_month(25) %&gt;%
  recur_on_month_of_year("Dec")

rb &lt;- runion(on_weekends, on_christmas)

workday &lt;- stepper(rb)

# Friday before Christmas, which was on a Monday
friday_before_christmas &lt;- as.Date("2000-12-22")

# Steps over the weekend and Christmas to the following Tuesday
friday_before_christmas %s+% workday(1)

# ---------------------------------------------------------------------------

# Christmas in 2005 was on a Sunday, but your company probably "observed"
# it on Monday. So when you are on the Friday before Christmas in 2005,
# stepping forward 1 working day should go to Tuesday.

# We'll adjust the previous rule for Christmas to roll to the nearest
# non-weekend day, if it happened to fall on a weekend.
on_observed_christmas &lt;- radjusted(
  on_christmas,
  adjust_on = on_weekends,
  adjustment = adj_nearest
)

# Note that the "observed" date for Christmas is the 26th
alma_search("2005-01-01", "2006-01-01", on_observed_christmas)

rb2 &lt;- runion(on_weekends, on_observed_christmas)

workday2 &lt;- stepper(rb2)

friday_before_christmas_2005 &lt;- as.Date("2005-12-23")

# Steps over the weekend and the observed Christmas date
# of 2005-12-26 to Tuesday the 27th.
friday_before_christmas_2005 %s+% workday2(1)
</code></pre>


</div>