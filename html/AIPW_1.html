<div class="container">

<table style="width: 100%;"><tr>
<td>AIPW</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Augmented Inverse Probability Weighting (AIPW)</h2>

<h3>Description</h3>

<p>An R6Class of AIPW for estimating the average causal effects with users' inputs of exposure, outcome, covariates and related
libraries for estimating the efficient influence function.
</p>


<h3>Details</h3>

<p>An AIPW object is constructed by <code>new()</code> with users' inputs of data and causal structures, then it <code>fit()</code> the data using the
libraries in <code>Q.SL.library</code> and <code>g.SL.library</code> with <code>k_split</code> cross-fitting, and provides results via the <code>summary()</code> method.
After using <code>fit()</code> and/or <code>summary()</code> methods, propensity scores  and inverse probability weights by exposure status can be
examined with <code>plot.p_score()</code> and <code>plot.ip_weights()</code>, respectively.
</p>
<p>If outcome is missing, analysis assumes missing at random (MAR) by estimating propensity scores of I(A=a, observed=1) with all covariates <code>W</code>.
(<code>W.Q</code> and <code>W.g</code> are disabled.) Missing exposure is not supported.
</p>
<p>See examples for illustration.
</p>


<h3>Value</h3>

<p><code>AIPW</code> object
</p>


<h3>Constructor</h3>

<p><code>AIPW$new(Y = NULL, A = NULL, W = NULL, W.Q = NULL, W.g = NULL, Q.SL.library = NULL, g.SL.library = NULL, k_split = 10, verbose = TRUE, save.sl.fit = FALSE)</code>
</p>


<h4>Constructor Arguments</h4>


<table>
<tr>
<td style="text-align: left;">
<strong>Argument</strong>      </td>
<td style="text-align: left;">   <strong>Type</strong>     </td>
<td style="text-align: left;">     <strong>Details</strong> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>Y</code>               </td>
<td style="text-align: left;">   Integer           </td>
<td style="text-align: left;">     A vector of outcome (binary (0, 1) or continuous) </td>
</tr>
<tr>
<td style="text-align: left;">
<code>A</code>               </td>
<td style="text-align: left;">   Integer           </td>
<td style="text-align: left;">     A vector of binary exposure (0 or 1) </td>
</tr>
<tr>
<td style="text-align: left;">
<code>W</code>               </td>
<td style="text-align: left;">   Data              </td>
<td style="text-align: left;">     Covariates for <strong>both</strong> exposure and outcome models. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>W.Q</code>             </td>
<td style="text-align: left;">   Data              </td>
<td style="text-align: left;">     Covariates for the <strong>outcome</strong> model (Q).</td>
</tr>
<tr>
<td style="text-align: left;">
<code>W.g</code>             </td>
<td style="text-align: left;">   Data              </td>
<td style="text-align: left;">     Covariates for the <strong>exposure</strong> model (g). </td>
</tr>
<tr>
<td style="text-align: left;">
<code>Q.SL.library</code>    </td>
<td style="text-align: left;">   SL.library        </td>
<td style="text-align: left;">     Algorithms used for the <strong>outcome</strong> model (Q). </td>
</tr>
<tr>
<td style="text-align: left;">
<code>g.SL.library</code>    </td>
<td style="text-align: left;">   SL.library         </td>
<td style="text-align: left;">    Algorithms used for the <strong>exposure</strong> model (g). </td>
</tr>
<tr>
<td style="text-align: left;">
<code>k_split</code>         </td>
<td style="text-align: left;">   Integer           </td>
<td style="text-align: left;">    Number of folds for splitting (Default = 10).</td>
</tr>
<tr>
<td style="text-align: left;">
<code>verbose</code>         </td>
<td style="text-align: left;">   Logical           </td>
<td style="text-align: left;">    Whether to print the result (Default = TRUE) </td>
</tr>
<tr>
<td style="text-align: left;">
<code>save.sl.fit</code>     </td>
<td style="text-align: left;">   Logical          </td>
<td style="text-align: left;">     Whether to save Q.fit and g.fit (Default = FALSE) </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h4>Constructor Argument Details</h4>


<dl>
<dt>
<code>W</code>, <code>W.Q</code> &amp; <code>W.g</code>
</dt>
<dd>
<p>It can be a vector, matrix or data.frame. If and only if <code>W == NULL</code>, <code>W</code> would be replaced by <code>W.Q</code> and <code>W.g</code>. </p>
</dd>
<dt>
<code>Q.SL.library</code> &amp; <code>g.SL.library</code>
</dt>
<dd>
<p>Machine learning algorithms from SuperLearner libraries</p>
</dd>
<dt><code>k_split</code></dt>
<dd>
<p>It ranges from 1 to number of observation-1.
If k_split=1, no cross-fitting; if k_split&gt;=2, cross-fitting is used
(e.g., <code>k_split=10</code>, use 9/10 of the data to estimate and the remaining 1/10 leftover to predict).
<strong>NOTE: it's recommended to use cross-fitting.</strong> </p>
</dd>
<dt><code>save.sl.fit</code></dt>
<dd>
<p>This option allows users to save the fitted sl object (libs$Q.fit &amp; libs$g.fit) for debug use.
<strong>Warning: Saving the SuperLearner fitted object may cause a substantive storage/memory use.</strong></p>
</dd>
</dl>
<h3>Public Methods</h3>


<table>
<tr>
<td style="text-align: left;">
<strong>Methods</strong>      </td>
<td style="text-align: left;">   <strong>Details</strong>                                      </td>
<td style="text-align: left;"> <strong>Link</strong>     </td>
</tr>
<tr>
<td style="text-align: left;">
<code>fit()</code>          </td>
<td style="text-align: left;">   Fit the data to the AIPW object                     </td>
<td style="text-align: left;">   fit.AIPW  </td>
</tr>
<tr>
<td style="text-align: left;">
<code>stratified_fit()</code>
</td>
<td style="text-align: left;">   Fit the data to the AIPW object stratified by <code>A</code>  </td>
<td style="text-align: left;">   stratified_fit.AIPW  </td>
</tr>
<tr>
<td style="text-align: left;">
<code>summary()</code>      </td>
<td style="text-align: left;">   Summary of the average treatment effects from AIPW    </td>
<td style="text-align: left;">   summary.AIPW_base</td>
</tr>
<tr>
<td style="text-align: left;">
<code>plot.p_score()</code> </td>
<td style="text-align: left;">   Plot the propensity scores by exposure status         </td>
<td style="text-align: left;">   plot.p_score</td>
</tr>
<tr>
<td style="text-align: left;">
<code>plot.ip_weights()</code> </td>
<td style="text-align: left;">   Plot the inverse probability weights using truncated propensity scores  </td>
<td style="text-align: left;">   plot.ip_weights</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Public Variables</h3>


<table>
<tr>
<td style="text-align: left;">
<strong>Variable</strong>     </td>
<td style="text-align: left;">   <strong>Generated by</strong>      </td>
<td style="text-align: left;">     <strong>Return</strong> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>n</code>              </td>
<td style="text-align: left;">   Constructor                </td>
<td style="text-align: left;">     Number of observations </td>
</tr>
<tr>
<td style="text-align: left;">
<code>stratified_fitted</code> </td>
<td style="text-align: left;">   <code>stratified_fit()</code>      </td>
<td style="text-align: left;">    Fit the outcome model stratified by exposure status </td>
</tr>
<tr>
<td style="text-align: left;">
<code>obs_est</code>        </td>
<td style="text-align: left;">   <code>fit()</code> &amp; <code>summary()</code>      </td>
<td style="text-align: left;">     Components calculating average causal effects </td>
</tr>
<tr>
<td style="text-align: left;">
<code>estimates</code>      </td>
<td style="text-align: left;">   <code>summary()</code>                </td>
<td style="text-align: left;">     A list of Risk difference, risk ratio, odds ratio </td>
</tr>
<tr>
<td style="text-align: left;">
<code>result</code>         </td>
<td style="text-align: left;">   <code>summary()</code>                </td>
<td style="text-align: left;">     A matrix contains RD, ATT, ATC, RR and OR with their SE and 95%CI </td>
</tr>
<tr>
<td style="text-align: left;">
<code>g.plot</code>         </td>
<td style="text-align: left;">   <code>plot.p_score()</code>           </td>
<td style="text-align: left;">     A density plot of propensity scores by exposure status</td>
</tr>
<tr>
<td style="text-align: left;">
<code>ip_weights.plot</code>         </td>
<td style="text-align: left;">   <code>plot.ip_weights()</code>           </td>
<td style="text-align: left;">     A box plot of inverse probability weights </td>
</tr>
<tr>
<td style="text-align: left;">
<code>libs</code>           </td>
<td style="text-align: left;">   <code>fit()</code>                    </td>
<td style="text-align: left;">     SuperLearner libraries and their fitted objects </td>
</tr>
<tr>
<td style="text-align: left;">
<code>sl.fit</code>         </td>
<td style="text-align: left;">   Constructor                </td>
<td style="text-align: left;">     A wrapper function for fitting SuperLearner </td>
</tr>
<tr>
<td style="text-align: left;">
<code>sl.predict</code>     </td>
<td style="text-align: left;">   Constructor                </td>
<td style="text-align: left;">     A wrapper function using <code>sl.fit</code> to predict </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h4>Public Variable Details</h4>


<dl>
<dt><code>stratified_fit</code></dt>
<dd>
<p>An indicator for whether the outcome model is fitted stratified by exposure status in the<code>fit()</code> method.
Only when using <code>stratified_fit()</code> to turn on <code>stratified_fit = TRUE</code>, <code>summary</code> outputs average treatment effects among the treated and the controls.</p>
</dd>
<dt><code>obs_est</code></dt>
<dd>
<p>After using <code>fit()</code> and <code>summary()</code> methods, this list contains the propensity scores (<code>p_score</code>),
counterfactual predictions (<code>mu</code>, <code>mu1</code> &amp; <code>mu0</code>) and
efficient influence functions (<code>aipw_eif1</code> &amp; <code>aipw_eif0</code>) for later average treatment effect calculations.</p>
</dd>
<dt><code>g.plot</code></dt>
<dd>
<p>This plot is generated by <code>ggplot2::geom_density</code></p>
</dd>
<dt><code>ip_weights.plot</code></dt>
<dd>
<p>This plot uses truncated propensity scores stratified by exposure status (<code>ggplot2::geom_boxplot</code>)</p>
</dd>
</dl>
<h3>References</h3>

<p>Zhong Y, Kennedy EH, Bodnar LM, Naimi AI (2021, In Press). AIPW: An R Package for Augmented Inverse Probability Weighted Estimation of Average Causal Effects. <em>American Journal of Epidemiology</em>.
</p>
<p>Robins JM, Rotnitzky A (1995). Semiparametric efficiency in multivariate regression models with missing data. <em>Journal of the American Statistical Association</em>.
</p>
<p>Chernozhukov V, Chetverikov V, Demirer M, et al (2018). Double/debiased machine learning for treatment and structural parameters. <em>The Econometrics Journal</em>.
</p>
<p>Kennedy EH, Sjolander A, Small DS (2015). Semiparametric causal inference in matched cohort studies. <em>Biometrika</em>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(SuperLearner)
library(ggplot2)

#create an object
aipw_sl &lt;- AIPW$new(Y=rbinom(100,1,0.5), A=rbinom(100,1,0.5),
                    W.Q=rbinom(100,1,0.5), W.g=rbinom(100,1,0.5),
                    Q.SL.library="SL.mean",g.SL.library="SL.mean",
                    k_split=1,verbose=FALSE)

#fit the object
aipw_sl$fit()
# or use `aipw_sl$stratified_fit()` to estimate ATE and ATT/ATC

#calculate the results
aipw_sl$summary(g.bound = 0.025)

#check the propensity scores by exposure status after truncation
aipw_sl$plot.p_score()

</code></pre>


</div>