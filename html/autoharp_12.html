<div class="container">

<table style="width: 100%;"><tr>
<td>forestharp-helpers</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Forestharp helpers</h2>

<h3>Description</h3>

<p>Example of functions that can be <em>directly used on TreeHarp objects
individually,</em> and on forestharp objects via <code>fapply</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">count_self_fn(th)

count_lam_fn(th)

count_fn_call(th, pattern, pkg_name)

extract_fn_call(th, pattern, pkg_name)

extract_formal_args(th, fn_name)

extract_assigned_objects(th)

extract_actual_args(th)

detect_growing(th, count = FALSE, within_for = FALSE)

detect_for_in_fn_def(th, fn_name)

count_fn_in_fn(th, fn_name, sub_fn)

detect_fn_call_in_for(th, fn_name)

extract_self_fn(th)

detect_fn_arg(th, fn_name, arg)

detect_nested_for(th)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>th</code></td>
<td>
<p>A TreeHarp object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pattern</code></td>
<td>
<p>A regular expression to pick up function names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pkg_name</code></td>
<td>
<p>The name of a package to match functions with. This should
be an exact match for the package name. The package should be attached for
this to work. In order to avoid picking up duplicate names, for instance
<code>tolower</code> is a function in base R and in ggplot2, run
<code>get_libraries</code> on the file as well, and match against it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn_name</code></td>
<td>
<p>Function name, as a character string</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>count</code></td>
<td>
<p>For <code>detect_growing</code>, this is a logical value that indicates
if the number of "grow" expressions should be counted and returned, or if just a
logical value should be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>within_for</code></td>
<td>
<p>If TRUE, only expresssions within a for loop are included.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sub_fn</code></td>
<td>
<p>(For count_fn_in_fn), the function to count (to look for within
fn_name).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arg</code></td>
<td>
<p>The argument to check for within fn_name (as a character string).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These are examples of functions that be called on a list of TreeHarp
objects, which we refer to as a forestharp object. Such objects are not
formally defined yet, but can be created using
<code>rmd_to_forestharp</code> or using <code>join_treeharps</code>.
</p>


<h3>Value</h3>

<p>On their own, each of these functions should return a scalar or a
1-dimensional array. When called with <code>fapply</code>, the scalar
numerical values can be combined (by taking the sum, any other provided
combiner function).
</p>
<p>The ultimate idea is that fapply should return a single feature for each rmd
file that it is called upon.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>count_self_fn</code>: Counts the number of self-defined functions.
</p>
<p>This helper counts the number of self-defined functions. It excludes
lambda functions. It returns an integer scalar.
</p>
<p>As long as the function <code>function</code> was called and assigned, it will be
counted.
</p>
</li>
<li> <p><code>count_lam_fn</code>: Counts the number of anonymous functions.
</p>
<p>Counts the number of anonymous functions, typically used in sapply, etc. It
returns an integer scalar. As long as the function <code>function</code> was
called but <em>not</em> assigned, it will be counted here.
</p>
</li>
<li> <p><code>count_fn_call</code>: Counts the number of function calls that match a pattern.
</p>
<p>This helper counts the number of function calls that match a pattern. It
returns a count, i.e. an integer vector of length 1.
</p>
<p>If <code>pkg_name</code> is provided instead of <code>pattern</code>, then this function
counts the number of function calls from that package.
</p>
</li>
<li> <p><code>extract_fn_call</code>: Extracts function calls as a string.
</p>
<p>Extracts the function calls that match a pattern. It returns a character
vector. Remember to set <code>combine = FALSE</code> when calling
<code>fapply</code> with it.
</p>
</li>
<li> <p><code>extract_formal_args</code>: Extracts function formal arguments called.
</p>
<p>Extracts the function <em>formal</em> arguments from functions with a given
name. The name must match the function name exactly. This returns a character
vector or NULL, if no formal arguments are used.
</p>
</li>
<li> <p><code>extract_assigned_objects</code>: Extracts names of assigned objects
</p>
<p>Extracts the names of assigned objects. This was written to assist in
detecting missed opportunities to use the pipe operator.
</p>
</li>
<li> <p><code>extract_actual_args</code>: Extracts actual argument names
</p>
<p>Extracts the actual arguments from an expression, not the formal
arguments. It only returns syntactic literals. It should be improved
to return the actual arguments for a specified function so that something
similar to <code>extract_assigned_objects</code> could be returned.
</p>
</li>
<li> <p><code>detect_growing</code>: Detects if a vector is being grown.
</p>
<p>It detects if there is an expression of form: x &lt;- c(x, new_val). This is
generally bad programming practice
</p>
</li>
<li> <p><code>detect_for_in_fn_def</code>: Detects if a for loop is present within a function
</p>
<p>It detects if a for loop is present within a function definition.
</p>
</li>
<li> <p><code>count_fn_in_fn</code>: Count use of a function within another.
</p>
<p>It counts the number of times a function is used within another.
</p>
</li>
<li> <p><code>detect_fn_call_in_for</code>: Detect for loop to call a function
</p>
<p>Checks if a function has been called within a for loop.
</p>
</li>
<li> <p><code>extract_self_fn</code>: Extract names of functions defined by user.
</p>
<p>Extracts names of user-defined functions. They may not all look nice, because
sum functions may be anonymous functions. This function needs to be improved.
</p>
</li>
<li> <p><code>detect_fn_arg</code>: Was a function called with a particular argument?
</p>
<p>Checks if a function was called with a particular argument, which could be
the formal or actual one. The immediate child of the function call node is
checked.
</p>
</li>
<li> <p><code>detect_nested_for</code>: Was a nested "for" loop called anywhere within the code?
</p>
<p>Checks if a nested for-loop was called anywhere within the code. This returns
a logical scalar for each TreeHarp object given.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># Dummy trees
th1 &lt;- TreeHarp(quote(X &lt;- rnorm(10, mean=0.9, sd=4)), TRUE)
th2 &lt;- TreeHarp(quote(Y &lt;- rbeta(10, shape1=3, shape2=5)), TRUE)
th3 &lt;- TreeHarp(quote(fn1 &lt;- function(x) x + 2), TRUE)
th4 &lt;- TreeHarp(quote(df1 &lt;- mutate(df1, new_col=2*old_col)), TRUE)

# Run helpers
count_self_fn(th3)
count_fn_call(th4, pkg_name="dplyr")
count_fn_call(th1, pattern="^r.*")

</code></pre>


</div>