<div class="container">

<table style="width: 100%;"><tr>
<td>derive_var_ontrtfl</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Derive On-Treatment Flag Variable</h2>

<h3>Description</h3>

<p>Derive on-treatment flag (<code>ONTRTFL</code>) in an ADaM dataset with a single
assessment date (e.g <code>ADT</code>) or event start and end dates (e.g.
<code>ASTDT</code>/<code>AENDT</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_var_ontrtfl(
  dataset,
  new_var = ONTRTFL,
  start_date,
  end_date = NULL,
  ref_start_date,
  ref_end_date = NULL,
  ref_end_window = 0,
  ignore_time_for_ref_end_date = TRUE,
  filter_pre_timepoint = NULL,
  span_period = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>Required columns are <code>start_date</code>, <code>end_date</code>, <code>ref_start_date</code> and
<code>ref_end_date</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_var</code></td>
<td>
<p>On-treatment flag variable name to be created.
</p>
<p>Default is <code>ONTRTFL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_date</code></td>
<td>
<p>The start date (e.g. <code>AESDT</code>) or assessment date (e.g.
<code>ADT</code>) Required; A date or date-time object column is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end_date</code></td>
<td>
<p>The end date of assessment/event (e.g. <code>AENDT</code>) A date or
date-time object column is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.
</p>
<p>Optional; Default is null. If the used and date value is missing on an
observation, it is assumed the medication is ongoing and <code>ONTRTFL</code> is set
to <code>"Y"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_start_date</code></td>
<td>
<p>The lower bound of the on-treatment period Required; A
date or date-time object column is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_end_date</code></td>
<td>
<p>The upper bound of the on-treatment period A date or
date-time object column is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.
</p>
<p>Optional; This can be null and everything after <code>ref_start_date</code> will be
considered on-treatment. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_end_window</code></td>
<td>
<p>A window to add to the upper bound <code>ref_end_date</code>
measured in days (e.g. 7 if 7 days should be added to the upper bound)
Optional; default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore_time_for_ref_end_date</code></td>
<td>
<p>If the argument is set to <code>TRUE</code>, the time part is ignored for checking if
the event occurred more than <code>ref_end_window</code> days after reference end
date.
</p>
<p><em>Permitted Values:</em> <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter_pre_timepoint</code></td>
<td>
<p>An expression to filter observations as not
on-treatment when <code>date</code> = <code>ref_start_date</code>. For example, if observations
where <code>VSTPT = PRE</code> should not be considered on-treatment when <code>date = ref_start_date</code>, <code>filter_pre_timepoint</code> should be used to denote when the
on-treatment flag should be set to null. Optional; default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>span_period</code></td>
<td>
<p>A logical scalar. If <code>TRUE</code>, events that started
prior to the <code>ref_start_date</code>and are ongoing or end after the
<code>ref_start_date</code> are flagged as <code>"Y"</code>. Optional; default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>On-Treatment is calculated by determining whether the assessment
date or start/stop dates fall between 2 dates. The following logic is used
to assign on-treatment = <code>"Y"</code>:
</p>

<ol>
<li> <p><code>start_date</code> is missing and <code>ref_start_date</code>is non-missing
</p>
</li>
<li>
<p> No timepoint filter is provided (<code>filter_pre_timepoint</code>) and both
<code>start_date</code> and <code>ref_start_date</code> are non-missing and <code>start_date</code> =
<code>ref_start_date</code>
</p>
</li>
<li>
<p> A timepoint is provided (<code>filter_pre_timepoint</code>) and both <code>start_date</code>
and <code>ref_start_date</code> are non-missing and <code>start_date = ref_start_date</code> and
the filter provided in <code>filter_pre_timepoint</code> is not true.
</p>
</li>
<li> <p><code>ref_end_date</code> is not provided and <code>ref_start_date &lt; start_date</code>
</p>
</li>
<li> <p><code>ref_end_date</code> is provided and <code>ref_start_date &lt; start_date</code> &lt;=
<code>ref_end_date + ref_end_window</code>.
</p>
</li>
</ol>
<p>If the <code>end_date</code> is provided and the <code>end_date</code> &lt; ref_start_date then the
<code>ONTRTFL</code> is set to <code>NULL</code>.This would be applicable to cases where the
<code>start_date</code> is missing and <code>ONTRTFL</code> has been assigned as <code>"Y"</code> above.
</p>
<p>If the <code>span_period</code> is <code>TRUE</code>, this allows the user to assign
<code>ONTRTFL</code> as <code>"Y"</code> to cases where the record started prior to the
<code>ref_start_date</code> and was ongoing or ended after the <code>ref_start_date</code>.
</p>
<p>Any date imputations needed should be done prior to calling this function.
</p>


<h3>Value</h3>

<p>The input dataset with an additional column named <code>ONTRTFL</code> with a
value of <code>"Y"</code> or <code>NA</code>
</p>


<h3>See Also</h3>

<p>BDS-Findings Functions that returns variable appended to dataset: 
<code>derive_basetype_records()</code>,
<code>derive_var_analysis_ratio()</code>,
<code>derive_var_anrind()</code>,
<code>derive_var_atoxgr()</code>,
<code>derive_var_atoxgr_dir()</code>,
<code>derive_var_base()</code>,
<code>derive_var_chg()</code>,
<code>derive_var_pchg()</code>,
<code>derive_var_shift()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(tibble)
library(dplyr, warn.conflicts = FALSE)
library(lubridate, warn.conflicts = FALSE)

advs &lt;- tribble(
  ~USUBJID, ~ADT,              ~TRTSDT,           ~TRTEDT,
  "P01",    ymd("2020-02-24"), ymd("2020-01-01"), ymd("2020-03-01"),
  "P02",    ymd("2020-01-01"), ymd("2020-01-01"), ymd("2020-03-01"),
  "P03",    ymd("2019-12-31"), ymd("2020-01-01"), ymd("2020-03-01")
)
derive_var_ontrtfl(
  advs,
  start_date = ADT,
  ref_start_date = TRTSDT,
  ref_end_date = TRTEDT
)

advs &lt;- tribble(
  ~USUBJID, ~ADT,              ~TRTSDT,           ~TRTEDT,
  "P01",    ymd("2020-07-01"), ymd("2020-01-01"), ymd("2020-03-01"),
  "P02",    ymd("2020-04-30"), ymd("2020-01-01"), ymd("2020-03-01"),
  "P03",    ymd("2020-03-15"), ymd("2020-01-01"), ymd("2020-03-01")
)
derive_var_ontrtfl(
  advs,
  start_date = ADT,
  ref_start_date = TRTSDT,
  ref_end_date = TRTEDT,
  ref_end_window = 60
)

advs &lt;- tribble(
  ~USUBJID, ~ADTM,                      ~TRTSDTM,                   ~TRTEDTM,
  "P01",    ymd_hm("2020-01-02T12:00"), ymd_hm("2020-01-01T12:00"), ymd_hm("2020-03-01T12:00"),
  "P02",    ymd("2020-01-01"),          ymd_hm("2020-01-01T12:00"), ymd_hm("2020-03-01T12:00"),
  "P03",    ymd("2019-12-31"),          ymd_hm("2020-01-01T12:00"), ymd_hm("2020-03-01T12:00"),
) %&gt;%
  mutate(TPT = c(NA, "PRE", NA))
derive_var_ontrtfl(
  advs,
  start_date = ADTM,
  ref_start_date = TRTSDTM,
  ref_end_date = TRTEDTM,
  filter_pre_timepoint = TPT == "PRE"
)

advs &lt;- tribble(
  ~USUBJID, ~ASTDT,            ~TRTSDT,           ~TRTEDT,           ~AENDT,
  "P01",    ymd("2020-03-15"), ymd("2020-01-01"), ymd("2020-03-01"), ymd("2020-12-01"),
  "P02",    ymd("2019-04-30"), ymd("2020-01-01"), ymd("2020-03-01"), ymd("2020-03-15"),
  "P03",    ymd("2019-04-30"), ymd("2020-01-01"), ymd("2020-03-01"), NA,
)
derive_var_ontrtfl(
  advs,
  start_date = ASTDT,
  end_date = AENDT,
  ref_start_date = TRTSDT,
  ref_end_date = TRTEDT,
  ref_end_window = 60,
  span_period = TRUE
)

advs &lt;- tribble(
  ~USUBJID, ~ASTDT,            ~AP01SDT,          ~AP01EDT,          ~AENDT,
  "P01",    ymd("2020-03-15"), ymd("2020-01-01"), ymd("2020-03-01"), ymd("2020-12-01"),
  "P02",    ymd("2019-04-30"), ymd("2020-01-01"), ymd("2020-03-01"), ymd("2020-03-15"),
  "P03",    ymd("2019-04-30"), ymd("2020-01-01"), ymd("2020-03-01"), NA,
)
derive_var_ontrtfl(
  advs,
  new_var = ONTR01FL,
  start_date = ASTDT,
  end_date = AENDT,
  ref_start_date = AP01SDT,
  ref_end_date = AP01EDT,
  span_period = TRUE
)
</code></pre>


</div>