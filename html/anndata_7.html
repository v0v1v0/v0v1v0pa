<div class="container">

<table style="width: 100%;"><tr>
<td>AnnData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create an Annotated Data Matrix</h2>

<h3>Description</h3>

<p><code>AnnData</code> stores a data matrix <code>X</code> together with annotations
of observations <code>obs</code> (<code>obsm</code>, <code>obsp</code>), variables <code>var</code> (<code>varm</code>, <code>varp</code>),
and unstructured annotations <code>uns</code>.
</p>
<p>An <code>AnnData</code> object <code>adata</code> can be sliced like a data frame,
for instance <code>adata_subset &lt;- adata[, list_of_variable_names]</code>. <code>AnnData</code>’s
basic structure is similar to R's ExpressionSet.
</p>
<p>If setting an <code>h5ad</code>-formatted HDF5 backing file <code>filename</code>,
data remains on the disk but is automatically loaded into memory if needed.
See this <a href="https://falexwolf.de/blog/171223_AnnData_indexing_views_HDF5-backing/">blog post</a> for more details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">AnnData(
  X = NULL,
  obs = NULL,
  var = NULL,
  uns = NULL,
  obsm = NULL,
  varm = NULL,
  layers = NULL,
  raw = NULL,
  dtype = "float32",
  shape = NULL,
  filename = NULL,
  filemode = NULL,
  obsp = NULL,
  varp = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A #observations × #variables data matrix. A view of the data is used if the data type matches, otherwise, a copy is made.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>Key-indexed one-dimensional observations annotation of length #observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>Key-indexed one-dimensional variables annotation of length #variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uns</code></td>
<td>
<p>Key-indexed unstructured annotation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsm</code></td>
<td>
<p>Key-indexed multi-dimensional observations annotation of length #observations. If passing a <code>~numpy.ndarray</code>, it needs to have a structured datatype.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varm</code></td>
<td>
<p>Key-indexed multi-dimensional variables annotation of length #variables. If passing a <code>~numpy.ndarray</code>, it needs to have a structured datatype.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layers</code></td>
<td>
<p>Key-indexed multi-dimensional arrays aligned to dimensions of <code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raw</code></td>
<td>
<p>Store raw version of <code>X</code> and <code>var</code> as <code style="white-space: pre;">⁠$raw$X⁠</code> and <code style="white-space: pre;">⁠$raw$var⁠</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtype</code></td>
<td>
<p>Data type used for storage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>Shape list (#observations, #variables). Can only be provided if <code>X</code> is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>Name of backing file. See <a href="https://docs.h5py.org/en/latest/high/file.html#h5py.File">h5py.File</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filemode</code></td>
<td>
<p>Open mode of backing file. See <a href="https://docs.h5py.org/en/latest/high/file.html#h5py.File">h5py.File</a>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsp</code></td>
<td>
<p>Pairwise annotation of observations, a mutable mapping with array-like values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varp</code></td>
<td>
<p>Pairwise annotation of observations, a mutable mapping with array-like values.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>AnnData</code> stores observations (samples) of variables/features in the rows of a matrix.
This is the convention of the modern classics of statistic and machine learning,
the convention of dataframes both in R and Python and the established statistics
and machine learning packages in Python (statsmodels, scikit-learn).
</p>
<p>Single dimensional annotations of the observation and variables are stored
in the <code>obs</code> and <code>var</code> attributes as data frames.
This is intended for metrics calculated over their axes.
Multi-dimensional annotations are stored in <code>obsm</code> and <code>varm</code>,
which are aligned to the objects observation and variable dimensions respectively.
Square matrices representing graphs are stored in <code>obsp</code> and <code>varp</code>,
with both of their own dimensions aligned to their associated axis.
Additional measurements across both observations and variables are stored in
<code>layers</code>.
</p>
<p>Indexing into an AnnData object can be performed by relative position
with numeric indices,  or by labels.
To avoid ambiguity with numeric indexing into observations or variables,
indexes of the AnnData object are converted to strings by the constructor.
</p>
<p>Subsetting an AnnData object by indexing into it will also subset its elements
according to the dimensions they were aligned to.
This means an operation like <code>adata[list_of_obs, ]</code> will also subset <code>obs</code>,
<code>obsm</code>, and <code>layers</code>.
</p>
<p>Subsetting an AnnData object returns a view into the original object,
meaning very little additional memory is used upon subsetting.
This is achieved lazily, meaning that the constituent arrays are subset on access.
Copying a view causes an equivalent “real” AnnData object to be generated.
Attempting to modify a view (at any attribute except X) is handled
in a copy-on-modify manner, meaning the object is initialized in place.
Here's an example
</p>
<div class="sourceCode r"><pre>batch1 &lt;- adata[adata$obs["batch"] == "batch1", ]
batch1$obs["value"] = 0 # This makes batch1 a “real” AnnData object
</pre></div>
<p>At the end of this snippet: <code>adata</code> was not modified,
and <code>batch1</code> is its own AnnData object with its own data.
</p>
<p>Similar to Bioconductor’s <code>ExpressionSet</code> and <code>scipy.sparse</code> matrices,
subsetting an AnnData object retains the dimensionality of its constituent arrays.
Therefore, unlike with the classes exposed by <code>pandas</code>, <code>numpy</code>,
and <code>xarray</code>, there is no concept of a one dimensional AnnData object.
AnnDatas always have two inherent dimensions, <code>obs</code> and <code>var</code>.
Additionally, maintaining the dimensionality of the AnnData object allows for
consistent handling of <code>scipy.sparse</code> matrices and <code>numpy</code> arrays.
</p>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>X</code></dt>
<dd>
<p>Data matrix of shape <code>n_obs</code> × <code>n_vars</code>.</p>
</dd>
<dt><code>filename</code></dt>
<dd>
<p>Name of the backing file.
</p>
<p>Change to backing mode by setting the filename of a <code>.h5ad</code> file.
</p>

<ul>
<li>
<p> Setting the filename writes the stored data to disk.
</p>
</li>
<li>
<p> Setting the filename when the filename was previously another name
moves the backing file from the previous file to the new file.
If you want to copy the previous file, use <code>copy(filename='new_filename')</code>.
</p>
</li>
</ul>
</dd>
<dt><code>layers</code></dt>
<dd>
<p>A list-like object with values of the same dimensions as <code>X</code>.
Layers in AnnData are inspired by <a href="https://linnarssonlab.org/loompy/apiwalkthrough/index.html#loomlayers">loompy's layers</a>.
</p>
<p>Overwrite the layers:
</p>
<div class="sourceCode"><pre>adata$layers &lt;- list(spliced = spliced, unspliced = unspliced)
</pre></div>
<p>Return the layer named <code>"unspliced"</code>:
</p>
<div class="sourceCode"><pre>adata$layers["unspliced"]
</pre></div>
<p>Create or replace the <code>"spliced"</code> layer:
</p>
<div class="sourceCode"><pre>adata$layers["spliced"] = example_matrix
</pre></div>
<p>Assign the 10th column of layer <code>"spliced"</code> to the variable a:
</p>
<div class="sourceCode"><pre>a &lt;- adata$layers["spliced"][, 10]
</pre></div>
<p>Delete the <code>"spliced"</code>:
</p>
<div class="sourceCode"><pre>adata$layers["spliced"] &lt;- NULL
</pre></div>
<p>Return layers' names:
</p>
<div class="sourceCode"><pre>names(adata$layers)
</pre></div>
</dd>
<dt><code>T</code></dt>
<dd>
<p>Transpose whole object.
</p>
<p>Data matrix is transposed, observations and variables are interchanged.
</p>
<p>Ignores <code>.raw</code>.</p>
</dd>
<dt><code>is_view</code></dt>
<dd>
<p><code>TRUE</code> if object is view of another AnnData object, <code>FALSE</code> otherwise.</p>
</dd>
<dt><code>isbacked</code></dt>
<dd>
<p><code>TRUE</code> if object is backed on disk, <code>FALSE</code> otherwise.</p>
</dd>
<dt><code>n_obs</code></dt>
<dd>
<p>Number of observations.</p>
</dd>
<dt><code>obs</code></dt>
<dd>
<p>One-dimensional annotation of observations (data.frame).</p>
</dd>
<dt><code>obs_names</code></dt>
<dd>
<p>Names of observations.</p>
</dd>
<dt><code>obsm</code></dt>
<dd>
<p>Multi-dimensional annotation of observations (matrix).
</p>
<p>Stores for each key a two or higher-dimensional matrix with <code>n_obs</code> rows.</p>
</dd>
<dt><code>obsp</code></dt>
<dd>
<p>Pairwise annotation of observations, a mutable mapping with array-like values.
</p>
<p>Stores for each key a two or higher-dimensional matrix whose first two dimensions are of length <code>n_obs</code>.</p>
</dd>
<dt><code>n_vars</code></dt>
<dd>
<p>Number of variables.</p>
</dd>
<dt><code>var</code></dt>
<dd>
<p>One-dimensional annotation of variables (data.frame).</p>
</dd>
<dt><code>var_names</code></dt>
<dd>
<p>Names of variables.</p>
</dd>
<dt><code>varm</code></dt>
<dd>
<p>Multi-dimensional annotation of variables (matrix).
</p>
<p>Stores for each key a two or higher-dimensional matrix with <code>n_vars</code> rows.</p>
</dd>
<dt><code>varp</code></dt>
<dd>
<p>Pairwise annotation of variables, a mutable mapping with array-like values.
</p>
<p>Stores for each key a two or higher-dimensional matrix whose first two dimensions are of length <code>n_vars</code>.</p>
</dd>
<dt><code>shape</code></dt>
<dd>
<p>Shape of data matrix (<code>n_obs</code>, <code>n_vars</code>).</p>
</dd>
<dt><code>uns</code></dt>
<dd>
<p>Unstructured annotation (ordered dictionary).</p>
</dd>
<dt><code>raw</code></dt>
<dd>
<p>Store raw version of <code>X</code> and <code>var</code> as <code style="white-space: pre;">⁠$raw$X⁠</code> and <code style="white-space: pre;">⁠$raw$var⁠</code>.
</p>
<p>The <code>raw</code> attribute is initialized with the current content of an object
by setting:
</p>
<div class="sourceCode"><pre>adata$raw = adata
</pre></div>
<p>Its content can be deleted:
</p>
<div class="sourceCode"><pre>adata$raw &lt;- NULL
</pre></div>
<p>Upon slicing an AnnData object along the obs (row) axis, <code>raw</code> is also
sliced. Slicing an AnnData object along the vars (columns) axis
leaves <code>raw</code> unaffected. Note that you can call:
</p>
<div class="sourceCode"><pre>adata$raw[, 'orig_variable_name']$X
</pre></div>
<p><code style="white-space: pre;">⁠to retrieve the data associated with a variable that might have been filtered out or "compressed away" in⁠</code>X'.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-AnnDataR6-new"><code>AnnDataR6$new()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-obs_keys"><code>AnnDataR6$obs_keys()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-obs_names_make_unique"><code>AnnDataR6$obs_names_make_unique()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-obsm_keys"><code>AnnDataR6$obsm_keys()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-var_keys"><code>AnnDataR6$var_keys()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-var_names_make_unique"><code>AnnDataR6$var_names_make_unique()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-varm_keys"><code>AnnDataR6$varm_keys()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-uns_keys"><code>AnnDataR6$uns_keys()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-chunk_X"><code>AnnDataR6$chunk_X()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-chunked_X"><code>AnnDataR6$chunked_X()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-concatenate"><code>AnnDataR6$concatenate()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-copy"><code>AnnDataR6$copy()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-rename_categories"><code>AnnDataR6$rename_categories()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-strings_to_categoricals"><code>AnnDataR6$strings_to_categoricals()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-to_df"><code>AnnDataR6$to_df()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-transpose"><code>AnnDataR6$transpose()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-write_csvs"><code>AnnDataR6$write_csvs()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-write_h5ad"><code>AnnDataR6$write_h5ad()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-write_loom"><code>AnnDataR6$write_loom()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-print"><code>AnnDataR6$print()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-.set_py_object"><code>AnnDataR6$.set_py_object()</code></a>
</p>
</li>
<li> <p><a href="#method-AnnDataR6-.get_py_object"><code>AnnDataR6$.get_py_object()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-AnnDataR6-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new AnnData object
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$new(obj)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>obj</code></dt>
<dd>
<p>A Python anndata object</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
# use AnnData() instead of AnnDataR6$new()
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-obs_keys"></a>



<h4>Method <code>obs_keys()</code>
</h4>

<p>List keys of observation annotation <code>obs</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$obs_keys()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2"))
)
ad$obs_keys()
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-obs_names_make_unique"></a>



<h4>Method <code>obs_names_make_unique()</code>
</h4>

<p>Makes the index unique by appending a number string to each duplicate index element: 1, 2, etc.
</p>
<p>If a tentative name created by the algorithm already exists in the index, it tries the next integer in the sequence.
</p>
<p>The first occurrence of a non-unique value is ignored.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$obs_names_make_unique(join = "-")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>join</code></dt>
<dd>
<p>The connecting string between name and integer (default: <code>"-"</code>).</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(rep(1, 6), nrow = 3),
  obs = data.frame(field = c(1, 2, 3))
)
ad$obs_names &lt;- c("a", "a", "b")
ad$obs_names_make_unique()
ad$obs_names
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-obsm_keys"></a>



<h4>Method <code>obsm_keys()</code>
</h4>

<p>List keys of observation annotation <code>obsm</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$obsm_keys()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  obsm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  )
)
ad$obs_keys()
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-var_keys"></a>



<h4>Method <code>var_keys()</code>
</h4>

<p>List keys of variable annotation <code>var</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$var_keys()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)
ad$var_keys()
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-var_names_make_unique"></a>



<h4>Method <code>var_names_make_unique()</code>
</h4>

<p>Makes the index unique by appending a number string to each duplicate index element: 1, 2, etc.
</p>
<p>If a tentative name created by the algorithm already exists in the index, it tries the next integer in the sequence.
</p>
<p>The first occurrence of a non-unique value is ignored.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$var_names_make_unique(join = "-")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>join</code></dt>
<dd>
<p>The connecting string between name and integer (default: <code>"-"</code>).</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(rep(1, 6), nrow = 2),
  var = data.frame(field = c(1, 2, 3))
)
ad$var_names &lt;- c("a", "a", "b")
ad$var_names_make_unique()
ad$var_names
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-varm_keys"></a>



<h4>Method <code>varm_keys()</code>
</h4>

<p>List keys of variable annotation <code>varm</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$varm_keys()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  )
)
ad$varm_keys()
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-uns_keys"></a>



<h4>Method <code>uns_keys()</code>
</h4>

<p>List keys of unstructured annotation <code>uns</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$uns_keys()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-chunk_X"></a>



<h4>Method <code>chunk_X()</code>
</h4>

<p>Return a chunk of the data matrix <code>X</code> with random or specified indices.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$chunk_X(select = 1000L, replace = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>select</code></dt>
<dd>
<p>Depending on the values:
</p>

<ul>
<li>
<p> 1 integer: A random chunk with select rows will be returned.
</p>
</li>
<li>
<p> multiple integers: A chunk with these indices will be returned.
</p>
</li>
</ul>
</dd>
<dt><code>replace</code></dt>
<dd>
<p>if <code>select</code> is an integer then <code>TRUE</code> means random sampling of indices with replacement,
<code>FALSE</code> without replacement.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(runif(10000), nrow = 50)
)

ad$chunk_X(select = 10L) # 10 random samples
ad$chunk_X(select = 1:3) # first 3 samples
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-chunked_X"></a>



<h4>Method <code>chunked_X()</code>
</h4>

<p>Return an iterator over the rows of the data matrix X.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$chunked_X(chunk_size = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>chunk_size</code></dt>
<dd>
<p>Row size of a single chunk.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(runif(10000), nrow = 50)
)
ad$chunked_X(10)
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-concatenate"></a>



<h4>Method <code>concatenate()</code>
</h4>

<p>Concatenate along the observations axis.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$concatenate(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>Deprecated</p>
</dd>
</dl>
</div>


<hr>
<a id="method-AnnDataR6-copy"></a>



<h4>Method <code>copy()</code>
</h4>

<p>Full copy, optionally on disk.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$copy(filename = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt>
<dd>
<p>Path to filename (default: <code>NULL</code>).</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2)
)
ad$copy()
ad$copy("file.h5ad")
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-rename_categories"></a>



<h4>Method <code>rename_categories()</code>
</h4>

<p>Rename categories of annotation <code>key</code> in <code>obs</code>, <code>var</code>, and <code>uns</code>.
Only supports passing a list/array-like <code>categories</code> argument.
Besides calling <code style="white-space: pre;">⁠self.obs[key].cat.categories = categories⁠</code> –
similar for <code>var</code> - this also renames categories in unstructured
annotation that uses the categorical annotation <code>key</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$rename_categories(key, categories)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>key</code></dt>
<dd>
<p>Key for observations or variables annotation.</p>
</dd>
<dt><code>categories</code></dt>
<dd>
<p>New categories, the same number as the old categories.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2"))
)
ad$rename_categories("group", c(a = "A", b = "B")) # ??
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-strings_to_categoricals"></a>



<h4>Method <code>strings_to_categoricals()</code>
</h4>

<p>Transform string annotations to categoricals.
</p>
<p>Only affects string annotations that lead to less categories than the total number of observations.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$strings_to_categoricals(df = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>df</code></dt>
<dd>
<p>If <code>df</code> is <code>NULL</code>, modifies both <code>obs</code> and <code>var</code>, otherwise modifies <code>df</code> inplace.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
)
ad$strings_to_categoricals() # ??
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-to_df"></a>



<h4>Method <code>to_df()</code>
</h4>

<p>Generate shallow data frame.
</p>
<p>The data matrix <code>X</code> is returned as data frame, where <code>obs_names</code> are the rownames, and <code>var_names</code> the columns names.
</p>
<p>No annotations are maintained in the returned object.
</p>
<p>The data matrix is densified in case it is sparse.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$to_df(layer = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>layer</code></dt>
<dd>
<p>Key for layers</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  layers = list(
    spliced = matrix(c(4, 5, 6, 7), nrow = 2),
    unspliced = matrix(c(8, 9, 10, 11), nrow = 2)
  )
)

ad$to_df()
ad$to_df("unspliced")
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-transpose"></a>



<h4>Method <code>transpose()</code>
</h4>

<p>transpose Transpose whole object.
</p>
<p>Data matrix is transposed, observations and variables are interchanged.
</p>
<p>Ignores <code>.raw</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$transpose()</pre></div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)

ad$transpose()
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-write_csvs"></a>



<h4>Method <code>write_csvs()</code>
</h4>

<p>Write annotation to .csv files.
</p>
<p>It is not possible to recover the full AnnData from these files. Use <code>write_h5ad()</code> for this.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$write_csvs(dirname, skip_data = TRUE, sep = ",")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>dirname</code></dt>
<dd>
<p>Name of the directory to which to export.</p>
</dd>
<dt><code>skip_data</code></dt>
<dd>
<p>Skip the data matrix <code>X</code>.</p>
</dd>
<dt><code>sep</code></dt>
<dd>
<p>Separator for the data</p>
</dd>
<dt><code>anndata</code></dt>
<dd>
<p>An <code>AnnData()</code> object</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$to_write_csvs("output")

unlink("output", recursive = TRUE)
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-write_h5ad"></a>



<h4>Method <code>write_h5ad()</code>
</h4>

<p>Write .h5ad-formatted hdf5 file.
</p>
<p>Generally, if you have sparse data that are stored as a dense matrix, you can
dramatically improve performance and reduce disk space by converting to a csr_matrix:
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$write_h5ad(
  filename,
  compression = NULL,
  compression_opts = NULL,
  as_dense = list()
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt>
<dd>
<p>Filename of data file. Defaults to backing file.</p>
</dd>
<dt><code>compression</code></dt>
<dd>
<p>See the h5py <a href="http://docs.h5py.org/en/latest/high/dataset.html#dataset-compression">filter pipeline</a>.
Options are <code>"gzip"</code>, <code>"lzf"</code> or <code>NULL</code>.</p>
</dd>
<dt><code>compression_opts</code></dt>
<dd>
<p>See the h5py <a href="http://docs.h5py.org/en/latest/high/dataset.html#dataset-compression">filter pipeline</a>.</p>
</dd>
<dt><code>as_dense</code></dt>
<dd>
<p>Sparse in AnnData object to write as dense. Currently only supports <code>"X"</code> and <code>"raw/X"</code>.</p>
</dd>
<dt><code>anndata</code></dt>
<dd>
<p>An <code>AnnData()</code> object</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$write_h5ad("output.h5ad")

file.remove("output.h5ad")
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-write_loom"></a>



<h4>Method <code>write_loom()</code>
</h4>

<p>Write .loom-formatted hdf5 file.
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$write_loom(filename, write_obsm_varm = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt>
<dd>
<p>The filename.</p>
</dd>
<dt><code>write_obsm_varm</code></dt>
<dd>
<p>Whether or not to also write the varm and obsm.</p>
</dd>
<dt><code>anndata</code></dt>
<dd>
<p>An <code>AnnData()</code> object</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$write_loom("output.loom")

file.remove("output.loom")
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-print"></a>



<h4>Method <code>print()</code>
</h4>

<p>Print AnnData object
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$print(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>optional arguments to print method.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre>\dontrun{
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  layers = list(
    spliced = matrix(c(4, 5, 6, 7), nrow = 2),
    unspliced = matrix(c(8, 9, 10, 11), nrow = 2)
  ),
  obsm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$print()
print(ad)
}
</pre>
</div>


<hr>
<a id="method-AnnDataR6-.set_py_object"></a>



<h4>Method <code>.set_py_object()</code>
</h4>

<p>Set internal Python object
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$.set_py_object(obj)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>obj</code></dt>
<dd>
<p>A python anndata object</p>
</dd>
</dl>
</div>


<hr>
<a id="method-AnnDataR6-.get_py_object"></a>



<h4>Method <code>.get_py_object()</code>
</h4>

<p>Get internal Python object
</p>


<h5>Usage</h5>

<div class="r"><pre>AnnDataR6$.get_py_object()</pre></div>




<h3>See Also</h3>

<p><code>read_h5ad()</code> <code>read_csv()</code> <code>read_excel()</code> <code>read_hdf()</code> <code>read_loom()</code> <code>read_mtx()</code> <code>read_text()</code> <code>read_umi_tools()</code> <code>write_h5ad()</code> <code>write_csvs()</code> <code>write_loom()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  layers = list(
    spliced = matrix(c(4, 5, 6, 7), nrow = 2),
    unspliced = matrix(c(8, 9, 10, 11), nrow = 2)
  ),
  obsm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

value &lt;- matrix(c(1,2,3,4), nrow = 2)
ad$X &lt;- value
ad$X

ad$layers
ad$layers["spliced"]
ad$layers["test"] &lt;- value
ad$layers

ad$to_df()
ad$uns

as.matrix(ad)
as.matrix(ad, layer = "unspliced")
dim(ad)
rownames(ad)
colnames(ad)

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$new`
## ------------------------------------------------

## Not run: 
# use AnnData() instead of AnnDataR6$new()
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$obs_keys`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2"))
)
ad$obs_keys()

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$obs_names_make_unique`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(rep(1, 6), nrow = 3),
  obs = data.frame(field = c(1, 2, 3))
)
ad$obs_names &lt;- c("a", "a", "b")
ad$obs_names_make_unique()
ad$obs_names

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$obsm_keys`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  obsm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  )
)
ad$obs_keys()

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$var_keys`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)
ad$var_keys()

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$var_names_make_unique`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(rep(1, 6), nrow = 2),
  var = data.frame(field = c(1, 2, 3))
)
ad$var_names &lt;- c("a", "a", "b")
ad$var_names_make_unique()
ad$var_names

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$varm_keys`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  )
)
ad$varm_keys()

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$uns_keys`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$chunk_X`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(runif(10000), nrow = 50)
)

ad$chunk_X(select = 10L) # 10 random samples
ad$chunk_X(select = 1:3) # first 3 samples

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$chunked_X`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(runif(10000), nrow = 50)
)
ad$chunked_X(10)

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$copy`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2)
)
ad$copy()
ad$copy("file.h5ad")

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$rename_categories`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2"))
)
ad$rename_categories("group", c(a = "A", b = "B")) # ??

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$strings_to_categoricals`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
)
ad$strings_to_categoricals() # ??

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$to_df`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  layers = list(
    spliced = matrix(c(4, 5, 6, 7), nrow = 2),
    unspliced = matrix(c(8, 9, 10, 11), nrow = 2)
  )
)

ad$to_df()
ad$to_df("unspliced")

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$transpose`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2"))
)

ad$transpose()

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$write_csvs`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$to_write_csvs("output")

unlink("output", recursive = TRUE)

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$write_h5ad`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$write_h5ad("output.h5ad")

file.remove("output.h5ad")

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$write_loom`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$write_loom("output.loom")

file.remove("output.loom")

## End(Not run)

## ------------------------------------------------
## Method `AnnDataR6$print`
## ------------------------------------------------

## Not run: 
ad &lt;- AnnData(
  X = matrix(c(0, 1, 2, 3), nrow = 2),
  obs = data.frame(group = c("a", "b"), row.names = c("s1", "s2")),
  var = data.frame(type = c(1L, 2L), row.names = c("var1", "var2")),
  layers = list(
    spliced = matrix(c(4, 5, 6, 7), nrow = 2),
    unspliced = matrix(c(8, 9, 10, 11), nrow = 2)
  ),
  obsm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  varm = list(
    ones = matrix(rep(1L, 10), nrow = 2),
    rand = matrix(rnorm(6), nrow = 2),
    zeros = matrix(rep(0L, 10), nrow = 2)
  ),
  uns = list(a = 1, b = 2, c = list(c.a = 3, c.b = 4))
)

ad$print()
print(ad)

## End(Not run)
</code></pre>


</div>