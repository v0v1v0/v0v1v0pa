<div class="container">

<table style="width: 100%;"><tr>
<td>multispati</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multivariate spatial analysis</h2>

<h3>Description</h3>

<p>These functions are deprecated. See the function <code>multispati</code> and the methods <code>plot.multispati</code>, <code>summary.multispati</code> and <code>print.multispati</code> in the package <code>adespatial</code>.
</p>
<p>This function ensures a multivariate extension of the univariate method of spatial autocorrelation analysis.
By accounting for the spatial dependence of data observations and their multivariate covariance simultaneously, 
complex interactions among many variables are analysed. Using a methodological scheme borrowed from duality diagram 
analysis, a strategy for the exploratory analysis of spatial pattern in the multivariate is developped.
</p>


<h3>Usage</h3>

<pre><code class="language-R">multispati(dudi, listw, scannf = TRUE, nfposi = 2, nfnega = 0)
## S3 method for class 'multispati'
plot(x, xax = 1, yax = 2, ...) 
## S3 method for class 'multispati'
summary(object, ...) 
## S3 method for class 'multispati'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dudi</code></td>
<td>
<p>an object of class <code>dudi</code> for the duality diagram analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listw</code></td>
<td>
<p>an object of class <code>listw</code> for the spatial dependence of data observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scannf</code></td>
<td>
<p>a logical value indicating whether the eigenvalues bar plot should be displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfposi</code></td>
<td>
<p>an integer indicating the number of kept positive axes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfnega</code></td>
<td>
<p>an integer indicating the number of kept negative axes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, object</code></td>
<td>
<p>an object of class <code>multispati</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xax, yax</code></td>
<td>
<p>the numbers of the x-axis and the y-axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This analysis generalizes the Wartenberg's multivariate spatial
correlation analysis to various duality diagrams created by the
functions (<code>dudi.pca</code>, <code>dudi.coa</code>, <code>dudi.acm</code>, <code>dudi.mix</code>...)
If <em>dudi</em> is a duality diagram created by the function <code>dudi.pca</code> 
and <em>listw</em> gives spatial weights created by a row normalized coding scheme,
the analysis is equivalent to Wartenberg's analysis. 
</p>
<p>We note X the data frame with the variables, Q the column weights matrix 
and D the row weights matrix associated to the duality diagram <em>dudi</em>.
We note L the neighbouring weights matrix associated to  <em>listw</em>.
Then, the <code>'multispati'</code> analysis gives principal axes v that maximize
the product of spatial autocorrelation and inertia of row scores : 
</p>
<p style="text-align: center;"><code class="reqn">I(XQv)*\|XQv\|^2 = v^{t}Q^{t}X^{t}DLXQv</code>
</p>



<h3>Value</h3>

<p>Returns an object of class <code>multispati</code>, which contains the following elements :
</p>
<table>
<tr style="vertical-align: top;">
<td><code>eig</code></td>
<td>
<p>a numeric vector containing the eigenvalues</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfposi</code></td>
<td>
<p>integer, number of kept axes associated to positive eigenvalues</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfnega</code></td>
<td>
<p>integer, number of kept axes associated to negative eigenvalues</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c1</code></td>
<td>
<p>principle axes (v), data frame with p rows and (nfposi + nfnega) columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>li</code></td>
<td>
<p>principal components (XQv), data frame with n rows and (nfposi + nfnega) columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ls</code></td>
<td>
<p>lag vector onto the principal axes (LXQv), data frame with n rows and (nfposi + nfnega) columns</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>principal axes of the dudi analysis (u) onto principal axes of multispati (t(u)Qv), data frame with <code>nf</code> rows and <code>(nfposi + nfnega)</code> columns</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Daniel Chessel  <br>
Sebastien Ollier <a href="mailto:sebastien.ollier@u-psud.fr">sebastien.ollier@u-psud.fr</a> <br>
Thibaut Jombart <a href="mailto:t.jombart@imperial.ac.uk">t.jombart@imperial.ac.uk</a>
</p>


<h3>References</h3>

<p>Dray, S., Said, S. and Debias, F. (2008) Spatial ordination of
vegetation data using a generalization of Wartenberg's  multivariate
spatial correlation. <em>Journal of vegetation science</em>, <b>19</b>,
45–56.
</p>
<p>Grunsky, E. C. and Agterberg, F. P. (1988) Spatial and multivariate analysis of geochemical data from metavolcanic rocks in the Ben Nevis area, Ontario. <em>Mathematical Geology</em>, <b>20</b>, 825–861.
</p>
<p>Switzer, P. and Green, A.A. (1984) Min/max autocorrelation factors for multivariate spatial imagery. Tech. rep. 6, Stanford University.
</p>
<p>Thioulouse, J., Chessel, D. and Champely, S. (1995) Multivariate analysis of spatial patterns: a unified approach to local and global structures. <em>Environmental and Ecological Statistics</em>, <b>2</b>, 1–14.
</p>
<p>Wartenberg, D. E. (1985) Multivariate spatial correlation: a method for
exploratory geographical analysis. <em>Geographical Analysis</em>,
<b>17</b>, 263–283.
</p>
<p>Jombart, T., Devillard, S., Dufour, A.-B. and Pontier, D. A
spatially explicit multivariate method to disentangle global and local
patterns of genetic variability. Submitted to <em>Genetics</em>.
</p>


<h3>See Also</h3>

<p><code>dudi</code>,<code>mat2listw</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
if (requireNamespace("spdep", quietly = TRUE)) {
    data(mafragh)
    maf.xy &lt;- mafragh$xy
    maf.flo &lt;- mafragh$flo
    maf.listw &lt;- spdep::nb2listw(neig2nb(mafragh$neig))
    if(adegraphicsLoaded()) {
      g1 &lt;- s.label(maf.xy, nb = neig2nb(mafragh$neig), plab.cex = 0.75)
    } else {
      s.label(maf.xy, neig = mafragh$neig, clab = 0.75)
    }
    maf.coa &lt;- dudi.coa(maf.flo,scannf = FALSE)
    maf.coa.ms &lt;- multispati(maf.coa, maf.listw, scannf = FALSE, nfposi = 2, nfnega = 2)
    maf.coa.ms
    
    ### detail eigenvalues components
    fgraph &lt;- function(obj){
      # use multispati summary
      sum.obj &lt;- summary(obj)
      # compute Imin and Imax
      L &lt;- spdep::listw2mat(eval(as.list(obj$call)$listw))
      Imin &lt;- min(eigen(0.5*(L+t(L)))$values)
      Imax &lt;- max(eigen(0.5*(L+t(L)))$values)
      I0 &lt;- -1/(nrow(obj$li)-1)
      # create labels
      labels &lt;- lapply(1:length(obj$eig),function(i) bquote(lambda[.(i)]))
      # draw the plot
      xmax &lt;- eval(as.list(obj$call)$dudi)$eig[1]*1.1
      par(las=1)
      var &lt;- sum.obj[,2]
      moran &lt;- sum.obj[,3]
      plot(x=var,y=moran,type='n',xlab='Inertia',ylab="Spatial autocorrelation (I)",
           xlim=c(0,xmax),ylim=c(Imin*1.1,Imax*1.1),yaxt='n')
      text(x=var,y=moran,do.call(expression,labels))
      ytick &lt;- c(I0,round(seq(Imin,Imax,le=5),1))
      ytlab &lt;- as.character(round(seq(Imin,Imax,le=5),1))
      ytlab &lt;- c(as.character(round(I0,1)),as.character(round(Imin,1)),
           ytlab[2:4],as.character(round(Imax,1)))
      axis(side=2,at=ytick,labels=ytlab)
      rect(0,Imin,xmax,Imax,lty=2)
      segments(0,I0,xmax,I0,lty=2)
      abline(v=0)
      title("Spatial and inertia components of the eigenvalues")
    }
    fgraph(maf.coa.ms)
    ## end eigenvalues details


    if(adegraphicsLoaded()) {
      g2 &lt;- s1d.barchart(maf.coa$eig, p1d.hori = FALSE, plot = FALSE)
      g3 &lt;- s1d.barchart(maf.coa.ms$eig, p1d.hori = FALSE, plot = FALSE) 
      g4 &lt;- s.corcircle(maf.coa.ms$as, plot = FALSE)
      G1 &lt;- ADEgS(list(g2, g3, g4), layout = c(1, 3))
    } else {
      par(mfrow = c(1, 3))
      barplot(maf.coa$eig)
      barplot(maf.coa.ms$eig) 
      s.corcircle(maf.coa.ms$as)
      par(mfrow = c(1, 1))
    }
 
 
    if(adegraphicsLoaded()) {
      g5 &lt;- s.value(maf.xy, -maf.coa$li[, 1], plot = FALSE)
      g6 &lt;- s.value(maf.xy, -maf.coa$li[, 2], plot = FALSE)
      g7 &lt;- s.value(maf.xy, maf.coa.ms$li[, 1], plot = FALSE)
      g8 &lt;- s.value(maf.xy, maf.coa.ms$li[, 2], plot = FALSE)
      G2 &lt;- ADEgS(list(g5, g6, g7, g8), layout = c(2, 2))
    } else {
      par(mfrow = c(2, 2))
      s.value(maf.xy, -maf.coa$li[, 1])
      s.value(maf.xy, -maf.coa$li[, 2])
      s.value(maf.xy, maf.coa.ms$li[, 1])
      s.value(maf.xy, maf.coa.ms$li[, 2])
      par(mfrow = c(1, 1))
    }


    w1 &lt;- -maf.coa$li[, 1:2]
    w1m &lt;- apply(w1, 2, spdep::lag.listw, x = maf.listw)
    w1.ms &lt;- maf.coa.ms$li[, 1:2]
    w1.msm &lt;- apply(w1.ms, 2, spdep::lag.listw, x = maf.listw)
    if(adegraphicsLoaded()) {
      g9 &lt;- s.match(w1, w1m, plab.cex = 0.75, plot = FALSE)
      g10 &lt;- s.match(w1.ms, w1.msm, plab.cex = 0.75, plot = FALSE)
      G3 &lt;- cbindADEg(g9, g10, plot = TRUE)
    } else {
      par(mfrow = c(1,2))
      s.match(w1, w1m, clab = 0.75)
      s.match(w1.ms, w1.msm, clab = 0.75)
      par(mfrow = c(1, 1))
    }

    maf.pca &lt;- dudi.pca(mafragh$env, scannf = FALSE)
    multispati.randtest(maf.pca, maf.listw)
    maf.pca.ms &lt;- multispati(maf.pca, maf.listw, scannf=FALSE)
    plot(maf.pca.ms)
}

## End(Not run)</code></pre>


</div>