<div class="container">

<table style="width: 100%;"><tr>
<td>derive_var_merged_ef_msrc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge an Existence Flag From Multiple Sources</h2>

<h3>Description</h3>

<p>Adds a flag variable to the input dataset which indicates if
there exists at least one observation in one of the source datasets
fulfilling a certain condition. For example, if a dose adjustment flag
should be added to <code>ADEX</code> but the dose adjustment information is collected
in different datasets, e.g., <code>EX</code>, <code>EC</code>, and <code>FA</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_var_merged_ef_msrc(
  dataset,
  by_vars,
  flag_events,
  source_datasets,
  new_var,
  true_value = "Y",
  false_value = NA_character_,
  missing_value = NA_character_
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>by_vars</code> argument are expected to be in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_vars</code></td>
<td>
<p>Grouping variables
</p>
<p><em>Permitted Values</em>: list of variables created by <code>exprs()</code>
e.g. <code>exprs(USUBJID, VISIT)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flag_events</code></td>
<td>
<p>Flag events
</p>
<p>A list of <code>flag_event()</code> objects is expected. For each event the condition
(<code>condition</code> field) is evaluated in the source dataset referenced by the
<code>dataset_name</code> field. If it evaluates to <code>TRUE</code> at least once, the new
variable is set to <code>true_value</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source_datasets</code></td>
<td>
<p>Source datasets
</p>
<p>A named list of datasets is expected. The <code>dataset_name</code> field of
<code>flag_event()</code> refers to the dataset provided in the list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_var</code></td>
<td>
<p>New variable
</p>
<p>The specified variable is added to the input dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>true_value</code></td>
<td>
<p>True value
</p>
<p>The new variable (<code>new_var</code>) is set to the specified value for all by
groups for which at least one of the source object (<code>sources</code>) has the
condition evaluate to <code>TRUE</code>.
</p>
<p>The values of <code>true_value</code>, <code>false_value</code>, and <code>missing_value</code> must be of
the same type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>false_value</code></td>
<td>
<p>False value
</p>
<p>The new variable (<code>new_var</code>) is set to the specified value for all by
groups which occur in at least one source (<code>sources</code>) but the condition
never evaluates to <code>TRUE</code>.
</p>
<p>The values of <code>true_value</code>, <code>false_value</code>, and <code>missing_value</code> must be of
the same type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing_value</code></td>
<td>
<p>Values used for missing information
</p>
<p>The new variable is set to the specified value for all by groups without
observations in any of the sources (<code>sources</code>).
</p>
<p>The values of <code>true_value</code>, <code>false_value</code>, and <code>missing_value</code> must be of
the same type.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ol>
<li>
<p> For each <code>flag_event()</code> object specified for <code>flag_events</code>: The
condition (<code>condition</code>) is evaluated in the dataset referenced by
<code>dataset_name</code>. If the <code>by_vars</code> field is specified the dataset is grouped
by the specified variables for evaluating the condition. If named elements
are used in <code>by_vars</code> like <code>by_vars = exprs(USUBJID, EXLNKID = ECLNKID)</code>,
the variables are renamed after the evaluation. If the <code>by_vars</code> element is
not specified, the observations are grouped by the variables specified for
the <code>by_vars</code> argument.
</p>
</li>
<li>
<p> The new variable (<code>new_var</code>) is added to the input dataset and set to
the true value (<code>true_value</code>) if for the by group at least one condition
evaluates to <code>TRUE</code> in one of the sources. It is set to the false value
(<code>false_value</code>) if for the by group at least one observation exists and for
all observations the condition evaluates to <code>FALSE</code> or <code>NA</code>. Otherwise, it
is set to the missing value (<code>missing_value</code>).
</p>
</li>
</ol>
<h3>Value</h3>

<p>The output dataset contains all observations and variables of the
input dataset and additionally the variable specified for <code>new_var</code>.
</p>


<h3>See Also</h3>

<p><code>flag_event()</code>
</p>
<p>General Derivation Functions for all ADaMs that returns variable appended to dataset:
<code>derive_var_extreme_flag()</code>,
<code>derive_var_joined_exist_flag()</code>,
<code>derive_var_merged_exist_flag()</code>,
<code>derive_var_merged_summary()</code>,
<code>derive_var_obs_number()</code>,
<code>derive_var_relative_flag()</code>,
<code>derive_vars_computed()</code>,
<code>derive_vars_joined()</code>,
<code>derive_vars_merged()</code>,
<code>derive_vars_merged_lookup()</code>,
<code>derive_vars_transposed()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(dplyr)

# Derive a flag indicating anti-cancer treatment based on CM and PR
adsl &lt;- tribble(
  ~USUBJID,
  "1",
  "2",
  "3",
  "4"
)

cm &lt;- tribble(
  ~USUBJID, ~CMCAT,        ~CMSEQ,
  "1",      "ANTI-CANCER",      1,
  "1",      "GENERAL",          2,
  "2",      "GENERAL",          1,
  "3",      "ANTI-CANCER",      1
)

# Assuming all records in PR indicate cancer treatment
pr &lt;- tibble::tribble(
  ~USUBJID, ~PRSEQ,
  "2",      1,
  "3",      1
)

derive_var_merged_ef_msrc(
  adsl,
  by_vars = exprs(USUBJID),
  flag_events = list(
    flag_event(
      dataset_name = "cm",
      condition = CMCAT == "ANTI-CANCER"
    ),
    flag_event(
      dataset_name = "pr"
    )
  ),
  source_datasets = list(cm = cm, pr = pr),
  new_var = CANCTRFL
)

# Using different by variables depending on the source
# Add a dose adjustment flag to ADEX based on ADEX, EC, and FA
adex &lt;- tribble(
  ~USUBJID, ~EXLNKID, ~EXADJ,
  "1",      "1",      "AE",
  "1",      "2",      NA_character_,
  "1",      "3",      NA_character_,
  "2",      "1",      NA_character_,
  "3",      "1",      NA_character_
)

ec &lt;- tribble(
  ~USUBJID, ~ECLNKID, ~ECADJ,
  "1",      "3",      "AE",
  "3",      "1",      NA_character_
)

fa &lt;- tribble(
  ~USUBJID, ~FALNKID, ~FATESTCD, ~FAOBJ,            ~FASTRESC,
  "3",      "1",      "OCCUR",   "DOSE ADJUSTMENT", "Y"
)

derive_var_merged_ef_msrc(
  adex,
  by_vars = exprs(USUBJID, EXLNKID),
  flag_events = list(
    flag_event(
      dataset_name = "ex",
      condition = !is.na(EXADJ)
    ),
    flag_event(
      dataset_name = "ec",
      condition = !is.na(ECADJ),
      by_vars = exprs(USUBJID, EXLNKID = ECLNKID)
    ),
    flag_event(
      dataset_name = "fa",
      condition = FATESTCD == "OCCUR" &amp; FAOBJ == "DOSE ADJUSTMENT" &amp; FASTRESC == "Y",
      by_vars = exprs(USUBJID, EXLNKID = FALNKID)
    )
  ),
  source_datasets = list(ex = adex, ec = ec, fa = fa),
  new_var = DOSADJFL
)
</code></pre>


</div>