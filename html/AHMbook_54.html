<div class="container">

<table style="width: 100%;"><tr>
<td>sim.spatialDS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Simulates data for a basic spatial distance sampling model
</h2>

<h3>Description</h3>

<p>Generates data with the following steps:
</p>
<p>1. Simulate a spatially correlated habitat covariate (x) over a grid of pixels covering a square.
</p>
<p>2. Distribute the population of N individuals over the square with probability of location in a pixel related to the covariate.
</p>
<p>3. Decide which individuals are detected using a distance sampling model with an observer at the center of the square, with either a half normal or a logit detection function. (Note that all the individuals in the square can be detected.)
</p>
<p>4. If <code>keep.all = FALSE</code>, return the locations of only the individuals detected.
</p>
<p>To recreate the data sets used in the book with R 3.6.0 or later, include <code>sample.kind="Rounding"</code> in the call to <code>set.seed</code>. This should only be used for reproduction of old results.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim.spatialDS(N = 1000, beta = 1, sigma = 1, keep.all = FALSE, B = 3,
  model=c("logit", "halfnorm"), lambda = B/3, useHabitat, show.plot=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>

<p>total population size in the square
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>

<p>coefficient for the effect of spatial covariate x on the distribution of individuals
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>

<p>scale parameter of detection function
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.all</code></td>
<td>

<p>if TRUE, the data for all individuals are returned; if FALSE, only for individuals detected.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>

<p>distance from the observer to the side of the square. This is usually set so that the probability of detection of individuals outside the square is negligable, eg, <code>B = 3*sigma</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>

<p>The detection function used, can be "logit" or "halfnorm": see Details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>The scale parameter for the spatially autocorrelated Habitat covariate.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useHabitat</code></td>
<td>

<p>If the output from a previous simulation is provided, the same Habitat covariate will be used (and <code>lambda</code> will be ignored).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.plot</code></td>
<td>

<p>choose whether to show plots or not. Set to FALSE when using function in simulations.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The "logit" detection function is <code>2*plogis(-d^2/(2*sigma^2))</code>, which corresponds to the detection model implemented in <code>unmarked::pcount.spHDS</code>.
</p>


<h3>Value</h3>

<p>A list with the values of the input arguments and the following additional elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>u1 </code></td>
<td>
<p>x coordinate of each animal</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u2 </code></td>
<td>
<p>y coordinate of each animal</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d </code></td>
<td>
<p>distance of each animal from the center of the circle</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pixel.id </code></td>
<td>
<p>the pixel in which each animal is located, the row number in <code>grid</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y </code></td>
<td>
<p>indicator of detection of each animal, a vector of length N</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.real </code></td>
<td>
<p>the number of animals inside the circle of radius B</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Habitat </code></td>
<td>
<p>Value of the spatially  correlated habitat covariate, a 900 x 1 matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid </code></td>
<td>
<p>Coordinates of the center of each pixel, a dataframe with 900 rows and 2 columns</p>
</td>
</tr>
</table>
<p>If <code>keep.all = FALSE</code> (the default), only the animals detected are included in <code>u1, u2, d, pixel.id</code>.
</p>


<h3>Note</h3>

<p>Kéry &amp; Royle (2016, p.535 and discussion p.540) and earlier versions of <code>AHMbook</code> included a hazard rate detection function. This is problematic because the detection probability at distance zero is less than 1 (<code>p(0) &lt; 1</code>) and should not be used. It is replaced here with the <code>logit</code> detection function, which does have <code>p(0) = 1</code>.
</p>


<h3>Author(s)</h3>

<p>Marc Kéry &amp; Andy Royle
</p>


<h3>References</h3>

<p>Kéry, M. &amp; Royle, J.A. (2016) <em>Applied Hierarchical Modeling in Ecology</em> AHM2 - 9.8.3.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Generate data with the default arguments and look at the structure:
tmp &lt;- sim.spatialDS()
str(tmp)

# Generate date with model = "logit" and analyse the data with unmarked::pcount.spatialHDS
# RNGkind(sample.kind = "Rounding") # run this for R &gt;= 3.6.0
set.seed(1234)
tmp &lt;- sim.spatialDS(model="logit")
# Plot shows a large area of good habitat west of the observer with many animals detected
str(tmp)  # 272 animals detected out of 850 inside the circle (N.real)

# Fit some models with unmarked
if(require(unmarked)) {
  # Get the count of animals detected in each pixel
  pixel.count &lt;- tabulate(tmp$pixel.id, nbins=nrow(tmp$grid))
  # Centre the Habitat covariate
  Habitat &lt;- tmp$Habitat - mean(tmp$Habitat)
  # Create a detection covariate: distance between observer and pixel center
  dist &lt;- with(tmp, sqrt((grid[,1]-B)^2 + (grid[,2]-B)^2))
  # Construct an unmarkedFrame
  umf &lt;- unmarkedFramePCount(y=cbind(pixel.count),
     siteCovs=data.frame(dist=dist, Habitat=Habitat))
  summary(umf)

  (fm0 &lt;- pcount.spHDS(~ -1 + I(dist^2) ~ 1, umf, K=20))
  (fm1 &lt;- pcount.spHDS(~ -1 + I(dist^2) ~ Habitat, umf, K=20))
  # The model with Habitat has much lower AIC
  # Get an estimate of the total population in the square (true is N = 1000)
  sum(predict(fm1, type='state')[, 1])
}
</code></pre>


</div>