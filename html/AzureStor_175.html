<div class="container">

<table style="width: 100%;"><tr>
<td>get_account_sas</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate shared access signatures</h2>

<h3>Description</h3>

<p>The simplest way for a user to access files and data in a storage account is to give them the account's access key. This gives them full control of the account, and so may be a security risk. An alternative is to provide the user with a <em>shared access signature</em> (SAS), which limits access to specific resources and only for a set length of time. There are three kinds of SAS: account, service and user delegation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get_account_sas(account, ...)

## S3 method for class 'az_storage'
get_account_sas(account, key = account$list_keys()[1], ...)

## S3 method for class 'storage_endpoint'
get_account_sas(account, key = account$key, ...)

## Default S3 method:
get_account_sas(account, key, start = NULL,
  expiry = NULL, services = "bqtf", permissions = "rl",
  resource_types = "sco", ip = NULL, protocol = NULL,
  auth_api_version = getOption("azure_storage_api_version"), ...)

get_user_delegation_key(account, ...)

## S3 method for class 'az_resource'
get_user_delegation_key(account, token = account$token, ...)

## S3 method for class 'blob_endpoint'
get_user_delegation_key(account,
  token = account$token, key_start = NULL, key_expiry = NULL, ...)

revoke_user_delegation_keys(account)

## S3 method for class 'az_storage'
revoke_user_delegation_keys(account)

get_user_delegation_sas(account, ...)

## S3 method for class 'az_storage'
get_user_delegation_sas(account, key, ...)

## S3 method for class 'blob_endpoint'
get_user_delegation_sas(account, key, ...)

## Default S3 method:
get_user_delegation_sas(account, key, resource,
  start = NULL, expiry = NULL, permissions = "rl", resource_type = "c",
  ip = NULL, protocol = NULL, snapshot_time = NULL,
  directory_depth = NULL,
  auth_api_version = getOption("azure_storage_api_version"), ...)

get_service_sas(account, ...)

## S3 method for class 'az_storage'
get_service_sas(account, resource, service = c("blob",
  "file"), key = account$list_keys()[1], ...)

## S3 method for class 'storage_endpoint'
get_service_sas(account, resource, key = account$key, ...)

## Default S3 method:
get_service_sas(account, resource, key, service,
  start = NULL, expiry = NULL, permissions = "rl",
  resource_type = NULL, ip = NULL, protocol = NULL, policy = NULL,
  snapshot_time = NULL, directory_depth = NULL,
  auth_api_version = getOption("azure_storage_api_version"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>account</code></td>
<td>
<p>An object representing a storage account. Depending on the generic, this can be one of the following: an Azure resource object (of class <code>az_storage</code>); a client storage endpoint (of class <code>storage_endpoint</code>); a <em>blob</em> storage endpoint (of class <code>blob_endpoint</code>); or a string with the name of the account.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to lower-level functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key</code></td>
<td>
<p>For <code>get_account_sas</code>, the <em>account</em> key, which controls full access to the storage account. For <code>get_user_delegation_sas</code>, a <em>user delegation</em> key, as obtained from <code>get_user_delegation_key</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start, expiry</code></td>
<td>
<p>The start and end dates for the account or user delegation SAS. These should be <code>Date</code> or <code>POSIXct</code> values, or strings coercible to such. If not supplied, the default is to generate start and expiry values for a period of 8 hours, starting from 15 minutes before the current time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>services</code></td>
<td>
<p>For <code>get_account_sas</code>, the storage service(s) for which the SAS is valid. Defaults to <code>bqtf</code>, meaning blob (including ADLS2), queue, table and file storage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permissions</code></td>
<td>
<p>The permissions that the SAS grants. The default value of <code>rl</code> (read and list) essentially means read-only access.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resource_types</code></td>
<td>
<p>For an account SAS, the resource types for which the SAS is valid. For <code>get_account_sas</code> the default is <code>sco</code> meaning service, container and object. For <code>get_user_delegation_sas</code> the default is <code>c</code> meaning container-level access (including blobs within the container). Other possible values include "b" (a single blob) or "d" (a directory).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ip</code></td>
<td>
<p>The IP address(es) or IP address range(s) for which the SAS is valid. The default is not to restrict access by IP.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>protocol</code></td>
<td>
<p>The protocol required to use the SAS. Possible values are <code>https</code> meaning HTTPS-only, or <code style="white-space: pre;">⁠https,http⁠</code> meaning HTTP is also allowed. Note that the storage account itself may require HTTPS, regardless of what the SAS allows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auth_api_version</code></td>
<td>
<p>The storage API version to use for authenticating.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>For <code>get_user_delegation_key</code>, an AAD token from which to obtain user details. The token must have <code style="white-space: pre;">⁠https://storage.azure.com⁠</code> as its audience.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_start, key_expiry</code></td>
<td>
<p>For <code>get_user_delegation_key</code>, the start and end dates for the user delegation key.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resource</code></td>
<td>
<p>For <code>get_user_delegation_sas</code> and <code>get_service_sas</code>, the resource for which the SAS is valid. Both types of SAS allow this to be either a blob container, a directory or an individual blob; the resource should be specified in the form <code style="white-space: pre;">⁠containername[/dirname[/blobname]]⁠</code>. A service SAS can also be used with file shares and files, in which case the resource should be of the form <code style="white-space: pre;">⁠sharename[/path-to-filename]⁠</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resource_type</code></td>
<td>
<p>For a service or user delegation SAS, the type of resource for which the SAS is valid. For blob storage, the default value is "b" meaning a single blob. For file storage, the default value is "f" meaning a single file. Other possible values include "bs" (a blob snapshot), "c" (a blob container), "d" (a directory in a blob container), or "s" (a file share). Note however that a user delegation SAS only supports blob storage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>snapshot_time</code></td>
<td>
<p>For a user delegation or service SAS, the blob snapshot for which the SAS is valid. Only required if <code>resource_type[s]="bs"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>directory_depth</code></td>
<td>
<p>For a service SAS, the depth of the directory, starting at 0 for the root. This is required if <code>resource_type="d"</code> and the account has a hierarchical namespace enabled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>service</code></td>
<td>
<p>For a service SAS, the storage service for which the SAS is valid: either "blob" or "file". Currently AzureStor does not support creating a service SAS for queue or table storage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>policy</code></td>
<td>
<p>For a service SAS, optionally the name of a stored access policy to correlate the SAS with. Revoking the policy will also invalidate the SAS.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Listed here are S3 generics and methods to obtain a SAS for accessing storage; in addition, the <code>az_storage</code> resource class has R6 methods for <code>get_account_sas</code>, <code>get_service_sas</code>, <code>get_user_delegation_key</code> and <code>revoke_user_delegation_keys</code> which simply call the corresponding S3 method.
</p>
<p>Note that you don't need to worry about these methods if you have been <em>given</em> a SAS, and only want to use it to access a storage account.
</p>
<p>An <strong>account SAS</strong> is secured with the storage account key. An account SAS delegates access to resources in one or more of the storage services. All of the operations available via a user delegation SAS are also available via an account SAS. You can also delegate access to read, write, and delete operations on blob containers, tables, queues, and file shares. To obtain an account SAS, call <code>get_account_sas</code>.
</p>
<p>A <strong>service SAS</strong> is like an account SAS, but allows finer-grained control of access. You can create a service SAS that allows access only to specific blobs in a container, or files in a file share. To obtain a service SAS, call <code>get_service_sas</code>.
</p>
<p>A <strong>user delegation SAS</strong> is a SAS secured with Azure AD credentials. It's recommended that you use Azure AD credentials when possible as a security best practice, rather than using the account key, which can be more easily compromised. When your application design requires shared access signatures, use Azure AD credentials to create a user delegation SAS for superior security.
</p>
<p>Every SAS is signed with a key. To create a user delegation SAS, you must first request a <strong>user delegation key</strong>, which is then used to sign the SAS. The user delegation key is analogous to the account key used to sign a service SAS or an account SAS, except that it relies on your Azure AD credentials. To request the user delegation key, call <code>get_user_delegation_key</code>. With the user delegation key, you can then create the SAS with <code>get_user_delegation_sas</code>.
</p>
<p>To invalidate all user delegation keys, as well as the SAS's generated with them, call <code>revoke_user_delegation_keys</code>.
</p>
<p>See the examples and Microsoft Docs pages below for how to specify arguments like the services, permissions, and resource types. Also, while not explicitly mentioned in the documentation, ADLSgen2 storage can use any SAS that is valid for blob storage.
</p>


<h3>See Also</h3>

<p>blob_endpoint, file_endpoint,
Date, POSIXt
</p>
<p><a href="https://docs.microsoft.com/en-us/rest/api/storagerp/">Azure Storage Provider API reference</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/">Azure Storage Services API reference</a>
</p>
<p><a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-account-sas">Create an account SAS</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-user-delegation-sas">Create a user delegation SAS</a>,
<a href="https://docs.microsoft.com/en-us/rest/api/storageservices/create-service-sas">Create a service SAS</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># account SAS valid for 7 days
get_account_sas("mystorage", "access_key", start=Sys.Date(), expiry=Sys.Date() + 7)

# SAS with read/write/create/delete permissions
get_account_sas("mystorage", "access_key", permissions="rwcd")

# SAS limited to blob (+ADLS2) and file storage
get_account_sas("mystorage", "access_key", services="bf")

# SAS for file storage, allows access to files only (not shares)
get_account_sas("mystorage", "access_key", services="f", resource_types="o")

# getting the key from an endpoint object
endp &lt;- storage_endpoint("https://mystorage.blob.core.windows.net", key="access_key")
get_account_sas(endp, permissions="rwcd")

# service SAS for a container
get_service_sas(endp, "containername")

# service SAS for a directory
get_service_sas(endp, "containername/dirname")

# read/write service SAS for a blob
get_service_sas(endp, "containername/blobname", permissions="rw")

## Not run: 

# user delegation key valid for 24 hours
token &lt;- AzureRMR::get_azure_token("https://storage.azure.com", "mytenant", "app_id")
endp &lt;- storage_endpoint("https://mystorage.blob.core.windows.net", token=token)
userkey &lt;- get_user_delegation_key(endp, start=Sys.Date(), expiry=Sys.Date() + 1)

# user delegation SAS for a container
get_user_delegation_sas(endp, userkey, resource="mycontainer")

# user delegation SAS for a specific file, read/write/create/delete access
# (order of permissions is important!)
get_user_delegation_sas(endp, userkey, resource="mycontainer/myfile",
                        resource_types="b", permissions="rcwd")


## End(Not run)
</code></pre>


</div>