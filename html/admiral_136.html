<div class="container">

<table style="width: 100%;"><tr>
<td>filter_relative</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Filter the Observations Before or After a Condition is Fulfilled</h2>

<h3>Description</h3>

<p>Filters the observations before or after the observation where a specified
condition is fulfilled for each by group. For example, the function could be
called to select for each subject all observations before the first disease
progression.
</p>


<h3>Usage</h3>

<pre><code class="language-R">filter_relative(
  dataset,
  by_vars,
  order,
  condition,
  mode,
  selection,
  inclusive,
  keep_no_ref_groups = TRUE,
  check_type = "warning"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>by_vars</code> and <code>order</code> arguments are expected to be in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_vars</code></td>
<td>
<p>Grouping variables
</p>
<p><em>Permitted Values</em>: list of variables created by <code>exprs()</code>
e.g. <code>exprs(USUBJID, VISIT)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>Sort order
</p>
<p>Within each by group the observations are ordered by the specified order.
</p>
<p>For handling of <code>NA</code>s in sorting variables see <a href="../articles/generic.html#sort_order">Sort Order</a>.
</p>
<p><em>Permitted Values:</em> list of expressions created by <code>exprs()</code>, e.g.,
<code>exprs(ADT, desc(AVAL))</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condition</code></td>
<td>
<p>Condition for Reference Observation
</p>
<p>The specified condition determines the reference observation. The output
dataset contains all observations before or after (<code>selection</code> parameter)
the reference observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>
<p>Selection mode (first or last)
</p>
<p>If <code>"first"</code> is specified, for each by group the observations before or
after (<code>selection</code> parameter) the observation where the condition
(<code>condition</code> parameter) is fulfilled the <em>first</em> time is included in the
output dataset. If <code>"last"</code> is specified, for each by group the
observations before or after (<code>selection</code> parameter) the observation where
the condition (<code>condition</code> parameter) is fulfilled the <em>last</em> time is
included in the output dataset.
</p>
<p><em>Permitted Values:</em> <code>"first"</code>, <code>"last"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selection</code></td>
<td>
<p>Select observations before or after the reference observation?
</p>
<p><em>Permitted Values:</em> <code>"before"</code>, <code>"after"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inclusive</code></td>
<td>
<p>Include the reference observation?
</p>
<p><em>Permitted Values:</em> <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_no_ref_groups</code></td>
<td>
<p>Should by groups without reference observation be kept?
</p>
<p><em>Permitted Values:</em> <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_type</code></td>
<td>
<p>Check uniqueness?
</p>
<p>If <code>"warning"</code> or <code>"error"</code> is specified, the specified message is issued
if the observations of the input dataset are not unique with respect to the
by variables and the order.
</p>
<p><em>Permitted Values:</em> <code>"none"</code>, <code>"warning"</code>, <code>"error"</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For each by group ( <code>by_vars</code> parameter) the observations before or
after (<code>selection</code> parameter) the observations where the condition
(<code>condition</code> parameter) is fulfilled the first or last time (<code>order</code>
parameter and <code>mode</code> parameter) is included in the output dataset.
</p>


<h3>Value</h3>

<p>A dataset containing for each by group the observations before or
after the observation where the condition was fulfilled the first or last
time
</p>


<h3>See Also</h3>

<p>Utilities for Filtering Observations: 
<code>count_vals()</code>,
<code>filter_exist()</code>,
<code>filter_extreme()</code>,
<code>filter_joined()</code>,
<code>filter_not_exist()</code>,
<code>max_cond()</code>,
<code>min_cond()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(tibble)

response &lt;- tribble(
  ~USUBJID, ~AVISITN, ~AVALC,
  "1",      1,        "PR",
  "1",      2,        "CR",
  "1",      3,        "CR",
  "1",      4,        "SD",
  "1",      5,        "NE",
  "2",      1,        "SD",
  "2",      2,        "PD",
  "2",      3,        "PD",
  "3",      1,        "SD",
  "4",      1,        "SD",
  "4",      2,        "PR",
  "4",      3,        "PD",
  "4",      4,        "SD",
  "4",      5,        "PR"
)

# Select observations up to first PD for each patient
response %&gt;%
  filter_relative(
    by_vars = exprs(USUBJID),
    order = exprs(AVISITN),
    condition = AVALC == "PD",
    mode = "first",
    selection = "before",
    inclusive = TRUE
  )

# Select observations after last CR, PR, or SD for each patient
response %&gt;%
  filter_relative(
    by_vars = exprs(USUBJID),
    order = exprs(AVISITN),
    condition = AVALC %in% c("CR", "PR", "SD"),
    mode = "last",
    selection = "after",
    inclusive = FALSE
  )

# Select observations from first response to first PD
response %&gt;%
  filter_relative(
    by_vars = exprs(USUBJID),
    order = exprs(AVISITN),
    condition = AVALC %in% c("CR", "PR"),
    mode = "first",
    selection = "after",
    inclusive = TRUE,
    keep_no_ref_groups = FALSE
  ) %&gt;%
  filter_relative(
    by_vars = exprs(USUBJID),
    order = exprs(AVISITN),
    condition = AVALC == "PD",
    mode = "first",
    selection = "before",
    inclusive = TRUE
  )
</code></pre>


</div>