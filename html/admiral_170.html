<div class="container">

<table style="width: 100%;"><tr>
<td>restrict_derivation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Execute a Derivation on a Subset of the Input Dataset</h2>

<h3>Description</h3>

<p>Execute a derivation on a subset of the input dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">restrict_derivation(dataset, derivation, args = NULL, filter)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivation</code></td>
<td>
<p>Derivation
</p>
<p>A function that performs a specific derivation is expected. A derivation
adds variables or observations to a dataset. The first argument of a
derivation must expect a dataset and the derivation must return a dataset.
The function must provide the <code>dataset</code> argument and all arguments
specified in the <code>params()</code> objects passed to the <code>arg</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args</code></td>
<td>
<p>Arguments of the derivation
</p>
<p>A <code>params()</code> object is expected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter</code></td>
<td>
<p>Filter condition</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>params()</code> <code>slice_derivation()</code>
</p>
<p>Higher Order Functions: 
<code>call_derivation()</code>,
<code>derivation_slice()</code>,
<code>slice_derivation()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(tibble)

adlb &lt;- tribble(
  ~USUBJID, ~AVISITN, ~AVAL, ~ABLFL,
  "1",            -1,   113, NA_character_,
  "1",             0,   113, "Y",
  "1",             3,   117, NA_character_,
  "2",             0,    95, "Y",
  "3",             0,   111, "Y",
  "3",             1,   101, NA_character_,
  "3",             2,   123, NA_character_
)

# Derive BASE for post-baseline records only (derive_var_base() can not be used in this case
# as it requires the baseline observation to be in the input dataset)
restrict_derivation(
  adlb,
  derivation = derive_vars_merged,
  args = params(
    by_vars = exprs(USUBJID),
    dataset_add = adlb,
    filter_add = ABLFL == "Y",
    new_vars = exprs(BASE = AVAL)
  ),
  filter = AVISITN &gt; 0
)

# Derive BASE for baseline and post-baseline records only
restrict_derivation(
  adlb,
  derivation = derive_var_base,
  args = params(
    by_vars = exprs(USUBJID)
  ),
  filter = AVISITN &gt;= 0
) %&gt;%
  # Derive CHG for post-baseline records only
  restrict_derivation(
    derivation = derive_var_chg,
    filter = AVISITN &gt; 0
  )
</code></pre>


</div>