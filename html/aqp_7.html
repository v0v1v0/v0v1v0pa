<div class="container">

<table style="width: 100%;"><tr>
<td>accumulateDepths</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Accumulate horizon depths, and reflect reversed depths, relative to new datum</h2>

<h3>Description</h3>

<p>Fix old-style organic horizon depths or depths with a non-standard datum by the "depth accumulation" method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">accumulateDepths(
  x,
  id = NULL,
  hzdepths = NULL,
  hzname = NULL,
  hzdatum = 0,
  seqnum = NULL,
  pattern = "O",
  fix = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>data.frame</code> or <code>SoilProfileCollection</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>unique profile ID. Default: <code>NULL</code>, if <code>x</code> is a SoilProfileCollection <code>idname(x)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hzdepths</code></td>
<td>
<p>character vector containing horizon top and bottom depth column names. Default: <code>NULL</code>, if <code>x</code> is a SoilProfileCollection <code>horizonDepths(x)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hzname</code></td>
<td>
<p>character vector containing horizon designation or other label column names. Default: <code>NULL</code>, if <code>x</code> is a SoilProfileCollection <code>hzdesgnname(x)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hzdatum</code></td>
<td>
<p>a numeric vector to add to accumulated depths. Default: <code>0</code>. Can be equal in length to number of profiles if <code>x</code> is a <code>SoilProfileCollection</code> or number of (unique) IDs if <code>x</code> is a <code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seqnum</code></td>
<td>
<p>Optional: character vector containing record "sequence number" column name; used in-lieu of <code>hzname</code> (when <code>NA</code>) to identify "first" record in a profile</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pattern</code></td>
<td>
<p>pattern to search for in <code>hzname</code> to identify matching horizons to append the profile to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix</code></td>
<td>
<p>apply adjustments to missing (<code>NA</code>) depths and expand 0-thickness horizons? Default: <code>TRUE</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The "depth accumulation" method calculates thicknesses of individual horizons and then cumulative sums them after putting them in <code>id</code> + top depth order. The routine tries to determine context based on <code>hzname</code> and <code>pattern</code>. The main transformation is if a top depth is deeper than the bottom depth, the depths are reflected on the Z-axis (made negative). The data are then <code>id</code> + top depth sorted again, the thickness calculated and accumulated to replace the old depths.
</p>
<p>This function uses several heuristics to adjust data before transformation and thickness calculation:
</p>


<h4>Regex matching of horizon designation patterns and similar</h4>


<ul>
<li>
<p> matches of <code>pattern</code> where both top and bottom depth <code>NA</code> -&gt; <code style="white-space: pre;">⁠[0,1]⁠</code> <code style="white-space: pre;">⁠[top,bottom]⁠</code> depth
</p>
</li>
<li>
<p> REMOVE horizons that do not match <code>pattern</code> where both top and bottom depths <code>NA</code>
</p>
</li>
</ul>
<h4>Over-ride <code>hzname</code> handling with the sequence column argument <code>seqnum</code>
</h4>


<ul><li>
<p> if <code>seqnum</code> column specified "first record with <code>NA</code> <code>hzname</code>" is considered a <code>pattern</code> match if <code>seqnum == 1</code>
</p>
</li></ul>
<h4>Trigger "fixing" with the <code>fix</code> argument:</h4>


<ul>
<li>
<p> Add 1 cm to bottom-most horizons with <code>NA</code> bottom depth
</p>
</li>
<li>
<p> Add 1 cm thickness to horizons with top and bottom depth equal
</p>
</li>
<li>
<p> Add 1 cm thickness to horizons with <code>NA</code> top depth and bottom depth <code>0</code>
</p>
</li>
</ul>
<h3>Value</h3>

<p>A horizon-level <code>data.frame</code>, suitable for promoting to SPC with <code style="white-space: pre;">⁠depths&lt;-⁠</code>, or a <code>SoilProfileCollection</code>, depending on the class of <code>x</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# example using hzdatum argument
data(sp4)
depths(sp4) &lt;- id ~ top + bottom
hz &lt;- accumulateDepths(sp4,
                       id = "id",
                       hzdepths = c("top", "bottom"),
                       hzname = "name",
                       hzdatum = 5 * 1:length(sp4))
plot(hz)
  
# example using old-style O horizons
hz &lt;- read.table(text = "peiidref hzdept hzdepb hzname seqnum phiid
                    1        11      0      5      A      2   295
                    2        11      1      0     Oe      1   294
                    3        11      5     13     C1      3   296
                    4        11     13     58     C2      4   297
                    5        11     58    152     C3      5   298
                    6        13      0      5      A      2   303
                    7        13      1      0     Oe      1   302
                    8        13      5     25     Bw      3   304
                    9        13     25     61      C      4   305
                    10       13     61     NA      R      5   306
                    11      136      0     13     A1      3   695
                    12      136      1      0     Oe      2   694
                    13      136      2      1     Oi      1   693
                    14      136     13     61     C1      4   696
                    15      136     61     76     C2      5   697")
                    
depths(hz) &lt;- peiidref ~ hzdept + hzdepb

hz_fixed &lt;- accumulateDepths(hz,
                             id = "peiidref",
                             hzdepths = c("hzdept", "hzdepb"),
                             hzname = "hzname")
is_valid &lt;- checkHzDepthLogic(hz_fixed)$valid

test0 &lt;- subset(hz_fixed, !is_valid)
test1 &lt;- subset(hz_fixed, is_valid)

origO &lt;- subset(hz, grepl("O", hzname))
fixedO &lt;- subset(hz_fixed, grepl("O", hzname))

par(mfrow=c(2,1), mar=c(0,0,3,2))
plotSPC(origO, max.depth = 25)
plotSPC(fixedO, max.depth = 25)

</code></pre>


</div>