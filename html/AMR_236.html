<div class="container">

<table style="width: 100%;"><tr>
<td>antibiogram</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate Antibiogram: Traditional, Combined, Syndromic, or Weighted-Incidence Syndromic Combination (WISCA)</h2>

<h3>Description</h3>

<p>Generate an antibiogram, and communicate the results in plots or tables. These functions follow the logic of Klinker <em>et al.</em> and Barbieri <em>et al.</em> (see <em>Source</em>), and allow reporting in e.g. R Markdown and Quarto as well.
</p>


<h3>Usage</h3>

<pre><code class="language-R">antibiogram(
  x,
  antibiotics = where(is.sir),
  mo_transform = "shortname",
  ab_transform = NULL,
  syndromic_group = NULL,
  add_total_n = TRUE,
  only_all_tested = FALSE,
  digits = 0,
  col_mo = NULL,
  language = get_AMR_locale(),
  minimum = 30,
  combine_SI = TRUE,
  sep = " + ",
  info = interactive()
)

## S3 method for class 'antibiogram'
plot(x, ...)

## S3 method for class 'antibiogram'
autoplot(object, ...)

## S3 method for class 'antibiogram'
knit_print(
  x,
  italicise = TRUE,
  na = getOption("knitr.kable.NA", default = ""),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a data.frame containing at least a column with microorganisms and columns with antibiotic results (class 'sir', see <code>as.sir()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>antibiotics</code></td>
<td>
<p>vector of any antibiotic name or code (will be evaluated with <code>as.ab()</code>, column name of <code>x</code>, or (any combinations of) antibiotic selectors such as <code>aminoglycosides()</code> or <code>carbapenems()</code>. For combination antibiograms, this can also be set to values separated with <code>"+"</code>, such as "TZP+TOB" or "cipro + genta", given that columns resembling such antibiotics exist in <code>x</code>. See <em>Examples</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mo_transform</code></td>
<td>
<p>a character to transform microorganism input - must be "name", "shortname", "gramstain", or one of the column names of the microorganisms data set: "mo", "fullname", "status", "kingdom", "phylum", "class", "order", "family", "genus", "species", "subspecies", "rank", "ref", "oxygen_tolerance", "source", "lpsn", "lpsn_parent", "lpsn_renamed_to", "gbif", "gbif_parent", "gbif_renamed_to", "prevalence", or "snomed". Can also be <code>NULL</code> to not transform the input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ab_transform</code></td>
<td>
<p>a character to transform antibiotic input - must be one of the column names of the antibiotics data set: "ab", "cid", "name", "group", "atc", "atc_group1", "atc_group2", "abbreviations", "synonyms", "oral_ddd", "oral_units", "iv_ddd", "iv_units", or "loinc". Can also be <code>NULL</code> to not transform the input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>syndromic_group</code></td>
<td>
<p>a column name of <code>x</code>, or values calculated to split rows of <code>x</code>, e.g. by using <code>ifelse()</code> or <code>case_when()</code>. See <em>Examples</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_total_n</code></td>
<td>
<p>a logical to indicate whether total available numbers per pathogen should be added to the table (default is <code>TRUE</code>). This will add the lowest and highest number of available isolate per antibiotic (e.g, if for <em>E. coli</em> 200 isolates are available for ciprofloxacin and 150 for amoxicillin, the returned number will be "150-200").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only_all_tested</code></td>
<td>
<p>(for combination antibiograms): a logical to indicate that isolates must be tested for all antibiotics, see <em>Details</em></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits to use for rounding</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_mo</code></td>
<td>
<p>column name of the names or codes of the microorganisms (see <code>as.mo()</code>) - the default is the first column of class <code>mo</code>. Values will be coerced using <code>as.mo()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>language</code></td>
<td>
<p>language to translate text, which defaults to the system language (see <code>get_AMR_locale()</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum</code></td>
<td>
<p>the minimum allowed number of available (tested) isolates. Any isolate count lower than <code>minimum</code> will return <code>NA</code> with a warning. The default number of <code>30</code> isolates is advised by the Clinical and Laboratory Standards Institute (CLSI) as best practice, see <em>Source</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>combine_SI</code></td>
<td>
<p>a logical to indicate whether all susceptibility should be determined by results of either S or I, instead of only S (default is <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>a separating character for antibiotic columns in combination antibiograms</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info</code></td>
<td>
<p>a logical to indicate info should be printed - the default is <code>TRUE</code> only in interactive mode</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>when used in R Markdown or Quarto: arguments passed on to <code>knitr::kable()</code> (otherwise, has no use)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an <code>antibiogram()</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>italicise</code></td>
<td>
<p>a logical to indicate whether the microorganism names in the knitr table should be made italic, using <code>italicise_taxonomy()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na</code></td>
<td>
<p>character to use for showing <code>NA</code> values</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function returns a table with values between 0 and 100 for <em>susceptibility</em>, not resistance.
</p>
<p><strong>Remember that you should filter your data to let it contain only first isolates!</strong> This is needed to exclude duplicates and to reduce selection bias. Use <code>first_isolate()</code> to determine them in your data set with one of the four available algorithms.
</p>
<p>All types of antibiograms as listed below can be plotted (using <code>ggplot2::autoplot()</code> or base <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> <code>plot()</code>/<code>barplot()</code>). The <code>antibiogram</code> object can also be used directly in R Markdown / Quarto (i.e., <code>knitr</code>) for reports. In this case, <code>knitr::kable()</code> will be applied automatically and microorganism names will even be printed in italics at default (see argument <code>italicise</code>). You can also use functions from specific 'table reporting' packages to transform the output of <code>antibiogram()</code> to your needs, e.g. with <code>flextable::as_flextable()</code> or <code>gt::gt()</code>.
</p>


<h4>Antibiogram Types</h4>

<p>There are four antibiogram types, as proposed by Klinker <em>et al.</em> (2021, <a href="https://doi.org/10.1177/20499361211011373">doi:10.1177/20499361211011373</a>), and they are all supported by <code>antibiogram()</code>:
</p>

<ol>
<li> <p><strong>Traditional Antibiogram</strong>
</p>
<p>Case example: Susceptibility of <em>Pseudomonas aeruginosa</em> to piperacillin/tazobactam (TZP)
</p>
<p>Code example:
</p>
<div class="sourceCode r"><pre>antibiogram(your_data,
            antibiotics = "TZP")
</pre></div>
</li>
<li> <p><strong>Combination Antibiogram</strong>
</p>
<p>Case example: Additional susceptibility of <em>Pseudomonas aeruginosa</em> to TZP + tobramycin versus TZP alone
</p>
<p>Code example:
</p>
<div class="sourceCode r"><pre>antibiogram(your_data,
            antibiotics = c("TZP", "TZP+TOB", "TZP+GEN"))
</pre></div>
</li>
<li> <p><strong>Syndromic Antibiogram</strong>
</p>
<p>Case example: Susceptibility of <em>Pseudomonas aeruginosa</em> to TZP among respiratory specimens (obtained among ICU patients only)
</p>
<p>Code example:
</p>
<div class="sourceCode r"><pre>antibiogram(your_data,
            antibiotics = penicillins(),
            syndromic_group = "ward")
</pre></div>
</li>
<li> <p><strong>Weighted-Incidence Syndromic Combination Antibiogram (WISCA)</strong>
</p>
<p>Case example: Susceptibility of <em>Pseudomonas aeruginosa</em> to TZP among respiratory specimens (obtained among ICU patients only) for male patients age &gt;=65 years with heart failure
</p>
<p>Code example:
</p>
<div class="sourceCode r"><pre>library(dplyr)
your_data %&gt;%
  filter(ward == "ICU" &amp; specimen_type == "Respiratory") %&gt;%
  antibiogram(antibiotics = c("TZP", "TZP+TOB", "TZP+GEN"),
              syndromic_group = ifelse(.$age &gt;= 65 &amp;
                                         .$gender == "Male" &amp;
                                         .$condition == "Heart Disease",
                                       "Study Group", "Control Group"))
</pre></div>
</li>
</ol>
<p>Note that for combination antibiograms, it is important to realise that susceptibility can be calculated in two ways, which can be set with the <code>only_all_tested</code> argument (default is <code>FALSE</code>). See this example for two antibiotics, Drug A and Drug B, about how <code>antibiogram()</code> works to calculate the %SI:
</p>
<div class="sourceCode"><pre>--------------------------------------------------------------------
                    only_all_tested = FALSE  only_all_tested = TRUE
                    -----------------------  -----------------------
 Drug A    Drug B   include as  include as   include as  include as
                    numerator   denominator  numerator   denominator
--------  --------  ----------  -----------  ----------  -----------
 S or I    S or I       X            X            X            X
   R       S or I       X            X            X            X
  &lt;NA&gt;     S or I       X            X            -            -
 S or I      R          X            X            X            X
   R         R          -            X            -            X
  &lt;NA&gt;       R          -            -            -            -
 S or I     &lt;NA&gt;        X            X            -            -
   R        &lt;NA&gt;        -            -            -            -
  &lt;NA&gt;      &lt;NA&gt;        -            -            -            -
--------------------------------------------------------------------
</pre></div>



<h3>Source</h3>


<ul>
<li>
<p> Klinker KP <em>et al.</em> (2021). <strong>Antimicrobial stewardship and antibiograms: importance of moving beyond traditional antibiograms</strong>. <em>Therapeutic Advances in Infectious Disease</em>, May 5;8:20499361211011373; <a href="https://doi.org/10.1177/20499361211011373">doi:10.1177/20499361211011373</a>
</p>
</li>
<li>
<p> Barbieri E <em>et al.</em> (2021). <strong>Development of a Weighted-Incidence Syndromic Combination Antibiogram (WISCA) to guide the choice of the empiric antibiotic treatment for urinary tract infection in paediatric patients: a Bayesian approach</strong> <em>Antimicrobial Resistance &amp; Infection Control</em> May 1;10(1):74; <a href="https://doi.org/10.1186/s13756-021-00939-2">doi:10.1186/s13756-021-00939-2</a>
</p>
</li>
<li> <p><strong>M39 Analysis and Presentation of Cumulative Antimicrobial Susceptibility Test Data, 5th Edition</strong>, 2022, <em>Clinical and Laboratory Standards Institute (CLSI)</em>. <a href="https://clsi.org/standards/products/microbiology/documents/m39/">https://clsi.org/standards/products/microbiology/documents/m39/</a>.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># example_isolates is a data set available in the AMR package.
# run ?example_isolates for more info.
example_isolates


# Traditional antibiogram ----------------------------------------------

antibiogram(example_isolates,
  antibiotics = c(aminoglycosides(), carbapenems())
)

antibiogram(example_isolates,
  antibiotics = aminoglycosides(),
  ab_transform = "atc",
  mo_transform = "gramstain"
)

antibiogram(example_isolates,
  antibiotics = carbapenems(),
  ab_transform = "name",
  mo_transform = "name"
)


# Combined antibiogram -------------------------------------------------

# combined antibiotics yield higher empiric coverage
antibiogram(example_isolates,
  antibiotics = c("TZP", "TZP+TOB", "TZP+GEN"),
  mo_transform = "gramstain"
)

# names of antibiotics do not need to resemble columns exactly:
antibiogram(example_isolates,
  antibiotics = c("Cipro", "cipro + genta"),
  mo_transform = "gramstain",
  ab_transform = "name",
  sep = " &amp; "
)


# Syndromic antibiogram ------------------------------------------------

# the data set could contain a filter for e.g. respiratory specimens
antibiogram(example_isolates,
  antibiotics = c(aminoglycosides(), carbapenems()),
  syndromic_group = "ward"
)

# now define a data set with only E. coli
ex1 &lt;- example_isolates[which(mo_genus() == "Escherichia"), ]

# with a custom language, though this will be determined automatically
# (i.e., this table will be in Spanish on Spanish systems)
antibiogram(ex1,
  antibiotics = aminoglycosides(),
  ab_transform = "name",
  syndromic_group = ifelse(ex1$ward == "ICU",
    "UCI", "No UCI"
  ),
  language = "es"
)


# Weighted-incidence syndromic combination antibiogram (WISCA) ---------

# the data set could contain a filter for e.g. respiratory specimens/ICU
antibiogram(example_isolates,
  antibiotics = c("AMC", "AMC+CIP", "TZP", "TZP+TOB"),
  mo_transform = "gramstain",
  minimum = 10, # this should be &gt;=30, but now just as example
  syndromic_group = ifelse(example_isolates$age &gt;= 65 &amp;
    example_isolates$gender == "M",
  "WISCA Group 1", "WISCA Group 2"
  )
)


# Print the output for R Markdown / Quarto -----------------------------

ureido &lt;- antibiogram(example_isolates,
  antibiotics = ureidopenicillins(),
  ab_transform = "name"
)

# in an Rmd file, you would just need to return `ureido` in a chunk,
# but to be explicit here:
if (requireNamespace("knitr")) {
  cat(knitr::knit_print(ureido))
}


# Generate plots with ggplot2 or base R --------------------------------

ab1 &lt;- antibiogram(example_isolates,
  antibiotics = c("AMC", "CIP", "TZP", "TZP+TOB"),
  mo_transform = "gramstain"
)
ab2 &lt;- antibiogram(example_isolates,
  antibiotics = c("AMC", "CIP", "TZP", "TZP+TOB"),
  mo_transform = "gramstain",
  syndromic_group = "ward"
)

if (requireNamespace("ggplot2")) {
  ggplot2::autoplot(ab1)
}
if (requireNamespace("ggplot2")) {
  ggplot2::autoplot(ab2)
}

plot(ab1)
plot(ab2)

</code></pre>


</div>