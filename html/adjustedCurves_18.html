<div class="container">

<table style="width: 100%;"><tr>
<td>cif_matching</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Using Propensity-Score Matching to Calculate Adjusted CIFs
</h2>

<h3>Description</h3>

<p>This page explains the details of estimating adjusted cumulative incidence functions using propensity-score matching in a competing risks setting (<code>method="matching"</code> in the <code>adjustedcif</code> function). All regular arguments of the <code>adjustedcif</code> function can be used. Additionally, the <code>treatment_model</code> argument has to be specified in the <code>adjustedcif</code> call. Further arguments specific to this method are listed below.
</p>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>treatment_model</code></td>
<td>

<p>[<strong>required</strong>] Must be either a model object with <code>variable</code> as response variable or a vector of previously estimated propensity scores.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gtol</code></td>
<td>

<p>Tolerance at which estimated treatment assignment probabilities are truncated. Every propensity score bigger than 1 - <code>gtol</code> is set to 1 - <code>gtol</code> and every propensity score smaller than <code>gtol</code> is set to <code>gtol</code>. Useful when there are extreme propensity scores close to 0 or 1. Defaults to 0.001,
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Further arguments passed to the <code>Match</code> function of the <span class="pkg">Matching</span> Package.
</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li>
<p><strong>Type of Adjustment:</strong> Requires a model describing the treatment assignment mechanism. This must be either a <code>glm</code> object or a vector of propensity scores.
</p>
</li>
<li>
<p><strong>Doubly-Robust:</strong> Estimates are not Doubly-Robust.
</p>
</li>
<li>
<p><strong>Categorical groups:</strong> Only two groups in <code>variable</code> are allowed. Must be a factor variable with exactly two levels.
</p>
</li>
<li>
<p><strong>Approximate Variance:</strong> Calculations to approximate the variance and confidence intervals are currently not available. Bootstrapping can still be used to estimate the confidence intervals (see <code>?adjustedcif</code>).
</p>
</li>
<li>
<p><strong>Allowed Time Values:</strong> Allows both continuous and integer time.
</p>
</li>
<li>
<p><strong>Bounded Estimates:</strong> Estimates are guaranteed to be bounded in the 0 to 1 probability range.
</p>
</li>
<li>
<p><strong>Monotone Function:</strong> Estimates are guaranteed to be monotone.
</p>
</li>
<li>
<p><strong>Dependencies:</strong> This method relies on both the <span class="pkg">Matching</span> and the <span class="pkg">cmprsk</span> packages.
</p>
</li>
</ul>
<p>Using the estimated propensity score, the individual observations in the dataset are matched to each other creating a new dataset in which the covariate distributions are balanced in respect to the two groups defined by <code>variable</code>. A simple Aalen-Johansen estimator is then used to calculate the confounder-adjusted CIFs. This corresponds to the method described in Austin &amp; Fine (2019). Details on the algorithm used for matching can be found in the documentation of the <span class="pkg">Matching</span> package.
</p>
<p>Simulation results showed that this specific implementation of this method is the least efficient method contained in this R-Package. While it does produce unbiased estimates, the variation in these estimates is very high. We strongly suggest using one of the other methods implemented here.
</p>


<h3>Value</h3>

<p>Adds the following additional objects to the output of the <code>adjustedcif</code> function:
</p>

<ul>
<li> <p><code>match_object</code>: The object creates using the <code>Match</code> function.
</p>
</li>
<li> <p><code>cuminc_object</code>: The <code>cuminc</code> object fit on the matched data.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Robin Denz
</p>


<h3>References</h3>

<p>Peter C. Austin and Jason P. Fine (2019). "Propensity-Score Matching with Competing Risks in Survival Analysis". In: Statistics in Medicine 38, pp. 751-777
</p>


<h3>See Also</h3>

<p><code>Match</code>, <code>cuminc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(adjustedCurves)
library(survival)

if (requireNamespace("Matching")) {

library(Matching)

set.seed(42)

# simulate some data as example
sim_dat &lt;- sim_confounded_crisk(n=50, max_t=5)
sim_dat$group &lt;- as.factor(sim_dat$group)

# estimate treatment assignment model
glm_mod &lt;- glm(group ~ x1 + x2 + x4 + x6, data=sim_dat, family="binomial")

# calculate adjusted CIFs
adjcif &lt;- adjustedcif(data=sim_dat,
                      variable="group",
                      ev_time="time",
                      event="event",
                      cause=1,
                      method="matching",
                      treatment_model=glm_mod)
plot(adjcif)

# Alternatively, supply the propensity score directly
# Here we use the logistic regression to calculate it, so we get
# exactly the same result. The propensity score can be calculated in
# any other way in practice, allowing flexibility
ps_score &lt;- glm_mod$fitted.values

adjcif &lt;- adjustedcif(data=sim_dat,
                      variable="group",
                      ev_time="time",
                      event="event",
                      cause=1,
                      method="matching",
                      treatment_model=ps_score)

# plot the curves
plot(adjcif)
}
</code></pre>


</div>