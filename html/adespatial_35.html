<div class="container">

<table style="width: 100%;"><tr>
<td>msr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Moran spectral randomization</h2>

<h3>Description</h3>

<p>This function allows to generate spatially-constrained random variables 
preserving the global autocorrelation (Moran's I) and the spatial structures 
at multiple scales. Multiscale property is defined by the power spectrum 
(i.e. decomposition of the variance of the original variables) on a basis of 
orthonormal eigenvectors (Moran's Eigenvector Maps, MEM). The function 
provides methods for univariate randomization, joint randomization of a group
of variables while keeping within-group correlations fixed and univariate 
randomization with a fixed correlation between original data and randomized 
replicates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">msr(x, ...)

## Default S3 method:
msr(
  x,
  listwORorthobasis,
  nrepet = 99,
  method = c("pair", "triplet", "singleton"),
  cor.fixed,
  nmax = 100,
  simplify = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>For <code>msr.default</code>, a <code>vector</code>, a <code>matrix</code> or a <code>data.frame</code> with the 
original variables. If <code>NCOL(x) &gt; 1</code>, then the joint randomization 
procedure that preserves the correlations among variables is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listwORorthobasis</code></td>
<td>
<p>an object of the class <code>listw</code> (spatial 
weights) created by the functions of the <span class="pkg">spdep</span> package or an object 
of class <code>orthobasis</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrepet</code></td>
<td>
<p>an <code>integer</code> indicating the number of replicates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>an character specifying which algorithm should be used to 
produce spatial replicates (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor.fixed</code></td>
<td>
<p>if not missing, the level of correlation between the 
original variable and its randomized replicates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmax</code></td>
<td>
<p>the number of trials used in the "triplet" procedure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simplify</code></td>
<td>
<p>A logical value. If <code>TRUE</code>, the outputs for univariate 
procedures are returned in a matrix where each column corresponds to a 
replicate. If <code>FALSE</code> a <code>list</code> is returned.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Three procedures are implemented in the function. The "pair" procedure is the
more general as it can be applied in the three cases (univariate, univariate 
with fixed correlation and multivariate). This procedure preserves the power 
spectrum by pair of MEMs but not strictly the global autocorrelation level 
(Moran's I). The "singleton" procedure can be used for univariate and 
multivariate cases. It preserves strictly the global level of autocorrelation
and the power spectrum. The "triplet" procedure can only be applied in the 
univariate case. It preserves the power spectrum by triplet of MEMs and 
strictly the global autocorrelation level.
</p>


<h3>Value</h3>

<p>Either a matrix (if <code>simplify</code> is <code>TRUE</code>) or a list with 
randomized replicates.
</p>


<h3>Author(s)</h3>

<p>Stephane Dray <a href="mailto:stephane.dray@univ-lyon1.fr">stephane.dray@univ-lyon1.fr</a> and Helene H 
Wagner <a href="mailto:helene.wagner@utoronto.ca">helene.wagner@utoronto.ca</a>
</p>


<h3>References</h3>

<p>Wagner, H.H. and Dray S. (2015) Generating spatially-constrained 
null models for irregularly spaced data using Moran spectral randomization 
methods. Methods in Ecology and Evolution, 6: 1169-1178.
doi:10.1111/2041-210X.12407
</p>


<h3>See Also</h3>

<p><code>scores.listw</code>, <code>nb2listw</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(spdep)
x1 &lt;- matrix(rnorm(81*5), nrow = 81)
lw1 &lt;- nb2listw(cell2nb(9, 9))

moran.mc(x1[,1], lw1, 2)$statistic

## singleton
x1.1 &lt;- msr(x1[,1], lw1, nrepet = 9, method = "singleton")
apply(x1.1, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)

## triplet
x1.2 &lt;- msr(x1[,1], lw1, nrepet = 9, method = "triplet")
apply(x1.2, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)

## pair
x1.3 &lt;- msr(x1[,1], lw1, nrepet = 9, method = "pair")
apply(x1.3, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)

## pair with cor.fixed
x1.4 &lt;- msr(x1[,1], lw1, nrepet = 9, cor.fixed = 0.5)
apply(x1.4, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)
cor(x1[,1], x1.4)

## pair preserving correlations for multivariate data
x1.5 &lt;- msr(x1, lw1, nrepet = 9, cor.fixed = 0.5)
cor(x1)
lapply(x1.5, cor)

apply(x1, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)
apply(x1.5[[1]], 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)

## singleton preserving correlations for multivariate data
x1.6 &lt;- msr(x1, lw1, nrepet = 9, method = "singleton")
cor(x1)
lapply(x1.6, cor)

apply(x1, 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)
apply(x1.6[[1]], 2, function(x) moran.mc(x, listw = lw1, nsim = 2)$statistic)

</code></pre>


</div>