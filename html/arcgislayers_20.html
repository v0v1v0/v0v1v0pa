<div class="container">

<table style="width: 100%;"><tr>
<td>prepare_spatial_filter</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prepare JSON for use as a spatial filter based on feature geometry or
bounding box input</h2>

<h3>Description</h3>

<p><code>prepare_spatial_filter()</code> prepares a named list with ESRI JSON geometry for
use as a spatial filter based on a a <code>sfc</code>, <code>sfg</code>, or <code>bbox</code> input object.
</p>
<p><code>match_spatial_rel()</code> takes a scalar character vector with a predicate name
to a type of ESRI spatial relation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">prepare_spatial_filter(
  filter_geom,
  crs,
  predicate,
  error_call = rlang::caller_env()
)

match_spatial_rel(predicate, error_call = rlang::caller_env())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>filter_geom</code></td>
<td>
<p>an object of class <code>bbox</code>, <code>sfc</code> or <code>sfg</code> used to filter
query results based on a predicate function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crs</code></td>
<td>
<p>a representation of a coordinate reference system.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predicate</code></td>
<td>
<p>Spatial predicate to use with <code>filter_geom</code>. Default
<code>"intersects"</code>. Possible options are <code>"intersects"</code>, <code>"contains"</code>,
<code>"crosses"</code>,  <code>"overlaps"</code>,  <code>"touches"</code>, and <code>"within"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error_call</code></td>
<td>
<p>default <code>rlang::caller_env()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Using <code>sfc</code> objects as <code>filter_geom</code>
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>
<p>If an <code>sfc</code> object is provided it will be transformed to the layers spatial
reference. If the <code>sfc</code> is missing a CRS (or is an <code>sfg</code> object) it is
assumed to use the same spatial reference as the FeatureLayer. If the <code>sfc</code>
object has multiple features, the features are unioned with
<code>sf::st_union()</code>. If an <code>sfc</code> object has <code>MULTIPOLYGON</code> geometry, the features
are unioned before being cast to <code>POLYGON</code> geometry with <code>sf::st_cast()</code>. All
geometries are checked for validity before conversion.
</p>


<h3>Value</h3>

<p><code>prepare_spatial_filter()</code> returns a named list with the
<code>geometryType</code>, <code>geometry</code> (as Esri JSON), and spatial relation predicate.
</p>
<p><code>match_spatial_rel()</code> returns one of the following spatial binary predicates:
</p>

<ul>
<li>
<p> esriSpatialRelIntersects
</p>
</li>
<li>
<p> esriSpatialRelContains
</p>
</li>
<li>
<p> esriSpatialRelCrosses
</p>
</li>
<li>
<p> esriSpatialRelOverlaps
</p>
</li>
<li>
<p> esriSpatialRelTouches
</p>
</li>
<li>
<p> esriSpatialRelWithin
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">prepare_spatial_filter(sf::st_point(c(0, 5)), 4326, "intersects")
</code></pre>


</div>