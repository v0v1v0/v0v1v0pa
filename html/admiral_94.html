<div class="container">

<table style="width: 100%;"><tr>
<td>derive_vars_period</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Subperiod, Period, or Phase Variables to ADSL</h2>

<h3>Description</h3>

<p>The function adds subperiod, period, or phase variables like <code>P01S1SDT</code>,
<code>P01S2SDT</code>, <code>AP01SDTM</code>, <code>AP02SDTM</code>, <code>TRT01A</code>, <code>TRT02A</code>, <code>PH1SDT</code>, <code>PH2SDT</code>,
... to the input dataset. The values of the variables are defined by a period
reference dataset which has one observations per patient and subperiod,
period, or phase.
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_vars_period(
  dataset,
  dataset_ref,
  new_vars,
  subject_keys = get_admiral_option("subject_keys")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>subject_keys</code> argument are expected to be in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset_ref</code></td>
<td>
<p>Period reference dataset
</p>
<p>The variables specified by <code>new_vars</code> and <code>subject_keys</code> are expected.
</p>
<p>If subperiod variables are requested, <code>APERIOD</code> and <code>ASPER</code> are expected.
If period variables are requested. <code>APERIOD</code> is expected. If phase
variables are requested, <code>APHASEN</code> is expected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_vars</code></td>
<td>
<p>New variables
</p>
<p>A named list of variables like <code>exprs(PHwSDT = PHSDT, PHwEDT = PHEDT, APHASEw = APHASE)</code> is expected. The left hand side of the elements defines
a set of variables (in CDISC notation) to be added to the output dataset.
The right hand side defines the source variable from the period reference
dataset.
</p>
<p>If the lower case letter "w"  is used it refers to a phase variable, if the
lower case letters "xx" are used it refers to a period variable, and if
both "xx" and "w" are used it refers to a subperiod variable.
</p>
<p>Only one type must be used, e.g., all left hand side values must refer to
period variables. It is not allowed to mix for example period and subperiod
variables. If period <em>and</em> subperiod variables are required, separate calls
must be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subject_keys</code></td>
<td>
<p>Variables to uniquely identify a subject
</p>
<p>A list of expressions where the expressions are symbols as returned by
<code>exprs()</code> is expected.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For each subperiod/period/phase in the period reference dataset and
each element in <code>new_vars</code> a variable (LHS value of <code>new_vars</code>) is added to
the output dataset and set to the value of the source variable (RHS value
of <code>new_vars</code>.
</p>


<h3>Value</h3>

<p>The input dataset with subperiod/period/phase variables added (see
"Details" section)
</p>


<h3>See Also</h3>

<p><code>create_period_dataset()</code>
</p>
<p>ADSL Functions that returns variable appended to dataset: 
<code>derive_var_age_years()</code>,
<code>derive_vars_aage()</code>,
<code>derive_vars_extreme_event()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(tibble)
library(dplyr, warn.conflicts = FALSE)
library(lubridate)

adsl &lt;- tibble(STUDYID = "xyz", USUBJID = c("1", "2"))

# Add period variables to ADSL
period_ref &lt;- tribble(
  ~USUBJID, ~APERIOD, ~APERSDT,     ~APEREDT,
  "1",             1, "2021-01-04", "2021-02-06",
  "1",             2, "2021-02-07", "2021-03-07",
  "2",             1, "2021-02-02", "2021-03-02",
  "2",             2, "2021-03-03", "2021-04-01"
) %&gt;%
  mutate(
    STUDYID = "xyz",
    APERIOD = as.integer(APERIOD),
    across(matches("APER[ES]DT"), ymd)
  )

derive_vars_period(
  adsl,
  dataset_ref = period_ref,
  new_vars = exprs(APxxSDT = APERSDT, APxxEDT = APEREDT)
) %&gt;%
  select(STUDYID, USUBJID, AP01SDT, AP01EDT, AP02SDT, AP02EDT)

# Add phase variables to ADSL
phase_ref &lt;- tribble(
  ~USUBJID, ~APHASEN, ~PHSDT,       ~PHEDT,       ~APHASE,
  "1",             1, "2021-01-04", "2021-02-06", "TREATMENT",
  "1",             2, "2021-02-07", "2021-03-07", "FUP",
  "2",             1, "2021-02-02", "2021-03-02", "TREATMENT"
) %&gt;%
  mutate(
    STUDYID = "xyz",
    APHASEN = as.integer(APHASEN),
    across(matches("PH[ES]DT"), ymd)
  )

derive_vars_period(
  adsl,
  dataset_ref = phase_ref,
  new_vars = exprs(PHwSDT = PHSDT, PHwEDT = PHEDT, APHASEw = APHASE)
) %&gt;%
  select(STUDYID, USUBJID, PH1SDT, PH1EDT, PH2SDT, PH2EDT, APHASE1, APHASE2)

# Add subperiod variables to ADSL
subperiod_ref &lt;- tribble(
  ~USUBJID, ~APERIOD, ~ASPER, ~ASPRSDT,     ~ASPREDT,
  "1",             1,      1, "2021-01-04", "2021-01-19",
  "1",             1,      2, "2021-01-20", "2021-02-06",
  "1",             2,      1, "2021-02-07", "2021-03-07",
  "2",             1,      1, "2021-02-02", "2021-03-02",
  "2",             2,      1, "2021-03-03", "2021-04-01"
) %&gt;%
  mutate(
    STUDYID = "xyz",
    APERIOD = as.integer(APERIOD),
    ASPER = as.integer(ASPER),
    across(matches("ASPR[ES]DT"), ymd)
  )

derive_vars_period(
  adsl,
  dataset_ref = subperiod_ref,
  new_vars = exprs(PxxSwSDT = ASPRSDT, PxxSwEDT = ASPREDT)
) %&gt;%
  select(STUDYID, USUBJID, P01S1SDT, P01S1EDT, P01S2SDT, P01S2EDT, P02S1SDT, P02S1EDT)
</code></pre>


</div>