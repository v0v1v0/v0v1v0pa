<div class="container">

<table style="width: 100%;"><tr>
<td>changeModelOnIC.asrtests</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Uses information criteria to decide whether to change an already fitted model.</h2>

<h3>Description</h3>

<p>Uses information criteria to decide whether to change the fitted model 
stored in the supplied <code>asrtests.object</code> according to the specified 
modifications. The function <code>changeTerms</code> is 
used to change the model. Thus, the model can be modified using a 
combination of adding and removing sets of terms from one or both of the fixed 
or random models, replacing the residual model and changing the bounds and/or initial 
values of some terms. The model will be unchanged 
if terms specified in <code>dropFixed</code> or <code>dropRandom</code> are not in the fitted 
model.
</p>
<p>A row is added to the <code>test.summary</code> <code>data.frame</code> of the 
<code>asrtests.object</code> using the supplied <code>label</code> and stating 
whether or not the new model has been swapped for the supplied model. 
Convergence in fitting the model is checked and a note included in the 
<code>action</code> if there was not. All components of the 
<code>asrtests.object</code> are updated to exhibit the differences 
between the supplied and new models.
</p>
<p>To obtain a list of the information criteria for a set of models use 
<code>changeTerms.asrtests</code> with <code>IClikelihood</code> set to 
<code>REML</code> or <code>full</code>, or use <code>infoCriteria.asreml</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'asrtests'
changeModelOnIC(asrtests.obj, 
                dropFixed = NULL, addFixed = NULL, 
                dropRandom = NULL,  addRandom = NULL, 
                newResidual = NULL, label = "Changed terms", 
                allow.unconverged = TRUE, allow.fixedcorrelation = TRUE,
                checkboundaryonly = FALSE, 
                trace = FALSE, update = TRUE, denDF = "numeric", 
                set.terms = NULL, ignore.suffices = TRUE, 
                bounds = "P", initial.values = NA, 
                which.IC = "AIC", IClikelihood = "REML", 
                fixedDF = NULL, varDF = NULL, 
                bound.exclusions = c("F","B","S","C"), 
          ...)</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>asrtests.obj</code></td>
<td>
<p>An <code>asrtests.object</code> containing the components 
(i) <code>asreml.obj</code>, (ii) <code>wald.tab</code>, and (iii) <code>test.summary</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dropFixed</code></td>
<td>
<p>A single <code>character</code> string in the form of a formula which, 
after addition of <code>". ~ . -"</code> and after expansion, specifies the sum 
of a set of terms to be dropped from the fixed formula. 
The names must match those in the <code>wald.tab</code> component of the 
<code>asrtests.obj</code>.  
The fixed terms will be reordered so that single-variable terms come 
first, followed by two-variable terms and so on. Note that 
multiple terms specified using a single <code>asreml::at</code> function 
can only be dropped as a whole. If the term was specified using 
an <code>asreml::at</code> function with a single level, then it can be 
removed and either the level itself or its <code>numeric</code> 
position in the levels returned by the <code>levels</code> function 
can be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addFixed</code></td>
<td>
<p>A single <code>character</code> string in the form of a formula which, 
after addition of <code>". ~ . +"</code> and expansion, specifies the sum 
of a set of terms to be added to the fixed formula. 
The fixed terms will be reordered so that single-variable terms come 
first, followed by two-variable terms and so on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dropRandom</code></td>
<td>
<p>A single <code>character</code> string in the form of a formula which, 
after addition of <code>" ~ . -"</code> and expansion, specifies the sum 
of a set of terms to be dropped from the random formula. 
The names must match those in the <code>vparameters</code> component of the 
<code>asreml.obj</code> component in the <code>asrtests.obj</code>. Note that 
multiple terms specified using a single <code>asreml::at</code> function 
can only be dropped as a whole. If the term was specified using 
an <code>asreml::at</code> function with a single level, then it can be 
removed and either the level itself or its <code>numeric</code> 
position in the levels returned by the <code>levels</code> function 
can be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addRandom</code></td>
<td>
<p>A single <code>character</code> string in the form of a formula which, 
after addition of <code>" ~ . +"</code>and expansion, specifies the sum 
of a set of terms to be added to the random formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newResidual</code></td>
<td>
<p>A single <code>character</code> string in the form of a formula which, 
after addition of <code>" ~ "</code>, specifies the <code>residual</code> 
(or <code>rcov</code>) model. To remove the model, enter <code>"-(.)"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>A <code>character</code> to use as an entry in the <code>terms</code> column in 
<code>test.summary</code> to indicate as far as is possible the terms that are 
being manipulated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allow.unconverged</code></td>
<td>
<p>A <code>logical</code> indicating whether to accept a new model 
even when it does not converge. If <code>FALSE</code> and the fit of the new 
model does not converge, the supplied <code>asrtests.obj</code> is returned.  
Also, if <code>FALSE</code> and the fit of the new model has converged, but that 
of the old model has not, the new model will be accepted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allow.fixedcorrelation</code></td>
<td>
<p>A <code>logical</code> indicating whether to accept a new model 
even when it contains correlations in the model whose values have been 
designated as fixed, bound or singular. If <code>FALSE</code> and the new model 
contains correlations whose values have not been able to be estimated, 
the supplied <code>asrtests.obj</code> is returned. The fit in the 
<code>asreml.obj</code> component of the supplied <code>asrtests.obj</code> will 
also be tested and a warning issued if both fixed correlations are found 
in it and <code>allow.fixedcorrelation</code> is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>checkboundaryonly</code></td>
<td>
<p>If <code>TRUE</code> then boundary and singular terms are not removed by 
<code>rmboundary.asrtests</code>; a warning is issued instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>If TRUE then partial iteration details are displayed when ASReml-R 
functions are invoked; if FALSE then no output is displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update</code></td>
<td>
<p>If <code>TRUE</code>, and <code>set.terms</code> is <code>NULL</code>, then 
<code>newfit.asreml</code> is called to fit the model to be tested, 
using the values of the variance parameters stored in 
the <code>asreml.object</code>, that is stored in <code>asrtests.obj</code>, as starting values. 
If <code>FALSE</code> or <code>set.terms</code> is not <code>NULL</code>, then 
<code>newfit.asreml</code> will not use the stored variance parameter 
values as starting values when fitting the new model, the only 
modifications being (i) those specified by this function's arguments and 
(ii) those specified via <code>...</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>denDF</code></td>
<td>
<p>Specifies the method to use in computing approximate denominator 
degrees of freedom when <code>wald.asreml</code> is called. Can be <code>none</code> 
to suppress the computations, <code>numeric</code> for numerical methods,
<code>algebraic</code> for algebraic methods or <code>default</code>, the default, 
to automatically choose numeric or algebraic computations depending 
on problem size. The denominator degrees of freedom are calculated 
according to Kenward and Roger (1997) for fixed terms in the dense 
part of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set.terms</code></td>
<td>
<p>A <code>character</code> vector specifying the terms that are to have 
bounds and/or initial values set prior to fitting the new model.
The names must match those in the <code>vparameters</code> component of the 
<code>asreml.obj</code> component in the new <code>asrtests.object</code>. 
The terms in the model do not need to change from those in the 
model in the supplied <code>asrtests.obj</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore.suffices</code></td>
<td>
<p>A logical vector specifying whether the suffices of the 
<code>asreml</code>-assigned names of the variance terms (i.e. the 
information to the right of an "!", other than "R!") is to 
be ignored in matching elements of <code>terms</code>. 
If <code>TRUE</code> for an element of <code>terms</code>, the suffices 
are stripped from the <code>asreml</code>-assigned names. 
If <code>FALSE</code> for an element of <code>terms</code>, the element 
must exactly match an <code>asreml</code>-assigned name for a 
variance term. This vector must be of length one or the 
same length as <code>terms</code>. If it is of length one then 
the same action is applied to the <code>asreml</code>-assigned 
suffices for all the terms in <code>terms</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>
<p>A <code>character</code> vector specifying the bounds to be applied 
to the terms specified in <code>set.terms</code>. This vector 
must be of length one or the same length as <code>set.terms</code>. 
If it is of length one then the same constraint is 
applied to all the terms in <code>set.terms</code>. 
If any of the bounds are equal to NA then they are 
left unchanged for those terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which.IC</code></td>
<td>
<p>A <code>character</code> specifying the information criterion to be used in 
selecting the best model. Possible values are <code>AIC</code> and 
<code>BIC</code>. The value of the criterion for supplied model must 
exceed that for changed model for the changed model to be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>IClikelihood</code></td>
<td>
<p>A <code>character</code> specifying whether Restricted Maximum Likelihood 
(<code>REML</code>) or the full likelihood, evaluated using REML estimates, 
(<code>full</code>) are to be used in calculating the information criteria 
for choosing between models when <code>family</code> is set to 
<code>asr_gaussian</code>. For <code>family</code> set to <code>asr_binomial</code> or 
<code>asr_poisson</code> and with <code>dispersion</code> set to 1, the 
<code>deviance</code> is extracted from <code>object</code> and used to calculate 
the AIC and BIC (as suggested by Damian Collins); the setting of 
<code>IClikelihood</code> is ignored and the log-likelihood set to <code>NA</code>. 
The information criteria are not valid for other settings of 
<code>family</code> and <code>dispersion</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedDF</code></td>
<td>
<p>A <code>numeric</code> giving the number of estimated fixed parameters. If
<code>NULL</code> then this is determined from the information in 
<code>asreml.obj</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varDF</code></td>
<td>
<p>A <code>numeric</code> giving the number of estimated variance parameters. If
<code>NULL</code> then this is determined from the information in 
<code>asreml.obj</code>. It replaces the <code>varDF</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.values</code></td>
<td>
<p>A character vector specifying the initial values for  
the terms specified in <code>terms</code>. This vector 
must be of length one or the same length as <code>terms</code>. 
If it is of length one then the same initial value is 
applied to all the terms in <code>terms</code>. 
If any of the initial.values are equal to NA then they are 
left unchanged for those terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bound.exclusions</code></td>
<td>
<p>A <code>character</code> specifying the bound (constraint) codes that 
will result in a variance parameter being excluded from the count of 
estimated variance parameters in calculating the information criteria. 
If set to <code>NULL</code> then none will be excluded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>asreml</code>, <code>wald.asreml</code> and 
<code>as.asrtests</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An <code>asrtests.object</code> containing the components (i) <code>asreml.obj</code>,
(ii) <code>wald.tab</code>, and (iii) <code>test.summary</code>. The values of the degrees of 
freedom and the information criteria are differences between those of the changed 
model and those of the model supplied to <code>changeModelOnIC</code>.</p>


<h3>Author(s)</h3>

<p>Chris Brien</p>


<h3>See Also</h3>

<p><code>as.asrtests</code>, <code>rmboundary.asrtests</code>, 
<code>testranfix.asrtests</code>, <code>testresidual.asrtests</code>, <br><code>newfit.asreml</code>, <code>reparamSigDevn.asrtests</code>, 
<code>chooseModel.asrtests</code>, <code>changeTerms.asrtests</code>, 
<code>infoCriteria.asreml</code></p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

data(Wheat.dat)
current.asr &lt;- asreml(yield ~ Rep + WithinColPairs + Variety, 
                      random = ~ Row + Column + units,
                      residual = ~ ar1(Row):ar1(Column), 
                      data=Wheat.dat)
current.asrt &lt;- as.asrtests(current.asr, NULL, NULL, 
                            label = "Maximal model")
current.asrt &lt;- rmboundary(current.asrt)

# Drop both Row and Column terms
current.asrt &lt;- changeModelOnIC(current.asrt, 
                                dropRandom = "Row + Column", 
                                checkboundaryonly = TRUE,
                                which.IC = "AIC", IClikelihood = "full")
current.asrt &lt;- iterate(current.asrt)
                          
# Add and drop both fixed and random terms
current.asrt &lt;- changeModelOnIC(current.asrt, 
                                addFixed = "vRow", dropFixed = "WithinColPairs", 
                                addRandom = "spl(vRow)", dropRandom = "units", 
                                checkboundaryonly = TRUE,
                                which.IC = "AIC", IClikelihood = "full")
                          
# Replace residual with model without Row autocorrelation
current.asrt &lt;- changeModelOnIC(current.asrt, 
                                newResidual = "Row:ar1(Column)", 
                                label="Row autocorrelation",
                                IClikelihood = "full")


## End(Not run)</code></pre>


</div>