<div class="container">

<table style="width: 100%;"><tr>
<td>paws</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Adaptive weigths smoothing using patches
</h2>

<h3>Description</h3>

<p>The function implements a version the propagation separation approach that
uses patches instead of individuel voxels for comparisons in parameter space. Functionality is analog to function <code>aws</code>. Using patches allows for an improved
handling of locally smooth functions and in 2D and 3D for improved smoothness of
discontinuities at the expense of increased computing time.
</p>


<h3>Usage</h3>

<pre><code class="language-R">paws(y, hmax = NULL, mask=NULL, onestep = FALSE, aws = TRUE, family = "Gaussian",
     lkern = "Triangle", aggkern = "Uniform", sigma2 = NULL, shape = NULL,
     scorr = 0, spmin = 0.25, ladjust = 1, wghts = NULL, u = NULL,
     graph = FALSE, demo = FALSE, patchsize = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>array <code>y</code> containing the observe response (image intensity) data.
<code>dim(y)</code> determines the dimensionality and extend of the grid design.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask</code></td>
<td>
<p>logical array defining a mask. All computations are restricted to the mask.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hmax</code></td>
<td>
 <p><code>hmax</code> specifies the maximal bandwidth. Defaults to <code>hmax=250, 12, 5</code>
for 1D, 2D, 3D images, respectively.
In case of <code>lkern="Gaussian"</code> the bandwidth is assumed to be given in full width half maximum (FWHM) units, i.e., <code>0.42466</code> times gridsize.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>onestep</code></td>
<td>

<p>apply the last step only (use for test purposes only)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aws</code></td>
<td>

<p>logical: if TRUE structural adaptation (AWS) is used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p><code>family</code> specifies the probability distribution. Default is <code>family="Gaussian"</code>, also implemented
are "Bernoulli", "Poisson", "Exponential", "Volatility", "Variance" and "NCchi". <code>family="Volatility"</code> specifies a Gaussian distribution with
expectation 0 and unknown variance. <code>family="Volatility"</code> specifies that <code>p*y/theta</code> is distributed as <code class="reqn">\chi^2</code> with <code>p=shape</code>
degrees of freedom. <code>family="NCchi"</code> uses a noncentral Chi distribution with <code>p=shape</code> degrees of freedom and noncentrality parameter <code>theta</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lkern</code></td>
<td>

<p>character: location kernel, either "Triangle", "Plateau", "Quadratic", "Cubic" or "Gaussian".
The default "Triangle" is equivalent to using an Epanechnikov kernel, "Quadratic" and  "Cubic" refer to a Bi-weight and Tri-weight
kernel, see Fan and Gijbels (1996). "Gaussian" is a truncated (compact support) Gaussian kernel.
This is included for comparisons only and should be avoided due to its large computational costs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggkern</code></td>
<td>

<p>character: kernel used in stagewise aggregation, either "Triangle" or "Uniform"
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2</code></td>
<td>

<p><code>sigma2</code> allows to specify the variance in case of <code>family="Gaussian"</code>. Not used if <code>family!="Gaussian"</code>.
Defaults to <code>NULL</code>. In this case a homoskedastic variance estimate is generated. If <code>length(sigma2)==length(y)</code> then <code>sigma2</code>
is assumed to contain the pointwise variance of <code>y</code> and a heteroscedastic variance model is used.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>Allows to specify an additional shape parameter for certain family models. Currently only used for family="Variance", that is <code class="reqn">\chi</code>-Square distributed observations
with <code>shape</code> degrees of freedom.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scorr</code></td>
<td>

<p>The vector <code>scorr</code> allows to specify a first order correlations of the noise for each coordinate direction,
defaults to 0 (no correlation).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spmin</code></td>
<td>

<p>Determines the form (size of the plateau) in the adaptation kernel.
Not to be changed by the user.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ladjust</code></td>
<td>

<p>factor to increase the default value of lambda
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wghts</code></td>
<td>
<p><code>wghts</code> specifies the  diagonal elements of a weight matrix to adjust for different distances between grid-points
in different coordinate directions, i.e. allows to define a more appropriate metric in the design space.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>

<p>a "true" value of the regression function, may be provided to
report risks at each iteration. This can be used to test the propagation condition with <code>u=0</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graph</code></td>
<td>
<p>If  <code>graph=TRUE</code> intermediate results are illustrated after each iteration step. Defaults to <code>graph=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demo</code></td>
<td>
<p> If <code>demo=TRUE</code> the function pauses after each iteration. Defaults to <code>demo=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>patchsize</code></td>
<td>

<p>positive integer defining the size of patches. Number of grid points within the patch is <code>(2*patchsize+1)^d</code> with <code>d</code> denoting the dimensionality of the design.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p> see <code>aws. The procedure is supposed to produce superior results if the assumption of a local constant image is violated or if smooothness of discontinuities is desired.</code>
</p>


<h3>Value</h3>

<p>returns an object of class <code>aws</code> with slots
</p>
<table>
<tr style="vertical-align: top;">
<td><code>y = "numeric"</code></td>
<td>
<p>y</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dy = "numeric"</code></td>
<td>
<p>dim(y)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x = "numeric"</code></td>
<td>
<p>numeric(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ni = "integer"</code></td>
<td>
<p>integer(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask = "logical"</code></td>
<td>
<p>logical(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta = "numeric"</code></td>
<td>
<p>Estimates of regression function, <code>length: length(y)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hseq = "numeric"</code></td>
<td>
<p>sequence of bandwidths employed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mae = "numeric"</code></td>
<td>
<p>Mean absolute error for each iteration step if u was specified,  numeric(0) else</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psnr = "numeric"</code></td>
<td>
<p>Peak signal-to-noise ratio for each iteration step if u was specified,  numeric(0) else</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var = "numeric"</code></td>
<td>
<p>approx. variance of the estimates of the regression function. Please note that this does not reflect variability due to randomness of weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmin = "numeric"</code></td>
<td>
<p>numeric(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmax = "numeric"</code></td>
<td>
<p>numeric(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wghts = "numeric"</code></td>
<td>
<p>numeric(0), ratio of distances <code>wghts[-1]/wghts[1]</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree = "integer"</code></td>
<td>
<p>0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hmax  = "numeric"</code></td>
<td>
<p>effective hmax</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma2  = "numeric"</code></td>
<td>
<p>provided or estimated error variance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scorr = "numeric"</code></td>
<td>
<p>scorr</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family = "character"</code></td>
<td>
<p>family</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape = "numeric"</code></td>
<td>
<p>shape</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lkern  = "integer"</code></td>
<td>
<p>integer code for lkern,
1="Plateau", 2="Triangle", 3="Quadratic", 4="Cubic", 5="Gaussian"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda = "numeric"</code></td>
<td>
<p>effective value of lambda</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ladjust = "numeric"</code></td>
<td>
<p>effective value of ladjust</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aws = "logical"</code></td>
<td>
<p>aws</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memory = "logical"</code></td>
<td>
<p>memory</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>homogen = "logical"</code></td>
<td>
<p>homogen</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>earlystop = "logical"</code></td>
<td>
<p>FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varmodel = "character"</code></td>
<td>
<p>"Constant"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcoef = "numeric"</code></td>
<td>
<p>numeric(0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call = "function"</code></td>
<td>
<p>the arguments of the call to <code>aws</code></p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>use <code>setCores='number of threads'</code> to enable parallel execution.
</p>


<h3>Author(s)</h3>

<p>Joerg Polzehl, <a href="mailto:polzehl@wias-berlin.de">polzehl@wias-berlin.de</a>,
<a href="https://www.wias-berlin.de/people/polzehl/">https://www.wias-berlin.de/people/polzehl/</a>
</p>


<h3>References</h3>

<p>J. Polzehl, K. Tabelow (2019). Magnetic Resonance Brain Imaging:
Modeling and Data Analysis Using R. Springer, Use R! series. Appendix A.
Doi:10.1007/978-3-030-29184-6.
</p>
<p>J. Polzehl, K. Papafitsoros, K. Tabelow (2020). Patch-Wise Adaptive Weights Smoothing in R, Journal of
Statistical Software, 95(6), 1-27. doi:10.18637/jss.v095.i06 .
</p>


<h3>See Also</h3>

<p>See also <code>aws</code>, <code>lpaws</code>, <code>vpaws</code>,<code>link{awsdata}</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
setCores(2)
y &lt;- array(rnorm(64^3),c(64,64,64))
yhat &lt;- paws(y,hmax=6)

## End(Not run)

</code></pre>


</div>