<div class="container">

<table style="width: 100%;"><tr>
<td>aov_car</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Convenient ANOVA estimation for factorial designs</h2>

<h3>Description</h3>

<p>These functions allow convenient specification of any type of ANOVAs (i.e.,
purely within-subjects ANOVAs, purely between-subjects ANOVAs, and mixed
between-within or split-plot ANOVAs) for data in the <strong>long</strong> format
(i.e., one observation per row). If the data has more than one observation
per individual and cell of the design (e.g., multiple responses per
condition), the data will be automatically aggregated. The default settings
reproduce results from commercial statistical packages such as SPSS or SAS.
<code>aov_ez</code> is called specifying the factors as character vectors,
<code>aov_car</code> is called using a formula similar to <code>aov</code>
specifying an error strata for the within-subject factor(s), and <code>aov_4</code>
is called with a <span class="pkg">lme4</span>-like formula (all ANOVA functions return
identical results). The returned object can be passed to e.g., <span class="pkg">emmeans</span>
for further analysis (e.g., follow-up tests, contrasts, plotting, etc.).
These functions employ <code>Anova</code> (from the <span class="pkg">car</span> package)
to provide test of effects avoiding the somewhat unhandy format of
<code>car::Anova</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aov_car(
  formula,
  data,
  fun_aggregate = NULL,
  type = afex_options("type"),
  factorize = afex_options("factorize"),
  observed = NULL,
  anova_table = list(),
  include_aov = afex_options("include_aov"),
  return = afex_options("return_aov"),
  ...
)

aov_4(
  formula,
  data,
  observed = NULL,
  fun_aggregate = NULL,
  type = afex_options("type"),
  factorize = afex_options("factorize"),
  return = afex_options("return_aov"),
  anova_table = list(),
  include_aov = afex_options("include_aov"),
  ...,
  print.formula = FALSE
)

aov_ez(
  id,
  dv,
  data,
  between = NULL,
  within = NULL,
  covariate = NULL,
  observed = NULL,
  fun_aggregate = NULL,
  transformation,
  type = afex_options("type"),
  factorize = afex_options("factorize"),
  return = afex_options("return_aov"),
  anova_table = list(),
  include_aov = afex_options("include_aov"),
  ...,
  print.formula = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula specifying the ANOVA model similar to
<code>aov</code> (for <code>aov_car</code> or similar to <code>lme4:lmer</code> for
<code>aov_4</code>). Must include an error term (i.e., <code>Error(id/...)</code> for
<code>aov_car</code> or <code>(...|id)</code> for <code>aov_4</code>). Note that the
within-subject factors do not need to be outside the Error term (this
contrasts with <code>aov</code>). See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> containing the data. Mandatory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun_aggregate</code></td>
<td>
<p>The function for aggregating the data before running the
ANOVA if there is more than one observation per individual and cell of the
design. The default <code>NULL</code> issues a warning if aggregation is
necessary and uses <code>mean</code>. Pass <code>mean</code> directly to avoid
the warning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>The type of sums of squares for the ANOVA. The default is given
by <code>afex_options("type")</code>, which is <strong>initially set to 3</strong>.
Passed to <code>Anova</code>. Possible values are <code>"II"</code>,
<code>"III"</code>, <code>2</code>, or <code>3</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factorize</code></td>
<td>
<p>logical. Should between subject factors be factorized (with
note) before running the analysis. The default is given by
<code>afex_options("factorize")</code>, which is initially <code>TRUE</code>. If one
wants to run an ANCOVA, this needs to be set to <code>FALSE</code> (in which case
centering on 0 is checked on numeric variables).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>observed</code></td>
<td>
<p><code>character</code> vector indicating which of the variables are
observed (i.e, measured) as compared to experimentally manipulated. The
default effect size reported (generalized eta-squared) requires correct
specification of the observed (in contrast to manipulated) variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>anova_table</code></td>
<td>
<p><code>list</code> of further arguments passed to function
producing the ANOVA table.  Arguments such as <code>es</code> (effect size) or
<code>correction</code>  are passed to either <code>anova.afex_aov</code> or
<code>nice</code>. Note that those settings can also be changed once an object of
class <code>afex_aov</code> is created by invoking the <code>anova</code> method
directly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_aov</code></td>
<td>
<p>Boolean. Allows suppressing the calculation of the aov
object. If TRUE the aov model is part of the returned <code>afex_aov</code>
object. <code>FALSE</code> (the default) prevents this potentially costly
calculation. Especially for designs with larger N and within-subjects
factors, this is highly advisable. Follow-up analyses using <span class="pkg">emmeans</span>
using the <code>univariate</code> model (which is not recommended) require the
aov model and TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return</code></td>
<td>
<p>What should be returned? The default is given by
<code>afex_options("return_aov")</code>, which is initially <code>"afex_aov"</code>,
returning an S3 object of class <code>afex_aov</code> for which various
methods exist (see there and below for more
details). Other values are currently still supported for backward
compatibility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>fun_aggregate</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.formula</code></td>
<td>
<p><code>aov_ez</code> and <code>aov_4</code> are wrapper for
<code>aov_car</code>. This boolean argument indicates whether the formula in the
call to <code>car.aov</code> should be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p><code>character</code> vector (of length 1) indicating the subject
identifier column in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dv</code></td>
<td>
<p><code>character</code> vector (of length 1) indicating the column
containing the <strong>dependent variable</strong> in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>between</code></td>
<td>
<p><code>character</code> vector indicating the
<strong>between</strong>-subject(s) factor(s)/column(s) in <code>data</code>. Default is
<code>NULL</code> indicating no between-subjects factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>within</code></td>
<td>
<p><code>character</code> vector indicating the
<strong>within</strong>-subject(s)(or repeated-measures) factor(s)/column(s) in
<code>data</code>.  Default is <code>NULL</code> indicating no within-subjects factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariate</code></td>
<td>
<p><code>character</code> vector indicating the between-subject(s)
covariate(s) (i.e., column(s)) in <code>data</code>. Default is <code>NULL</code>
indicating no covariates. Please note that <code>factorize</code> needs to be set
to <code>FALSE</code> in case the covariate is numeric and should be treated as
such.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transformation</code></td>
<td>
<p>In <code>aov_ez</code>, a <code>character</code> vector (of length 
1) indicating the name of a transformation to apply to <code>dv</code> before 
fitting the model. If missing, no transformation is applied. In 
<code>aov_car</code> and <code>aov_4</code>, a response transformation may be 
incorporated in the left-hand side of <code>formula</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>



<h4>Details of ANOVA Specification</h4>

 <p><code>aov_ez</code> will concatenate
all between-subject factors using <code>*</code> (i.e., producing all main effects
and interactions) and all covariates by <code>+</code> (i.e., adding only the main
effects to the existing between-subject factors). The within-subject factors
do fully interact with all between-subject factors and covariates. This is
essentially identical to the behavior of SPSS's <code>glm</code> function.
</p>
<p>The <code>formula</code>s for <code>aov_car</code> or <code>aov_4</code> must contain a single
<code>Error</code> term specifying the <code>ID</code> column and potential
within-subject factors (you can use <code>mixed</code> for running
mixed-effects models with multiple error terms). Factors outside the
<code>Error</code> term are treated as between-subject factors (the within-subject
factors specified in the <code>Error</code> term are ignored outside the
<code>Error</code> term; in other words, it is not necessary to specify them
outside the <code>Error</code> term, see Examples).<br> Suppressing the intercept
(i.e, via <code>0 +</code> or <code>- 1</code>) is ignored. Specific specifications of
effects (e.g., excluding terms with <code>-</code> or using <code>^</code>) could be okay
but is not tested. Using the <code>I</code> or <code>poly</code> function
within the formula is not tested and not supported!
</p>
<p>To run an ANCOVA you need to set <code>factorize = FALSE</code> and make sure that
all variables have the correct type (i.e., factors are factors and numeric
variables are numeric and centered).
</p>
<p>Note that the default behavior is to include calculation of the effect size
generalized eta-squared for which <strong>all non-manipluated (i.e.,
observed)</strong> variables need to be specified via the <code>observed</code> argument to
obtain correct results. When changing the effect size to <code>"pes"</code>
(partial eta-squared) or <code>"none"</code> via <code>anova_table</code> this becomes
unnecessary.
</p>
<p>Factor contrasts will be set to <code>"contr.sum"</code> for all between-subject
factors if default contrasts are not equal to <code>"contr.sum"</code> or
<code>attrib(factor, "contrasts") != "contr.sum"</code>. (within-subject factors
are hard-coded <code>"contr.sum"</code>.) </p>



<h4>Statistical Issues</h4>

 <p><strong>Type 3 sums of squares are default
in <span class="pkg">afex</span>.</strong> While some authors argue that so-called type 3 sums of
squares are dangerous and/or problematic (most notably Venables, 2000), they
are the default in many commercial statistical application such as SPSS or
SAS. Furthermore, statisticians with an applied perspective recommend type 3
tests (e.g., Maxwell and Delaney, 2004). Consequently, they are the default
for the ANOVA functions described here. For some more discussion on this
issue see <a href="https://stats.stackexchange.com/q/6208/442">here</a>.
</p>
<p>Note that lower order effects (e.g., main effects) in type 3 ANOVAs are only
meaningful with
<a href="https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faqwhat-is-effect-coding/">effects
coding</a>. Therefore, contrasts are set to <code>contr.sum</code> which
ensures meaningful results. For a discussion of the other (non-recommended)
coding schemes see
<a href="https://stats.oarc.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/">here</a>.
</p>



<h4>Follow-Up Contrasts and Post-Hoc Tests</h4>

<p> The S3 object returned
per default can be directly passed to <code>emmeans::emmeans</code> for further
analysis. This allows to test any type of contrasts that might be of interest
independent of whether or not this contrast involves between-subject
variables, within-subject variables, or a combination thereof. The general
procedure to run those contrasts is the following (see Examples for a full
example):
</p>

<ol>
<li>
<p> Estimate an <code>afex_aov</code> object with the function returned here. For example: <code>x &lt;- aov_car(dv ~ a*b + (id/c), d)</code>
</p>
</li>
<li>
<p> Obtain a <code>emmGrid-class</code> object by running <code>emmeans</code> on the <code>afex_aov</code> object from step 1 using the factors involved in the contrast. For example: <code>r &lt;- emmeans(x, ~a:c)</code>
</p>
</li>
<li>
<p> Create a list containing the desired contrasts on the reference grid object from step 2. For example: <code>con1 &lt;- list(a_x = c(-1, 1, 0, 0, 0, 0), b_x = c(0, 0, -0.5, -0.5, 0, 1))</code>
</p>
</li>
<li>
<p> Test the contrast on the reference grid using <code>contrast</code>. For example: <code>contrast(r, con1)</code>
</p>
</li>
<li>
<p> To control for multiple testing p-value adjustments can be specified. For example the Bonferroni-Holm correction: <code>contrast(r, con1, adjust = "holm")</code>
</p>
</li>
</ol>
<p>Note that <span class="pkg">emmeans</span> allows for a variety of advanced settings and
simplifications, for example: all pairwise comparison of a single factor
using one command (e.g., <code>emmeans(x, "a", contr = "pairwise")</code>) or
advanced control for multiple testing by passing objects to <span class="pkg">multcomp</span>.
A comprehensive overview of the functionality is provided in the
accompanying vignettes (see
<a href="https://CRAN.R-project.org/package=emmeans">here</a>).
</p>
<p>Since version 1.0, <span class="pkg">afex</span> per default uses the <code>multivariate</code> model
(i.e., the <code>lm</code> slot of the <code>afex_aov</code> object) for follow-up tests
with <span class="pkg">emmeans</span>. Compared to the <code>univariate</code> model (i.e., the
<code>aov</code> slot), this can handle unbalanced data and addresses sphericity
better. To use the older (and not recommended) <code>model = "univariate"</code>
make sure to set <code>include_aov = TRUE</code> when estimating the ANOVA.
</p>
<p>Starting with <span class="pkg">afex</span> version 0.22, <span class="pkg">emmeans</span> is <em>not</em>
loaded/attached automatically when loading <span class="pkg">afex</span>. Therefore,
<span class="pkg">emmeans</span> now needs to be loaded by the user via
<code>library("emmeans")</code> or <code>require("emmeans")</code>.
</p>
  


<h4>Methods for <code>afex_aov</code> Objects</h4>

<p> A full overview over the
methods provided for <code>afex_aov</code> objects is provided in the corresponding
help page: <code>afex_aov-methods</code>. The probably most important ones
for end-users are <code>summary</code>, <code>anova</code>, and <code>nice</code>.
</p>
<p>The <code>summary</code> method returns, for ANOVAs containing within-subject
(repeated-measures) factors with more than two levels, the complete
univariate analysis: Results without df-correction, the Greenhouse-Geisser
corrected results, the Hyunh-Feldt corrected results, and the results of the
Mauchly test for sphericity.
</p>
<p>The <code>anova</code> method returns a <code>data.frame</code> of class <code>"anova"</code>
containing the ANOVA table in numeric form (i.e., the one in slot
<code>anova_table</code> of a <code>afex_aov</code>). This method has arguments such as
<code>correction</code> and <code>es</code> and can be used to obtain an ANOVA table with
different correction than the one initially specified.
</p>
<p>The <code>nice</code> method also returns a <code>data.frame</code>, but rounds
most values and transforms them into characters for nice printing. Also has
arguments like <code>correction</code> and <code>es</code> which can be used to obtain an
ANOVA table with different correction than the one initially specified. </p>



<h3>Value</h3>

<p><code>aov_car</code>, <code>aov_4</code>, and <code>aov_ez</code> are wrappers for
<code>Anova</code> and <code>aov</code>, the return value is
dependent on the <code>return</code> argument. Per default, an S3 object of class
<code>"afex_aov"</code> is returned containing the following slots:
</p>

<dl>
<dt><code>"anova_table"</code></dt>
<dd>
<p>An ANOVA table of class <code>c("anova",
   "data.frame")</code>.</p>
</dd>
<dt><code>"aov"</code></dt>
<dd>
<p><code>aov</code> object returned from <code>aov</code> 
(should not be used to evaluate significance of effects, but can be passed
to <code>emmeans</code> for post-hoc tests).</p>
</dd>
<dt><code>"Anova"</code></dt>
<dd>
<p>object returned from <code>Anova</code>, an 
object of class <code>"Anova.mlm"</code> (if within-subjects factors are present)
or of class <code>c("anova", "data.frame")</code>.</p>
</dd>
<dt><code>"lm"</code></dt>
<dd>
<p>the object fitted with <code>lm</code> and passed to
<code>Anova</code> (i.e., an object of class <code>"lm"</code> or <code>"mlm"</code>). Also
returned if <code>return = "lm"</code>.</p>
</dd>
<dt><code>"data"</code></dt>
<dd>
<p>a list containing: (1) <code>long</code> (the possibly
aggregated data in long format used for <code>aov</code>), <code>wide</code> (the data
used to fit the <code>lm</code> object), and <code>idata</code> (if within-subject
factors are present, the <code>idata</code> argument passed to
<code>car::Anova</code>). Also returned if <code>return = "data"</code>.</p>
</dd>
</dl>
<p>In addition, the object has the following attributes: <code>"dv"</code>,
<code>"id"</code>, <code>"within"</code>, <code>"between"</code>, and <code>"type"</code>.
</p>
<p>The print method for <code>afex_aov</code> objects
(invisibly) returns (and prints) the same as if <code>return</code> is
<code>"nice"</code>: a nice ANOVA table (produced by <code>nice</code>) with the
following columns: <code>Effect</code>, <code>df</code>, <code>MSE</code> (mean-squared
errors), <code>F</code> (potentially with significant symbols), <code>ges</code>
(generalized eta-squared), <code>p</code>.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>aov_4()</code>: Allows definition of ANOVA-model using
<code>lme4::lmer</code>-like Syntax (but still fits a standard ANOVA).
</p>
</li>
<li> <p><code>aov_ez()</code>: Allows definition of ANOVA-model using character strings.
</p>
</li>
</ul>
<h3>Note</h3>

<p>Calculation of ANOVA models via <code>aov</code> (which is done per default)
can be comparatively slow and produce comparatively large objects for
ANOVAs with many within-subjects factors or levels. To avoid this
calculation set <code>include_aov = FALSE</code>. You can also disable this
globally with: <code>afex_options(include_aov = FALSE)</code>
</p>
<p>The id variable and variables entered as within-subjects (i.e.,
repeated-measures) factors are silently converted to factors. Levels of
within-subject factors are converted to valid variable names using
<code>make.names(...,unique=TRUE)</code>. Unused factor levels are
silently dropped on all variables.
</p>
<p>Contrasts attached to a factor as an attribute are probably not preserved
and not supported.
</p>
<p>The workhorse is <code>aov_car</code>. <code>aov_4</code> and <code>aov_ez</code> only
construe and pass an appropriate formula to <code>aov_car</code>. Use
<code>print.formula = TRUE</code> to view this formula.
</p>
<p>In contrast to <code>aov</code> <code>aov_car</code> assumes that all factors to
the right of <code>/</code> in the <code>Error</code> term are belonging together.
Consequently, <code>Error(id/(a*b))</code> and <code>Error(id/a*b)</code> are identical
(which is not true for <code>aov</code>).
</p>


<h3>Author(s)</h3>

<p>Henrik Singmann
</p>
<p>The design of these functions was influenced by <code>ezANOVA</code>
from package <span class="pkg">ez</span>.
</p>


<h3>References</h3>

<p>Cramer, A. O. J., van Ravenzwaaij, D., Matzke, D., Steingroever,
H., Wetzels, R., Grasman, R. P. P. P., ... Wagenmakers, E.-J. (2015).
Hidden multiplicity in exploratory multiway ANOVA: Prevalence and remedies.
<em>Psychonomic Bulletin &amp; Review</em>, 1-8. <a href="https://doi.org/10.3758/s13423-015-0913-5">doi:10.3758/s13423-015-0913-5</a>
</p>
<p>Maxwell, S. E., &amp; Delaney, H. D. (2004). <em>Designing Experiments and
Analyzing Data: A Model-Comparisons Perspective</em>. Mahwah, N.J.: Lawrence
Erlbaum Associates.
</p>
<p>Venables, W.N. (2000). <em>Exegeses on linear models</em>. Paper presented to
the S-Plus User's Conference, Washington DC, 8-9 October 1998, Washington,
DC. Available from: <a href="http://www.stats.ox.ac.uk/pub/MASS3/Exegeses.pdf">http://www.stats.ox.ac.uk/pub/MASS3/Exegeses.pdf</a>
</p>


<h3>See Also</h3>

<p>Various methods for objects of class <code>afex_aov</code> are available:
<code>afex_aov-methods</code>
</p>
<p><code>nice</code> creates the nice ANOVA tables which is by default printed.
See also there for a slightly longer discussion of the available effect
sizes.
</p>
<p><code>mixed</code> provides a (formula) interface for obtaining p-values for
mixed-models via <span class="pkg">lme4</span>. The functions presented here do not estimate
mixed models.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
##########################
## 1: Specifying ANOVAs ##
##########################

# Example using a purely within-subjects design 
# (Maxwell &amp; Delaney, 2004, Chapter 12, Table 12.5, p. 578):
data(md_12.1)
aov_ez("id", "rt", md_12.1, within = c("angle", "noise"), 
       anova_table=list(correction = "none", es = "none"))

# Default output
aov_ez("id", "rt", md_12.1, within = c("angle", "noise"))       


# examples using obk.long (see ?obk.long), a long version of the OBrienKaiser
# dataset (car package). Data is a split-plot or mixed design: contains both
# within- and between-subjects factors.
data(obk.long, package = "afex")

# estimate mixed ANOVA on the full design:
aov_car(value ~ treatment * gender + Error(id/(phase*hour)), 
        data = obk.long, observed = "gender")

aov_4(value ~ treatment * gender + (phase*hour|id), 
        data = obk.long, observed = "gender")

aov_ez("id", "value", obk.long, between = c("treatment", "gender"), 
        within = c("phase", "hour"), observed = "gender")

# the three calls return the same ANOVA table:
# Anova Table (Type 3 tests)
# 
# Response: value
#                         Effect          df   MSE         F  ges p.value
# 1                    treatment       2, 10 22.81    3.94 + .198    .055
# 2                       gender       1, 10 22.81    3.66 + .115    .085
# 3             treatment:gender       2, 10 22.81      2.86 .179    .104
# 4                        phase 1.60, 15.99  5.02 16.13 *** .151   &lt;.001
# 5              treatment:phase 3.20, 15.99  5.02    4.85 * .097    .013
# 6                 gender:phase 1.60, 15.99  5.02      0.28 .003    .709
# 7       treatment:gender:phase 3.20, 15.99  5.02      0.64 .014    .612
# 8                         hour 1.84, 18.41  3.39 16.69 *** .125   &lt;.001
# 9               treatment:hour 3.68, 18.41  3.39      0.09 .002    .979
# 10                 gender:hour 1.84, 18.41  3.39      0.45 .004    .628
# 11       treatment:gender:hour 3.68, 18.41  3.39      0.62 .011    .641
# 12                  phase:hour 3.60, 35.96  2.67      1.18 .015    .335
# 13        treatment:phase:hour 7.19, 35.96  2.67      0.35 .009    .930
# 14           gender:phase:hour 3.60, 35.96  2.67      0.93 .012    .449
# 15 treatment:gender:phase:hour 7.19, 35.96  2.67      0.74 .019    .646
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘+’ 0.1 ‘ ’ 1
# 
# Sphericity correction method: GG 

# "numeric" variables are per default converted to factors (as long as factorize
# = TRUE):
obk.long$hour2 &lt;- as.numeric(as.character(obk.long$hour))

# gives same results as calls before
aov_car(value ~ treatment * gender + Error(id/phase*hour2), 
        data = obk.long, observed = c("gender"))


# ANCOVA: adding a covariate (necessary to set factorize = FALSE)
aov_car(value ~ treatment * gender + age + Error(id/(phase*hour)), 
        data = obk.long, observed = c("gender", "age"), factorize = FALSE)

aov_4(value ~ treatment * gender + age + (phase*hour|id), 
        data = obk.long, observed = c("gender", "age"), factorize = FALSE)

aov_ez("id", "value", obk.long, between = c("treatment", "gender"), 
        within = c("phase", "hour"), covariate = "age", 
        observed = c("gender", "age"), factorize = FALSE)


# aggregating over one within-subjects factor (phase), with warning:
aov_car(value ~ treatment * gender + Error(id/hour), data = obk.long, 
        observed = "gender")

aov_ez("id", "value", obk.long, c("treatment", "gender"), "hour", 
       observed = "gender")

# aggregating over both within-subjects factors (again with warning),
# only between-subjects factors:
aov_car(value ~ treatment * gender + Error(id), data = obk.long, 
        observed = c("gender"))
aov_4(value ~ treatment * gender + (1|id), data = obk.long, 
      observed = c("gender"))
aov_ez("id", "value", obk.long, between = c("treatment", "gender"), 
       observed = "gender")

# only within-subject factors (ignoring between-subjects factors)
aov_car(value ~ Error(id/(phase*hour)), data = obk.long)
aov_4(value ~ (phase*hour|id), data = obk.long)
aov_ez("id", "value", obk.long, within = c("phase", "hour"))

### changing defaults of ANOVA table:

# no df-correction &amp; partial eta-squared:
aov_car(value ~ treatment * gender + Error(id/(phase*hour)), 
        data = obk.long, anova_table = list(correction = "none", es = "pes"))

# no df-correction and no MSE
aov_car(value ~ treatment * gender + Error(id/(phase*hour)), 
        data = obk.long,observed = "gender", 
        anova_table = list(correction = "none", MSE = FALSE))

# add p-value adjustment for all effects (see Cramer et al., 2015, PB&amp;R)
aov_ez("id", "value", obk.long, between = "treatment", 
       within = c("phase", "hour"), 
       anova_table = list(p_adjust_method = "holm"))


###########################
## 2: Follow-up Analysis ##
###########################

# use data as above
data(obk.long, package = "afex")

# 1. obtain afex_aov object:
a1 &lt;- aov_ez("id", "value", obk.long, between = c("treatment", "gender"), 
        within = c("phase", "hour"), observed = "gender")


if (requireNamespace("ggplot2") &amp; requireNamespace("emmeans")) {
# 1b. plot data using afex_plot function, for more see: 
## vignette("afex_plot_introduction", package = "afex")

## default plot uses multivariate model-based CIs
afex_plot(a1, "hour", "gender", c("treatment", "phase"))

  
a1b &lt;- aov_ez("id", "value", obk.long, between = c("treatment", "gender"), 
        within = c("phase", "hour"), observed = "gender", 
        include_aov = TRUE)
## you can use a univariate model and CIs if you refit the model with the aov
## slot
afex_plot(a1b, "hour", "gender", c("treatment", "phase"), 
          emmeans_arg = list(model = "univariate"))

## in a mixed between-within designs, no error-bars might be preferrable:
afex_plot(a1, "hour", "gender", c("treatment", "phase"), error = "none")
}

if (requireNamespace("emmeans")) {
library("emmeans")  # package emmeans needs to be attached for follow-up tests.

# 2. obtain reference grid object (default uses multivariate model):
r1 &lt;- emmeans(a1, ~treatment +phase)
r1

# 3. create list of contrasts on the reference grid:
c1 &lt;- list(
  A_B_pre = c(rep(0, 6), 0, -1, 1),  # A versus B for pretest
  A_B_comb = c(-0.5, 0.5, 0, -0.5, 0.5, 0, 0, 0, 0), # A vs. B for post and follow-up combined
  effect_post = c(0, 0, 0, -1, 0.5, 0.5, 0, 0, 0), # control versus A&amp;B post
  effect_fup = c(-1, 0.5, 0.5, 0, 0, 0, 0, 0, 0), # control versus A&amp;B follow-up
  effect_comb = c(-0.5, 0.25, 0.25, -0.5, 0.25, 0.25, 0, 0, 0) # control versus A&amp;B combined
)

# 4. test contrasts on reference grid:
contrast(r1, c1)

# same as before, but using Bonferroni-Holm correction for multiple testing:
contrast(r1, c1, adjust = "holm")

# 2. (alternative): all pairwise comparisons of treatment:
emmeans(a1, "treatment", contr = "pairwise")
}

#######################
## 3: Other examples ##
#######################
data(obk.long, package = "afex")

# replicating ?Anova using aov_car:
obk_anova &lt;- aov_car(value ~ treatment * gender + Error(id/(phase*hour)), 
        data = obk.long, type = 2)
# in contrast to aov you do not need the within-subject factors outside Error()

str(obk_anova, 1, give.attr = FALSE)
# List of 5
#  $ anova_table:Classes ‘anova’ and 'data.frame':	15 obs. of  6 variables:
#  $ aov        : NULL
#  $ Anova      :List of 14
#  $ lm         :List of 13
#  $ data       :List of 3

obk_anova$Anova
# Type II Repeated Measures MANOVA Tests: Pillai test statistic
#                             Df test stat approx F num Df den Df    Pr(&gt;F)    
# (Intercept)                  1   0.96954   318.34      1     10 6.532e-09 ***
# treatment                    2   0.48092     4.63      2     10 0.0376868 *  
# gender                       1   0.20356     2.56      1     10 0.1409735    
# treatment:gender             2   0.36350     2.86      2     10 0.1044692    
# phase                        1   0.85052    25.61      2      9 0.0001930 ***
# treatment:phase              2   0.68518     2.61      4     20 0.0667354 .  
# gender:phase                 1   0.04314     0.20      2      9 0.8199968    
# treatment:gender:phase       2   0.31060     0.92      4     20 0.4721498    
# hour                         1   0.93468    25.04      4      7 0.0003043 ***
# treatment:hour               2   0.30144     0.35      8     16 0.9295212    
# gender:hour                  1   0.29274     0.72      4      7 0.6023742    
# treatment:gender:hour        2   0.57022     0.80      8     16 0.6131884    
# phase:hour                   1   0.54958     0.46      8      3 0.8324517    
# treatment:phase:hour         2   0.66367     0.25     16      8 0.9914415    
# gender:phase:hour            1   0.69505     0.85      8      3 0.6202076    
# treatment:gender:phase:hour  2   0.79277     0.33     16      8 0.9723693    
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

</code></pre>


</div>