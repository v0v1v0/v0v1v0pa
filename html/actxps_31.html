<div class="container">

<table style="width: 100%;"><tr>
<td>exp_shiny</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Interactively explore experience data</h2>

<h3>Description</h3>

<p>Launch a Shiny application to interactively explore drivers of
experience.
</p>
<p><code>dat</code> must be an <code>exposed_df</code> object. An error will be thrown is any other
object type is passed. If <code>dat</code> has transactions attached, the app will
contain features for both termination and transaction studies. Otherwise,
the app will only support termination studies.
</p>
<p>If nothing is passed to <code>predictors</code>, all columns names in <code>dat</code> will be
used (excluding the policy number, status, termination date, exposure,
transaction counts, and transaction amounts columns).
</p>
<p>The <code>expected</code> argument is optional. As a default, any column names
containing the word "expected" are used.
</p>


<h3>Usage</h3>

<pre><code class="language-R">exp_shiny(
  dat,
  predictors = names(dat),
  expected = names(dat)[grepl("expected", names(dat))],
  distinct_max = 25L,
  title,
  credibility = TRUE,
  conf_level = 0.95,
  cred_r = 0.05,
  theme = "shiny",
  col_exposure = "exposure"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>An <code>exposed_df</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictors</code></td>
<td>
<p>A character vector of independent variables in <code>dat</code> to
include in the Shiny app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expected</code></td>
<td>
<p>A character vector of expected values in <code>dat</code> to include
in the Shiny app.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distinct_max</code></td>
<td>
<p>Maximum number of distinct values allowed for
<code>predictors</code> to be included as "Color" and "Facets" grouping variables. This
input prevents the drawing of overly complex plots. Default value = 25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>Optional. Title of the Shiny app. If no title is provided,
a descriptive title will be generated based on attributes of <code>dat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>credibility</code></td>
<td>
<p>If <code>TRUE</code>, the output will include partial credibility
weights and credibility-weighted termination rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf_level</code></td>
<td>
<p>Confidence level used for the Limited Fluctuation
credibility method and confidence intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cred_r</code></td>
<td>
<p>Error tolerance under the Limited Fluctuation credibility
method</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theme</code></td>
<td>
<p>The name of a theme passed to the <code>preset</code> argument of
<code>bslib::bs_theme()</code>. Alternatively, a complete Bootstrap theme created using
<code>bslib::bs_theme()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_exposure</code></td>
<td>
<p>Name of the column in <code>dat</code> containing exposures. This
input is only used to clarify the exposure basis when <code>dat</code> is a
<code>split_exposed_df</code> object. For more information on split exposures, see
<code>expose_split()</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>No return value. This function is called for the side effect of
launching a Shiny application.
</p>


<h3>Layout</h3>



<h4>Filters</h4>

<p>The sidebar contains filtering widgets organized by data type for all
variables passed to the <code>predictors</code> argument.
</p>
<p>At the top of the sidebar, information is shown on the percentage of records
remaining after applying filters. A description of all active filters is also
provided.
</p>
<p>The top of the sidebar also includes a "play / pause" switch that can pause
reactivity of the application. Pausing is a good option when multiple changes
are made in quick succession, especially when the underlying data set is
large.
</p>



<h4>Grouping variables</h4>

<p>This box includes widgets to select grouping variables for summarizing
experience. The "x" widget determines the x variable in the plot output.
Similarly, the "Color" and "Facets" widgets are used for color and facets.
Multiple faceting variable selections are allowed. For the table output,
"x", "Color", and "Facets" have no particular meaning beyond the order in
which grouping variables are displayed.
</p>



<h4>Study type</h4>

<p>This box includes a toggle to switch between termination studies and
transaction studies (if available). Different options are available for each
study type.
</p>


<h5>Termination studies</h5>

<p>The expected values checkboxes are used to activate and deactivate expected
values passed to the <code>expected</code> argument. This impacts the table output
directly and the available "y" variables for the plot. If there are no
expected values available, this widget will not appear. The "Weight by"
widget is used to specify which column, if any, contains weights for
summarizing experience.
</p>



<h5>Transaction studies</h5>

<p>The transaction types checkboxes are used to activate and deactivate
transaction types that appear in the plot and table outputs. The available
transaction types are taken from the <code>trx_types</code> attribute of <code>dat</code>.
In the plot output, transaction type will always appear as a faceting
variable. The "Transactions as % of" selector will expand the list of
available "y" variables for the plot and impact the table output directly.
Lastly, a toggle exists that allows for all transaction types to be
aggregated into a single group.
</p>




<h4>Output</h4>



<h5>Plot</h5>

<p>This tab includes a plot and various options for customization:
</p>

<ul>
<li>
<p> y: y variable
</p>
</li>
<li>
<p> Geometry: plotting geometry
</p>
</li>
<li>
<p> Second y-axis: activate to enable a second y-axis
</p>
</li>
<li>
<p> Second axis y: y variable to plot on the second axis
</p>
</li>
<li>
<p> Add Smoothing: activate to plot loess curves
</p>
</li>
<li>
<p> Confidence intervals: If available, add error bars for confidence intervals
around the selected y variable
</p>
</li>
<li>
<p> Free y Scales: activate to enable separate y scales in each plot
</p>
</li>
<li>
<p> Log y-axis: activate to plot all y-axes on a log-10 scale
</p>
</li>
</ul>
<p>The gear icon above the plot contains a pop-up menu that can be used to
change the size of the plot for exporting.
</p>



<h5>Table</h5>

<p>This tab includes a data table.
</p>
<p>The gear icon above the table contains a pop-up menu that can be used to
change the appearance of the table:
</p>

<ul>
<li>
<p> The "Confidence intervals" and "Credibility-weighted termination rates"
switches add these outputs to the table. These values are hidden as a default
to prevent over-crowding.
</p>
</li>
<li>
<p> The "Include color scales" switch disables or re-enables conditional color
formatting.
</p>
</li>
<li>
<p> The "Decimals" slider controls the number of decimals displayed for
percentage fields.
</p>
</li>
<li>
<p> The "Font size multiple" slider impacts the table's font size
</p>
</li>
</ul>
<h5>Export</h5>

<p>This pop-up menu contains options for saving summarized experience data, the
plot, or the table. Data is saved as a CSV file. The plot and table are saved
as png files.
</p>




<h3>Examples</h3>

<pre><code class="language-R">
if (interactive()) {
  study_py &lt;- expose_py(census_dat, "2019-12-31", target_status = "Surrender")
  expected_table &lt;- c(seq(0.005, 0.03, length.out = 10),
                      0.2, 0.15, rep(0.05, 3))

  study_py &lt;- study_py |&gt;
    mutate(expected_1 = expected_table[pol_yr],
           expected_2 = ifelse(inc_guar, 0.015, 0.03)) |&gt;
    add_transactions(withdrawals) |&gt;
    left_join(account_vals, by = c("pol_num", "pol_date_yr"))

  exp_shiny(study_py)
}

</code></pre>


</div>