<div class="container">

<table style="width: 100%;"><tr>
<td>az_resource</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Azure resource class</h2>

<h3>Description</h3>

<p>Class representing a generic Azure resource.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_resource</code>.
</p>


<h3>Methods</h3>


<ul>
<li> <p><code>new(...)</code>: Initialize a new resource object. See 'Initialization' for more details.
</p>
</li>
<li> <p><code>delete(confirm=TRUE, wait=FALSE)</code>: Delete this resource, after a confirmation check. Optionally wait for the delete to finish.
</p>
</li>
<li> <p><code>update(...)</code>: Update this resource on the host.
</p>
</li>
<li> <p><code>sync_fields()</code>: Synchronise the R object with the resource it represents in Azure. Returns the <code>properties$provisioningState</code> field, so you can query this programmatically to check if a resource has finished provisioning. Not all resource types require explicit provisioning, in which case this method will return NULL.
</p>
</li>
<li> <p><code>set_api_version(api_version, stable_only=TRUE)</code>: Set the API version to use when interacting with the host. If <code>api_version</code> is not supplied, use the latest version available, either the latest stable version (if <code>stable_only=TRUE</code>) or the latest preview version (if <code>stable_only=FALSE</code>).
</p>
</li>
<li> <p><code>get_api_version()</code>: Get the current API version.
</p>
</li>
<li> <p><code>get_subresource(type, name)</code>: Get a sub-resource of this resource. See 'Sub-resources' below.
</p>
</li>
<li> <p><code>create_subresource(type, name, ...)</code>: Create a sub-resource of this resource.
</p>
</li>
<li> <p><code>delete_subresource(type, name, confirm=TRUE)</code>: Delete a sub-resource of this resource.
</p>
</li>
<li> <p><code>do_operation(...)</code>: Carry out an operation. See 'Operations' for more details.
</p>
</li>
<li> <p><code>set_tags(..., keep_existing=TRUE)</code>: Set the tags on this resource. The tags can be either names or name-value pairs. To delete a tag, set it to <code>NULL</code>.
</p>
</li>
<li> <p><code>get_tags()</code>: Get the tags on this resource.
</p>
</li>
<li> <p><code>create_lock(name, level)</code>: Create a management lock on this resource.
</p>
</li>
<li> <p><code>get_lock(name)</code>: Returns a management lock object.
</p>
</li>
<li> <p><code>delete_lock(name)</code>: Deletes a management lock object.
</p>
</li>
<li> <p><code>list_locks()</code>: List all locks that apply to this resource. Note this includes locks created at the subscription or resource group level.
</p>
</li>
<li> <p><code>add_role_assignment(name, ...)</code>: Adds a new role assignment. See 'Role-based access control' below.
</p>
</li>
<li> <p><code>get_role_assignment(id)</code>: Retrieves an existing role assignment.
</p>
</li>
<li> <p><code>remove_role_assignment(id)</code>: Removes an existing role assignment.
</p>
</li>
<li> <p><code>list_role_assignments()</code>: Lists role assignments.
</p>
</li>
<li> <p><code>get_role_definition(id)</code>: Retrieves an existing role definition.
</p>
</li>
<li> <p><code>list_role_definitions()</code> Lists role definitions.
</p>
</li>
</ul>
<h3>Initialization</h3>

<p>There are multiple ways to initialize a new resource object. The <code>new()</code> method can retrieve an existing resource, deploy/create a new resource, or create an empty/null object (without communicating with the host), based on the arguments you supply.
</p>
<p>All of these initialization options have the following arguments in common.
</p>

<ol>
<li> <p><code>token</code>: An OAuth 2.0 token, as generated by get_azure_token.
</p>
</li>
<li> <p><code>subscription</code>: The subscription ID.
</p>
</li>
<li> <p><code>api_version</code>: Optionally, the API version to use when interacting with the host. By default, this is NULL in which case the latest API version will be used.
</p>
</li>
<li>
<p> A set of <em>identifying arguments</em>:
</p>

<ul>
<li> <p><code>resource_group</code>: The resource group containing the resource.
</p>
</li>
<li> <p><code>id</code>: The full ID of the resource. This is a string of the form <code style="white-space: pre;">⁠/subscriptions/{uuid}/resourceGroups/{resource-group-name}/provider/{resource-provider-name}/{resource-path}/{resource-name}⁠</code>.
</p>
</li>
<li> <p><code>provider</code>: The provider of the resource, eg <code>Microsoft.Compute</code>.
</p>
</li>
<li> <p><code>path</code>: The path to the resource, eg <code>virtualMachines</code>.
</p>
</li>
<li> <p><code>type</code>: The combination of provider and path, eg <code>Microsoft.Compute/virtualMachines</code>.
</p>
</li>
<li> <p><code>name</code>: The name of the resource instance, eg <code>myWindowsVM</code>.
</p>
</li>
</ul>
</li>
</ol>
<p>Providing <code>id</code> will fill in the values for all the other identifying arguments. Similarly, providing <code>type</code> will fill in the values for <code>provider</code> and <code>path</code>. Unless you provide <code>id</code>, you must also provide <code>name</code>.
</p>
<p>The default behaviour for <code>new()</code> is to retrieve an existing resource, which occurs if you supply only the arguments listed above. If you also supply an argument <code>deployed_properties=NULL</code>, this will create a null object. If you supply any other (named) arguments, <code>new()</code> will create a new object on the host, with the supplied arguments as parameters.
</p>
<p>Generally, the easiest way to initialize an object is via the <code>get_resource</code>, <code>create_resource</code> or <code>list_resources</code> methods of the az_resource_group class, which will handle all the gory details automatically.
</p>


<h3>Operations</h3>

<p>The <code>do_operation()</code> method allows you to carry out arbitrary operations on the resource. It takes the following arguments:
</p>

<ul>
<li> <p><code>op</code>: The operation in question, which will be appended to the URL path of the request.
</p>
</li>
<li> <p><code>options</code>: A named list giving the URL query parameters.
</p>
</li>
<li> <p><code>...</code>: Other named arguments passed to call_azure_rm, and then to the appropriate call in httr. In particular, use <code>body</code> to supply the body of a PUT, POST or PATCH request.
</p>
</li>
<li> <p><code>http_verb</code>: The HTTP verb as a string, one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, <code>HEAD</code> or <code>PATCH</code>.
</p>
</li>
</ul>
<p>Consult the Azure documentation for your resource to find out what operations are supported.
</p>


<h3>Sub-resources</h3>

<p>Some resource types can have sub-resources: objects exposed by Resource Manager that make up a part of their parent's functionality. For example, a storage account (type <code>Microsoft.Storage/storageAccounts</code>) provides the blob storage service, which can be accessed via Resource Manager as a sub-resource of type <code>Microsoft.Storage/storageAccounts/blobServices/default</code>.
</p>
<p>To retrieve an existing sub-resource, use the <code>get_subresource()</code> method. You do not need to include the parent resource's type and name. For example, if <code>res</code> is a resource for a storage account, and you want to retrieve the sub-resource for the blob container "myblobs", call
</p>
<div class="sourceCode"><pre>res$get_subresource(type="blobServices/default/containers", name="myblobs")
</pre></div>
<p>Notice that the storage account's resource type and name are omitted from the <code>get_subresource</code> arguments. Similarly, to create a new subresource, call the <code>create_subresource()</code> method with the same naming convention, passing any required fields as named arguments; and to delete it, call <code>delete_subresource()</code>.
</p>


<h3>Role-based access control</h3>

<p>AzureRMR implements a subset of the full RBAC functionality within Azure Active Directory. You can retrieve role definitions and add and remove role assignments, at the subscription, resource group and resource levels. See rbac for more information.
</p>


<h3>See Also</h3>

<p>az_resource_group, call_azure_rm, call_azure_url,
<a href="https://learn.microsoft.com/en-us/rest/api/resources/resources">Resources API reference</a>
</p>
<p>For role-based access control methods, see rbac
</p>
<p>For management locks, see lock
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

# recommended way to retrieve a resource: via a resource group object
# storage account:
stor &lt;- resgroup$get_resource(type="Microsoft.Storage/storageAccounts", name="mystorage")
# virtual machine:
vm &lt;- resgroup$get_resource(type="Microsoft.Compute/virtualMachines", name="myvm")

## carry out operations on a resource

# storage account: get access keys
stor$do_operation("listKeys", http_verb="POST")

# virtual machine: run a script
vm$do_operation("runCommand",
    body=list(
        commandId="RunShellScript", # RunPowerShellScript for Windows
        script=as.list("ifconfig &gt; /tmp/ifconfig.out")
    ),
    encode="json",
    http_verb="POST")

## retrieve properties

# storage account: endpoint URIs
stor$properties$primaryEndpoints$file
stor$properties$primaryEndpoints$blob

# virtual machine: hardware profile
vm$properties$hardwareProfile

## update a resource: resizing a VM
properties &lt;- list(hardwareProfile=list(vmSize="Standard_DS3_v2"))
vm$do_operation(http_verb="PATCH",
    body=list(properties=properties),
    encode="json")

# sync with Azure: useful to track resource creation/update status
vm$sync_fields()

## subresource: create a public blob container
stor$create_subresource(type="blobservices/default/containers", name="mycontainer",
    properties=list(publicAccess="container"))

## delete a subresource and resource
stor$delete_subresource(type="blobservices/default/containers", name="mycontainer")
stor$delete()


## End(Not run)
</code></pre>


</div>