<div class="container">

<table style="width: 100%;"><tr>
<td>apollo_combineModels</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Combines separate model components.</h2>

<h3>Description</h3>

<p>Combines model components to create likelihood for overall model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">apollo_combineModels(
  P,
  apollo_inputs,
  functionality,
  components = NULL,
  asList = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p>List of vectors, matrices or 3-dim arrays. Likelihood of the model components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function apollo_validateInputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>functionality</code></td>
<td>
<p>Character. Setting instructing Apollo what processing to apply to the likelihood function. This is in general controlled by the functions that call <code>apollo_probabilities</code>, though the user can also call <code>apollo_probabilities</code> manually with a given functionality for testing/debugging. Possible values are:
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: For further processing/debugging, produces likelihood for each model component (if multiple components are present), at the level of individual draws and observations.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: For conditionals, produces likelihood of the full model, at the level of individual inter-individual draws.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: For model estimation, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: For model estimation, produces analytical gradients of the likelihood, where possible.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Prepares output for post-estimation reporting.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: For model prediction, produces probabilities for individual alternatives and individual model components (if multiple components are present) at the level of an observation, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Prepares likelihood functions for use in estimation.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: For debugging, produces probabilities of all alternatives and individual model components at the level of an observation, at the level of individual draws.
</p>
</li>
<li> <p><strong><code>"report"</code></strong>: Prepares output summarising model and choiceset structure.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Produces overall model likelihood with constants only.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Validates model specification, produces likelihood of the full model, at the level of individual decision-makers, after averaging across draws.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Produces overall model likelihood with all parameters at zero.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>components</code></td>
<td>
<p>Character vector. Optional argument. Names of elements in P that should be multiplied to construct the whole model likelihood. If a single element is provided, it is interpreted as a regular expression. Default is to include all components in P.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asList</code></td>
<td>
<p>Logical. Only used if <code>functionality</code> is <code>"conditionals","estimate","validate","zero_LL"</code> or <code>"output"</code>. If <code>TRUE</code>, it will return a list as described in the 'Value' section. If <code>FALSE</code>, it will only return a vector/matrix/3-dim array of the product of likelihoods inside P. Default is <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function should be called inside apollo_probabilities after all model components have been produced.
</p>
<p>It should be called before apollo_avgInterDraws, apollo_avgIntraDraws, apollo_panelProd and apollo_prepareProb, whichever apply, except where these functions are called inside any latent class components of the overall model.
</p>


<h3>Value</h3>

<p>Argument <code>P</code> with (for most functionalities) an extra element called "model", which is the product of all the other elements. Shape depends on argument <code>functionality</code>.
</p>

<ul>
<li> <p><strong><code>"components"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"conditionals"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"estimate"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"gradient"</code></strong>: Returns <code>P</code> containing the gradient of the likelihood after applying the product rule across model components.
</p>
</li>
<li> <p><strong><code>"output"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"prediction"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"preprocess"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"raw"</code></strong>: Returns <code>P</code> without changes.
</p>
</li>
<li> <p><strong><code>"shares_LL"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"validate"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
<li> <p><strong><code>"zero_LL"</code></strong>: Returns <code>P</code> with an extra component called <code>"model"</code>, which is the product of all other elements of <code>P</code>.
</p>
</li>
</ul>
</div>