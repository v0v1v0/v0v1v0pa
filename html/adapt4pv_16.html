<div class="container">

<table style="width: 100%;"><tr>
<td>ps_pond</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>weihting on propensity score</h2>

<h3>Description</h3>

<p>Implement the weighting on propensity score with Matching Weights (MW)
or the Inverse Probability of Treatment Weighting (IPTW) for all the
drug exposures of the input drug matrix <code>x</code> which have more
than a given number of co-occurence with the outcome.
The binary outcome is regressed on a drug exposure through a
classical weighted regression, for each drug exposure
considered after filtering.
With this approach, a p-value is obtained for each drug and a
variable selection is performed over the corrected for multiple
comparisons p-values.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ps_pond(
  x,
  y,
  n_min = 3,
  betaPos = TRUE,
  weights_type = c("mw", "iptw"),
  truncation = FALSE,
  q = 0.025,
  est_type = "bic",
  threshold = 0.05,
  ncore = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Input matrix, of dimension nobs x nvars. Each row is an observation
vector. Can be in sparse matrix format (inherit from class
<code>"sparseMatrix"</code> as in package <code>Matrix</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Binary response variable, numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_min</code></td>
<td>
<p>Numeric, Minimal number of co-occurence between a drug covariate
and the outcome y to estimate its score. See details belows.
Default is 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>betaPos</code></td>
<td>
<p>Should the covariates selected by the procedure be
positively associated with the outcome ? Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights_type</code></td>
<td>
<p>Character. Indicates which type of weighting
is implemented. Could be either "mw" or "iptw".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>truncation</code></td>
<td>
<p>Bouleen, should we do weight truncation?
Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>If <code>truncation</code> is <code>TRUE</code>, quantile value for
weight truncation. Ignored if <code>truncation</code> is <code>FALSE</code>.
Default is 2.5 <code class="reqn">\%</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est_type</code></td>
<td>
<p>Character, indicates which approach is used to estimate
the propensity score.
Could be either "bic", "hdps" or "xgb".
Default is "bic".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>Threshold for the p-values. Default is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncore</code></td>
<td>
<p>The number of calcul units used for parallel computing.
Default is 1, no parallelization is implemented.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The MW are defined by
</p>
<p style="text-align: center;"><code class="reqn">mw_i = min(PS_i, 1-PS_i)/[(expo_i) * PS_i + (1-expo_i) * (1-PS_i) ] </code>
</p>

<p>and weights from IPTW by
</p>
<p style="text-align: center;"><code class="reqn">iptw_i = expo_i/PS_i + (1-expo_i)/(1-PS_i)  </code>
</p>

<p>where <code class="reqn">expo_i</code> is the drug exposure indicator.
The PS could be estimated in different ways: using lasso-bic approach,
the hdps algorithm or gradient tree boosting.
The scores are estimated using the default parameter values of
<code>est_ps_bic</code>, <code>est_ps_hdps</code> and <code>est_ps_xgb</code> functions
(see documentation for details).
We apply the same filter and the same multiple testing correction as in
the paper UPCOMING REFERENCE: first, PS are estimated only for drug covariates which have
more than <code>n_min</code> co-occurence with the outcome <code>y</code>.
Adjustment on the PS is performed for these covariates and
one sided or two-sided (depend on <code>betaPos</code> parameter)
p-values are obtained.
The p-values of the covariates not retained after filtering are set to 1.
All these p-values are then adjusted for multiple comparaison with the
Benjamini-Yekutieli correction.
COULD BE VERY LONG. Since this approach (i) estimate a score for several
drug covariates and (ii) perform an adjustment on these scores,
parallelization is highly recommanded.
</p>


<h3>Value</h3>

<p>An object with S3 class <code>"ps", "*" ,"**" </code>,
where <code>"*"</code> is <code>"mw"</code> or <code>"iptw"</code>, same as the
input parameter <code>weights_type</code>, and <code>"**"</code> is
<code>"bic"</code>, <code>"hdps"</code> or <code>"xgb"</code> according on how the
score was estimated.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>estimates</code></td>
<td>
<p>Regression coefficients associated with
the drug covariates. Numeric, length equal to the number of selected
variables with this approach.
Some elements could be NA if
(i) the corresponding covariate was filtered out,
(ii) weigted regression did not converge. Trying to estimate
the score in a different way could help, but it's not insured.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corrected_pvals</code></td>
<td>
<p>One sided p-values if <code>betaPos = TRUE</code>,
two-sided p-values if <code>betaPos = FALSE</code> adjusted for multiple testing.
Numeric, length equal to nvars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selected_variables</code></td>
<td>
<p>Character vector, names of variable(s)
selected with the weighting on PS based approach.
If <code>betaPos = TRUE</code>, this set is the covariates with a
corrected one-sided p-value lower than <code>threshold</code>.
Else this set is the covariates with a
corrected two-sided p-value lower than <code>threshold</code>.
Covariates are ordering according to their corrected p-value.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Emeline Courtois <br> Maintainer: Emeline Courtois
<a href="mailto:emeline.courtois@inserm.fr">emeline.courtois@inserm.fr</a>
</p>


<h3>References</h3>

<p>Benjamini, Y., &amp; Yekuteli, D. (2001). "The Control of the False Discovery Rate in Multiple Testing under Dependency".
<em>The Annals of Statistics</em>. 29(4), 1165â€“1188, doi: <a href="https://doi.org/10.1214/aos/1013699998">doi:10.1214/aos/1013699998</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(15)
drugs &lt;- matrix(rbinom(100*20, 1, 0.2), nrow = 100, ncol = 20)
colnames(drugs) &lt;- paste0("drugs",1:ncol(drugs))
ae &lt;- rbinom(100, 1, 0.3)
pondps &lt;- ps_pond(x = drugs, y = ae, n_min = 10, weights_type = "iptw")


</code></pre>


</div>