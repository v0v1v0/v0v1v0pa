<div class="container">

<table style="width: 100%;"><tr>
<td>ppca</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Phylogenetic principal component analysis</h2>

<h3>Description</h3>

<p>These functions are designed to perform a phylogenetic principal component 
analysis (pPCA, Jombart et al. 2010) and to display the results.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ppca(
  x,
  prox = NULL,
  method = c("patristic", "nNodes", "oriAbouheif", "Abouheif", "sumDD"),
  f = function(x) {
     1/x
 },
  center = TRUE,
  scale = TRUE,
  scannf = TRUE,
  nfposi = 1,
  nfnega = 0
)

## S3 method for class 'ppca'
scatter(x, axes = 1:ncol(x$li), useLag = FALSE, ...)

## S3 method for class 'ppca'
print(x, ...)

## S3 method for class 'ppca'
summary(object, ..., printres = TRUE)

## S3 method for class 'ppca'
screeplot(x, ..., main = NULL)

## S3 method for class 'ppca'
plot(x, axes = 1:ncol(x$li), useLag = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a phylo4d object (for <code>ppca</code>) or a ppca object 
(for other methods).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prox</code></td>
<td>
<p>a marix of phylogenetic proximities as returned by 
<code>proxTips</code>. If not provided, this matrix will be constructed 
using the arguments <code>method</code> and <code>a</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string (full or abbreviated without ambiguity) 
specifying the method used to compute proximities; possible values are:<br>
- <code>patristic</code>: (inversed sum of) branch lengths <br> - <code>nNodes</code>: 
(inversed) number of nodes on the path between the nodes <br> - 
<code>oriAbouheif</code>: original Abouheif's proximity, with diagonal (see 
details in <code>proxTips</code>) <br> - <code>Abouheif</code>: Abouheif's 
proximity (see details in <code>proxTips</code>) <br> - <code>sumDD</code>: 
(inversed) sum of direct descendants of all nodes on the path (see details 
in <code>proxTips</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>a function to change a distance into a proximity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>a logical indicating whether traits should be centred to mean 
zero (TRUE, default) or not (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>a logical indicating whether traits should be scaled to unit 
variance (TRUE, default) or not (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scannf</code></td>
<td>
<p>a logical stating whether eigenvalues should be chosen 
interactively (TRUE, default) or not (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfposi</code></td>
<td>
<p>an integer giving the number of positive eigenvalues retained 
('global structures').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfnega</code></td>
<td>
<p>an integer giving the number of negative eigenvalues retained 
('local structures').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axes</code></td>
<td>
<p>the index of the principal components to be represented.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useLag</code></td>
<td>
<p>a logical stating whether the lagged components (<code>x\$ls</code>) 
should be used instead of the components (<code>x\$li</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to other methods. Can be used to 
provide arguments to <code>table.phylo4d</code> in <code>plot</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>a <code>ppca</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printres</code></td>
<td>
<p>a logical stating whether results should be printed on the 
screen (TRUE, default) or not (FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>a title for the screeplot; if NULL, a default one is used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ppca</code> performs the phylogenetic component analysis. Other functions 
are:<br></p>
<p>- <code>print.ppca</code>: prints the ppca content<br></p>
<p>- <code>summary.ppca</code>: provides useful information about a ppca object, 
including the decomposition of eigenvalues of all axes<br></p>
<p>- <code>scatter.ppca</code>: plot principal components using 
<code>table.phylo4d</code><br></p>
<p>- <code>screeplot.ppca</code>: graphical display of the decomposition of pPCA 
eigenvalues<br></p>
<p>- <code>plot.ppca</code>: several graphics describing a ppca object<br></p>
<p>The phylogenetic Principal Component Analysis (pPCA, Jombart et al., 2010) is
derived from the spatial Principal Component Analysis (spca, Jombart et al.
2008), implemented in the adegenet package (see 
<code>spca</code>).<br></p>
<p>pPCA is designed to investigate phylogenetic patterns a set of quantitative 
traits. The analysis returns principal components maximizing the product of 
variance of the scores and their phylogenetic autocorrelation (Moran's I), 
therefore reflecting life histories that are phylogenetically structured. 
Large positive and large negative eigenvalues correspond to global and local 
structures.<br></p>


<h3>Value</h3>

<p>The class <code>ppca</code> are given to lists with the following 
components:<br></p>
<table>
<tr style="vertical-align: top;">
<td><code>eig</code></td>
<td>
<p>a numeric vector of eigenvalues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfposi</code></td>
<td>
<p>an integer giving the number of global structures retained.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nfnega</code></td>
<td>
<p>an integer giving the number of local structures retained.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c1</code></td>
<td>
<p>a data.frame of loadings of traits for each axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>li</code></td>
<td>
<p>a
data.frame of coordinates of taxa onto the ppca axes (i.e., principal
components).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ls</code></td>
<td>
<p>a data.frame of lagged prinpal components; useful
to represent of global scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>a data.frame giving the
coordinates of the axes of an 'ordinary' PCA onto the ppca axes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tre</code></td>
<td>
<p>a phylogenetic tre with class
phylo4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prox</code></td>
<td>
<p>a matrix of phylogenetic proximities.</p>
</td>
</tr>
</table>
<p>Other functions have different outputs:<br></p>
<p>- <code>scatter.ppca</code> returns the matched call.<br></p>


<h3>Author(s)</h3>

<p>Thibaut Jombart <a href="mailto:tjombart@imperial.ac.uk">tjombart@imperial.ac.uk</a>
</p>


<h3>References</h3>

<p>Jombart, T.; Pavoine, S.; Dufour, A. &amp; Pontier, D. (2010, in 
press) Exploring phylogeny as a source of ecological variation: a 
methodological approach. doi:10.1016/j.jtbi.2010.03.038
</p>
<p>Jombart, T., Devillard, S., Dufour, A.-B. and Pontier, D. (2008) Revealing 
cryptic phylogenetic patterns in genetic variability by a new multivariate 
method. <em>Heredity</em>, <b>101</b>, 92â€“103.
</p>


<h3>See Also</h3>

<p>The implementation of <code>spca</code> in the adegenet 
package (<code>adegenet</code>) <br></p>


<h3>Examples</h3>

<pre><code class="language-R">
data(lizards)

if(require(ape) &amp;&amp; require(phylobase)){

#### ORIGINAL EXAMPLE FROM JOMBART ET AL 2010 ####


## BUILD A TREE AND A PHYLO4D OBJECT
liz.tre &lt;- read.tree(tex=lizards$hprA)
liz.4d &lt;- phylo4d(liz.tre, lizards$traits)
oldpar &lt;- par(mar=rep(.1,4))
table.phylo4d(liz.4d,var.lab=c(names(lizards$traits),
   "ACP 1\n(\"size effect\")"),show.node=FALSE, cex.lab=1.2)


## REMOVE DUPLICATED POPULATIONS
liz.4d &lt;- prune(liz.4d, c(7,14))
table.phylo4d(liz.4d)


## CORRECT LABELS
lab &lt;- c("Pa", "Ph", "Ll", "Lmca", "Lmcy", "Phha", "Pha",
   "Pb", "Pm", "Ae", "Tt", "Ts", "Lviv", "La", "Ls", "Lvir")
tipLabels(liz.4d) &lt;- lab


## REMOVE SIZE EFFECT
dat &lt;- tdata(liz.4d, type="tip")
dat &lt;- log(dat)
newdat &lt;- data.frame(lapply(dat, function(v) residuals(lm(v~dat$mean.L))))
rownames(newdat) &lt;- rownames(dat)
tdata(liz.4d, type="tip") &lt;- newdat[,-1] # replace data in the phylo4d object


## pPCA
liz.ppca &lt;- ppca(liz.4d,scale=FALSE,scannf=FALSE,nfposi=1,nfnega=1, method="Abouheif")
liz.ppca
tempcol &lt;- rep("grey",7)
tempcol[c(1,7)] &lt;- "black"
barplot(liz.ppca$eig,main='pPCA eigenvalues',cex.main=1.8,col=tempcol)

par(mar=rep(.1,4))
plot(liz.ppca,ratio.tree=.7)


## CONTRIBUTIONS TO PC (LOADINGS) (viewed as dotcharts)
dotchart(liz.ppca$c1[,1],lab=rownames(liz.ppca$c1),main="Global principal
component 1")
abline(v=0,lty=2)

dotchart(liz.ppca$c1[,2],lab=rownames(liz.ppca$c1),main="Local principal
component 1")
abline(v=0,lty=2)


## REPRODUCE FIGURES FROM THE PAPER
obj.ppca &lt;- liz.4d
tdata(obj.ppca, type="tip") &lt;- liz.ppca$li
myLab &lt;- paste(" ",rownames(liz.ppca$li), sep="")

## FIGURE 1
par(mar=c(.1,2.4,2.1,1))
table.phylo4d(obj.ppca, ratio=.7, var.lab=c("1st global PC", "1st local
   PC"), tip.label=myLab,box=FALSE,cex.lab=1.4, cex.sym=1.2, show.node.label=TRUE)
add.scatter.eig(liz.ppca$eig,1,1,1,csub=1.2, posi="topleft", ratio=.23)


## FIGURE 2
s.arrow(liz.ppca$c1,xlim=c(-1,1),clab=1.3,cgrid=1.3)



#### ANOTHER EXAMPLE - INCLUDING NA REPLACEMENT ####
## LOAD THE DATA
data(maples)
tre &lt;- read.tree(text=maples$tre)
x &lt;- phylo4d(tre, maples$tab)
omar &lt;- par("mar")
par(mar=rep(.1,4))
table.phylo4d(x, cex.lab=.5, cex.sym=.6, ratio=.1) # note NAs in last trait ('x')

## FUNCTION TO REPLACE NAS
f1 &lt;- function(vec){
if(any(is.na(vec))){
m &lt;- mean(vec, na.rm=TRUE)
vec[is.na(vec)] &lt;- m
}
return(vec)
}


## PERFORM THE PPCA
dat &lt;- apply(maples$tab,2,f1) # replace NAs
x.noNA &lt;- phylo4d(tre, as.data.frame(dat))
map.ppca &lt;- ppca(x.noNA, scannf=FALSE, method="Abouheif")
map.ppca


## SOME GRAPHICS
screeplot(map.ppca)
scatter(map.ppca, useLag=TRUE)
plot(map.ppca, useLag=TRUE)


## MOST STRUCTURED TRAITS
a &lt;- map.ppca$c1[,1] # loadings on PC 1
names(a) &lt;- row.names(map.ppca$c1)
highContrib &lt;- a[a&lt; quantile(a,0.1) | a&gt;quantile(a,0.9)]
datSel &lt;- cbind.data.frame(dat[, names(highContrib)], map.ppca$li)
temp &lt;- phylo4d(tre, datSel)
table.phylo4d(temp) # plot of most structured traits


## PHYLOGENETIC AUTOCORRELATION TESTS FOR THESE TRAITS
prox &lt;- proxTips(tre, method="Abouheif")
abouheif.moran(dat[, names(highContrib)], prox)
par(oldpar)

}

</code></pre>


</div>