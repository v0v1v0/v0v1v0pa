<div class="container">

<table style="width: 100%;"><tr>
<td>mspa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multi-Scale Pattern Analysis</h2>

<h3>Description</h3>

<p>The multi-scale pattern analysis (MSPA, Jombart et al 2009) investigates the 
main scales of spatial variation in a multivariate dataset. This 
implementation allows one to perform a MSPA using any multivariate analysis 
(stored as a <code>dudi</code> object), and a list of spatial weights
(class <code>listw</code>) or an object of class <code>orthobasisSp</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mspa(
  dudi,
  lwORorthobasisSp,
  nblocks,
  scannf = TRUE,
  nf = 2,
  centring = c("param", "sim"),
  nperm = 999
)

## S3 method for class 'mspa'
scatter(
  x,
  xax = 1,
  yax = 2,
  posieig = "topleft",
  bary = TRUE,
  plot = TRUE,
  storeData = TRUE,
  pos = -1,
  ...
)

## S3 method for class 'mspa'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dudi</code></td>
<td>
<p>a duality diagram (i.e. a reduced space ordination) obtained by a
<code>dudi</code> function (for instance 
<code>dudi.pca</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwORorthobasisSp</code></td>
<td>
<p>either a list of weights (class <code>listw</code>) that 
san be obtained easily using the function <code>chooseCN</code> or an 
object of class <code>orthobasisSp</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nblocks</code></td>
<td>
<p>an integer indicating the number of blocks to divide MEMs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scannf</code></td>
<td>
<p>logical, indicating whether the screeplot should be displayed 
to choose the number or retained factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nf</code></td>
<td>
<p>the number of retained factors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>centring</code></td>
<td>
<p>a character string indicating if parametric ("param") or 
non-parametric ("sim") centring should be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm</code></td>
<td>
<p>an integer giving the number of permutations used to compute the
theoretical coefficients of determination (999 by default); used if 
centring="sim".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a mspa object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xax</code></td>
<td>
<p>an integer indicating the x axis to be displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yax</code></td>
<td>
<p>an integer indicating the y axis to be displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>posieig</code></td>
<td>
<p>a character indicating the position of the screeplot (any of 
the four combination between "top", "bottom", "left" and "right").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bary</code></td>
<td>
<p>a logical indicating whether the barycenter of the variables 
should be displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>a logical indicating if the graphics is displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>storeData</code></td>
<td>
<p>a logical indicating if the data should be stored in the
returned object. If <code>FALSE</code>, only the names of the data arguments are
stored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pos</code></td>
<td>
<p>an integer indicating the position of the environment where the
data are stored, relative to the environment where the function is called.
Useful only if <code>storeData</code> is <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional graphical parameters (see <code>adegpar</code> and 
<code>trellis.par.get</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>scatter</code> method is used for plotting the results. Compared to the 
original version of the method, this new implementation allows to specify a 
number of blocks (<code>nblocks</code>). In this case, the multiscale decomposition
is performed by dividing MEMs into several blocks and summing R2 values. This
could facilitate the interpretation of results.
</p>


<h3>Value</h3>

<p>An object having the classes <code>mspa</code> and 
<code>dudi</code>: <code>mspa</code> objects are <code>dudi</code>
objects with the following extra slots:<br> - ls: principal components of
the MSPA. These are the coordinates of variables onto principal axes, to be
used for plotting. Correspond to matrix <b>B</b> in Appendix A of Jombart
et al (2009). <br> - R2: matrix of R2 between variables and MEMs.
Corresponds to <b>S</b> in Jombart et al (2009).<br> - meanPoint:
coordinates of the 'mean variable' onto principal axes. The 'mean variable'
is an hypothetic variable whose scale profile is the average of those of
all variables of the analysed dataset.<br> - varweights: the weights of
variables. Corresponds to <b>d</b> in Jombart et al. (2009).<br></p>


<h3>Author(s)</h3>

<p>Thibaut Jombart <a href="mailto:t.jombart@imperial.ac.uk">t.jombart@imperial.ac.uk</a>
</p>


<h3>References</h3>

<p>Jombart T, Dray S, and Dufour, A-B. (2009) Finding essential 
scales of spatial variation in ecological data: a multivariate approach. 
<em>Ecography</em> <b>32</b>: 161-168.
</p>


<h3>See Also</h3>

<p><code>chooseCN</code> to obtain a list of spatial weights.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

####################################
### using oribatib mites dataset ###
####################################

if(require("ade4", quietly = TRUE)){
## load data
data(oribatid)

## get the list of spatial weights
cn &lt;- chooseCN(oribatid$xy, res = "listw", ask = FALSE, type = 1)

## Hellinger transformation
hellTrans &lt;- function(X){
  if (!( is.matrix(X) | is.data.frame(X) )) stop("Object is not a matrix.")  
  if (any(is.na(X))) stop("na entries in table.")
  
  sumRow &lt;- apply(X,1,sum)
  Y &lt;- X/sumRow
  Y &lt;- sqrt(Y)
  
  return(Y)
}


## ENVIRONMENTAL VARIABLES ##
## Hill and Smith analysis for environmental variables
## (for a mixture of quantitative / qualitative variables)
hsEnv &lt;- dudi.hillsmith(oribatid$envir,scannf=FALSE)

## detrending of the analysis (residuals of regression onto xy coordinates)
hsEnv.detr &lt;- pcaivortho(hsEnv,oribatid$xy,scannf=FALSE)

## MSPA of the detrended analysis
mspaEnv &lt;- mspa(hsEnv.detr,cn,scannf=FALSE,nf=2)
scatter(mspaEnv)



## SPECIES DATA ##
## PCA of species abundances, after Hellinger transformation
pcaFau &lt;- dudi.pca(hellTrans(oribatid$fau),scale=FALSE,scannf=FALSE)

## detrending of this PCA
pcaFau.detr &lt;- pcaivortho(pcaFau,oribatid$xy,scannf=FALSE)

# MSPA of the detrended analysis
mspaFau &lt;- mspa(pcaFau.detr,cn,scannf=FALSE,nf=2)
scatter(mspaFau)



## CANONICAL MSPA ##
## RDA species ~ envir
## (species abundances predicted by environment)
## note: RDA = 'PCAIV' (PCA with Instrumental Variables)
rda1 &lt;- pcaiv(dudi=pcaFau.detr, df=oribatid$envir,scannf=FALSE,nf=2)

## canonical MSPA (species predicted by environment)
mspaCan1 &lt;- mspa(dudi=rda1, lw=cn, scannf=FALSE, nf=2)
scatter(mspaCan1)

## same analysis, using a non-parametric centring
mspaCan1NP &lt;- mspa(dudi=rda1, lw=cn, scannf=FALSE, nf=2,cent="sim",nper=999)
scatter(mspaCan1NP) # basically no change



## PARTIAL CANONICAL MSPA ##
## partial RDA species ~ envir
## (species abundances not predicted by environment)
rda2 &lt;- pcaivortho(dudi=pcaFau.detr,df=oribatid$envir,scannf=FALSE,nf=2)

## partial canonical MSPA
mspaCan2 &lt;- mspa(dudi=rda2, lw=cn, scannf=FALSE, nf=2)
scatter(mspaCan2) # nothing left
}
</code></pre>


</div>