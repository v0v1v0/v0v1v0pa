<div class="container">

<table style="width: 100%;"><tr>
<td>az_vm_template</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Virtual machine template class</h2>

<h3>Description</h3>

<p>Class representing a virtual machine deployment template. This class keeps track of all resources that are created as part of deploying a VM, and exposes methods for managing them.
</p>


<h3>Format</h3>

<p>An R6 object of class <code>az_vm_template</code>, inheriting from <code>AzureRMR::az_template</code>.
</p>


<h3>Details</h3>

<p>A single virtual machine in Azure is actually a collection of resources, including any and all of the following.
</p>

<ul>
<li>
<p> Network interface (Azure resource type <code>Microsoft.Network/networkInterfaces</code>)
</p>
</li>
<li>
<p> Network security group (Azure resource type <code>Microsoft.Network/networkSecurityGroups</code>)
</p>
</li>
<li>
<p> Virtual network (Azure resource type <code>Microsoft.Network/virtualNetworks</code>)
</p>
</li>
<li>
<p> Public IP address (Azure resource type <code>Microsoft.Network/publicIPAddresses</code>)
</p>
</li>
<li>
<p> The VM itself (Azure resource type <code>Microsoft.Compute/virtualMachines</code>)
</p>
</li>
</ul>
<p>By wrapping the deployment template used to create these resources, the <code>az_vm_template</code> class allows managing them all as a single entity.
</p>


<h3>Fields</h3>

<p>The following fields are exposed, in addition to those provided by the AzureRMR::az_template class.
</p>

<ul>
<li> <p><code>dns_name</code>: The DNS name for the VM. Will be NULL if the VM is not publicly visible, or doesn't have a domain name assigned to its public IP address.
</p>
</li>
<li> <p><code>identity</code>: The managed identity details for the VM. Will be NULL if the VM doesn't have an identity assigned.
</p>
</li>
</ul>
<h3>Methods</h3>

<p>The following methods are available, in addition to those provided by the AzureRMR::az_template class.
</p>

<ul>
<li> <p><code>start(wait=TRUE)</code>: Start the VM. By default, wait until the startup process is complete.
</p>
</li>
<li> <p><code>stop(deallocate=TRUE, wait=FALSE)</code>: Stop the VM. By default, deallocate it as well.
</p>
</li>
<li> <p><code>restart(wait=TRUE)</code>: Restart the VM.
</p>
</li>
<li> <p><code>run_deployed_command(command, parameters, script)</code>: Run a PowerShell command on the VM.
</p>
</li>
<li> <p><code>run_script(script, parameters)</code>: Run a script on the VM. For a Linux VM, this will be a shell script; for a Windows VM, a PowerShell script. Pass the script as a character vector.
</p>
</li>
<li> <p><code>sync_vm_status()</code>: Check the status of the VM.
</p>
</li>
<li> <p><code>resize(size, deallocate=FALSE, wait=FALSE)</code>: Resize the VM. Optionally stop and deallocate it first (may sometimes be necessary).
</p>
</li>
<li> <p><code>redeploy()</code>: Redeploy the VM.
</p>
</li>
<li> <p><code>reimage()</code>: Reimage the VM.
</p>
</li>
<li> <p><code>get_public_ip_address(nic=1, config=1)</code>: Get the public IP address of the VM. Returns NA if the VM is stopped, or is not publicly accessible.
</p>
</li>
<li> <p><code>get_private_ip_address(nic=1, config=1)</code>: Get the private IP address of the VM.
</p>
</li>
<li> <p><code>get_public_ip_resource(nic=1, config=1)</code>: Get the Azure resource for the VM's public IP address.
</p>
</li>
<li> <p><code>get_nic(nic=1)</code>: Get the VM's network interface resource.
</p>
</li>
<li> <p><code>get_vnet(nic=1, config=1)</code>: Get the VM's virtual network resource.
</p>
</li>
<li> <p><code>get_nsg(nic=1, config=1)</code>: Get the VM's network security group resource. Note that an NSG can be attached to either the VM's network interface or to its virtual network subnet; if there is an NSG attached to both, this method returns a list containing the two NSG resource objects.
</p>
</li>
<li> <p><code>get_disk(disk="os")</code>: Get a managed disk resource attached to the VM. The <code>disk</code> argument can be "os" for the OS disk, or a number indicating the LUN of a data disk. AzureVM only supports managed disks.
</p>
</li>
<li> <p><code>add_extension(publisher, type, version, settings=list(), protected_settings=list(), key_vault_settings=list())</code>: Add an extension to the VM.
</p>
</li>
<li> <p><code>do_vm_operation(...)</code>: Carries out an arbitrary operation on the VM resource. See the <code>do_operation</code> method of the AzureRMR::az_resource class for more details.
</p>
</li>
</ul>
<p>Many of these methods are actually provided by the az_vm_resource class, and propagated to the template as active bindings.
</p>


<h3>See Also</h3>

<p>AzureRMR::az_template, create_vm, get_vm, delete_vm
</p>
<p><a href="https://docs.microsoft.com/en-us/rest/api/compute/virtualmachines">VM API reference</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

sub &lt;- AzureRMR::get_azure_login()$
    get_subscription("subscription_id")

vm &lt;- sub$get_vm("myvm")

vm$identity

vm$start()
vm$get_private_ip_address()
vm$get_public_ip_address()

vm$run_script("echo hello world! &gt; /tmp/hello.txt")

vm$stop()
vm$get_private_ip_address()
vm$get_public_ip_address()  # NA, assuming VM has a dynamic IP address

vm$resize("Standard_DS13_v2")
vm$sync_vm_status()


## End(Not run)
</code></pre>


</div>