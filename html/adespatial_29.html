<div class="container">

<table style="width: 100%;"><tr>
<td>mem.select</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Selection of the best subset of spatial eigenvectors (MEM, Moran's
Eigenvector Maps)</h2>

<h3>Description</h3>

<p><code>mem.select</code> computes the spatial eigenvectors (MEM) of the spatial
weighting matrix (SWM) provided (<code>listw</code>) and optimizes the selection of
a subset of MEM variables relative to response variable(s) stored in
<code>x</code>. The optimization is done either by maximizing the adjusted
R-squared (R2) of all (<code>method = "global"</code>) or a subset (<code>method =
"FWD"</code>) of MEM variables or by minimizing the residual spatial
autocorrelation (<code>method = "MIR"</code>) (see details in Bauman et al. 2018a).
</p>


<h3>Usage</h3>

<pre><code class="language-R">mem.select(
  x,
  listw,
  MEM.autocor = c("positive", "negative", "all"),
  method = c("FWD", "MIR", "global"),
  MEM.all = FALSE,
  nperm = 999,
  nperm.global = 9999,
  alpha = 0.05,
  verbose = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A vector, matrix, or dataframe of response variable(s). The
<code>method = "MIR"</code> is only implemented for a vector response. Note that
<code>x</code> can also contain the residuals of a model when other (e.g.,
environmental) variables should be considered in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listw</code></td>
<td>
<p>A spatial weighting matrix of class <code>listw</code>; can be created
with functions of the package <code>spdep</code>, or with the user-friendly
function <code>listw.candidates</code>. Note that, the function <code>listw.candidates</code>
returns a <code>list</code> of <code>listw</code> and subselection by <code>[[]]</code> should be 
performed in this case (see <code>Example</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MEM.autocor</code></td>
<td>
<p>Sign of the spatial eigenvectors to generate; "positive",
"negative", or "all", for positively, negatively autocorrelated
eigenvectors, or both, respectively; default is "positive"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Criterion to select the best subset of MEM variables. Either
<code>"FWD"</code> (default option), <code>"MIR"</code> (for univariate <code>x</code>
only), or <code>"global"</code> (see <code>Details</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MEM.all</code></td>
<td>
<p>A logical indicating if the complete set of MEM variables
should be returned</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm</code></td>
<td>
<p>Number of permutations to perform the tests in the selection 
procedure; Default is 999</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm.global</code></td>
<td>
<p>Number of permutations to perform the tests in the global test;
Default is 9999</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Significance threshold value for the tests; Default is 0.05</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If 'TRUE' more diagnostics are printed. The default setting is
FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters (for internal use with <code>listw.select</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function provides three different methods to select a subset of
MEM variables. For all methods, a global test is firstly performed. If
<code>MEM.autocor = "all"</code>, two global tests are performed and p-values are
corrected for multiple comparison (Sidak correction).
</p>
<p>If the MEM variables are to be further used in a model including actual
predictors (e.g. environmental), then a subset of spatial eigenvectors
needs to be selected before proceeding to further analyses to avoid model
overfitting and/or a loss of statistical power to detect the contribution of
the environment to the variability of the response data (Griffith 2003, Dray
et al. 2006, Blanchet et al. 2008, Peres-Neto and Legendre 2010, Diniz-Filho
et al. 2012). Although several eigenvector selection approaches have been 
proposed to select a best subset of eigenvectors, Bauman et al. (2018b) showed 
that two main procedures should be preferred, depending on the underlying 
objective: the forward selection with double stopping criterion (Blanchet et
al. 2008; <code>method = "FWD"</code>) or the minimization of the residual spatial 
autocorrelation (Griffith and Peres-Neto 2006; MIR selection in Bauman et al.
2018a,b, <code>method = "MIR"</code>). 
The most powerful and accurate selection method, in terms of R2 estimation,
is the forward selection. This method should be preferred when the objective 
is to capture as accurately as possible the spatial patterns of <code>x</code>. If 
the objective is to optimize the detection of the spatial patterns in the 
residuals of a model of the response variable(s) against a set of environmental 
predictors, for instance, then <code>x</code> should be the model residuals, and 
<code>method = "FWD"</code>. This allows optimizing the detection of residual
spatial patterns once the effect of the environmental predictors has been
removed. 
If however the objective is only to remove the spatial autocorrelation from the
residuals of a model of <code>x</code> against a set of actual predictors (e.g.
environmental) with a small number of spatial predictors, then accuracy is
not as important and one should focus mainly on the number of spatial
predictors (Bauman et al. 2018b). In this case, <code>method = "MIR"</code> is more 
adapted, as it has the advantage to maintain the standard errors of the actual 
predictor coefficients as low as possible. Note that <code>method = "MIR"</code> can 
only be used for a univariate <code>x</code>, as the Moran's I is a univariate index. 
If <code>x</code> is multivariate, then the best criterion is the forward selection 
(see Bauman et al. 2018b).
A third option is to not perform any selection of MEM variables 
(<code>method = "global"</code>). This option may be interesting when the complete set 
of MEM variables will be used, like in Moran spectral randomizations (Wagner and
Dray 2015, Bauman et al. 2018c) or when using smoothed MEM (Munoz 2009).
</p>
<p>For <code>method = "MIR"</code>, the global test consists in computing the
Moran's I of <code>x</code> (e.g. residuals of the model of the response variable
against environmental variables) and tests it by permutation (results
stored in <code>global.test</code>). If the Moran's I is significant, the
function performs a selection procedure that searches among the set of
generated spatial predictors the one that best minimizes the value of the
Moran's I. A model of <code>x</code> against the selected eigenvector is built,
and the significance of the Moran's I of the model residuals is tested
again. The procedure goes on until the Moran's I of the model residuals is
not significant anymore, hence the name of Minimization of moran's I in the
Residuals (MIR).
</p>
<p>For <code>method = "global"</code> and <code>method = "FWD"</code>, the global test
consists in computing the adjusted global R2, that is, the R2 of the model
of <code>x</code> against the whole set of generated MEM variables and tests it
by permutation (results stored in <code>global.test</code>).
</p>
<p>For <code>method = "global"</code>, if the adjusted global R2 is significant, the
functions returns the whole set of generated MEM variables in <code>MEM.select</code>.
</p>
<p>For <code>method = "FWD"</code>, if the adjusted global R2 is significant, the
function performs a forward selection with double stopping criterion that 
searches among the set of generated spatial predictors the one that best maximizes 
the R2 of the model. The procedure is repeated untill one of the two stopping
criterion is reached (see Blanchet et al. 2008). Note that in a few cases, the forward
selection does not select any variable even though the global model is significant. This
can happen for example when a single variable has a strong relation with the response 
variable(s), because the integration of the variable alone yields an adjusted R2
slightly higher than the global adjusted R2. In this case, we recommend checking that this
is indeed the reason why the first selected variable was rejected, and rerun the analysis
with a second stopping criterion equal to the global adjusted R2 plus a small amount
allowing avoiding this issue (e.g. 5
done through the argument <code>adjR2thresh</code> of function <code>forward.sel</code>, until the
solution is implemented in <code>mem.select</code>.
</p>
<p>For the <code>method = "FWD"</code> and <code>method = "MIR"</code>, the MEM selected
by the procedure are returned in <code>MEM.select</code> and a summary of the
results is provided in <code>summary</code>. If no MEM are selected, then
<code>MEM.select</code> and <code>summary</code> are not returned.
</p>


<h3>Value</h3>

<p>The function returns a list with: </p>
 <dl>
<dt>global.test</dt>
<dd>
<p>An
object of class <code>randtest</code> containing the result of the global test
associated to all MEM (adjusted R2 and p-value). If <code>MEM.autocor = "all"</code>, 
a list with two elements (<code>positive</code> and <code>negative</code>) corresponding to 
the results of the global tests performed on positive and negative MEM respectively.</p>
</dd>
<dt>MEM.all</dt>
<dd>
<p>An object of class <code>orthobasisSp</code> containing the
complete set of generated MEM variables (generated by
<code>scores.listw</code>). Only returned if <code>MEM.all = TRUE</code>.</p>
</dd>
<dt>summary</dt>
<dd>
<p>A dataframe summarizing the results of the selection
procedure</p>
</dd> <dt>MEM.select</dt>
<dd>
<p>An object of class <code>orthobasisSp</code>
containing the subset of significant MEM variables.</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>David Bauman (<a href="mailto:dbauman@ulb.ac.be">dbauman@ulb.ac.be</a> or
<a href="mailto:davbauman@gmail.com">davbauman@gmail.com</a>) and Stéphane Dray
</p>


<h3>References</h3>

<p>Bauman D., Fortin M-J, Drouet T. and Dray S. (2018a) Optimizing the choice 
of a spatial weighting matrix in eigenvector-based methods. Ecology, 99, 2159-2166
</p>
<p>Bauman D., Drouet T., Dray S. and Vleminckx J. (2018b) Disentangling good from
bad practices in the selection of spatial or phylogenetic eigenvectors.
Ecography, 41, 1–12
</p>
<p>Bauman D., Vleminckx J., Hardy O., Drouet T. (2018c) Testing and interpreting the 
shared space-environment fraction in variation partitioning analyses of ecological data.
Oikos
</p>
<p>Blanchet G., Legendre P. and Borcard D. (2008) Forward selection of
explanatory variables. Ecology, 89(9), 2623–2632
</p>
<p>Diniz-Filho J.A.F., Bini L.M., Rangel T.F., Morales-Castilla I. et al.
(2012) On the selection of phylogenetic eigenvectors for ecological
analyses. Ecography, 35, 239–249
</p>
<p>Dray S., Legendre P. and Peres-Neto P. R. (2006) Spatial modeling: a
comprehensive framework for principal coordinate analysis of neighbor
matrices (PCNM). Ecological Modelling, 196, 483–493
</p>
<p>Griffith D. (2003) Spatial autocorrelation and spatial filtering: gaining
understanding through theory and scientific visualization. Springer, Berlin
</p>
<p>Griffith D. and Peres-Neto P. (2006) Spatial modeling in Ecology: the
flexibility of eigenfunction spatial analyses. Ecology, 87, 2603–2613
</p>
<p>Munoz, F. 2009. Distance-based eigenvector maps (DBEM) to analyse
metapopulation structure with irregular sampling. Ecological Modelling, 220,
2683–2689
</p>
<p>Peres-Neto P. and Legendre P. (2010) Estimating and controlling for spatial
structure in the study of ecological communities. Global Ecology and
Biogeography, 19, 174–184
</p>
<p>Wagner H., Dray S. (2015). Generating spatially constrained null models for
irregularly spaced data using Moran spectral randomization methods. Methods
in Ecology and Evolution, 6, 1169–1178
</p>


<h3>See Also</h3>

<p><code>listw.candidates</code>, <code>listw.select</code>,
<code>scores.listw</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if(require(vegan)){ 
# Illustration of the MIR selection on the oribatid mite data
# (Borcard et al. 1992, 1994 for details on the dataset):
# *******************************************************
# Community data (response matrix):
data(mite)
# We will compute the example on a single species:
spe &lt;- mite[, 2]
# Environmental explanatory dataset:
data(mite.env)
# We only use two numerical explanatory variables:
env &lt;- mite.env[, 1:2]
dim(env)
# Coordinates of the 70 sites:
data(mite.xy)
coord &lt;- mite.xy
# We build the model we are interested in:
mod &lt;- lm(spe ~ ., data = env)


# In order to avoid possible type I error rate inflation issues, we check 
# whether the model residuals are independent, and if they are spatially
# autocorrelated, we select a small subset of MEM variables to add to the
# model as covariables with the MIR selection:

# 1) We build a spatial weighting matrix based on Gabriel graph with a
# weighting function decreasing linearly with the distance:
w &lt;- listw.candidates(coord, nb = "gab", weights = "flin")


# 2) We test the spatial autocorrelation of the model residuals and, if
# necessary, select a subset of spatial predictors:
y &lt;- residuals(mod)
MEM &lt;- mem.select(x = y, listw = w[[1]], method = "MIR", MEM.autocor = "positive",
         nperm = 999, alpha = 0.05)
dim(MEM$MEM.select)
# The residuals of the model presented spatial autocorrelation. The selection
# of MEM variables is thus performed to remove residual autocorrelation.

# 3) We can reconstruct our model adding the selected MEM variable as covariables:
env2 &lt;- cbind(env, MEM$MEM.select)
mod_complete &lt;- lm(spe ~ ., data = env2)
summary(mod_complete)$coefficient[, 1]   # Coefficient estimates
summary(mod_complete)$coefficient[, 2]   # Standard errors
}


</code></pre>


</div>