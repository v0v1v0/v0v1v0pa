<div class="container">

<table style="width: 100%;"><tr>
<td>collapseDuplicates</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Remove duplicate DNA sequences and combine annotations</h2>

<h3>Description</h3>

<p><code>collapseDuplicates</code> identifies duplicate DNA sequences, allowing for ambiguous 
characters, removes the duplicate entries, and combines any associated annotations.
</p>


<h3>Usage</h3>

<pre><code class="language-R">collapseDuplicates(
  data,
  id = "sequence_id",
  seq = "sequence_alignment",
  text_fields = NULL,
  num_fields = NULL,
  seq_fields = NULL,
  add_count = FALSE,
  ignore = c("N", "-", ".", "?"),
  sep = ",",
  dry = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.frame containing Change-O columns. The data.frame 
must contain, at a minimum, a unique identifier column 
and a column containg a character vector of DNA sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>name of the column containing sequence identifiers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seq</code></td>
<td>
<p>name of the column containing DNA sequences.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>text_fields</code></td>
<td>
<p>character vector of textual columns to collapse. The textual 
annotations of duplicate sequences will be merged into a single 
string with each unique value alphabetized and delimited by 
<code>sep</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_fields</code></td>
<td>
<p>vector of numeric columns to collapse. The numeric annotations
of duplicate sequences will be summed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seq_fields</code></td>
<td>
<p>vector of nucletoide sequence columns to collapse. The sequence 
with the fewest numer of non-informative characters will be 
retained. Where a non-informative character is one of 
<code>c("N", "-", ".", "?")</code>. Note, this is distinct from the 
<code>seq</code> parameter which is used to determine duplicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_count</code></td>
<td>
<p>if <code>TRUE</code> add the column <code>collpase_count</code> that 
indicates the number of sequences that were collapsed to build 
each unique entry.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore</code></td>
<td>
<p>vector of characters to ignore when testing for equality.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>character to use for delimiting collapsed annotations in the 
<code>text_fields</code> columns. Defines both the input and output 
delimiter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dry</code></td>
<td>
<p>if <code>TRUE</code> perform dry run. Only labels the sequences without 
collapsing them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>if <code>TRUE</code> report the number input, discarded and output 
sequences; if <code>FALSE</code> process sequences silently.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>collapseDuplicates</code> identifies duplicate sequences in the <code>seq</code> column by
testing for character identity, with consideration of IUPAC ambiguous nucleotide codes. 
A cluster of sequences are considered duplicates if they are all equivalent, and no 
member of the cluster is equivalent to a sequence in a different cluster. 
</p>
<p>Textual annotations, specified by <code>text_fields</code>, are collapsed by taking the unique
set of values within in each duplicate cluster and delimiting those values by <code>sep</code>.
Numeric annotations, specified by <code>num_fields</code>, are collapsed by summing all values 
in the duplicate cluster. Sequence annotations, specified by <code>seq_fields</code>, are 
collapsed by retaining the first sequence with the fewest number of N characters.
</p>
<p>Columns that are not specified in either <code>text_fields</code>, <code>num_fields</code>, or 
<code>seq_fields</code> will be retained, but the value will be chosen from a random entry 
amongst all sequences in a cluster of duplicates.
</p>
<p>An ambiguous sequence is one that can be assigned to two different clusters, wherein
the ambiguous sequence is equivalent to two sequences which are themselves 
non-equivalent. Ambiguous sequences arise due to ambiguous characters at positions that
vary across sequences, and are discarded along with their annotations when <code>dry=FALSE</code>. 
Thus, ambiguous sequences are removed as duplicates of some sequence, but do not create a potential
false-positive annotation merger. Ambiguous sequences are not included in the 
<code>collapse_count</code> annotation that is added when <code>add_count=TRUE</code>.
</p>
<p>If <code>dry=TRUE</code> sequences will not be removed from the input. Instead, the following columns
will be appended to the input defining the collapse action that would have been performed in the
<code>dry=FALSE</code> case.
</p>

<ul>
<li>  <p><code>collapse_id</code>:     an identifer for the group of identical sequences.
</p>
</li>
<li>  <p><code>collapse_class</code>:  string defining how the sequence matches to the other in the set.
one of <code>"duplicated"</code> (has duplicates),
<code>"unique"</code> (no duplicates), <code>"ambiguous_duplicate"</code> 
(no duplicates after ambiguous sequences are removed), 
or <code>"ambiguous"</code> (matches multiple non-duplicate sequences).
</p>
</li>
<li>  <p><code>collapse_pass</code>:   <code>TRUE</code> for the sequences that would be retained.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A modified <code>data</code> data.frame with duplicate sequences removed and 
annotation fields collapsed if <code>dry=FALSE</code>. If <code>dry=TRUE</code>, 
sequences will be labeled with the collapse action, but the input will be
otherwise unmodifed (see Details).
</p>


<h3>See Also</h3>

<p>Equality is tested with seqEqual and pairwiseEqual. 
For IUPAC ambiguous character codes see IUPAC_DNA.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example data.frame
db &lt;- data.frame(sequence_id=LETTERS[1:4],
                 sequence_alignment=c("CCCCTGGG", "CCCCTGGN", "NAACTGGN", "NNNCTGNN"),
                 c_call=c("IGHM", "IGHG", "IGHG", "IGHA"),
                 sample_id=c("S1", "S1", "S2", "S2"),
                 duplicate_count=1:4,
                 stringsAsFactors=FALSE)

# Annotations are not parsed if neither text_fields nor num_fields is specified
# The retained sequence annotations will be random
collapseDuplicates(db, verbose=TRUE)

# Unique text_fields annotations are combined into a single string with ","
# num_fields annotations are summed
# Ambiguous duplicates are discarded
collapseDuplicates(db, text_fields=c("c_call", "sample_id"), num_fields="duplicate_count", 
                   verbose=TRUE)

# Use alternate delimiter for collapsing textual annotations
collapseDuplicates(db, text_fields=c("c_call", "sample_id"), num_fields="duplicate_count", 
                   sep="/", verbose=TRUE)

# Add count of duplicates
collapseDuplicates(db, text_fields=c("c_call", "sample_id"), num_fields="duplicate_count", 
                   add_count=TRUE, verbose=TRUE)

# Masking ragged ends may impact duplicate removal
db$sequence_alignment &lt;- maskSeqEnds(db$sequence_alignment)
collapseDuplicates(db, text_fields=c("c_call", "sample_id"), num_fields="duplicate_count", 
                   add_count=TRUE, verbose=TRUE)

</code></pre>


</div>