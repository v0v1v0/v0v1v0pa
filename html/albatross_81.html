<div class="container">

<table style="width: 100%;"><tr>
<td>write.openfluor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Export a PARAFAC model for the OpenFluor database</h2>

<h3>Description</h3>

<p>Prepares a fitted PARAFAC model for submission to OpenFluor - an online
spectral database of fluorescence by environmental organic compounds.
</p>


<h3>Usage</h3>

<pre><code class="language-R">write.openfluor(
  model, filename, name = "?", creator = "?", doi = "?",
  reference = "?", unit = "?", toolbox =, date =, fluorometer = "?",
  constraints =, validation = "?", methods = "?", preprocess = "?",
  sources = "?", ecozones = "?", description = "",
  shift = FALSE, scale = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A <code>feemparafac</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>

<p>Path to the text file to create from the <code>model</code> argument.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>

<p>Short name of the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>creator</code></td>
<td>

<p>Name of the creator of the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doi</code></td>
<td>

<p>Digital object identifier of the referenced source. Can also be
“ISBN:...” for books.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference</code></td>
<td>

<p>Full citation for the referenced source using the following style:
“Author AA, Author BB, Author CC, (year), ‘Title’,
Journal Abbrev, Vol, pages”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit</code></td>
<td>

<p>Units the fluorescence was measured in. Typically, one of “RU”,
“QSE”, “AU”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>toolbox</code></td>
<td>

<p>Defaults to
“albatross <var>version</var>, multiway <var>version</var>”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date</code></td>
<td>

<p>Defaults to today, in “<var>yyyy</var>-<var>mm</var>-<var>dd</var>” format.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fluorometer</code></td>
<td>

<p>The model of the instrument that produced the data.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constraints</code></td>
<td>

<p>Constraints applied to the PARAFAC model. Defaults to
<code>model$const</code>, but please edit it to a more human-readable form.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>validation</code></td>
<td>

<p>Validation method used for the PARAFAC model, examples include:
“Split-Half Analysis”, “core-consistency”.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>methods</code></td>
<td>

<p>The sequence of steps taken to handle the samples and to ensure
proper fluorescence intensity measurement. Examples include: </p>

<ul>
<li>
<p> Sampling: Filtration GF/F
</p>
</li>
<li>
<p> Sampling: Filtration <var>x</var> um
</p>
</li>
<li>
<p> Sampling: samples frozen
</p>
</li>
<li>
<p> Instrument spectral bias correction: Ex
</p>
</li>
<li>
<p> Instrument spectral bias correction: Em
</p>
</li>
<li>
<p> Instrument spectral bias correction: Ex &amp; Em
</p>
</li>
<li>
<p> Inner filter effect correction: absorbance method
</p>
</li>
<li>
<p> Inner filter effect correction: dilution
</p>
</li>
<li>
<p> Inner filter effect correction: CDA
</p>
</li>
<li>
<p> Inner filter effect correction: <var>other (please describe)</var>
</p>
</li>
<li>
<p> Internal calibration: Raman Peak area
</p>
</li>
<li>
<p> Internal calibration: Raman Peak height
</p>
</li>
<li>
<p> Internal calibration: Blank Subtraction
</p>
</li>
<li>
<p> External calibration: Quinine Sulphate dilution series
</p>
</li>
<li>
<p> External calibration: STARNA reference standards
</p>
</li>
<li>
<p> External calibration: NIST reference standards
</p>
</li>
<li>
<p> External calibration: <var>other (please describe)</var>
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preprocess</code></td>
<td>

<p>PARAFAC-specific pre-processing steps applied to the dataset. Examples
include (but are not limited to): </p>

<ul>
<li>
<p> Outliers removed
</p>
</li>
<li>
<p> Scatter region excised (replaced with NaNs)
</p>
</li>
<li>
<p> Scatter region smoothed (replaced with interpolated values)
</p>
</li>
<li>
<p> Sample mode normalised to DOC concentration
</p>
</li>
<li>
<p> Sample mode normalised to unit variance
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sources</code></td>
<td>

<p>Should preferably include one or more of the following keywords:
</p>

<ul>
<li>
<p> river
</p>
</li>
<li>
<p> stream
</p>
</li>
<li>
<p> lake
</p>
</li>
<li>
<p> wetland
</p>
</li>
<li>
<p> reservoir
</p>
</li>
<li>
<p> estuary
</p>
</li>
<li>
<p> ocean - coastal and shelf seas
</p>
</li>
<li>
<p> ocean - surface off-shore
</p>
</li>
<li>
<p> ocean - deep off-shore
</p>
</li>
<li>
<p> freshwater
</p>
</li>
<li>
<p> seawater
</p>
</li>
<li>
<p> groundwater
</p>
</li>
<li>
<p> wastewater
</p>
</li>
<li>
<p> drinking water
</p>
</li>
<li>
<p> treated water
</p>
</li>
<li>
<p> recycled water
</p>
</li>
<li>
<p> ballast water
</p>
</li>
<li>
<p> sediment
</p>
</li>
<li>
<p> mudflat
</p>
</li>
<li>
<p> mangrove
</p>
</li>
<li>
<p> aquarium
</p>
</li>
<li>
<p> mesocosm
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ecozones</code></td>
<td>

<p>List all major or minor terrestrial, freshwater and
marine ecozones and ecoregions that apply. The full set
of possible options is too large to include here, but see
<a href="https://en.wikipedia.org/wiki/Lists_of_ecoregions">https://en.wikipedia.org/wiki/Lists_of_ecoregions</a> for a source
of inspiration.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>description</code></td>
<td>

<p>Brief description of the model and its source data in <code class="reqn">\le 256</code>
characters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shift, scale</code></td>
<td>

<p>If <code>shift</code> is specified (default <code>FALSE</code>), the loadings
are first shifted by subtracting <code>min(x)</code> to ensure that the
minimal value is <code class="reqn">0</code>.
</p>
<p>If <code>scale</code> is specified (default <code>TRUE</code>), the loadings
are then rescaled by dividing by <code>max(x)</code> so that the maximal
value is <code class="reqn">1</code>.
</p>
<p>Note that OpenFluor clamps values outside the <code class="reqn">[0, 1]</code> range
and uses scale-invariant (but <em>not</em> shift-invariant) Tucker's
congruence coefficient to find matches.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Provided the <code>model</code> and the <code>filename</code> arguments, this
function exports the loadings into a file that passes OpenFluor syntax
check and is suitable for further editing. Alternatively, some or all
of the fields may be specified programmatically.
</p>
<p>The fields <code>constraints</code>, <code>methods</code>, <code>preprocess</code>,
<code>sources</code>, <code>ecozones</code> can be specified as character vectors
(to be comma-separated on output); others should be single strings.
</p>


<h3>References</h3>

<p>Murphy KR, Stedmon CA, Wenig P, Bro R (2014).
“OpenFluor - an online spectral library of auto-fluorescence by organic compounds in the environment.”
<em>Analytical Methods</em>, <b>6</b>, 658-661.
<a href="https://doi.org/10.1039/C3AY41935E">doi:10.1039/C3AY41935E</a>.
</p>
<p><a href="https://openfluor.lablicate.com/">https://openfluor.lablicate.com/</a>
</p>


<h3>See Also</h3>

<p><code>feemparafac</code></p>


<h3>Examples</h3>

<pre><code class="language-R">  data(feems)
  cube &lt;- feemscale(feemscatter(cube, c(24, 14)), na.rm = TRUE)
  factors &lt;- feemparafac(cube, nfac = 3, ctol = 1e-4)
  # all defaults
  write.openfluor(factors, f1 &lt;- tempfile(fileext = '.txt'))
  if (interactive()) file.show(f1)
  unlink(f1)
  # all non-default arguments
  write.openfluor(
    factors, f2 &lt;- tempfile(fileext = '.txt'), name = 'example',
    creator = 'J. Doe', doi = '10.1000/1', reference = paste(
      'Upper D, (1973),', "'The unsuccessful self-treatment of a case",
      "of \"writer's block\"',", 'J Appl Behav Anal, 7(3), 497'
    ), unit = 'AU', toolbox = 'all calculations done by hand',
    date = '2038-01-19', fluorometer = 'Acme Fluor-o-matic 9000',
    constraints = 'non-negative', validation = 'prior knowledge',
    methods = 'Instrument spectral bias correction: Ex &amp; Em',
    preprocess = 'Scatter region excised (replaced with NaNs)',
    sources = 'freshwater', ecozones = 'Balkash',
    description = 'not a real model', shift = FALSE, scale = TRUE
  )
  if (interactive()) file.show(f2)
  unlink(f2)
</code></pre>


</div>