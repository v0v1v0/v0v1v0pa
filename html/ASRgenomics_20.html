<div class="container">

<table style="width: 100%;"><tr>
<td>H.matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generates the hybrid <code class="reqn">H</code> matrix</h2>

<h3>Description</h3>

<p>The single-step GBLUP approach combines the information from the pedigree relationship matrix
<code class="reqn">\boldsymbol{A}</code> and the genomic relationship matrix <code class="reqn">\boldsymbol{G}</code> in one
hybrid relationship matrix called <code class="reqn">\boldsymbol{H}</code>.
This function will calculate directly this matrix <code class="reqn">\boldsymbol{H}</code>.
The user should provide the matrices <code class="reqn">\boldsymbol{A}</code> or
its inverse (only one of these is required) and the
inverse of the matrix <code class="reqn">\boldsymbol{G}</code> (<code class="reqn">\boldsymbol{G_{inv}}</code>) in its full form.
Individual names should
be assigned to  <code>rownames</code> and <code>colnames</code>, and individuals from
<code class="reqn">\boldsymbol{G_{inv}}</code> are verified to be all a subset within individuals from
<code class="reqn">\boldsymbol{A}</code> (or <code class="reqn">\boldsymbol{A_{inv}}</code>).
This function is a wrapper of  the H.inverse function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">H.matrix(
  A = NULL,
  Ainv = NULL,
  Ginv = NULL,
  lambda = NULL,
  tau = 1,
  omega = 1,
  sparseform = FALSE,
  keep.order = TRUE,
  digits = 8,
  message = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>Input of the pedigree relationship matrix <code class="reqn">\boldsymbol{A}</code>
in full form (<code class="reqn">na \times na</code>) (default = <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ainv</code></td>
<td>
<p>Input of the inverse of the pedigree relationship matrix
<code class="reqn">\boldsymbol{A}^{-1}</code> in full form (<code class="reqn">na \times na</code>) (default = <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ginv</code></td>
<td>
<p>Input of the inverse of the genomic relationship matrix
<code class="reqn">\boldsymbol{G}^{-1}</code> in full form (<code class="reqn">ng \times ng</code>) (default = <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>The scaling factor for <code class="reqn">(\boldsymbol{G}^{-1}-\boldsymbol{A}^{-1}_{22})</code> (default = <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>The scaling factor for <code class="reqn">\boldsymbol{G}^{-1}</code> (default = <code>1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega</code></td>
<td>
<p>The scaling factor for <code class="reqn">\boldsymbol{A}^{-1}_{22}</code> (default = <code>1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparseform</code></td>
<td>
<p>If <code>TRUE</code> it generates the requested matrix in sparse form to be used
directly in <span class="pkg">asreml</span> with required attributes (default = <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.order</code></td>
<td>
<p>If <code>TRUE</code> the original order of the individuals from the
<code class="reqn">\boldsymbol{A}</code> or <code class="reqn">\boldsymbol{A_{inv}}</code> matrix is kept.
Otherwise the non-genotyped individuals are placed first and
then genotyped individuals (default = <code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Set up the number of digits used to round the output matrix (default = <code>8</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>If <code>TRUE</code> diagnostic messages are printed on screen (default = <code>TRUE</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is currently equivalent to using H.inverse with (<code>inverse = FALSE</code>).
</p>

<p>The <code class="reqn">\boldsymbol{H}</code> matrix is obtained with the following equations:
</p>
<p style="text-align: center;"><code class="reqn">\boldsymbol{H}=\boldsymbol{A}+\begin{bmatrix}\boldsymbol{A}_{12}\boldsymbol{A}_{22}^{-1}(\boldsymbol{G}-\boldsymbol{A}_{22})\boldsymbol{A}_{22}^{-1}\boldsymbol{A}_{21}&amp;\boldsymbol{A}_{12}\boldsymbol{A}_{22}^{-1}(\boldsymbol{G}-\boldsymbol{A}_{22})\\(\boldsymbol{G}-\boldsymbol{A}_{22})\boldsymbol{A}_{22}^{-1}\boldsymbol{A}_{21}&amp;(\boldsymbol{G}-\boldsymbol{A}_{22})\end{bmatrix}</code>
</p>




<h3>Value</h3>

<p>The hybrid matrix <code class="reqn">\boldsymbol{H}</code> matrix, in full or sparse form.
</p>


<h3>References</h3>

<p>Christensen, O.F., Lund, M.S. 2010. Genomic prediction matrix when some animals
are not genotyped. Gen. Sel. Evol. 42(2):1–8.
</p>
<p>Christensen, O., Madsen, P., Nielsen, B., Ostersen, T., and Su, G. 2012. Single-step methods
for genomic evaluation in pigs. Animal 6(10):1565–1571.
</p>
<p>Legarra, A., Aguilar, I., and Misztal, I. 2009. A relationship matrix including full
pedigree and genomic information. J. Dairy Sci. 92:4656-4663.
</p>
<p>Martini, J.W.R., Schrauf, M.F., Garcia-Baccino, C.A., Pimentel, E.C.G., Munilla, S.,
Rogberg-Muñoz, A., Cantet, R.J.C., Reimer, C., Gao, N., Wimmer, V., and Simianer, H. 2018.
The effect of the <code class="reqn">H^{-1}</code> scaling factors <code class="reqn">\tau</code> and <code class="reqn">\omega</code>
on the structure of <code class="reqn">H</code> in the single-step procedure.
Genet. Sel. Evol. 50:1-9.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Get A matrix.
A &lt;- AGHmatrix::Amatrix(data = ped.pine)
A[1:5,1:5]
dim(A)

# Read and filter genotypic data.
M.clean &lt;- qc.filtering(
 M = geno.pine655,
 maf = 0.05,
 marker.callrate = 0.2, ind.callrate = 0.20,
 na.string = "-9",
 plots = FALSE)$M.clean

# Get G matrix.
G &lt;- G.matrix(M = M.clean, method = "VanRaden", na.string = "-9")$G
G[1:5, 1:5]
dim(G)

# Match G2A.
check &lt;- match.G2A(
 A = A, G = G,
 clean = TRUE, ord = TRUE, mism = TRUE, RMdiff = TRUE)

# Align G matrix with A.
G_align &lt;- G.tuneup(G = check$Gclean, A = check$Aclean, align = TRUE, sparseform = FALSE)$Gb

# Get Ginverse using the aligned G.
Ginv &lt;- G.inverse(G = G_align, sparseform = FALSE)$Ginv
Ginv[1:5, 1:5]
dim(Ginv)

# Obtaining H.
H &lt;- H.matrix(A = A, G = Ginv, lambda = 0.90, sparseform = FALSE)
H[1:5, 1:5]


</code></pre>


</div>