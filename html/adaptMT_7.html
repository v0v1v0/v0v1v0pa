<div class="container">

<table style="width: 100%;"><tr>
<td>ctgm_lfdr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Conditional Two-Groups Models on Unmasked P-Values</h2>

<h3>Description</h3>

<p><code>ctgm_lfdr</code> computes the oracle local FDR estimate, by using all p-values without masking.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ctgm_lfdr(x, pvals, models, dist = beta_family(), type = c("over", "raw"),
  params0 = list(pix = NULL, mux = NULL), niter = 50, cr = "BIC",
  verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>covariates (i.e. side-information). Should be compatible to <code>models</code>. See Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvals</code></td>
<td>
<p>a vector of values in [0, 1]. P-values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>models</code></td>
<td>
<p>an object of class "<code>adapt_model</code>" or a list of objects of class "adapt_model". See Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>an object of class "<code>gen_exp_family</code>". <code>beta_family()</code> as default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character. Either "over" or "raw" indicating the type of local FDR estimates. See Details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params0</code></td>
<td>
<p>a list in the form of list(pix = , mux = ). Initial values of pi(x) and mu(x). Both can be set as NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>a positive integer. Number of EM iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cr</code></td>
<td>
<p>a string. The criterion for model selection with BIC as default. Also support AIC, AICC and HIC</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical values in the form of list(fit = , ms = ). Indicate whether the progress of model fitting and model selection is displayed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ctgm_lfdr</code> implements the EM algorithm to fit pi(x) and mu(x) on unmasked p-values. Although it is not related to FDR control of AdaPT, it provides useful measures for post-hoc justification and other purposes.
For instance, one can use these local FDR estimates for prioritizing the hypotheses if strict FDR control is not required.
</p>
<p>In contrast to <code>adapt</code>, <code>cytm_lfdr</code> does not guarantee FDR control unless the model is correctly specified. It is recommended to use <code>ctgm_lfdr</code> only when FDR control is not required.
</p>
<p><code>x</code> should have a type compatible to the fitting functions in <code>models</code>. For GLM and GAM, <code>x</code> should be a data.frame. For glmnet, <code>x</code> should be a matrix.
</p>
<p><code>models</code> could either be an <code>adapt_model</code> object, if a single model is used, or a list of <code>adapt_model</code> objects, each of which corresponding to a model. Each element should be generated by <code>gen_adapt_model</code>. For glm/gam/glmnet, one can use the shortcut by running <code>gen_adapt_model</code> with name = "glm" or "gam" or "glmnet" but without specifying <code>pifun</code>, <code>mufun</code>, <code>pifun_init</code> and <code>mufun_init</code>. See examples below.
</p>
<p>When <code>type = "over"</code>, it yields a conservative estimate of local FDR
</p>
<p style="text-align: center;"><code class="reqn">lfdr(p) = (1 - \pi_{1} + \pi_{1}f_{1}(1)) / (1 - \pi_{1} + \pi_{1}f_{1}(p)).</code>
</p>

<p>When <code>type = "raw"</code>, it yields the original local FDR.
</p>
<p style="text-align: center;"><code class="reqn">lfdr(p) = (1 - \pi_{1}) / (1 - \pi_{1} + \pi_{1}f_{1}(p)).</code>
</p>

<p>The former is shown to be more stable and reliable because the weak identifiability in conditional mixture models.
</p>


<h3>Value</h3>


<ul>
<li>
<p>lfdra vector of values in [0, 1]. Local FDR estimates of each hypothesis.
</p>
</li>
<li>
<p>modelan <code>adapt_model</code> object. The selected model if multiple models are provided.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
# Load estrogen data
data(estrogen)
pvals &lt;- as.numeric(estrogen$pvals)
x &lt;- data.frame(x = as.numeric(estrogen$ord_high))
dist &lt;- beta_family()

# Subsample the data for convenience
inds &lt;- (x$x &lt;= 5000)
pvals &lt;- pvals[inds]
x &lt;- x[inds,,drop = FALSE]

# Generate models for function adapt
library("splines")
formulas &lt;- paste0("ns(x, df = ", 6:10, ")")
models &lt;- lapply(formulas, function(formula){
    piargs &lt;- muargs &lt;- list(formula = formula)
    gen_adapt_model(name = "glm", piargs = piargs, muargs = muargs)
})

# Run ctgm_lfdr with two types of lfdr estimates
res_over &lt;- ctgm_lfdr(x, pvals, models, type = "over")
res_raw &lt;- ctgm_lfdr(x, pvals, models, type = "raw")

# Compare two estimates
par(mfrow = c(2, 1))
hist(res_over$lfdr)
hist(res_raw$lfdr)


</code></pre>


</div>