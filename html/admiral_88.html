<div class="container">

<table style="width: 100%;"><tr>
<td>derive_vars_duration</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Derive Duration</h2>

<h3>Description</h3>

<p>Derives duration between two dates, specified by the variables present in
input dataset e.g., duration of adverse events, relative day, age, ...
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_vars_duration(
  dataset,
  new_var,
  new_var_unit = NULL,
  start_date,
  end_date,
  in_unit = "days",
  out_unit = "DAYS",
  floor_in = TRUE,
  add_one = TRUE,
  trunc_out = FALSE,
  type = "duration"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>start_date</code> and <code>end_date</code> arguments are expected to be in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_var</code></td>
<td>
<p>Name of variable to create</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_var_unit</code></td>
<td>
<p>Name of the unit variable If the parameter is not
specified, no variable for the unit is created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_date</code></td>
<td>
<p>The start date
</p>
<p>A date or date-time object is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.
</p>
<p>Refer to <code>convert_dtc_to_dt()</code> to obtain a vector of imputed dates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end_date</code></td>
<td>
<p>The end date
</p>
<p>A date or date-time object is expected.
</p>
<p>Refer to <code>derive_vars_dt()</code> to impute and derive a date from a date
character vector to a date object.
</p>
<p>Refer to <code>convert_dtc_to_dt()</code> to obtain a vector of imputed dates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>in_unit</code></td>
<td>
<p>Input unit
</p>
<p>See floor_in and add_one parameter for details.
</p>
<p>Permitted Values (case-insensitive):
</p>
<p>For years: <code>"year"</code>, <code>"years"</code>, <code>"yr"</code>, <code>"yrs"</code>, <code>"y"</code>
</p>
<p>For months: <code>"month"</code>, <code>"months"</code>, <code>"mo"</code>, <code>"mos"</code>
</p>
<p>For days: <code>"day"</code>, <code>"days"</code>, <code>"d"</code>
</p>
<p>For hours: <code>"hour"</code>, <code>"hours"</code>, <code>"hr"</code>, <code>"hrs"</code>, <code>"h"</code>
</p>
<p>For minutes: <code>"minute"</code>, <code>"minutes"</code>, <code>"min"</code>, <code>"mins"</code>
</p>
<p>For seconds: <code>"second"</code>, <code>"seconds"</code>, <code>"sec"</code>, <code>"secs"</code>, <code>"s"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out_unit</code></td>
<td>
<p>Output unit
</p>
<p>The duration is derived in the specified unit
</p>
<p>Permitted Values (case-insensitive):
</p>
<p>For years: <code>"year"</code>, <code>"years"</code>, <code>"yr"</code>, <code>"yrs"</code>, <code>"y"</code>
</p>
<p>For months: <code>"month"</code>, <code>"months"</code>, <code>"mo"</code>, <code>"mos"</code>
</p>
<p>For weeks: <code>"week"</code>, <code>"weeks"</code>, <code>"wk"</code>, <code>"wks"</code>, <code>"w"</code>
</p>
<p>For days: <code>"day"</code>, <code>"days"</code>, <code>"d"</code>
</p>
<p>For hours: <code>"hour"</code>, <code>"hours"</code>, <code>"hr"</code>, <code>"hrs"</code>, <code>"h"</code>
</p>
<p>For minutes: <code>"minute"</code>, <code>"minutes"</code>, <code>"min"</code>, <code>"mins"</code>
</p>
<p>For seconds: <code>"second"</code>, <code>"seconds"</code>, <code>"sec"</code>, <code>"secs"</code>, <code>"s"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>floor_in</code></td>
<td>
<p>Round down input dates?
</p>
<p>The input dates are round down with respect to the input unit, e.g., if the
input unit is 'days', the time of the input dates is ignored.
</p>
<p>Default: <code>TRUE</code>
</p>
<p>Permitted Values: <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_one</code></td>
<td>
<p>Add one input unit?
</p>
<p>If the duration is non-negative, one input unit is added. i.e., the
duration can not be zero.
</p>
<p>Default: <code>TRUE</code>
</p>
<p>Permitted Values: <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trunc_out</code></td>
<td>
<p>Return integer part
</p>
<p>The fractional part of the duration (in output unit) is removed, i.e., the
integer part is returned.
</p>
<p>Default: <code>FALSE</code>
</p>
<p>Permitted Values: <code>TRUE</code>, <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>lubridate duration type.
</p>
<p>See below for details.
</p>
<p>Default: <code>"duration"</code>
</p>
<p>Permitted Values: <code>"duration"</code>, <code>"interval"</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The duration is derived as time from start to end date in the
specified output unit. If the end date is before the start date, the duration
is negative. The start and end date variable must be present in the specified
input dataset.
</p>
<p>The <a href="https://lubridate.tidyverse.org/">lubridate</a> package calculates two
types of spans between two dates: duration and interval.
While these calculations are largely the same, when the unit of the time period
is month or year the result can be slightly different.
</p>
<p>The difference arises from the ambiguity in the length of <code>"1 month"</code> or
<code>"1 year"</code>.
Months may have 31, 30, 28, or 29 days, and years are 365 days and 366 during leap years.
Durations and intervals help solve the ambiguity in these measures.
</p>
<p>The <strong>interval</strong> between <code>2000-02-01</code> and <code>2000-03-01</code> is <code>1</code> (i.e. one month).
The <strong>duration</strong> between these two dates is <code>0.95</code>, which accounts for the fact
that the year 2000 is a leap year, February has 29 days, and the average month
length is <code>30.4375</code>, i.e. <code>29 / 30.4375 = 0.95</code>.
</p>
<p>For additional details, review the
<a href="https://lubridate.tidyverse.org/reference/timespan.html">lubridate time span reference page</a>.
</p>


<h3>Value</h3>

<p>The input dataset with the duration and unit variable added
</p>


<h3>See Also</h3>

<p><code>compute_duration()</code>
</p>
<p>Date/Time Derivation Functions that returns variable appended to dataset: 
<code>derive_var_trtdurd()</code>,
<code>derive_vars_dt()</code>,
<code>derive_vars_dtm()</code>,
<code>derive_vars_dtm_to_dt()</code>,
<code>derive_vars_dtm_to_tm()</code>,
<code>derive_vars_dy()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(lubridate)
library(tibble)

# Derive age in years
data &lt;- tribble(
  ~USUBJID, ~BRTHDT, ~RANDDT,
  "P01", ymd("1984-09-06"), ymd("2020-02-24"),
  "P02", ymd("1985-01-01"), NA,
  "P03", NA, ymd("2021-03-10"),
  "P04", NA, NA
)

derive_vars_duration(data,
  new_var = AAGE,
  new_var_unit = AAGEU,
  start_date = BRTHDT,
  end_date = RANDDT,
  out_unit = "years",
  add_one = FALSE,
  trunc_out = TRUE
)

# Derive adverse event duration in days
data &lt;- tribble(
  ~USUBJID, ~ASTDT, ~AENDT,
  "P01", ymd("2021-03-05"), ymd("2021-03-02"),
  "P02", ymd("2019-09-18"), ymd("2019-09-18"),
  "P03", ymd("1985-01-01"), NA,
  "P04", NA, NA
)

derive_vars_duration(data,
  new_var = ADURN,
  new_var_unit = ADURU,
  start_date = ASTDT,
  end_date = AENDT,
  out_unit = "days"
)

# Derive adverse event duration in minutes
data &lt;- tribble(
  ~USUBJID, ~ADTM, ~TRTSDTM,
  "P01", ymd_hms("2019-08-09T04:30:56"), ymd_hms("2019-08-09T05:00:00"),
  "P02", ymd_hms("2019-11-11T10:30:00"), ymd_hms("2019-11-11T11:30:00"),
  "P03", ymd_hms("2019-11-11T00:00:00"), ymd_hms("2019-11-11T04:00:00"),
  "P04", NA, ymd_hms("2019-11-11T12:34:56"),
)

derive_vars_duration(data,
  new_var = ADURN,
  new_var_unit = ADURU,
  start_date = ADTM,
  end_date = TRTSDTM,
  in_unit = "minutes",
  out_unit = "minutes",
  add_one = FALSE
)

# Derive adverse event start time since last dose in hours
data &lt;- tribble(
  ~USUBJID, ~ASTDTM, ~LDOSEDTM,
  "P01", ymd_hms("2019-08-09T04:30:56"), ymd_hms("2019-08-08T10:05:00"),
  "P02", ymd_hms("2019-11-11T23:59:59"), ymd_hms("2019-10-11T11:37:00"),
  "P03", ymd_hms("2019-11-11T00:00:00"), ymd_hms("2019-11-10T23:59:59"),
  "P04", ymd_hms("2019-11-11T12:34:56"), NA,
  "P05", NA, ymd_hms("2019-09-28T12:34:56")
)
derive_vars_duration(
  data,
  new_var = LDRELTM,
  new_var_unit = LDRELTMU,
  start_date = LDOSEDTM,
  end_date = ASTDTM,
  in_unit = "hours",
  out_unit = "hours",
  add_one = FALSE
)
</code></pre>


</div>