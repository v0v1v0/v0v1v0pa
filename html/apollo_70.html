<div class="container">

<table style="width: 100%;"><tr>
<td>apollo_outOfSample</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cross-validation of fit (LL)</h2>

<h3>Description</h3>

<p>Randomly generates estimation and validation samples, estimates the model on 
the first and calculates the likelihood for the second, then repeats.
</p>


<h3>Usage</h3>

<pre><code class="language-R">apollo_outOfSample(
  apollo_beta,
  apollo_fixed,
  apollo_probabilities,
  apollo_inputs,
  estimate_settings = list(estimationRoutine = "bgw", maxIterations = 200, writeIter =
    FALSE, hessianRoutine = "none", printLevel = 3L, silent = TRUE),
  outOfSample_settings = list(nRep = 10, validationSize = 0.1, samples = NA, rmse = NULL)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>apollo_beta</code></td>
<td>
<p>Named numeric vector. Names and values for parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apollo_fixed</code></td>
<td>
<p>Character vector. Names (as defined in 
<code>apollo_beta</code>) of parameters whose value should not 
change during estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apollo_probabilities</code></td>
<td>
<p>Function. Returns probabilities of the model to 
be estimated. Must receive three arguments:
</p>

<ul>
<li> <p><strong><code>apollo_beta</code></strong>: Named numeric 
vector. Names and values of model parameters.
</p>
</li>
<li> <p><strong><code>apollo_inputs</code></strong>: List 
containing options of the model. See 
apollo_validateInputs.
</p>
</li>
<li> <p><strong><code>functionality</code></strong>: Character. 
Can be either <strong><code>"components"</code></strong>, 
<code>"conditionals"</code>, <code>"estimate"</code> 
(default), <code>"gradient"</code>, 
<code>"output"</code>, <code>"prediction"</code>, 
<code>"preprocess"</code>, <code>"raw"</code>, 
<code>"report"</code>, <code>"shares_LL"</code>, 
<code>"validate"</code> or <code>"zero_LL"</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apollo_inputs</code></td>
<td>
<p>List grouping most common inputs. Created by function 
apollo_validateInputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate_settings</code></td>
<td>
<p>List. Options controlling the estimation process. 
See apollo_estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outOfSample_settings</code></td>
<td>
<p>List. Contains settings for this function. User 
input is required for all settings except those 
with a default or marked as optional. 
</p>

<dl>
<dt>nRep</dt>
<dd>
<p>Numeric scalar. Number of 
times a different pair of 
estimation and validation 
sets are to be extracted 
from the full database.
Default is 30.</p>
</dd>
<dt>samples</dt>
<dd>
<p>Numeric matrix or 
data.frame. Optional 
argument. Must have as 
many rows as observations 
in the <code>database</code>, 
and as many columns as 
number of  repetitions 
wanted. Each column 
represents a re-sample, 
and each element must be 
a 0 if the observation 
should be assigned to the 
estimation sample, or 1 
if the observation should 
be assigned to the 
prediction sample. If this 
argument is provided, then 
<code>nRep</code> and 
<code>validationSize</code> are 
ignored. Note that this 
allows sampling at the 
observation rather than 
the individual level.</p>
</dd>
<dt>validationSize</dt>
<dd>
<p>Numeric scalar. 
Size of the 
validation sample. 
Can be a percentage 
of the sample (0-1) 
or the number of 
individuals in the 
validation sample 
(&gt;1). Default is 
0.1.</p>
</dd>
<dt>rmse</dt>
<dd>
<p>Character matrix with two
columns. Used to calculate 
Root Mean Squared Error (RMSE) 
of prediction. The first 
column must contain the names 
of observed outcomes in the 
database. The second column 
must contain the names of the 
predicted outcomes as 
returned by 
<code>apollo_prediction</code>. 
If omitted or NULL, no RMSE 
is calculated. This only 
works for models with a 
single component.</p>
</dd>
</dl>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A common way to test for overfitting of a model is to measure its fit on a 
sample not used during estimation that is, measuring its out-of-sample fit. 
A simple way to do this is splitting the complete available dataset in two 
parts: an estimation sample, and a validation sample. 
The model of interest is estimated using only the estimation sample, and 
then those estimated parameters are used to measure the fit of the model 
(e.g. the log-likelihood of the model) on the validation sample. Doing this 
with only one validation sample, however, may lead to biased results, as a 
particular validation sample need not be representative of the population. 
One way to minimise this issue is to randomly draw several pairs of 
estimation and validation samples from the complete dataset, and apply the 
procedure to each pair.
</p>
<p>The splitting of the database into estimation and validation samples is done 
at the individual level, not at the observation level. If the sampling wants 
to be done at the individual level (not recommended on panel data), then the 
optional <code>outOfSample_settings$samples</code> argument should be provided.
</p>
<p>This function writes two different files to the working/output directory:
</p>

<ul>
<li> <p><strong><code>modelName_outOfSample_params.csv</code></strong>: Records the 
estimated parameters, final log-likelihood, and number of 
observations on each repetition.
</p>
</li>
<li> <p><strong><code>modelName_outOfSample_samples.csv</code></strong>: Records the 
sample composition of each repetition.
</p>
</li>
</ul>
<p>The first two files are updated throughout the run of this function, while 
the last one is only written once the function finishes.
</p>
<p>When run, this function will look for the two files above in the 
working/output directory. If they are found, the function will attempt to 
pick up re-sampling from where those files left off. This is useful in cases 
where the original bootstrapping was interrupted, or when additional 
re-sampling wants to be performed.
</p>


<h3>Value</h3>

<p>A matrix with the average log-likelihood per observation for both the 
estimation and validation samples, for each repetition. Two additional 
files with further details are written to the working/output directory.
</p>


</div>