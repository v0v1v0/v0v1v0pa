<div class="container">

<table style="width: 100%;"><tr>
<td>accrual_plot_predict</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Accrual prediction plots</h2>

<h3>Description</h3>

<p>Generates an accrual prediction plot using an accrual data frame produced by <code>accrual_create_df</code>
and a target sample size. Prediction is based on a weighted linear regression.
If the accrual data frame is a list (i.e. using the by option in <code>accrual_create_df</code>),
or if center start dates are given, the number of enrolled and targeted sites is included.
</p>


<h3>Usage</h3>

<pre><code class="language-R">accrual_plot_predict(
  accrual_df,
  target,
  overall = TRUE,
  name_overall = attr(accrual_df, "name_overall"),
  fill_up = TRUE,
  wfun = function(x) seq(1/nrow(x), 1, by = 1/nrow(x)),
  col.obs = NULL,
  lty.obs = 1,
  col.pred = "red",
  lty.pred = 2,
  pch.pred = 8,
  pos_prediction = c("out", "in", "none"),
  label_prediction = NULL,
  cex_prediction = 1,
  format_prediction = "%B %d, %Y",
  show_center = TRUE,
  design = 1,
  center_label = "Centers",
  center_legend = c("number", "strip"),
  targetc = NA,
  center_colors = NULL,
  center_legend_text_size = 0.7,
  ylim = NA,
  xlim = NA,
  ylab = "Recruited patients",
  xlabformat = "%d%b%Y",
  xlabn = 5,
  xlabminn = xlabn%/%2,
  xlabpos = NA,
  xlabsrt = 45,
  xlabadj = c(1, 1),
  xlabcex = 1,
  mar = NA,
  legend.list = NULL,
  ...,
  center_start_dates = NULL
)

gg_accrual_plot_predict(
  accrual_df,
  target,
  overall = TRUE,
  name_overall = attr(accrual_df, "name_overall"),
  col.pred = "red",
  lty.pred = 2,
  pch.pred = 8,
  fill_up = TRUE,
  wfun = function(x) seq(1/nrow(x), 1, by = 1/nrow(x)),
  pos_prediction = c("out", "in", "none"),
  label_prediction = NULL,
  format_prediction = "%B %d, %Y",
  xlabformat = "%d%b%Y"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>accrual_df</code></td>
<td>
<p>object of class 'accrual_df' or 'accrual_list' produced by <code>accrual_create_df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>target sample size or date to predict end date or expected sample size, respectively.
A single number or date, or a named vector with the same length as accrual_df.
For the latter, center-specific predictions are shown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall</code></td>
<td>
<p>logical, indicates that accrual_df contains a summary with all sites (only if by is not NA).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name_overall</code></td>
<td>
<p>name of the summary with all sites (if by is not NA and overall==TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill_up</code></td>
<td>
<p>whether to fill up days where no recruitment was observed,
otherwise these points do not contribute to the regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wfun</code></td>
<td>
<p>function to calculate the weights with accrual data frame as argument,
default is wfun&lt;-function(x) seq(1 / nrow(x), 1, by = 1/nrow(x)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.obs</code></td>
<td>
<p>line color of cumulative recruitment, can be a vector with the same length as accrual_df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty.obs</code></td>
<td>
<p>line type of cumulative recruitment, can be a vector with the same length as accrual_df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.pred</code></td>
<td>
<p>line color of prediction, can be a vector with the same length as accrual_df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty.pred</code></td>
<td>
<p>line color of prediction, can be a vector with the same length as accrual_df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch.pred</code></td>
<td>
<p>point symbol for end of prediction, can be a vector with the same length as accrual_df.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pos_prediction</code></td>
<td>
<p>position of text with predicted end date or sample size,
either <code>"out"</code>, <code>"in"</code> or <code>"none"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_prediction</code></td>
<td>
<p>label for predicted end date or sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex_prediction</code></td>
<td>
<p>text size for predicted end date or sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format_prediction</code></td>
<td>
<p>date format for predicted end date (only if target is a sample size)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_center</code></td>
<td>
<p>logical, whether the center info should be shown
(if accrual_df is a list or if center_start_dates are given).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>design</code></td>
<td>
<p>design options for the center info
1 (default): below plot, 2: within plot, top, 3: within plot, bottom.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_label</code></td>
<td>
<p>label for the center info.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_legend</code></td>
<td>
<p>either "number" to plot numbers in the center strip or "strip" to add a legend strip,
requires specification of center_colors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>targetc</code></td>
<td>
<p>target number of centers, to scale the legend if it is "strip".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_colors</code></td>
<td>
<p>colors to be used for the strip with the centers, a vector of length targetc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_legend_text_size</code></td>
<td>
<p>size of the text of the center or legend strip, only has a function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>limits for y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>limits for x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>y-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabformat</code></td>
<td>
<p>format of date on x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabn</code></td>
<td>
<p>integer giving the desired number of intervals for the xlabel, default=5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabminn</code></td>
<td>
<p>integer giving the minimal number of intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabpos</code></td>
<td>
<p>position of the x-label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabsrt</code></td>
<td>
<p>rotation of x-axis labels in degrees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabadj</code></td>
<td>
<p>adjustment of x-label, numeric vector with length 1 or 2 for different adjustment in x- and y-direction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlabcex</code></td>
<td>
<p>size of x-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar</code></td>
<td>
<p>vector of length 4 (bottom, left, top, right margins), overwrite default margins.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.list</code></td>
<td>
<p>named list with options passed to legend(), only if accrual data frame is a list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further options passed to plot() and axis().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_start_dates</code></td>
<td>
<p>alternative way to add center info,
vector with dates on which centers are enrolled.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When the <code>accrual_df</code> includes multiple sites, the dataframe
passed to <code>ggplot</code> includes a <code>site</code> variable
which can be used for facetting
</p>


<h3>Value</h3>

<p><code>accrual_plot_predict</code> returns a plot with the accrual prediction.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(accrualdemo)
accrual_df&lt;-accrual_create_df(accrualdemo$date)
##Predict end date
accrual_plot_predict(accrual_df=accrual_df,target=300)
##Predict sample size
accrual_plot_predict(accrual_df=accrual_df,as.Date("2020-11-01"))

#Include site
accrual_df&lt;-accrual_create_df(accrualdemo$date,by=accrualdemo$site)
accrual_plot_predict(accrual_df=accrual_df,target=300,center_label="Site")
## with strip and target
accrual_plot_predict(accrual_df=accrual_df,target=300,center_label="Site",
 targetc=5,center_colors=heat.colors(5),center_legend="strip")

#Design for site
accrual_plot_predict(accrual_df=accrual_df,target=300,design=2)

#Format prediction end date
accrual_plot_predict(accrual_df=accrual_df,target=300,
     pos_prediction="in",label_prediction="End of accrual: ",cex_prediction=1.2,
     format_prediction="%Y-%m-%d",ylim=c(0,150))

#Format plot
accrual_plot_predict(accrual_df=accrual_df,target=300,
     ylab="No of recruited patients",ylim=c(0,150),
     xlabcex=1.2,xlabsrt=30,xlabn=5,xlabmin=5,
     mgp=c(3,0.5,0),cex.lab=1.2,cex.axis=1.2)

#predictions for all sites
accrual_plot_predict(accrual_df=accrual_df,
target=c("Site 1"=160,"Site 2"=100,"Site 3"=40,"Overall"=300))
## different colors
accrual_plot_predict(accrual_df=accrual_df,
target=c("Site 1"=160,"Site 2"=100,"Site 3"=40,"Overall"=300),
col.obs=topo.colors(length(accrual_df)))
##not showing center info
accrual_plot_predict(accrual_df=accrual_df,
target=c("Site 1"=160,"Site 2"=100,"Site 3"=40,"Overall"=300),
show_center=FALSE)

#predictions of sample size for all sites
target&lt;-rep(as.Date("2020-11-01"),4)
names(target)&lt;-c("Site 1","Site 2","Site 3","Overall")
accrual_plot_predict(accrual_df=accrual_df,target=target,col.obs=topo.colors(length(accrual_df)))
### ggplot2 approach
data(accrualdemo)
accrual_df&lt;-accrual_create_df(accrualdemo$date)
gg_accrual_plot_predict(accrual_df = accrual_df, target = 300)
gg_accrual_plot_predict(accrual_df = accrual_df, target = 300) +
  ggplot2::theme_classic()

#Include site
accrual_df&lt;-accrual_create_df(accrualdemo$date, by=accrualdemo$site)
gg_accrual_plot_predict(accrual_df=accrual_df, target=300)


#Format prediction end date
gg_accrual_plot_predict(accrual_df = accrual_df,
target=300,
pos_prediction="in",
format_prediction="%Y-%m-%d")


#predictions for all sites
gg_accrual_plot_predict(accrual_df = accrual_df,
target=c("Site 1"=160,"Site 2"=100,"Site 3"=40,"Overall"=300))
gg_accrual_plot_predict(accrual_df = accrual_df,
 target=c("Site 1"=160,"Site 2"=100,"Site 3"=40,"Overall"=300)) +
	ggplot2::theme(legend.position = c(0.15,.9)) +
	ggplot2::labs(col = "Site")
</code></pre>


</div>