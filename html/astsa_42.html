<div class="container">

<table style="width: 100%;"><tr>
<td>ffbs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Forward Filtering Backward Sampling
</h2>

<h3>Description</h3>

<p>FFBS algorithm for state space models
</p>


<h3>Usage</h3>

<pre><code class="language-R">ffbs(y, A, mu0, Sigma0, Phi, sQ, sR, Ups = NULL, Gam = NULL, input = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y </code></td>
<td>
<p>Data matrix, vector or time series.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A </code></td>
<td>
<p>Observation matrix. Can be constant or an array with 
<code>dim=c(q,p,n)</code> if time varying.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu0 </code></td>
<td>
<p>Initial state mean.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma0 </code></td>
<td>
<p>Initial state covariance matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Phi </code></td>
<td>
<p>State transition matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sQ </code></td>
<td>
<p>State error covariance matrix is <code>Q = sQ%*%t(sQ)</code> – see details below. In the univariate case, it is the standard deviation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sR </code></td>
<td>
<p>Observation error covariance matrix is <code>R = sR%*%t(sR)</code> – see details below. In the univariate case, it is the standard deviation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ups </code></td>
<td>
<p>State input matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gam </code></td>
<td>
<p>Observation input matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input </code></td>
<td>
<p>matrix or vector of inputs having the same row dimension as y.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For a linear state space model,
the FFBS algorithm provides a way to sample a state sequence <code class="reqn">x_{0:n}</code> 
from the posterior <code class="reqn">\pi(x_{0:n} \mid \Theta, y_{1:n})</code>
with parameters <code class="reqn">\Theta</code> and  data <code class="reqn">y_{1:n}</code>.
</p>
<p>The general model  is
</p>
<p style="text-align: center;"><code class="reqn">x_t = \Phi  x_{t-1} + \Upsilon u_{t} +   sQ\,  w_t \quad w_t \sim iid\ N(0,I)</code>
</p>

<p style="text-align: center;"><code class="reqn">y_t = A_t  x_{t-1} + \Gamma u_{t} +   sR\, v_t \quad v_t \sim iid\ N(0,I)</code>
</p>

<p>where <code class="reqn">w_t \perp v_t</code>. Consequently the state noise covariance matrix is
<code class="reqn">Q = sQ\, sQ'</code> and the observation noise covariance matrix is
<code class="reqn">R = sR\, sR'</code> and <code class="reqn">sQ, sR</code>  do not have to be square as long as everything is
conformable.
</p>
<p><code class="reqn">x_t</code> is p-dimensional, <code class="reqn">y_t</code> is q-dimensional, and  <code class="reqn">u_t</code> is r-dimensional.
Note that <code class="reqn">sQ\, w_t</code>  has to be p-dimensional, but  <code class="reqn">w_t</code> does not, and
<code class="reqn">sR\, v_t</code>  has to be q-dimensional, but  <code class="reqn">v_t</code> does not.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Xs </code></td>
<td>
<p>An array of sampled states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X0n </code></td>
<td>
<p>The sampled initial state (because R is 1-based) </p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The script uses <code>Kfilter</code>.  If <code class="reqn">A_t</code> is constant wrt time, it is not necessary to
input an array; see the example.  The example below is just one pass of the algorithm; see the example
at <a href="https://github.com/nickpoison/astsa/blob/master/fun_with_astsa/fun_with_astsa.md#gibbs-sampling-for-linear-state-space-models">FUN WITH ASTSA</a> for the real fun.
</p>


<h3>Author(s)</h3>

<p>D.S. Stoffer
</p>


<h3>Source</h3>

<p>Chapter 6 of the Shumway and Stoffer Springer text. 
</p>


<h3>References</h3>

<p>You can find demonstrations of  astsa capabilities at 
<a href="https://github.com/nickpoison/astsa/blob/master/fun_with_astsa/fun_with_astsa.md">FUN WITH ASTSA</a>.
</p>
<p>The most recent version of the package can be found  at <a href="https://github.com/nickpoison/astsa/">https://github.com/nickpoison/astsa/</a>.
</p>
<p>In addition, the News and ChangeLog files are at  <a href="https://github.com/nickpoison/astsa/blob/master/NEWS.md">https://github.com/nickpoison/astsa/blob/master/NEWS.md</a>.
</p>
<p>The webpages for the texts and some help on using R for time series analysis can be found at
<a href="https://nickpoison.github.io/">https://nickpoison.github.io/</a>. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

## -- this is just one pass --##
# generate some data
 set.seed(1)
 sQ  = 1; sR = 3; n = 100  
 mu0 = 0; Sigma0 = 10; x0 = rnorm(1,mu0,Sigma0)
 w = rnorm(n); v = rnorm(n)
 x = c(x0 + sQ*w[1]);  y = c(x[1] + sR*v[1])   # initialize
for (t in 2:n){
  x[t] = x[t-1] + sQ*w[t]
  y[t] = x[t] + sR*v[t]   
  }

## run one pass of FFBS, plot data, states and sampled states  
run = ffbs(y, A=1, mu0=0, Sigma0=10, Phi=1, sQ=1, sR=3)
tsplot(cbind(y,run$Xs), spaghetti=TRUE, type='o', col=c(8,4), pch=c(1,NA))
legend('topleft', legend=c("y(t)","xs(t)"), lty=1, col=c(8,4), bty="n", pch=c(1,NA))

## End(Not run)
</code></pre>


</div>