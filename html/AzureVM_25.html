<div class="container">

<table style="width: 100%;"><tr>
<td>centos_7.5</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>VM configuration functions</h2>

<h3>Description</h3>

<p>VM configuration functions
</p>


<h3>Usage</h3>

<pre><code class="language-R">centos_7.5(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

centos_7.6(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

centos_8.1(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

debian_8_backports(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

debian_9_backports(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

debian_10_backports(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

debian_10_backports_gen2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

ubuntu_dsvm(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh,
  nsg_rule_allow_jupyter, nsg_rule_allow_rstudio)), ...)

ubuntu_dsvm_gen2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh,
  nsg_rule_allow_jupyter, nsg_rule_allow_rstudio)), ...)

windows_dsvm(keylogin = FALSE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_rdp)), ...)

rhel_7.6(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

rhel_8(keylogin = TRUE, managed_identity = TRUE, datadisks = numeric(0),
  nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

rhel_8.1(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

rhel_8.1_gen2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

rhel_8.2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

rhel_8.2_gen2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

ubuntu_16.04(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

ubuntu_18.04(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

ubuntu_20.04(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

ubuntu_20.04_gen2(keylogin = TRUE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_ssh)), ...)

windows_2016(keylogin = FALSE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_rdp)), ...)

windows_2019(keylogin = FALSE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_rdp)), ...)

windows_2019_gen2(keylogin = FALSE, managed_identity = TRUE,
  datadisks = numeric(0), nsg = nsg_config(list(nsg_rule_allow_rdp)), ...)

vm_config(image, keylogin, managed_identity = TRUE,
  os_disk_type = c("Premium_LRS", "StandardSSD_LRS", "Standard_LRS"),
  datadisks = numeric(0), nsg = nsg_config(), ip = ip_config(),
  vnet = vnet_config(), nic = nic_config(), other_resources = list(),
  variables = list(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>keylogin</code></td>
<td>
<p>Whether to use an SSH public key to login (TRUE) or a password (FALSE). Note that Windows does not support SSH key logins.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>managed_identity</code></td>
<td>
<p>Whether to provide a managed system identity for the VM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datadisks</code></td>
<td>
<p>The data disks to attach to the VM. Specify this as either a vector of numeric disk sizes in GB, or a list of <code>datadisk_config</code> objects for more control over the specification.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsg</code></td>
<td>
<p>The network security group for the VM. Can be a call to <code>nsg_config</code> to create a new NSG; an AzureRMR resource object or resource ID to reuse an existing NSG; or NULL to not use an NSG (not recommended).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>For the specific VM configurations, other customisation arguments to be passed to <code>vm_config</code>. For <code>vm_config</code>, named arguments that will be folded into the VM resource definition in the template. In particular use <code style="white-space: pre;">⁠properties=list(*)⁠</code> to set additional properties for the VM, beyond those set by the various configuration functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>image</code></td>
<td>
<p>For <code>vm_config</code>, the VM image to deploy. This should be an object of class <code>image_config</code>, created by the function of the same name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>os_disk_type</code></td>
<td>
<p>The type of primary disk for the VM. Can be "Premium_LRS" (the default), "StandardSSD_LRS", or "Standard_LRS". Of these, "Standard_LRS" uses hard disks and the others use SSDs as the underlying hardware. Change this to "StandardSSD_LRS" or "Standard_LRS" if the VM size doesn't support premium storage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ip</code></td>
<td>
<p>The public IP address for the VM. Can be a call to <code>ip_config</code> to create a new IP address; an AzureRMR resource object or resource ID to reuse an existing address resource; or NULL if the VM should not be accessible from outside its subnet.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vnet</code></td>
<td>
<p>The virtual network for the VM. Can be a call to <code>vnet_config</code> to create a new virtual network, or an AzureRMR resource object or resource ID to reuse an existing virtual network. Note that by default, AzureVM will associate the NSG with the virtual network/subnet, not with the VM's network interface.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nic</code></td>
<td>
<p>The network interface for the VM. Can be a call to <code>nic_config</code> to create a new interface, or an AzureRMR resource object or resource ID to reuse an existing interface.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>other_resources</code></td>
<td>
<p>An optional list of other resources to include in the deployment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>An optional named list of variables to add to the template.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These functions are for specifying the details of a new virtual machine deployment: the VM image and related options, along with the Azure resources that the VM may need. These include the datadisks, network security group, public IP address (if the VM is to be accessible from outside its subnet), virtual network, and network interface. <code>vm_config</code> is the base configuration function, and the others call it to create VMs with specific operating systems and other image details.
</p>

<ul>
<li> <p><code>ubuntu_dsvm</code>: Data Science Virtual Machine, based on Ubuntu 18.04
</p>
</li>
<li> <p><code>windows_dsvm</code>: Data Science Virtual Machine, based on Windows Server 2019
</p>
</li>
<li> <p><code>ubuntu_16.04</code>, <code>ubuntu_18.04</code>, <code>ubuntu_20.04</code>, <code>ubuntu_20.04_gen2</code>: Ubuntu LTS
</p>
</li>
<li> <p><code>windows_2016</code>, <code>windows_2019</code>: Windows Server Datacenter edition
</p>
</li>
<li> <p><code>rhel_7.6</code>, <code>rhel_8</code>, <code>rhel_8.1</code>, <code>rhel_8.1_gen2</code>, <code>rhel_8.2</code>, “rhel_8.2_gen2: Red Hat Enterprise Linux
</p>
</li>
<li> <p><code>centos_7.5</code>, <code>centos_7.6</code>, <code>centos_8.1</code>: CentOS
</p>
</li>
<li> <p><code>debian_8_backports</code>, <code>debian_9_backports</code>, <code>debian_10_backports</code>, <code>debian_10_backports_gen2</code>: Debian with backports
</p>
</li>
</ul>
<p>The VM configurations with <code>gen2</code> in the name are <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/generation-2">generation 2 VMs</a>, which feature several technical improvements over the earlier generation 1. Consider using these for greater efficiency, however note that gen2 VMs are only available for select images and do not support all possible VM sizes.
</p>
<p>Each resource can be specified in a number of ways:
</p>

<ul>
<li>
<p> To <em>create</em> a new resource as part of the deployment, call the corresponding <code style="white-space: pre;">⁠*_config⁠</code> function.
</p>
</li>
<li>
<p> To use an <em>existing</em> resource, supply either an <code>AzureRMR::az_resource</code> object (recommended) or a string containing the resource ID.
</p>
</li>
<li>
<p> If the resource is not needed, specify it as NULL.
</p>
</li>
<li>
<p> For the <code>other_resources</code> argument, supply a list of resources, each of which should be a list of resource fields (name, type, properties, sku, etc).
</p>
</li>
</ul>
<p>A VM configuration defines the following template variables by default, depending on its resources. If a particular resource is created, the corresponding <code style="white-space: pre;">⁠*Name⁠</code>, <code style="white-space: pre;">⁠*Id⁠</code> and <code style="white-space: pre;">⁠*Ref⁠</code> variables will be available. If a resource is referred to but not created, the <code style="white-space: pre;">⁠*Name*⁠</code> and <code style="white-space: pre;">⁠*Id⁠</code> variables will be available. Other variables can be defined via the <code>variables</code> argument.
</p>

<table>
<tr>
<td style="text-align: left;">
<strong>Variable name</strong> </td>
<td style="text-align: left;"> <strong>Contents</strong> </td>
<td style="text-align: left;"> <strong>Description</strong> </td>
</tr>
<tr>
<td style="text-align: left;">
<code>location</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceGroup().location]⁠</code> </td>
<td style="text-align: left;"> Region to deploy resources </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vmId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Compute/virtualMachines', parameters('vmName'))]⁠</code> </td>
<td style="text-align: left;"> VM resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vmRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]⁠</code> </td>
<td style="text-align: left;"> VM template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-nsg')]⁠</code> </td>
<td style="text-align: left;"> Network security group resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]⁠</code> </td>
<td style="text-align: left;"> NSG resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nsgRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/networkSecurityGroups/', variables('nsgName'))]⁠</code> </td>
<td style="text-align: left;"> NSG template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-ip')]⁠</code> </td>
<td style="text-align: left;"> Public IP address resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/publicIPAddresses', variables('ipName'))]⁠</code> </td>
<td style="text-align: left;"> IP resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>ipRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/publicIPAddresses/', variables('ipName'))]⁠</code> </td>
<td style="text-align: left;"> IP template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-vnet')]⁠</code> </td>
<td style="text-align: left;"> Virtual network resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/virtualNetworks', variables('vnetName'))]⁠</code> </td>
<td style="text-align: left;"> Vnet resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>vnetRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/virtualNetworks/', variables('vnetName'))]⁠</code> </td>
<td style="text-align: left;"> Vnet template reference </td>
</tr>
<tr>
<td style="text-align: left;">
<code>subnet</code> </td>
<td style="text-align: left;"> <code>subnet</code> </td>
<td style="text-align: left;"> Subnet name. Only defined if a Vnet was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>subnetId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(variables('vnetId'), '/subnets/', variables('subnet'))]⁠</code> </td>
<td style="text-align: left;"> Subnet resource ID. Only defined if a Vnet was created or supplied as an <code>az_resource</code> object. </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nicName</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat(parameters('vmName'), '-nic')]⁠</code> </td>
<td style="text-align: left;"> Network interface resource name </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nicId</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[resourceId('Microsoft.Network/networkInterfaces', variables('nicName'))]⁠</code> </td>
<td style="text-align: left;"> NIC resource ID </td>
</tr>
<tr>
<td style="text-align: left;">
<code>nicRef</code> </td>
<td style="text-align: left;"> <code style="white-space: pre;">⁠[concat('Microsoft.Network/networkInterfaces/', variables('nicName'))]⁠</code> </td>
<td style="text-align: left;"> NIC template reference
</td>
</tr>
</table>
<p>Thus, for example, if you are creating a VM named "myvm" along with all its associated resources, the NSG is named "myvm-nsg", the public IP address is "myvm-ip", the virtual network is "myvm-vnet", and the network interface is "myvm-nic".
</p>


<h3>Value</h3>

<p>An object of S3 class <code>vm_config</code>, that can be used by the <code>create_vm</code> method.
</p>


<h3>See Also</h3>

<p>image_config, user_config, datadisk_config for options relating to the VM resource itself
</p>
<p>nsg_config, ip_config, vnet_config, nic_config for other resource configs
</p>
<p>build_template for template builder methods
</p>
<p>vmss_config for configuring a virtual machine scaleset
</p>
<p>create_vm
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# basic Linux (Ubuntu) and Windows configs
ubuntu_18.04()
windows_2019()

# Windows DSVM with 500GB data disk, no public IP address
windows_dsvm(datadisks=500, ip=NULL)

# RHEL VM exposing ports 80 (HTTP) and 443 (HTTPS)
rhel_8(nsg=nsg_config(nsg_rule_allow_http, nsg_rule_allow_https))

# exposing no ports externally, spot (low) priority
rhel_8(nsg=nsg_config(list()), properties=list(priority="spot"))

# deploying an extra resource: storage account
ubuntu_18.04(
    variables=list(storName="[concat(parameters('vmName'), 'stor')]"),
    other_resources=list(
        list(
            type="Microsoft.Storage/storageAccounts",
            name="[variables('storName')]",
            apiVersion="2018-07-01",
            location="[variables('location')]",
            properties=list(supportsHttpsTrafficOnly=TRUE),
            sku=list(name="Standard_LRS"),
            kind="Storage"
        )
    )
)

## custom VM configuration: Windows 10 Pro 1903 with data disks
## this assumes you have a valid Win10 desktop license
user &lt;- user_config("myname", password="Use-strong-passwords!")
image &lt;- image_config(
     publisher="MicrosoftWindowsDesktop",
     offer="Windows-10",
     sku="19h1-pro"
)
datadisks &lt;- list(
    datadisk_config(250, type="Premium_LRS"),
    datadisk_config(1000, type="Standard_LRS")
)
nsg &lt;- nsg_config(
    list(nsg_rule_allow_rdp)
)
vm_config(
    image=image,
    keylogin=FALSE,
    datadisks=datadisks,
    nsg=nsg,
    properties=list(licenseType="Windows_Client")
)


## Not run: 

# reusing existing resources: placing multiple VMs in one vnet/subnet
rg &lt;- AzureRMR::get_azure_login()$
    get_subscription("sub_id")$
    get_resource_group("rgname")

vnet &lt;- rg$get_resource(type="Microsoft.Network/virtualNetworks", name="myvnet")

# by default, the NSG is associated with the subnet, so we don't need a new NSG either
vmconfig1 &lt;- ubuntu_18.04(vnet=vnet, nsg=NULL)
vmconfig2 &lt;- debian_9_backports(vnet=vnet, nsg=NULL)
vmconfig3 &lt;- windows_2019(vnet=vnet, nsg=NULL)


## End(Not run)
</code></pre>


</div>