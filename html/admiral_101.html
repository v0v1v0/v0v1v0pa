<div class="container">

<table style="width: 100%;"><tr>
<td>derive_var_atoxgr_dir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Derive Lab Toxicity Grade 0 - 4</h2>

<h3>Description</h3>

<p>Derives a character lab grade based on severity/toxicity criteria.
</p>


<h3>Usage</h3>

<pre><code class="language-R">derive_var_atoxgr_dir(
  dataset,
  new_var,
  tox_description_var,
  meta_criteria,
  criteria_direction,
  get_unit_expr,
  signif_dig = get_admiral_option("signif_digits")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>Input dataset
</p>
<p>The variables specified by the <code>tox_description_var</code> argument are expected to be in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_var</code></td>
<td>
<p>Name of the character grade variable to create, for example, <code>ATOXGRH</code>
or <code>ATOXGRL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tox_description_var</code></td>
<td>
<p>Variable containing the description of the grading
criteria. For example: "Anemia" or "INR Increased".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meta_criteria</code></td>
<td>
<p>Metadata data set holding the criteria (normally a case statement)
</p>
<p>Permitted Values: <code>atoxgr_criteria_ctcv4</code>, <code>atoxgr_criteria_ctcv5</code>, <code>atoxgr_criteria_daids</code>
</p>

<ul>
<li> <p><code>atoxgr_criteria_ctcv4</code> implements <a href="https://ctep.cancer.gov/protocoldevelopment/electronic_applications/ctc.htm">Common Terminology Criteria for Adverse Events (CTCAE) v4.0</a>
</p>
</li>
<li> <p><code>atoxgr_criteria_ctcv5</code> implements <a href="https://ctep.cancer.gov/protocoldevelopment/electronic_applications/ctc.htm">Common Terminology Criteria for Adverse Events (CTCAE) v5.0</a>
</p>
</li>
<li> <p><code>atoxgr_criteria_daids</code> implements
<a href="https://rsc.niaid.nih.gov/sites/default/files/daidsgradingcorrectedv21.pdf">Division of AIDS (DAIDS) Table for Grading the Severity of Adult and Pediatric Adverse Events</a>
</p>
<p>The metadata should have the following variables:
</p>
</li>
<li> <p><code>TERM</code>: variable to hold the term describing the criteria applied to a particular lab test,
eg. "Anemia" or "INR Increased". Note: the variable is case insensitive.
</p>
</li>
<li> <p><code>DIRECTION</code>: variable to hold the direction of the abnormality of a particular lab test
value. "L" is for LOW values, "H" is for HIGH values. Note: the variable is case insensitive.
</p>
</li>
<li> <p><code>SI_UNIT_CHECK</code>: variable to hold unit of particular lab test. Used to check against input data
if criteria is based on absolute values.
</p>
</li>
<li> <p><code>VAR_CHECK</code>: variable to hold comma separated list of variables used in criteria. Used to check
against input data that variables exist.
</p>
</li>
<li> <p><code>GRADE_CRITERIA_CODE</code>: variable to hold code that creates grade based on defined criteria.
</p>
</li>
<li> <p><code>FILTER</code>: Required only for DAIDS grading, specifies <code>admiral</code> code to filter the lab data
based on a subset of subjects (e.g. AGE &gt; 18 YEARS)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criteria_direction</code></td>
<td>
<p>Direction (L= Low, H = High) of toxicity grade.
</p>
<p>Permitted Values: "L", "H"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>get_unit_expr</code></td>
<td>
<p>An expression providing the unit of the parameter
</p>
<p>The result is used to check the units of the input parameters. Compared with
<code>SI_UNIT_CHECK</code> in metadata (see <code>meta_criteria</code> parameter).
</p>
<p>Permitted Values: A variable containing unit from the input dataset, or a function call,
for example, <code>get_unit_expr = extract_unit(PARAM)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>signif_dig</code></td>
<td>
<p>Number of significant digits to use when comparing a lab value against another
value.
</p>
<p>Significant digits used to avoid floating point discrepancies when comparing numeric values.
See blog: <a href="https://pharmaverse.github.io/blog/posts/2023-10-30_floating_point/floating_point.html">How admiral handles floating points</a></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>new_var</code> is derived with values NA, "0", "1", "2", "3", "4", where "4" is the most
severe grade
</p>

<ul>
<li>
<p> "4" is where the lab value satisfies the criteria for grade 4.
</p>
</li>
<li>
<p> "3" is where the lab value satisfies the criteria for grade 3.
</p>
</li>
<li>
<p> "2" is where the lab value satisfies the criteria for grade 2.
</p>
</li>
<li>
<p> "1" is where the lab value satisfies the criteria for grade 1.
</p>
</li>
<li>
<p> "0" is where a grade can be derived and is not grade "1", "2", "3" or "4".
</p>
</li>
<li>
<p> NA is where a grade cannot be derived.
</p>
</li>
</ul>
<h3>Value</h3>

<p>The input dataset with the character variable added
</p>


<h3>See Also</h3>

<p>BDS-Findings Functions that returns variable appended to dataset: 
<code>derive_basetype_records()</code>,
<code>derive_var_analysis_ratio()</code>,
<code>derive_var_anrind()</code>,
<code>derive_var_atoxgr()</code>,
<code>derive_var_base()</code>,
<code>derive_var_chg()</code>,
<code>derive_var_ontrtfl()</code>,
<code>derive_var_pchg()</code>,
<code>derive_var_shift()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(tibble)

data &lt;- tribble(
  ~ATOXDSCL,                    ~AVAL, ~ANRLO, ~ANRHI, ~PARAM,
  "Hypoglycemia",               119,   4,      7,      "Glucose (mmol/L)",
  "Lymphocyte count decreased", 0.7,   1,      4,      "Lymphocytes Abs (10^9/L)",
  "Anemia",                     129,   120,    180,    "Hemoglobin (g/L)",
  "White blood cell decreased", 10,    5,      20,     "White blood cell (10^9/L)",
  "White blood cell decreased", 15,    5,      20,     "White blood cell (10^9/L)",
  "Anemia",                     140,   120,    180,    "Hemoglobin (g/L)"
)

derive_var_atoxgr_dir(data,
  new_var = ATOXGRL,
  tox_description_var = ATOXDSCL,
  meta_criteria = atoxgr_criteria_ctcv5,
  criteria_direction = "L",
  get_unit_expr = extract_unit(PARAM)
)

data &lt;- tribble(
  ~ATOXDSCH,                     ~AVAL,  ~ANRLO,   ~ANRHI, ~PARAM,
  "CPK increased",               129,    0,        30,     "Creatine Kinase (U/L)",
  "Lymphocyte count increased",  4,      1,        4,      "Lymphocytes Abs (10^9/L)",
  "Lymphocyte count increased",  2,      1,        4,      "Lymphocytes Abs (10^9/L)",
  "CPK increased",               140,    120,      180,    "Creatine Kinase (U/L)"
)

derive_var_atoxgr_dir(data,
  new_var = ATOXGRH,
  tox_description_var = ATOXDSCH,
  meta_criteria = atoxgr_criteria_ctcv5,
  criteria_direction = "H",
  get_unit_expr = extract_unit(PARAM)
)
</code></pre>


</div>