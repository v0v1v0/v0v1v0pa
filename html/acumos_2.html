<div class="container">

<table style="width: 100%;"><tr>
<td>compose</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compose a Acumos microservice
</h2>

<h3>Description</h3>

<p><code>compose</code> generates everything necessary to create a Acumos microservice.
</p>


<h3>Usage</h3>

<pre><code class="language-R">compose(predict, transform, fit, generate, service, initialize,
        aux = list(), name = "R Component", componentVersion="unknown version",
        file = "component.zip")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>predict</code></td>
<td>
<p>predict function (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>
<p>transform function (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>fit function (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generate</code></td>
<td>
<p>generate function (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>service</code></td>
<td>
<p>function handling additional non-Acumos requests
(optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialize</code></td>
<td>
<p>function for any one-shot initializations of the
environment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aux</code></td>
<td>
<p>list of any auxiliary objects that are to be passed to the
global workspace of the component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>string, name of the component</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>componentVersion</code></td>
<td>
<p>string, version of the component</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>string, filename for the resulting component file</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A regular component will have at least one of the three functions
<code>predict</code>, <code>transform</code> or <code>fit</code> set in which case
those functions are exposed via the Acumos API.
</p>
<p>A special component can instead provide the <code>generate</code> function
only in which case the <code>generate</code> function is called upon
instantiation instead of serving the Acumos API. This is useful
when adapting from other inputs than Acumos since the
<code>generate</code> function can use arbitrary input methods and then use
Acumos API to push to other Acumos components. Similarly,
non-Acumos requests can be served using the <code>service</code> call-back
function with the signature
<code>function(path, query, body, headers)</code> where <code>body</code> is
<code>NULL</code> or a raw vector. This interface is experimental and
currently not part of the official API.
</p>
<p>The functions can have two special arguments <code>inputs</code> and
<code>output</code> which are used to define the types of the input and
output data. They have to be named string vectors where the names
will match formats of the functions and the string specifies the
input type (class). At this point only <code>"character"</code>,
<code>"integer"</code>, <code>"numeric"</code> and <code>"raw"</code> are
supported. If those arguments are not present, they default to
<code>c(x="character")</code>. If the result of the function is a list, it
is assumed that the list holds the outputs, otherwise only one
output is used.
</p>
<p>The <code>compose()</code> function is called mainly for its side-effect
of creating the Acumos API component file, at this point it is a (ZIP)
bundle of <code>meta.json</code> (metadata), <code>component.bin</code>
(serialized R functions and code) and <code>component.proto</code> (I/O
definition)
</p>


<h3>Value</h3>

<p>Structure describing the component (parsed content of the JSON
description).
</p>


<h3>Author(s)</h3>

<p>Simon Urbanek
</p>


<h3>See Also</h3>

<p><code>run</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## pass-through component
compose(transform=identity, name="identity")

## simple addition
compose(transform=function(a, b, inputs=c(a="numeric", b="numeric"),
        outputs=c(x="numeric")) a + b, name="Addition")

## silly RF trained on Iris
library(randomForest)
compose(predict=function(..., inputs=lapply(iris[-5], class)){
                    as.character(predict(rf, as.data.frame(list(...))))
                },
        aux = list(rf = randomForest(Species ~ ., data=iris)),
        name="Random Forest")
file.remove("component.zip")
</code></pre>


</div>