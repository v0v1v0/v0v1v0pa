<div class="container">

<table style="width: 100%;"><tr>
<td>ratioTransform.alldiffs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculates the ratios of nominated pairs of predictions stored in an <code>alldiffs.object</code>.</h2>

<h3>Description</h3>

<p>Ratio predictions and error intervals are formed for two levels of a factor, 
the <code>ratio.factor</code>. For each pair of a level of the <code>ratio.factor</code> 
in <code>numerator.levels</code> with a level in <code>denominator.levels</code>, 
the ratio predictions are formed from all combinations of the other factors 
as the ratio of the two predictions for each combination, along with confidence 
intervals for the ratio predictions computed using the Fieller (1954) method.
</p>
<p>The printing of the components produced is controlled by the 
<code>tables</code> argument.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'alldiffs'
ratioTransform(alldiffs.obj, ratio.factor, 
               numerator.levels, denominator.levels, 
               method = "Fieller", alpha = 0.05,  
               response = NULL, response.title = NULL, 
               tables = "predictions", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>alldiffs.obj</code></td>
<td>
<p>An <code>alldiffs.object</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio.factor</code></td>
<td>
<p>A <code>character</code> string giving the name of the factor 
for whose levels the ratios are to be calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numerator.levels</code></td>
<td>
<p>A <code>character</code> string containing the levels 
of <code>ratio.factor</code> to be used as numerators of the ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>denominator.levels</code></td>
<td>
<p>A <code>character</code> string containing the levels 
of <code>ratio.factor</code> to be used as denominators of the ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A <code>character</code> string specifying the method to use in calculating 
the ratios and their <code>error.intervals</code>. At present only <code>Fieller</code> 
is available. For the <code>Fieller</code> <code>method</code>, ratios of predictions 
are formed and confidence intervals formed for them using Fieller's (1954) theorem.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A <code>numeric</code> giving the significance level for LSDs or one minus 
the confidence level for confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>A <code>character</code> specifying the response variable for the 
predictions. It is stored as an attribute to the <code>alldiffs.object</code> .</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response.title</code></td>
<td>
<p>A <code>character</code> specifying the title for the response variable 
for the predictions. It is stored as an attribute to the 
<code>alldiffs.object</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tables</code></td>
<td>
<p>A <code>character</code> vector containing either <code>none</code> or <code>predictions</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to <code>linTransform.alldiffs</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>list</code> of <code>predictions.frame</code>s, each containing the ratio predictions 
and their confidence limits for a combination of the <code>numerator.levels</code> with the 
<code>denominator.levels</code>. It will also contain the values of the variables in the 
<code>classify</code> of <code>alldiffs.obj</code> that index the ratio predictions, except that 
the <code>ratio.factor</code> is omitted. 
</p>
<p>If <code>sortFactor</code> attribute of the <code>alldiffs.object</code> is set and is not the 
<code>ratio.factor</code>, the predictions and their backtransforms will be sorted using 
the <code>sortOrder</code> attribute of the  <code>alldiffs.object</code>.
</p>


<h3>Author(s)</h3>

<p>Chris Brien</p>


<h3>References</h3>

<p>Fieller, E. C. (1954). Some Problems in Interval Estimation. <em>Journal of the 
Royal Statistical Society.Series B (Methodological)</em>, <b>16</b>, 175-185.</p>


<h3>See Also</h3>

<p><code>pairdiffsTransform</code>, <code>linTransform</code>, <code>predictPlus.asreml</code>, 
<code>as.alldiffs</code>, <br><code>print.alldiffs</code>, <code>sort.alldiffs</code>,  <code>subset.alldiffs</code>, 
<code>allDifferences.data.frame</code>, <br><code>redoErrorIntervals.alldiffs</code>,  
<code>recalcLSD.alldiffs</code>,  <code>predictPresent.asreml</code>, <br><code>plotPredictions.data.frame</code>, <br><code>as.Date</code>, <code>predict.asreml</code></p>


<h3>Examples</h3>

<pre><code class="language-R">#### Form the ratios and Fieller CIs for RGR Salinity
load(system.file("extdata", "testDiffs.rda", package = "asremlPlus", mustWork = TRUE))
Preds.ratio.RGR &lt;- ratioTransform(diffs.RGR,
                                  ratio.factor = "Salinity", 
                                  numerator.levels = "Salt",
                                  denominator.levels = "Control")

#### Form the ratios and Fieller CIs for Nitrogen compared to no Nitrogen                                  
data("Oats.dat")
## Not run: 
m1.asr &lt;- asreml(Yield ~ Nitrogen*Variety, 
                 random=~Blocks/Wplots,
                 data=Oats.dat)
current.asrt &lt;- as.asrtests(m1.asr)
wald.tab &lt;-  current.asrt$wald.tab
Var.diffs &lt;- predictPlus(m1.asr, classify="Nitrogen:Variety", pairwise = TRUE,
                         Vmatrix = TRUE, error.intervals = "halfLeast",
                         LSDtype = "factor", LSDby = "Variety",
                         wald.tab = wald.tab)

## End(Not run)

 ## Use lme4 and emmmeans to get predictions and associated statistics
if (requireNamespace("lmerTest", quietly = TRUE) &amp; 
    requireNamespace("emmeans", quietly = TRUE))
{
  m1.lmer &lt;- lmerTest::lmer(Yield ~ Nitrogen*Variety + (1|Blocks/Wplots),
                              data=Oats.dat)
  ## Set up a wald.tab
  int &lt;- as.data.frame(rbind(rep(NA,4)))
  rownames(int) &lt;- "(Intercept)"
  wald.tab &lt;- anova(m1.lmer, ddf = "Kenward", type = 1)[,3:6]
  names(wald.tab) &lt;- names(int) &lt;- c("Df", "denDF", "F.inc", "Pr")
  wald.tab &lt;- rbind(int, wald.tab)
  #Get predictions
  Var.emm &lt;- emmeans::emmeans(m1.lmer, specs = ~ Nitrogen:Variety)
  Var.preds &lt;- summary(Var.emm)
  ## Modify Var.preds to be compatible with a predictions.frame
  Var.preds &lt;- as.predictions.frame(Var.preds, predictions = "emmean", 
                                    se = "SE", interval.type = "CI", 
                                    interval.names = c("lower.CL", "upper.CL"))
  Var.vcov &lt;- vcov(Var.emm)
  Var.sed &lt;- NULL
  den.df &lt;- wald.tab[match("Variety", rownames(wald.tab)), "denDF"]
  
  #Create alldiffs object
  Var.diffs &lt;- as.alldiffs(predictions = Var.preds, 
                           sed = Var.sed, vcov = Var.vcov, 
                           classify = "Nitrogen:Variety", response = "Yield", tdf = den.df)
} 

if (exists("Var.diffs"))
  Preds.ratio.OatsN &lt;- ratioTransform(alldiffs.obj = Var.diffs,
                                      ratio.factor = "Nitrogen", 
                                      numerator.levels = c("0.2","0.4","0.6"),
                                      denominator.levels = "0.2")
</code></pre>


</div>