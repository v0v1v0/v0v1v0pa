<div class="container">

<table style="width: 100%;"><tr>
<td>RunModel.Supervisor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>RunModel function for a GRiwrmInputsModel object</h2>

<h3>Description</h3>

<p>RunModel function for a GRiwrmInputsModel object
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'Supervisor'
RunModel(x, RunOptions, Param, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>[object of class <code>Supervisor</code>] see CreateSupervisor for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RunOptions</code></td>
<td>
<p>[object of class <em>GRiwrmRunOptions</em>] see <code>[CreateRunOptions.GRiwrm]</code> for details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Param</code></td>
<td>
<p>list parameter values. The list item names are the IDs of the sub-basins. Each item is a vector of numerical parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments for compatibility with S3 methods</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><em>GRiwrmOutputsModel</em> object which is a list of <em>OutputsModel</em> objects (See airGR::RunModel) for each node of the semi-distributed model
</p>


<h3>Examples</h3>

<pre><code class="language-R">###############################################################################
# An example of reservoir management on an hypothetical dam at station "54095"
# on the Severn river build to support low-flows at "54057"
###############################################################################
# A minimum flow of 50 m3/s is maintained at the dam location and an extra-release
# is provided when the flow at the downstream station "54057" cross a minimum
# threshold of 65 m3/s. The dam has a storage capacity of 650 millions m3
###############################################################################
library(airGRiwrm)

# Load Severn network information
data(Severn)
nodes &lt;- Severn$BasinsInfo[, c("gauge_id", "downstream_id", "distance_downstream", "area")]
nodes$model &lt;- "RunModel_GR4J"

# Insert a dam downstream the location the gauging station 54095
# The dam is a direct injection node
nodes$downstream_id[nodes$gauge_id == "54095"] &lt;- "Dam"
nodes$distance_downstream[nodes$gauge_id == "54095"] &lt;- 0
nodes &lt;- rbind(nodes,
               data.frame(gauge_id = "Dam",
                          downstream_id = "54001",
                          distance_downstream = 42,
                          area = NA,
                          model = "RunModel_Reservoir"))

griwrm &lt;- CreateGRiwrm(nodes,
                 list(id = "gauge_id",
                      down = "downstream_id",
                      length = "distance_downstream"))
## Not run: 
plot(griwrm)

## End(Not run)

# Format meteorological inputs for CreateInputs
BasinsObs &lt;- Severn$BasinsObs
DatesR &lt;- BasinsObs[[1]]$DatesR
PrecipTot &lt;- cbind(sapply(BasinsObs, function(x) {x$precipitation}))
PotEvapTot &lt;- cbind(sapply(BasinsObs, function(x) {x$peti}))
Precip &lt;- ConvertMeteoSD(griwrm, PrecipTot)
PotEvap &lt;- ConvertMeteoSD(griwrm, PotEvapTot)

# Create a release flow time series for the dam
# This release will be modified by the Supervisor
# We initiate it with the natural flow for having a good initialization of the
# model at the first time step of the running period
Qinf &lt;- data.frame(
  Dam = BasinsObs$`54095`$discharge_spec * griwrm$area[griwrm$id == "54095"] * 1E3
)

# InputsModel object
IM_severn &lt;- CreateInputsModel(griwrm, DatesR, Precip, PotEvap, Qinf)

# Initialization of the Supervisor
sv &lt;- CreateSupervisor(IM_severn)

# Dam management is modeled by a controller
# This controller releases a minimum flow Qmin and provides
# extra release if flow measured somewhere is below Qthreshold
# Flow is expressed in m3 / time step
# Y[1] = runoff flow at gauging station 54095 filling the reservoir
# Y[2] = flow at gauging station 54057, location of the low-flow objective
# The returned value is the release calculated at the reservoir
# We need to enclose the Supervisor variable and other parameters in
# the environment of the function with a function returning the logic function
factoryDamLogic &lt;- function(sv, Qmin, Qthreshold) {
  function(Y) {
    # Estimate natural flow at low-flow support location
    Qnat &lt;- Y[1] - Y[2]
    # The release is the max between: low-flow support and minimum flow
    U &lt;- max(Qthreshold - Qnat, Qmin)
    return(U)
  }
}

# And define a final function enclosing logic and parameters together
funDamLogic &lt;- factoryDamLogic(
  sv = sv, # The Supervisor which store the released flow
  Qmin = 50 * 86400, # Min flow to maintain downstream the reservoir (m3/day)
  Qthreshold = 65 * 86400 # Min flow threshold to support at station 54057 (m3/day)
)

CreateController(sv, "DamRelease", Y = c("54057", "Dam"), U = "Dam", FUN = funDamLogic)

# GRiwrmRunOptions object simulation of the hydrological year 2002-2003
IndPeriod_Run &lt;- which(
  DatesR &gt;= as.POSIXct("2002-11-01", tz = "UTC") &amp;
  DatesR &lt;= as.POSIXct("2003-11-01", tz = "UTC")
)
IndPeriod_WarmUp &lt;- seq.int(IndPeriod_Run[1] - 366, IndPeriod_Run[1] - 1)
RO_severn &lt;- CreateRunOptions(
  IM_severn,
  IndPeriod_WarmUp = IndPeriod_WarmUp,
  IndPeriod_Run = IndPeriod_Run
)

# Load parameters of the model from Calibration in vignette V02
P_severn &lt;- readRDS(system.file("vignettes", "ParamV02.RDS", package = "airGRiwrm"))

# Set the reservoir parameters: maximum storage capacity and celerity of inflows
# As the distance between the upstream node "54095" and the dam is 0 km, the celerity
# doesn't have any effect. However it must be positive.
P_severn$Dam &lt;- c(Vmax = 650E6, celerity = 1)

# The Supervisor is used instead of InputsModel for running the model
OM_dam &lt;- RunModel(sv,
                   RunOptions = RO_severn,
                   Param = P_severn)

# Plotting the time series of flows and reservoir storage
oldpar &lt;- par(mfrow=c(2,1),
              mar = c(2,3.3,1.2,0.5),
              mgp = c(2,1,0))
plot(attr(OM_dam, "Qm3s")[, c("DatesR", "54095", "Dam", "54057")],
     ylim = c(0, 200))
Vres &lt;- as.Qm3s(DatesR = OM_dam$Dam$DatesR,
                   "Simulated volume" = OM_dam$Dam$Vsim / 1E6)
plot(Vres,
     main = "Simulated reservoir storage",
     ylab = expression("Storage (Mm" ^ "3" * ")"))
par(oldpar)
</code></pre>


</div>