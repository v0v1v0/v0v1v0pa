<div class="container">

<table style="width: 100%;"><tr>
<td>ab_test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian A/B Test</h2>

<h3>Description</h3>

<p>Function for conducting a Bayesian A/B test (i.e., test between two
proportions).
</p>


<h3>Usage</h3>

<pre><code class="language-R">ab_test(
  data = NULL,
  prior_par = list(mu_psi = 0, sigma_psi = 1, mu_beta = 0, sigma_beta = 1),
  prior_prob = NULL,
  nsamples = 10000,
  is_df = 5,
  posterior = FALSE,
  y = NULL,
  n = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>list or data frame with the data. This list (data frame) needs to
contain the following elements: <code>y1</code> (number of "successes" in the
control condition), <code>n1</code> (number of trials in the control condition),
<code>y2</code> (number of "successes" in the experimental condition), <code>n2</code>
(number of trials in the experimental condition). Each of these elements
needs to be an integer. Alternatively, the user can provide for each of the
elements a vector with a cumulative sequence of "successes"/trials. This
allows the user to produce a sequential plot of the posterior probabilities
for each hypothesis by passing the result object of class <code>"ab"</code> to
the <code>plot_sequential</code> function. Sequential data can also be
provided in form of a data frame or matrix that has the columns "outcome"
(containing only 0 and 1 to indicate the binary outcome) and "group"
(containing only 1 and 2 to indicate the group membership). Note that the
data can also be provided by specifying the arguments <code>y</code> and
<code>n</code> instead (not possible for sequential data).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_par</code></td>
<td>
<p>list with prior parameters. This list needs to contain the
following elements: <code>mu_psi</code> (prior mean for the normal prior on the
test-relevant log odds ratio), <code>sigma_psi</code> (prior standard deviation
for the normal prior on the test-relevant log odds ratio), <code>mu_beta</code>
(prior mean for the normal prior on the grand mean of the log odds),
<code>sigma_beta</code> (prior standard deviation for the normal prior on the
grand mean of the log odds). Each of the elements needs to be a real number
(the standard deviations need to be positive). The default are standard
normal priors for both the log odds ratio parameter and the grand mean of
the log odds parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_prob</code></td>
<td>
<p>named vector with prior probabilities for the four
hypotheses <code>"H1"</code>, <code>"H+"</code>, <code>"H-"</code>, and <code>"H0"</code>.
<code>"H1"</code> states that the "success" probability differs between the
control and the experimental condition but does not specify which one is
higher. <code>"H+"</code> states that the "success" proability in the
experimental condition is higher than in the control condition, <code>"H-"</code>
states that the "success" probability in the experimental condition is
lower than in the control condition. <code>"H0"</code> states that the "success"
probability is identical (i.e., there is no effect). The one-sided
hypotheses <code>"H+"</code> and <code>"H-"</code> are obtained by truncating the
normal prior on the log odds ratio so that it assigns prior mass only to
the allowed log odds ratio values (e.g., for <code>"H+"</code> a normal prior
that is truncated from below at 0). If <code>NULL</code> (default) the prior
probabilities are set to <code>c(0, 1/4, 1/4, 1/2)</code>. That is, the default
assigns prior probability .5 to the hypothesis that there is no effect
(i.e., <code>"H0"</code>). The remaining prior probability (i.e., also .5) is
split evenly across the hypothesis that there is a positive effect (i.e.,
<code>"H+"</code>) and the hypothesis that there is a negative effect (i.e.,
<code>"H-"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsamples</code></td>
<td>
<p>determines the number of importance samples for obtaining the
log marginal likelihood for <code>"H+"</code> and <code>"H-"</code> and the number of
posterior samples in case <code>posterior = TRUE</code>. The default is
<code>10000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is_df</code></td>
<td>
<p>degrees of freedom of the multivariate t importance sampling
proposal density. The default is <code>5</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>posterior</code></td>
<td>
<p>Boolean which indicates whether posterior samples should be
returned. The default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>integer vector of length 2 containing the number of "successes" in
the control and experimental conditon</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>integer vector of length 2 containing the number of trials in
the control and experimental conditon</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The implemented Bayesian A/B test is based on the following model by
Kass and Vaidyanathan (1992, section 3): </p>
<p style="text-align: center;"><code class="reqn">log(p1/(1 - p1)) = \beta -
  \psi/2</code>
</p>
 <p style="text-align: center;"><code class="reqn">log(p2/(1 - p2)) = \beta + \psi/2</code>
</p>
 <p style="text-align: center;"><code class="reqn">y1 ~ Binomial(n1,
  p1)</code>
</p>
 <p style="text-align: center;"><code class="reqn">y2 ~ Binomial(n2, p2).</code>
</p>
 <p><code>"H0"</code> states that <code class="reqn">\psi = 0</code>,
<code>"H1"</code> states that <code class="reqn">\psi != 0</code>, <code>"H+"</code> states that <code class="reqn">\psi
  &gt; 0</code>, and <code>"H-"</code> states that <code class="reqn">\psi &lt; 0</code>. Normal priors are
assigned to the two parameters <code class="reqn">\psi</code> (i.e., the test-relevant log odds
ratio) and <code class="reqn">\beta</code> (i.e., the grand mean of the log odds which is a
nuisance parameter). Log marginal likelihoods for <code>"H0"</code> and
<code>"H1"</code> are obtained via Laplace approximations (see Kass &amp;
Vaidyanathan, 1992) which work well even for very small sample sizes. For
the one-sided hypotheses <code>"H+"</code> and <code>"H-"</code> the log marginal
likelihoods are obtained based on importance sampling which uses as a
proposal a multivariate t distribution with location and scale matrix
obtained via a Laplace approximation to the (log-transformed) posterior. If
<code>posterior = TRUE</code>, posterior samples are obtained using importance
sampling.
</p>


<h3>Value</h3>

<p>returns an object of class <code>"ab"</code> with components: </p>

<ul>
<li> <p><code>input</code>: a list with the input arguments. </p>
</li>
<li> <p><code>post</code>: a
list with parameter posterior samples for the three hypotheses <code>"H1"</code>,
<code>"H+"</code> (in the output called <code>"Hplus"</code>), and <code>"H-"</code> (in the
output called <code>"Hminus"</code>). Only contains samples if <code>posterior =
  TRUE</code>. </p>
</li>
<li> <p><code>laplace</code>: a list with the approximate parameter
posterior mode and variance/covariance matrix for each hypothesis obtained
via a Laplace approximation. </p>
</li>
<li> <p><code>method</code>: character that indicates
the method that has been used to obtain the results. The default is
<code>"log-is"</code> (importance sampling with multivariate t proposal based on
a Laplace approximation to the log transformed posterior). If this method
fails (for the one-sided hypotheses), method <code>"is-sn"</code> is used (i.e.,
importance sampling is used to obtain unconstrained samples, then a
skew-normal distribution is fitted to the samples to obtain the results for
the one-sided hypotheses). If <code>method = "is-sn"</code>, posterior samples
can only be obtained for <code>"H1"</code>. </p>
</li>
<li> <p><code>logml</code>: a list with the
estimated log marginal likelihoods for the hypotheses <code>"H0"</code> (i.e.,
<code>"logml0"</code>), <code>"H1"</code> (i.e., <code>"logml1"</code>), <code>"H+"</code> (i.e.,
<code>"logmlplus"</code>), and <code>"H-"</code> (i.e., <code>"logmlminus"</code>). </p>
</li>
<li>
<p><code>post_prob</code>: a named vector with the posterior probabilities of the
four hypotheses <code>"H1"</code>, <code>"H+"</code>, <code>"H-"</code>, and <code>"H0"</code>.
</p>
</li>
<li> <p><code>logbf</code>: a list with the log Bayes factor in favor of
<code>"H1"</code> over <code>"H0"</code>, the log Bayes factor in favor of <code>"H+"</code>
over <code>"H0"</code>, and the log Bayes factor in favor of <code>"H-"</code> over
<code>"H0"</code>. </p>
</li>
<li> <p><code>bf</code>: a list with the Bayes factor in favor of
<code>"H1"</code> over <code>"H0"</code> (i.e., <code>"bf10"</code>), the Bayes factor in
favor of <code>"H+"</code> over <code>"H0"</code> (i.e., <code>"bfplus0"</code>), and the
Bayes factor in favor of <code>"H-"</code> over <code>"H0"</code> (i.e.,
<code>"bfminus0"</code>).</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Quentin F. Gronau
</p>


<h3>References</h3>

<p>Kass, R. E., &amp; Vaidyanathan, S. K. (1992). Approximate Bayes
factors and orthogonal parameters, with application to testing equality of
two binomial proportions. <em>Journal of the Royal Statistical Society,
Series B, 54</em>, 129-144.
doi: <a href="https://doi.org/10.1111/j.2517-6161.1992.tb01868.x">10.1111/j.2517-6161.1992.tb01868.x</a>
</p>
<p>Gronau, Q. F., Raj K. N., A., &amp; Wagenmakers, E.-J. (2021). Informed Bayesian
Inference for the A/B Test. <em>Journal of Statistical Software, 100</em>.
doi: <a href="https://doi.org/10.18637/jss.v100.i17">10.18637/jss.v100.i17</a>
</p>


<h3>See Also</h3>

<p><code>elicit_prior</code> allows the user to elicit a prior based
on providing quantiles for either the log odds ratio, the odds ratio, the
relative risk, or the absolute risk. The resulting prior is always
translated to the corresponding normal prior on the log odds ratio. The
<code>plot_prior</code> function allows the user to visualize the prior
distribution. The <code>simulate_priors</code> function produces samples
from the prior distribution. The prior and posterior probabilities of the
hypotheses can be visualized using the <code>prob_wheel</code> function.
Parameter posteriors can be visualized using the
<code>plot_posterior</code> function. The <code>plot_sequential</code>
function allows the user to sequentially plot the posterior probabilities
of the hypotheses (only possible if the <code>data</code> object contains vectors
with the cumulative "successes"/trials).
</p>


<h3>Examples</h3>

<pre><code class="language-R"># synthetic data
data &lt;- list(y1 = 10, n1 = 28, y2 = 14, n2 = 26)

# Bayesian A/B test with default settings
ab &lt;- ab_test(data = data)
print(ab)

# different prior parameter settings
prior_par &lt;- list(mu_psi = 0.2, sigma_psi = 0.8,
                  mu_beta = 0, sigma_beta = 0.7)
ab2 &lt;- ab_test(data = data, prior_par = prior_par)
print(ab2)

# different prior probabilities
prior_prob &lt;- c(.1, .3, .2, .4)
names(prior_prob) &lt;- c("H1", "H+", "H-", "H0")
ab3 &lt;- ab_test(data = data, prior_prob = prior_prob)
print(ab3)

# also possible to obtain posterior samples
ab4 &lt;- ab_test(data = data, posterior = TRUE)

# plot parameter posterior
plot_posterior(x = ab4, what = "logor")
</code></pre>


</div>