<div class="container">

<table style="width: 100%;"><tr>
<td>with_adbc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cleanup helpers</h2>

<h3>Description</h3>

<p>Managing the lifecycle of databases, connections, and statements can
be complex and error-prone. The R objects that wrap the underlying ADBC
pointers will perform cleanup in the correct order if you rely on garbage
collection (i.e., do nothing and let the objects go out of scope); however
it is good practice to explicitly clean up these objects. These helpers
are designed to make explicit and predictable cleanup easy to accomplish.
</p>


<h3>Usage</h3>

<pre><code class="language-R">with_adbc(x, code)

local_adbc(x, .local_envir = parent.frame())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An ADBC database, ADBC connection, ADBC statement, or
nanoarrow_array_stream returned from calls to an ADBC function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>code</code></td>
<td>
<p>Code to execute before cleaning up the input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.local_envir</code></td>
<td>
<p>The execution environment whose scope should be tied
to the input.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that you can use <code>adbc_connection_join()</code> and <code>adbc_statement_join()</code>
to tie the lifecycle of the parent object to that of the child object.
These functions mark any previous references to the parent object as
released so you can still use local and with helpers to manage the parent
object before it is joined. Use <code>stream_join_parent = TRUE</code> in
<code>adbc_statement_execute_query()</code> to tie the lifecycle of a statement to
the output stream.
</p>


<h3>Value</h3>


<ul>
<li> <p><code>with_adbc()</code> returns the result of <code>code</code>
</p>
</li>
<li> <p><code>local_adbc()</code> returns the input, invisibly.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># Using with_adbc():
with_adbc(db &lt;- adbc_database_init(adbc_driver_void()), {
  with_adbc(con &lt;- adbc_connection_init(db), {
    with_adbc(stmt &lt;- adbc_statement_init(con), {
      # adbc_statement_set_sql_query(stmt, "SELECT * FROM foofy")
      # adbc_statement_execute_query(stmt)
      "some result"
    })
  })
})

# Using local_adbc_*() (works best within a function, test, or local())
local({
  db &lt;- local_adbc(adbc_database_init(adbc_driver_void()))
  con &lt;- local_adbc(adbc_connection_init(db))
  stmt &lt;- local_adbc(adbc_statement_init(con))
  # adbc_statement_set_sql_query(stmt, "SELECT * FROM foofy")
  # adbc_statement_execute_query(stmt)
  "some result"
})

</code></pre>


</div>