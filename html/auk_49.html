<div class="container">

<table style="width: 100%;"><tr>
<td>format_unmarked_occu</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Format EBD data for occupancy modeling with <code>unmarked</code>
</h2>

<h3>Description</h3>

<p>Prepare a data frame of species observations for ingestion into the package
<code>unmarked</code> for hierarchical modeling of abundance and occurrence. The
function <code>unmarked::formatWide()</code> takes a data frame and converts it to one
of several <code>unmarked</code> objects, which can then be used for modeling. This
function converts data from a format in which each row is an observation
(e.g. as in the eBird Basic Dataset) to the esoteric format required by
<code>unmarked::formatWide()</code> in which each row is a site.
</p>


<h3>Usage</h3>

<pre><code class="language-R">format_unmarked_occu(
  x,
  site_id = "site",
  response = "species_observed",
  site_covs,
  obs_covs
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>data.frame</code>; observation data, e.g. from the eBird Basic Dataset
(EBD), for <strong>a single species</strong>, that has been filtered to those with
repeat visits by <code>filter_repeat_visits()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site_id</code></td>
<td>
<p>character; a unique idenitifer for each "site", typically
identifying observations from a unique location by the same observer
within a period of temporal closure. Data output from
<code>filter_repeat_visits()</code> will have a <code>.site_id</code> variable that meets these
requirements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>character; the variable that will act as the response in
modeling efforts, typically a binary variable indicating presence or
absence or a count of individuals seen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site_covs</code></td>
<td>
<p>character; the variables that will act as site-level
covariates, i.e. covariates that vary at the site level, for example,
latitude/longitude or habitat predictors. If this parameter is missing, it
will be assumed that any variable that is not an observation-level
covariate (<code>obs_covs</code>) or the <code>site_id</code>, is a site-level covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_covs</code></td>
<td>
<p>character; the variables that will act as observation-level
covariates, i.e. covariates that vary within sites, at the level of
observations, for example, time or length of observation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Hierarchical modeling requires repeat observations at each "site" to
estimate detectability. A "site" is typically defined as a geographic
location visited by the same observer within a period of temporal closure.
To define these sites and filter out observations that do not correspond to
repeat visits, users should use <code>filter_repeat_visits()</code>, then pass the
output to this function.
</p>
<p><code>format_unmarked_occu()</code> is designed to prepare data to be converted into
an <code>unmarkedFrameOccu</code> object for occupancy modeling with
<code>unmarked::occu()</code>; however, it can also be used to prepare data for
conversion to an <code>unmarkedFramePCount</code> object for abundance modeling with
<code>unmarked::pcount()</code>.
</p>


<h3>Value</h3>

<p>A data frame that can be processed by <code>unmarked::formatWide()</code>.
Each row will correspond to a unqiue site and, assuming there are a maximum
of <code>N</code> observations per site, columns will be as follows:
</p>

<ol>
<li>
<p> The unique site identifier, named "site".
</p>
</li>
<li> <p><code>N</code> response columns, one for each observation, named "y.1", ..., "y.N".
</p>
</li>
<li>
<p> Columns for each of the site-level covariates.
</p>
</li>
<li>
<p> Groups of <code>N</code> columns of observation-level covariates, one column per
covariate per observation, names "covariate_name.1", ...,
"covariate_name.N".
</p>
</li>
</ol>
<h3>See Also</h3>

<p>Other modeling: 
<code>filter_repeat_visits()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># read and zero-fill the ebd data
f_ebd &lt;- system.file("extdata/zerofill-ex_ebd.txt", package = "auk")
f_smpl &lt;- system.file("extdata/zerofill-ex_sampling.txt", package = "auk")
# data must be for a single species
ebd_zf &lt;- auk_zerofill(x = f_ebd, sampling_events = f_smpl,
                       species = "Collared Kingfisher",
                       collapse = TRUE)
occ &lt;- filter_repeat_visits(ebd_zf, n_days = 30)
# format for unmarked
# typically one would join in habitat covariates prior to this step
occ_wide &lt;- format_unmarked_occu(occ,
                                 response = "species_observed",
                                 site_covs = c("latitude", "longitude"),
                                 obs_covs = c("effort_distance_km", 
                                              "duration_minutes"))
# create an unmarked object
if (requireNamespace("unmarked", quietly = TRUE)) {
  occ_um &lt;- unmarked::formatWide(occ_wide, type = "unmarkedFrameOccu")
  unmarked::summary(occ_um)
}

# this function can also be used for abundance modeling
abd &lt;- ebd_zf %&gt;% 
  # convert count to integer, drop records with no count
  dplyr::mutate(observation_count = as.integer(observation_count)) %&gt;% 
  dplyr::filter(!is.na(observation_count)) %&gt;% 
  # filter to repeated visits
  filter_repeat_visits(n_days = 30)
# prepare for conversion to unmarkedFramePCount object
abd_wide &lt;- format_unmarked_occu(abd,
                                 response = "observation_count",
                                 site_covs = c("latitude", "longitude"),
                                 obs_covs = c("effort_distance_km", 
                                              "duration_minutes"))
# create an unmarked object
if (requireNamespace("unmarked", quietly = TRUE)) {
  abd_um &lt;- unmarked::formatWide(abd_wide, type = "unmarkedFrameOccu")
  unmarked::summary(abd_um)
}
</code></pre>


</div>