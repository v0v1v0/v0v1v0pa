<div class="container">

<table style="width: 100%;"><tr>
<td>kernelbb</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Kernel Brownian Bridge Home-Range</h2>

<h3>Description</h3>

<p><code>kernelbb</code> is used to estimate the utilization distribution of an
animal using the brownian bridge approach of the kernel method (for
autocorrelated relocations; Bullard 1991, Horne et al. 2007). 
</p>
<p><code>liker</code> can be used to find the maximum likelihood
estimation of the parameter sig1, using the approach defined in Horne
et al. 2007 (see Details).
</p>


<h3>Usage</h3>

<pre><code class="language-R">kernelbb(ltr, sig1, sig2, grid = 40, same4all = FALSE, byburst = FALSE,
         extent = 0.5, nalpha = 25)

liker(tr, rangesig1, sig2, le = 1000,
      byburst = FALSE, plotit = TRUE)

## S3 method for class 'liker'
print(x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ltr,tr</code></td>
<td>
<p>an object of class <code>ltraj</code> of type II (time recorded),
regular or not (see <code>help(as.ltraj)</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig1</code></td>
<td>
<p>first smoothing parameter for the brownian bridge method
(related to the speed of the animals; it can be estimated by the
function <code>liker</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sig2</code></td>
<td>
<p>second smoothing parameter for the brownian bridge method
(related to the imprecision of the relocations, supposed known).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>a number giving the size of the grid on
which the UD should be estimated.  Alternatively, this parameter may
be an object of class <code>SpatialPixels</code>, or a list of objects of
class <code>SpatialPixels</code>, with named elements corresponding to each
level of the factor id</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>same4all</code></td>
<td>
<p>logical. If <code>TRUE</code>, the same grid
is used for all animals.  If <code>FALSE</code>, one grid per
animal is used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byburst</code></td>
<td>
<p>logical. Whether the brownian bridge estimation should
be done by burst.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extent</code></td>
<td>
<p>a value indicating the extent of the grid used for the
estimation (the extent of the grid on the abscissa is equal to
<code>(min(xy[,1]) + extent * diff(range(xy[,1])))</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nalpha</code></td>
<td>
<p>a parameter used internally to compute the integral
of the Brownian bridge.  The integral is computed by cutting each
step built by two relocations into <code>nalpha</code> sub-intervals. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rangesig1</code></td>
<td>
<p>the range of possible values of sig1 within which
the likelihood should be maximized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>le</code></td>
<td>
<p>The number of values of sig1 tested within the specified
range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotit</code></td>
<td>
<p>logical. Whether the results of the function should be
plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class <code>khr</code> returned by <code>kernelbb</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additionnal parameters to be passed to the generic
functions <code>print</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>kernelbb</code> uses the brownian bridge approach to
estimate the Utilization Distribution of an animal with serial
autocorrelation of the relocations (Bullard 1991, Horne et al. 2007).
Instead of simply smoothing the relocation pattern (which is the case
for the function <code>kernelUD</code>), it takes into account the fact that
between two successive relocations r1 and r2, the animal has moved
through a continuous path, which is not necessarily linear.  A
brownian bridge estimates the density of probability that this path
passed through any point of the study area, given that the animal was
located at the point r1 at time t1 and at the point r2 at time t2,
with a certain amount of inaccuracy (controled by the parameter sig2,
see Examples).  Brownian bridges are placed over the different
sections of the trajectory, and these functions are then summed over the
area.  The brownian bridge approach therefore smoothes a trajectory.
</p>
<p>The brownian bridge estimation relies on two smoothing parameters,
<code>sig1</code> and <code>sig2</code>.  The parameter <code>sig1</code> is related to
the speed of the animal, and describes how far from the line joining
two successive relocations the animal can go during one time unit
(here the time is measured in second). The function <code>liker</code> can
be used to estimate this value using the maximum likelihood approach
described in Horne et al. (2007). The larger this parameter is,
and the more wiggly the trajectory is likely to be.
The parameter <code>sig2</code> is equivalent to the parameter 
<code>h</code> of the classical kernel method: it is related to the
inaccuracy of the relocations, and is supposed known (See examples for
an illustration of the smoothing parameters).
</p>
<p>The functions <code>getvolumeUD</code> and <code>getverticeshr</code> can then be
used to conpute the home ranges (see <code>kernelbb</code>).  More
generally, more details on the generic parameters of <code>kernelbb</code>
can be found on the help page of <code>kernelUD</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>estUDm</code>
</p>
<p><code>liker</code> returns an object of class <code>liker</code>, with one
component per animal (or per burst, depending on the value of
the parameter <code>perburst</code>), containing the value of (i) optimized
sig1, (ii) sig2, and (iii) a data frame named "cv" with the tested
values of sig1 and the corresponding log-likelihood.
</p>


<h3>Author(s)</h3>

<p> Clement Calenge <a href="mailto:clement.calenge@ofb.gouv.fr">clement.calenge@ofb.gouv.fr</a> </p>


<h3>References</h3>

<p>Bullard, F. (1991) <em>Estimating the home range of an animal: a Brownian
bridge approach</em>. Master of Science, University of North Carolina,
Chapel Hill.
</p>
<p>Horne, J.S., Garton, E.O., Krone, S.M. and Lewis, J.S. (2007)
Analyzing animal movements using brownian bridge. <em>Ecology</em>,
<b>in press</b>.
</p>


<h3>See Also</h3>

<p><code>as.ltraj</code> for further information concerning
objects of class <code>ltraj</code>. <code>kernelUD</code> for the
classical kernel estimation. ,  <code>mcp</code> for
estimation of home ranges using the minimum convex polygon, and for
help on the function <code>plot.hrsize</code>. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 

#########################################################
#########################################################
#########################################################
###
###        Example of a typical case study
###       with the brownian bridge approach
###

## Load the data
data(puechcirc)
x &lt;- puechcirc[1]

## Field studies have shown that the mean standard deviation (relocations
## as a sample of the actual position of the animal) is equal to 58
## meters on these data (Maillard, 1996, p. 63). Therefore
sig2 &lt;- 58

## Find the maximum likelihood estimation of the parameter sig1
## First, try to find it between 10 and 100.
liker(x, sig2 = 58, rangesig1 = c(10, 100))

## Wow! we expected a too large standard deviation! Try again between
## 1 and 10:
liker(x, sig2 = 58, rangesig1 = c(1, 10))

## So that sig1 = 6.23

## Now, estimate the brownian bridge
tata &lt;- kernelbb(x, sig1 = 6.23, sig2 = 58, grid = 100)
image(tata)


## OK, now look at the home range
image(tata)
plot(getverticeshr(tata, 95), add=TRUE, lwd=2)





#########################################################
#########################################################
#########################################################
###
###      Comparison of the brownian bridge approach
###            with the classical approach
###


## Take an illustrative example: we simulate a trajectory
suppressWarnings(RNGversion("3.5.0"))
set.seed(2098)
pts1 &lt;- data.frame(x = rnorm(25, mean = 4.5, sd = 0.05),
                   y = rnorm(25, mean = 4.5, sd = 0.05))
pts1b &lt;- data.frame(x = rnorm(25, mean = 4.5, sd = 0.05),
                    y = rnorm(25, mean = 4.5, sd = 0.05))
pts2 &lt;- data.frame(x = rnorm(25, mean = 4, sd = 0.05),
                   y = rnorm(25, mean = 4, sd = 0.05))
pts3 &lt;- data.frame(x = rnorm(25, mean = 5, sd = 0.05),
                   y = rnorm(25, mean = 4, sd = 0.05))
pts3b &lt;- data.frame(x = rnorm(25, mean = 5, sd = 0.05),
                    y = rnorm(25, mean = 4, sd = 0.05))
pts2b &lt;- data.frame(x = rnorm(25, mean = 4, sd = 0.05),
                    y = rnorm(25, mean = 4, sd = 0.05))
pts &lt;- do.call("rbind", lapply(1:25, function(i) {
          rbind(pts1[i,], pts1b[i,], pts2[i,], pts3[i,],
                pts3b[i,], pts2b[i,])
}))
dat &lt;- 1:150
class(dat) &lt;- c("POSIXct","POSIXt")
x &lt;- as.ltraj(pts, date=dat, id = rep("A", 150))

## See the trajectory:
plot(x)


## Now, we suppose that there is a precision of 0.05
## on the relocations
sig2 &lt;- 0.05
## and that sig1=0.1
sig1 &lt;- 0.1

## Now fits the brownian bridge home range
(kbb &lt;- kernelbb(x, sig1 = sig1,
                 sig2 = sig2))


## Now fits the classical kernel home range
coordinates(pts) &lt;- c("x","y")
(kud &lt;- kernelUD(pts))


###### The results

opar &lt;- par(mfrow=c(2,2), mar=c(0.1,0.1,2,0.1))
plot(pts, pch=16)
title(main="The relocation pattern")
box()
plot(x, axes=FALSE, main="The trajectory")
box()
image(kud)
title(main="Classical kernel home range")
plot(getverticeshr(kud, 95), add=TRUE)
box()
image(kbb)
title(main="Brownian bridge kernel home range")
plot(getverticeshr(kbb, 95), add=TRUE)
box()
par(opar)



###############################################
###############################################
###############################################
###
###         Image of a brownian bridge.
###          Fit with two relocations
###               


xx &lt;- c(0,1)
yy &lt;- c(0,1)
date &lt;- c(0,1)
class(date) &lt;- c("POSIXt", "POSIXct")
tr &lt;- as.ltraj(data.frame(x = xx,y = yy), date, id="a")

## Use of different smoothing parameters
sig1 &lt;- c(0.05, 0.1, 0.2, 0.4, 0.6)
sig2 &lt;- c(0.05, 0.1, 0.2, 0.5, 0.7)

y &lt;- list()
for (i in 1:5) {
  for (j in 1:5) {
     k &lt;- paste("s1=", sig1[i], ", s2=", sig2[j], sep = "")
     y[[k]]&lt;-kernelbb(tr, sig1[i], sig2[j])
   }
 }

## Displays the results
opar &lt;- par(mar = c(0,0,2,0), mfrow = c(5,5))
foo &lt;- function(x)
   {
     image(y[[x]])
     title(main = names(y)[x])
     points(tr[[1]][,c("x","y")], pch = 16)
   }
lapply(1:length(y), foo)

par(opar)



## End(Not run)
</code></pre>


</div>