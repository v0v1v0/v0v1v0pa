<div class="container">

<table style="width: 100%;"><tr>
<td>lavielle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Segmentation of a time series using the method of Lavielle (1999,
2005)</h2>

<h3>Description</h3>

<p>These functions allow to perform a non-parametric segmentation of a
time series using the penalized contrast method of Lavielle (1999,
2005). The function <code>lavielle</code> computes the contrast matrix
(i.e., the matrix used to segment the series) either from a series of
observations or from an animal trajectory.  The function
<code>chooseseg</code> can be used to estimate the number of segments
building up the trajectory.  The function <code>findpath</code> can be used
to find the limits of the segments (see Details). 
</p>


<h3>Usage</h3>

<pre><code class="language-R">lavielle(x, ...)

## Default S3 method:
lavielle(x, Lmin, Kmax, ld = 1,
                           type = c("mean", "var", "meanvar"), ...) 

## S3 method for class 'ltraj'
lavielle(x, Lmin, Kmax, ld = 1, which = "dist",
                         type = c("mean", "var", "meanvar"), ...) 

## S3 method for class 'lavielle'
print(x, ...)

chooseseg(lav, S = 0.75, output = c("full","opt"),
          draw = TRUE)

findpath(lav, K, plotit = TRUE)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>for <code>lavielle.default</code>, a vector containing the
successive observations building up the series.  For
<code>lavielle.ltraj</code>, an object of class <code>ltraj</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lmin</code></td>
<td>
<p>an integer value indicating the minimum number of
observations in each segment.  Should be a multiple of <code>ld</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Kmax</code></td>
<td>
<p>an integer value indicating the maximum number of segments
expected in the series</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ld</code></td>
<td>
<p>an integer value indicating the resolution for the
calculation of the contrast function.  The contrast function will be
evaluated for segments containing the observations <code>c(1:ld)</code>,
<code>c(1:(2*ld))</code>, <code>c(1:(3*ld))</code>, and all segments will
necessarily contain a multiple of <code>ld</code> observations.  Note that
<code>ld</code> should be set to values greater than 1 if memory problem
occur</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>the type of contrast function to be used to segment the
series (see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>a character string giving any syntactically correct R
expression implying the descriptive elements in <code>x</code> or the
variables in the optional attribute <code>infolocs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lav</code></td>
<td>
<p>an object of class <code>"lavielle"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>a value indicating the threshold in the second derivative of
the contrast function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>type of output expected (see the section value)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw</code></td>
<td>
<p>a logical value indicating whether the decrease in the
contrast function should be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>The number of segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotit</code></td>
<td>
<p>a logical value indicating whether the segmentation should
be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed from or to other
functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The method of Lavielle (1999, 2005) per se finds the best segmentation
of a time series, given that it is built by <code>K</code> segments.  It
searches the segmentation for which a contrast function (measuring the
contrast between the actual series and the segmented series) is
minimized.  Different contrast functions are available measuring
different aspects of the variation of the series from one segment to
the next: when <code>type = "mean"</code>, we suppose that only
the mean of the segments varies between segments; when <code>type =
    "var"</code>, we suppose that only the variance of the segments varies
between segments; when <code>type = "meanvar"</code>, we suppose that both
the mean and the variance varies between segments.  It is required to
specify a value for the minimum number of observations <code>Lmin</code> in
a segment, as well as the maximum number of segments <code>Kmax</code> in
the series.
</p>
<p>There are several approaches to estimate the best number of segments
<code>K</code> to partition the time series.  One possible approach is
the graphical examination of the decrease of the contrast function
with the number of segments.  In theory, there should be a clear
"break" in the decrease of this function after the optimal value of
<code>K</code>.  Lavielle (2005) suggested an alternative way to estimate
automatically the optimal number of segments, also relying on the
presence of a "break" in the decrease of the contrast function.  He
proposed to choose the last value of <code>K</code> for which the second
derivative of a standardized constrast function is greater than a
threshold <code>S</code> (see Lavielle, 2005 for details).  Based on
numerical experiments, he proposed to choose the value <code>S =
  0.75</code>. Note, however, that for short time series (i.e. less than 500
observations) some simulations indicated that this value may not be
optimal and may depend on the value of <code>Kmax</code>, so that the
graphical method is maybe more appropriate.
</p>


<h3>Value</h3>

<p>The function <code>lavielle.default</code> returns a list of class
<code>lavielle</code>, with an attribute <code>"typeseg"</code> set to
<code>"default"</code>. This list contains the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>contmat</code></td>
<td>
<p>The contrast matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumcont</code></td>
<td>
<p>The optimal contrast</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matpath</code></td>
<td>
<p>The matrix of the paths from the first to the last
observation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Kmax</code></td>
<td>
<p>The maximum number of segments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lmin</code></td>
<td>
<p>The minimum number of observations in a segment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ld</code></td>
<td>
<p>the value of the resolution <code>ld</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>series</code></td>
<td>
<p>The time series</p>
</td>
</tr>
</table>
<p>The function <code>lavielle.ltraj</code> also returns a list of class
<code>lavielle</code>, with an attribute <code>"typeseg"</code> set to
<code>"ltraj"</code>. 
</p>
<p>The function <code>chooseseg</code> returns the optimal number of segments
when <code>output = "opt"</code>, and a dataframe containing the value of
the contrast function <code>Jk</code> and of the second derivative <code>D</code>
of the standardized contrast function for each possible value of
<code>K</code>, if <code>output = "full"</code>.
</p>
<p>The function <code>findpath</code> return a list containing vectors giving
the index of the first and last observations in each segment, when the
object of class <code>"lavielle"</code> passed as argument is characterized
by an attribute <code>"typeseg"</code> set to <code>"default"</code>.  When the
attribute <code>"typeseg"</code> is set to <code>"ltraj"</code>, this function
returns an object of class ltraj where each burst correspond to a
segment. 
</p>


<h3>Note</h3>

<p>The contrast matrix is a matrix of size <code>n*n</code> (with <code>n</code> the
number of observations in the series).  If <code>n</code> is large, memory
problems may occur.  In this case, setting <code>ld</code> to a value
greater than one will allow to reduce the size of this matrix (i.e. it
will be of size <code>k*k</code>, where <code>k = floor(n/ld)</code>).  However,
this will also reduce the resolution of the segmentation, so that the
segment limits will be less precisely estimated.
</p>


<h3>Author(s)</h3>

<p>Clement Calenge <a href="mailto:clement.calenge@ofb.gouv.fr">clement.calenge@ofb.gouv.fr</a>.  The code
is a C translation based on the Matlab code of M. Lavielle</p>


<h3>References</h3>

<p>Lavielle, M. (1999) Detection of multiple changes in a sequence of
dependent variables. <em>Stochastic Processes and their
Applications</em>, <b>83</b>: 79â€“102.
</p>
<p>Lavielle, M. (2005) Using penalized contrasts for the change-point
problem. Report number 5339, Institut national de recherche en
informatique et en automatique.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#################################################
##
## A simulated series

suppressWarnings(RNGversion("3.5.0"))
set.seed(129)
seri &lt;- c(rnorm(100), rnorm(100, mean=2),
          rnorm(100), rnorm(100, mean=-3),
          rnorm(100), rnorm(100, mean=2))
plot(seri, ty="l", xlab="time", ylab="Series")

## Segmentation:
(l &lt;- lavielle(seri, Lmin=10, Kmax=20))

## choose the number of segments
chooseseg(l)

## There is a clear break in the
## decrease of the contrast function after K = 6
## Moreover, Jk(6) &gt;&gt; 0.75 and Jk(7) &lt;&lt; 0.75
## We choose 6 segments:
fp &lt;- findpath(l, 6)
fp

## This list gives the limits of the segments
## for example, to get the first segment:
seg &lt;- 1
firstseg &lt;- seri[fp[[seg]][1]:fp[[seg]][2]]

####################################################
##
## Now, changes of variance

## A simulated series
suppressWarnings(RNGversion("3.5.0"))
set.seed(129)
seri &lt;- c(rnorm(100), rnorm(100, sd=2),
          rnorm(100), rnorm(100, sd=3),
          rnorm(100), rnorm(100, sd=2))
plot(seri, ty="l", xlab="time", ylab="Series")

## Segmentation:
(l &lt;- lavielle(seri, Lmin=10, Kmax=20, type="var"))

## choose the number of segments
chooseseg(l)

## There is a clear break in the
## decrease of the contrast function after K = 6
## Moreover, Jk(6) &gt;&gt; 0.75 and Jk(7) &lt;&lt; 0.75
## We choose 6 segments:
fp &lt;- findpath(l, 6)
fp

## This list gives the limits of the segments
## for example, to get the first segment:
seg &lt;- 1
firstseg &lt;- seri[fp[[seg]][1]:fp[[seg]][1]]

#################################################
##
## Example of segmentation of a trajectory

## Show the trajectory
data(porpoise)
gus &lt;- porpoise[1]
plot(gus)

## Show the changes in the distance between
## successive relocations with the time
plotltr(gus, "dist")

## Segmentation of the trajectory based on these distances
lav &lt;- lavielle(gus, Lmin=2, Kmax=20)

## Choose the number of segments
chooseseg(lav)
## 4 segments seem a good choice

## Show the partition
kk &lt;- findpath(lav, 4)
plot(kk)

</code></pre>


</div>